import e from"BsbiDb";import t from"jquery";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n,r){return c(e,t),s(n,"set"),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,n,r),r}function s(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function c(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}var l=function(){function e(){n(this,e),a(this,"route",null),a(this,"view",void 0),a(this,"title","untitled"),a(this,"handle",void 0),a(this,"app",void 0)}return o(e,[{key:"initialise",value:function(){this.view.initialise()}},{key:"registerRoute",value:function(e){if(null===this.route)throw new Error("No route set for '".concat(this.title,"' controller."));console.log({route:this.route}),e.on(this.route,this.routeHandler.bind(this),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null})}},{key:"routeHandler",value:function(e,t){}}],[{key:"nextHandle",get:function(){var t,n,r;return i(e,e,u,(r=u,c(n=e,e),s(r,"get"),1+(t=+function(e,t){return t.get?t.get.call(e):t.value}(n,r)))),t}}]),e}(),u={writable:!0,value:0},d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function f(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var h=function(e){return e&&e.Math==Math&&e},p=h("object"==typeof globalThis&&globalThis)||h("object"==typeof window&&window)||h("object"==typeof self&&self)||h("object"==typeof d&&d)||function(){return this}()||Function("return this")(),v={},S=function(e){try{return!!e()}catch(e){return!0}},y=!S((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),N={},m={}.propertyIsEnumerable,g=Object.getOwnPropertyDescriptor,b=g&&!m.call({1:2},1);N.f=b?function(e){var t=g(this,e);return!!t&&t.enumerable}:m;var T,E,w=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},_={}.toString,C=function(e){return _.call(e).slice(8,-1)},O=C,R="".split,I=S((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==O(e)?R.call(e,""):Object(e)}:Object,M=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},L=I,x=M,H=function(e){return L(x(e))},k=function(e){return"function"==typeof e},P=k,A=function(e){return"object"==typeof e?null!==e:P(e)},D=p,F=k,U=function(e){return F(e)?e:void 0},j=function(e,t){return arguments.length<2?U(D[e]):D[e]&&D[e][t]},J=j("navigator","userAgent")||"",B=p,Y=J,G=B.process,K=B.Deno,V=G&&G.versions||K&&K.version,X=V&&V.v8;X?E=(T=X.split("."))[0]<4?1:T[0]+T[1]:Y&&(!(T=Y.match(/Edge\/(\d+)/))||T[1]>=74)&&(T=Y.match(/Chrome\/(\d+)/))&&(E=T[1]);var q=E&&+E,Q=q,W=S,Z=!!Object.getOwnPropertySymbols&&!W((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Q&&Q<41})),z=Z&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ee=k,te=j,ne=z?function(e){return"symbol"==typeof e}:function(e){var t=te("Symbol");return ee(t)&&Object(e)instanceof t},re=function(e){try{return String(e)}catch(e){return"Object"}},oe=k,ae=re,ie=function(e){if(oe(e))return e;throw TypeError(ae(e)+" is not a function")},se=ie,ce=function(e,t){var n=e[t];return null==n?void 0:se(n)},le=k,ue=A,de={exports:{}},fe=p,he=function(e,t){try{Object.defineProperty(fe,e,{value:t,configurable:!0,writable:!0})}catch(n){fe[e]=t}return t},pe=he,ve=p["__core-js_shared__"]||pe("__core-js_shared__",{}),Se=ve;(de.exports=function(e,t){return Se[e]||(Se[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.18.2",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var ye=M,Ne=function(e){return Object(ye(e))},me=Ne,ge={}.hasOwnProperty,be=Object.hasOwn||function(e,t){return ge.call(me(e),t)},Te=0,Ee=Math.random(),we=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Te+Ee).toString(36)},_e=p,Ce=de.exports,Oe=be,Re=we,Ie=Z,Me=z,Le=Ce("wks"),xe=_e.Symbol,He=Me?xe:xe&&xe.withoutSetter||Re,ke=function(e){return Oe(Le,e)&&(Ie||"string"==typeof Le[e])||(Ie&&Oe(xe,e)?Le[e]=xe[e]:Le[e]=He("Symbol."+e)),Le[e]},Pe=A,Ae=ne,De=ce,Fe=function(e,t){var n,r;if("string"===t&&le(n=e.toString)&&!ue(r=n.call(e)))return r;if(le(n=e.valueOf)&&!ue(r=n.call(e)))return r;if("string"!==t&&le(n=e.toString)&&!ue(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Ue=ke("toPrimitive"),je=function(e,t){if(!Pe(e)||Ae(e))return e;var n,r=De(e,Ue);if(r){if(void 0===t&&(t="default"),n=r.call(e,t),!Pe(n)||Ae(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===t&&(t="number"),Fe(e,t)},Je=ne,Be=function(e){var t=je(e,"string");return Je(t)?t:String(t)},Ye=A,Ge=p.document,Ke=Ye(Ge)&&Ye(Ge.createElement),Ve=function(e){return Ke?Ge.createElement(e):{}},Xe=Ve,qe=!y&&!S((function(){return 7!=Object.defineProperty(Xe("div"),"a",{get:function(){return 7}}).a})),Qe=y,We=N,Ze=w,$e=H,ze=Be,et=be,tt=qe,nt=Object.getOwnPropertyDescriptor;v.f=Qe?nt:function(e,t){if(e=$e(e),t=ze(t),tt)try{return nt(e,t)}catch(e){}if(et(e,t))return Ze(!We.f.call(e,t),e[t])};var rt={},ot=A,at=function(e){if(ot(e))return e;throw TypeError(String(e)+" is not an object")},it=y,st=qe,ct=at,lt=Be,ut=Object.defineProperty;rt.f=it?ut:function(e,t,n){if(ct(e),t=lt(t),ct(n),st)try{return ut(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var dt=rt,ft=w,ht=y?function(e,t,n){return dt.f(e,t,ft(1,n))}:function(e,t,n){return e[t]=n,e},pt={exports:{}},vt=k,St=ve,yt=Function.toString;vt(St.inspectSource)||(St.inspectSource=function(e){return yt.call(e)});var Nt,mt,gt,bt=St.inspectSource,Tt=k,Et=bt,wt=p.WeakMap,_t=Tt(wt)&&/native code/.test(Et(wt)),Ct=de.exports,Ot=we,Rt=Ct("keys"),It=function(e){return Rt[e]||(Rt[e]=Ot(e))},Mt={},Lt=_t,xt=A,Ht=ht,kt=be,Pt=ve,At=It,Dt=Mt,Ft=p.WeakMap;if(Lt||Pt.state){var Ut=Pt.state||(Pt.state=new Ft),jt=Ut.get,Jt=Ut.has,Bt=Ut.set;Nt=function(e,t){if(Jt.call(Ut,e))throw new TypeError("Object already initialized");return t.facade=e,Bt.call(Ut,e,t),t},mt=function(e){return jt.call(Ut,e)||{}},gt=function(e){return Jt.call(Ut,e)}}else{var Yt=At("state");Dt[Yt]=!0,Nt=function(e,t){if(kt(e,Yt))throw new TypeError("Object already initialized");return t.facade=e,Ht(e,Yt,t),t},mt=function(e){return kt(e,Yt)?e[Yt]:{}},gt=function(e){return kt(e,Yt)}}var Gt={set:Nt,get:mt,has:gt,enforce:function(e){return gt(e)?mt(e):Nt(e,{})},getterFor:function(e){return function(t){var n;if(!xt(t)||(n=mt(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Kt=y,Vt=be,Xt=Function.prototype,qt=Kt&&Object.getOwnPropertyDescriptor,Qt=Vt(Xt,"name"),Wt={EXISTS:Qt,PROPER:Qt&&"something"===function(){}.name,CONFIGURABLE:Qt&&(!Kt||Kt&&qt(Xt,"name").configurable)},Zt=p,$t=k,zt=be,en=ht,tn=he,nn=bt,rn=Wt.CONFIGURABLE,on=Gt.get,an=Gt.enforce,sn=String(String).split("String");(pt.exports=function(e,t,n,r){var o,a=!!r&&!!r.unsafe,i=!!r&&!!r.enumerable,s=!!r&&!!r.noTargetGet,c=r&&void 0!==r.name?r.name:t;$t(n)&&("Symbol("===String(c).slice(0,7)&&(c="["+String(c).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!zt(n,"name")||rn&&n.name!==c)&&en(n,"name",c),(o=an(n)).source||(o.source=sn.join("string"==typeof c?c:""))),e!==Zt?(a?!s&&e[t]&&(i=!0):delete e[t],i?e[t]=n:en(e,t,n)):i?e[t]=n:tn(t,n)})(Function.prototype,"toString",(function(){return $t(this)&&on(this).source||nn(this)}));var cn={},ln=Math.ceil,un=Math.floor,dn=function(e){var t=+e;return t!=t||0===t?0:(t>0?un:ln)(t)},fn=dn,hn=Math.max,pn=Math.min,vn=function(e,t){var n=fn(e);return n<0?hn(n+t,0):pn(n,t)},Sn=dn,yn=Math.min,Nn=function(e){return e>0?yn(Sn(e),9007199254740991):0},mn=Nn,gn=function(e){return mn(e.length)},bn=H,Tn=vn,En=gn,wn=function(e){return function(t,n,r){var o,a=bn(t),i=En(a),s=Tn(r,i);if(e&&n!=n){for(;i>s;)if((o=a[s++])!=o)return!0}else for(;i>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},_n={includes:wn(!0),indexOf:wn(!1)},Cn=be,On=H,Rn=_n.indexOf,In=Mt,Mn=function(e,t){var n,r=On(e),o=0,a=[];for(n in r)!Cn(In,n)&&Cn(r,n)&&a.push(n);for(;t.length>o;)Cn(r,n=t[o++])&&(~Rn(a,n)||a.push(n));return a},Ln=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],xn=Mn,Hn=Ln.concat("length","prototype");cn.f=Object.getOwnPropertyNames||function(e){return xn(e,Hn)};var kn={};kn.f=Object.getOwnPropertySymbols;var Pn=cn,An=kn,Dn=at,Fn=j("Reflect","ownKeys")||function(e){var t=Pn.f(Dn(e)),n=An.f;return n?t.concat(n(e)):t},Un=be,jn=Fn,Jn=v,Bn=rt,Yn=function(e,t){for(var n=jn(t),r=Bn.f,o=Jn.f,a=0;a<n.length;a++){var i=n[a];Un(e,i)||r(e,i,o(t,i))}},Gn=S,Kn=k,Vn=/#|\.prototype\./,Xn=function(e,t){var n=Qn[qn(e)];return n==Zn||n!=Wn&&(Kn(t)?Gn(t):!!t)},qn=Xn.normalize=function(e){return String(e).replace(Vn,".").toLowerCase()},Qn=Xn.data={},Wn=Xn.NATIVE="N",Zn=Xn.POLYFILL="P",$n=Xn,zn=p,er=v.f,tr=ht,nr=pt.exports,rr=he,or=Yn,ar=$n,ir=function(e,t){var n,r,o,a,i,s=e.target,c=e.global,l=e.stat;if(n=c?zn:l?zn[s]||rr(s,{}):(zn[s]||{}).prototype)for(r in t){if(a=t[r],o=e.noTargetGet?(i=er(n,r))&&i.value:n[r],!ar(c?r:s+(l?".":"#")+r,e.forced)&&void 0!==o){if(typeof a==typeof o)continue;or(a,o)}(e.sham||o&&o.sham)&&tr(a,"sham",!0),nr(n,r,a,e)}},sr={};sr[ke("toStringTag")]="z";var cr,lr="[object z]"===String(sr),ur=lr,dr=k,fr=C,hr=ke("toStringTag"),pr="Arguments"==fr(function(){return arguments}()),vr=ur?fr:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),hr))?n:pr?fr(t):"Object"==(r=fr(t))&&dr(t.callee)?"Arguments":r},Sr=S,yr=k,Nr=vr,mr=bt,gr=[],br=j("Reflect","construct"),Tr=/^\s*(?:class|function)\b/,Er=Tr.exec,wr=!Tr.exec((function(){})),_r=function(e){if(!yr(e))return!1;try{return br(Object,gr,e),!0}catch(e){return!1}},Cr=!br||Sr((function(){var e;return _r(_r.call)||!_r(Object)||!_r((function(){e=!0}))||e}))?function(e){if(!yr(e))return!1;switch(Nr(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}return wr||!!Er.call(Tr,mr(e))}:_r,Or=Cr,Rr=re,Ir=function(e){if(Or(e))return e;throw TypeError(Rr(e)+" is not a constructor")},Mr=Mn,Lr=Ln,xr=Object.keys||function(e){return Mr(e,Lr)},Hr=rt,kr=at,Pr=xr,Ar=y?Object.defineProperties:function(e,t){kr(e);for(var n,r=Pr(t),o=r.length,a=0;o>a;)Hr.f(e,n=r[a++],t[n]);return e},Dr=j("document","documentElement"),Fr=at,Ur=Ar,jr=Ln,Jr=Mt,Br=Dr,Yr=Ve,Gr=It("IE_PROTO"),Kr=function(){},Vr=function(e){return"<script>"+e+"<\/script>"},Xr=function(e){e.write(Vr("")),e.close();var t=e.parentWindow.Object;return e=null,t},qr=function(){try{cr=new ActiveXObject("htmlfile")}catch(e){}var e,t;qr="undefined"!=typeof document?document.domain&&cr?Xr(cr):((t=Yr("iframe")).style.display="none",Br.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Vr("document.F=Object")),e.close(),e.F):Xr(cr);for(var n=jr.length;n--;)delete qr.prototype[jr[n]];return qr()};Jr[Gr]=!0;var Qr=Object.create||function(e,t){var n;return null!==e?(Kr.prototype=Fr(e),n=new Kr,Kr.prototype=null,n[Gr]=e):n=qr(),void 0===t?n:Ur(n,t)},Wr=ie,Zr=A,$r=[].slice,zr={},eo=function(e,t,n){if(!(t in zr)){for(var r=[],o=0;o<t;o++)r[o]="a["+o+"]";zr[t]=Function("C,a","return new C("+r.join(",")+")")}return zr[t](e,n)},to=Function.bind||function(e){var t=Wr(this),n=$r.call(arguments,1),r=function(){var o=n.concat($r.call(arguments));return this instanceof r?eo(t,o.length,o):t.apply(e,o)};return Zr(t.prototype)&&(r.prototype=t.prototype),r},no=ir,ro=Ir,oo=at,ao=A,io=Qr,so=to,co=S,lo=j("Reflect","construct"),uo=co((function(){function e(){}return!(lo((function(){}),[],e)instanceof e)})),fo=!co((function(){lo((function(){}))})),ho=uo||fo;function po(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vo(e,t){return(vo=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function So(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&vo(e,t)}function yo(e){return(yo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function No(e,t){if(t&&("object"===yo(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return po(e)}function mo(e){return(mo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function go(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function bo(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,go(e,t,"set"),n),n}function To(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,go(e,t,"get"))}no({target:"Reflect",stat:!0,forced:ho,sham:ho},{construct:function(e,t){ro(e),oo(t);var n=arguments.length<3?e:ro(arguments[2]);if(fo&&!uo)return lo(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(so.apply(e,r))}var o=n.prototype,a=io(ao(o)?o:Object.prototype),i=Function.apply.call(e,a,t);return ao(i)?i:a}});var Eo=Qr,wo=rt,_o=ke("unscopables"),Co=Array.prototype;null==Co[_o]&&wo.f(Co,_o,{configurable:!0,value:Eo(null)});var Oo,Ro,Io,Mo=function(e){Co[_o][e]=!0},Lo={},xo=!S((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Ho=be,ko=k,Po=Ne,Ao=xo,Do=It("IE_PROTO"),Fo=Object.prototype,Uo=Ao?Object.getPrototypeOf:function(e){var t=Po(e);if(Ho(t,Do))return t[Do];var n=t.constructor;return ko(n)&&t instanceof n?n.prototype:t instanceof Object?Fo:null},jo=S,Jo=k,Bo=Uo,Yo=pt.exports,Go=ke("iterator"),Ko=!1;[].keys&&("next"in(Io=[].keys())?(Ro=Bo(Bo(Io)))!==Object.prototype&&(Oo=Ro):Ko=!0),(null==Oo||jo((function(){var e={};return Oo[Go].call(e)!==e})))&&(Oo={}),Jo(Oo[Go])||Yo(Oo,Go,(function(){return this}));var Vo={IteratorPrototype:Oo,BUGGY_SAFARI_ITERATORS:Ko},Xo=rt.f,qo=be,Qo=ke("toStringTag"),Wo=function(e,t,n){e&&!qo(e=n?e:e.prototype,Qo)&&Xo(e,Qo,{configurable:!0,value:t})},Zo=Vo.IteratorPrototype,$o=Qr,zo=w,ea=Wo,ta=Lo,na=function(){return this},ra=function(e,t,n){var r=t+" Iterator";return e.prototype=$o(Zo,{next:zo(1,n)}),ea(e,r,!1),ta[r]=na,e},oa=k,aa=at,ia=function(e){if("object"==typeof e||oa(e))return e;throw TypeError("Can't set "+String(e)+" as a prototype")},sa=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return aa(n),ia(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),ca=ir,la=Wt,ua=k,da=ra,fa=Uo,ha=sa,pa=Wo,va=ht,Sa=pt.exports,ya=Lo,Na=la.PROPER,ma=la.CONFIGURABLE,ga=Vo.IteratorPrototype,ba=Vo.BUGGY_SAFARI_ITERATORS,Ta=ke("iterator"),Ea=function(){return this},wa=function(e,t,n,r,o,a,i){da(n,t,r);var s,c,l,u=function(e){if(e===o&&v)return v;if(!ba&&e in h)return h[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",f=!1,h=e.prototype,p=h[Ta]||h["@@iterator"]||o&&h[o],v=!ba&&p||u(o),S="Array"==t&&h.entries||p;if(S&&(s=fa(S.call(new e)))!==Object.prototype&&s.next&&(fa(s)!==ga&&(ha?ha(s,ga):ua(s[Ta])||Sa(s,Ta,Ea)),pa(s,d,!0)),Na&&"values"==o&&p&&"values"!==p.name&&(ma?va(h,"name","values"):(f=!0,v=function(){return p.call(this)})),o)if(c={values:u("values"),keys:a?v:u("keys"),entries:u("entries")},i)for(l in c)(ba||f||!(l in h))&&Sa(h,l,c[l]);else ca({target:t,proto:!0,forced:ba||f},c);return h[Ta]!==v&&Sa(h,Ta,v,{name:o}),ya[t]=v,c},_a=H,Ca=Mo,Oa=Lo,Ra=Gt,Ia=wa,Ma=Ra.set,La=Ra.getterFor("Array Iterator"),xa=Ia(Array,"Array",(function(e,t){Ma(this,{type:"Array Iterator",target:_a(e),index:0,kind:t})}),(function(){var e=La(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Oa.Arguments=Oa.Array,Ca("keys"),Ca("values"),Ca("entries");var Ha=vr,ka=lr?{}.toString:function(){return"[object "+Ha(this)+"]"},Pa=lr,Aa=pt.exports,Da=ka;Pa||Aa(Object.prototype,"toString",Da,{unsafe:!0});var Fa=vr,Ua=function(e){if("Symbol"===Fa(e))throw TypeError("Cannot convert a Symbol value to a string");return String(e)},ja=dn,Ja=Ua,Ba=M,Ya=function(e){return function(t,n){var r,o,a=Ja(Ba(t)),i=ja(n),s=a.length;return i<0||i>=s?e?"":void 0:(r=a.charCodeAt(i))<55296||r>56319||i+1===s||(o=a.charCodeAt(i+1))<56320||o>57343?e?a.charAt(i):r:e?a.slice(i,i+2):o-56320+(r-55296<<10)+65536}},Ga={codeAt:Ya(!1),charAt:Ya(!0)},Ka=Ga.charAt,Va=Ua,Xa=Gt,qa=wa,Qa=Xa.set,Wa=Xa.getterFor("String Iterator");qa(String,"String",(function(e){Qa(this,{type:"String Iterator",string:Va(e),index:0})}),(function(){var e,t=Wa(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Ka(n,r),t.index+=e.length,{value:e,done:!1})}));var Za=pt.exports,$a=function(e,t,n){for(var r in t)Za(e,r,t[r],n);return e},za={exports:{}},ei={},ti=H,ni=cn.f,ri={}.toString,oi="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];ei.f=function(e){return oi&&"[object Window]"==ri.call(e)?function(e){try{return ni(e)}catch(e){return oi.slice()}}(e):ni(ti(e))};var ai=!S((function(){return Object.isExtensible(Object.preventExtensions({}))})),ii=ir,si=Mt,ci=A,li=be,ui=rt.f,di=cn,fi=ei,hi=ai,pi=!1,vi=we("meta"),Si=0,yi=Object.isExtensible||function(){return!0},Ni=function(e){ui(e,vi,{value:{objectID:"O"+Si++,weakData:{}}})},mi=za.exports={enable:function(){mi.enable=function(){},pi=!0;var e=di.f,t=[].splice,n={};n[vi]=1,e(n).length&&(di.f=function(n){for(var r=e(n),o=0,a=r.length;o<a;o++)if(r[o]===vi){t.call(r,o,1);break}return r},ii({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:fi.f}))},fastKey:function(e,t){if(!ci(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!li(e,vi)){if(!yi(e))return"F";if(!t)return"E";Ni(e)}return e[vi].objectID},getWeakData:function(e,t){if(!li(e,vi)){if(!yi(e))return!0;if(!t)return!1;Ni(e)}return e[vi].weakData},onFreeze:function(e){return hi&&pi&&yi(e)&&!li(e,vi)&&Ni(e),e}};si[vi]=!0;var gi=Lo,bi=ke("iterator"),Ti=Array.prototype,Ei=function(e){return void 0!==e&&(gi.Array===e||Ti[bi]===e)},wi=ie,_i=function(e,t,n){if(wi(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}},Ci=vr,Oi=ce,Ri=Lo,Ii=ke("iterator"),Mi=function(e){if(null!=e)return Oi(e,Ii)||Oi(e,"@@iterator")||Ri[Ci(e)]},Li=ie,xi=at,Hi=Mi,ki=function(e,t){var n=arguments.length<2?Hi(e):t;if(Li(n))return xi(n.call(e));throw TypeError(String(e)+" is not iterable")},Pi=at,Ai=ce,Di=function(e,t,n){var r,o;Pi(e);try{if(!(r=Ai(e,"return"))){if("throw"===t)throw n;return n}r=r.call(e)}catch(e){o=!0,r=e}if("throw"===t)throw n;if(o)throw r;return Pi(r),n},Fi=at,Ui=Ei,ji=gn,Ji=_i,Bi=ki,Yi=Mi,Gi=Di,Ki=function(e,t){this.stopped=e,this.result=t},Vi=function(e,t,n){var r,o,a,i,s,c,l,u=n&&n.that,d=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_ITERATOR),h=!(!n||!n.INTERRUPTED),p=Ji(t,u,1+d+h),v=function(e){return r&&Gi(r,"normal",e),new Ki(!0,e)},S=function(e){return d?(Fi(e),h?p(e[0],e[1],v):p(e[0],e[1])):h?p(e,v):p(e)};if(f)r=e;else{if(!(o=Yi(e)))throw TypeError(String(e)+" is not iterable");if(Ui(o)){for(a=0,i=ji(e);i>a;a++)if((s=S(e[a]))&&s instanceof Ki)return s;return new Ki(!1)}r=Bi(e,o)}for(c=r.next;!(l=c.call(r)).done;){try{s=S(l.value)}catch(e){Gi(r,"throw",e)}if("object"==typeof s&&s&&s instanceof Ki)return s}return new Ki(!1)},Xi=function(e,t,n){if(e instanceof t)return e;throw TypeError("Incorrect "+(n?n+" ":"")+"invocation")},qi=ke("iterator"),Qi=!1;try{var Wi=0,Zi={next:function(){return{done:!!Wi++}},return:function(){Qi=!0}};Zi[qi]=function(){return this},Array.from(Zi,(function(){throw 2}))}catch(e){}var $i=function(e,t){if(!t&&!Qi)return!1;var n=!1;try{var r={};r[qi]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},zi=k,es=A,ts=sa,ns=function(e,t,n){var r,o;return ts&&zi(r=t.constructor)&&r!==n&&es(o=r.prototype)&&o!==n.prototype&&ts(e,o),e},rs=ir,os=p,as=$n,is=pt.exports,ss=za.exports,cs=Vi,ls=Xi,us=k,ds=A,fs=S,hs=$i,ps=Wo,vs=ns,Ss=function(e,t,n){var r=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),a=r?"set":"add",i=os[e],s=i&&i.prototype,c=i,l={},u=function(e){var t=s[e];is(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(o&&!ds(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!ds(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!ds(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(as(e,!us(i)||!(o||s.forEach&&!fs((function(){(new i).entries().next()})))))c=n.getConstructor(t,e,r,a),ss.enable();else if(as(e,!0)){var d=new c,f=d[a](o?{}:-0,1)!=d,h=fs((function(){d.has(1)})),p=hs((function(e){new i(e)})),v=!o&&fs((function(){for(var e=new i,t=5;t--;)e[a](t,t);return!e.has(-0)}));p||((c=t((function(t,n){ls(t,c,e);var o=vs(new i,t,c);return null!=n&&cs(n,o[a],{that:o,AS_ENTRIES:r}),o}))).prototype=s,s.constructor=c),(h||v)&&(u("delete"),u("has"),r&&u("get")),(v||f)&&u(a),o&&s.clear&&delete s.clear}return l[e]=c,rs({global:!0,forced:c!=i},l),ps(c,e),o||n.setStrong(c,e,r),c},ys=C,Ns=Array.isArray||function(e){return"Array"==ys(e)},ms=Ns,gs=Cr,bs=A,Ts=ke("species"),Es=function(e){var t;return ms(e)&&(t=e.constructor,(gs(t)&&(t===Array||ms(t.prototype))||bs(t)&&null===(t=t[Ts]))&&(t=void 0)),void 0===t?Array:t},ws=function(e,t){return new(Es(e))(0===t?0:t)},_s=_i,Cs=I,Os=Ne,Rs=gn,Is=ws,Ms=[].push,Ls=function(e){var t=1==e,n=2==e,r=3==e,o=4==e,a=6==e,i=7==e,s=5==e||a;return function(c,l,u,d){for(var f,h,p=Os(c),v=Cs(p),S=_s(l,u,3),y=Rs(v),N=0,m=d||Is,g=t?m(c,y):n||i?m(c,0):void 0;y>N;N++)if((s||N in v)&&(h=S(f=v[N],N,p),e))if(t)g[N]=h;else if(h)switch(e){case 3:return!0;case 5:return f;case 6:return N;case 2:Ms.call(g,f)}else switch(e){case 4:return!1;case 7:Ms.call(g,f)}return a?-1:r||o?o:g}},xs={forEach:Ls(0),map:Ls(1),filter:Ls(2),some:Ls(3),every:Ls(4),find:Ls(5),findIndex:Ls(6),filterReject:Ls(7)},Hs=$a,ks=za.exports.getWeakData,Ps=at,As=A,Ds=Xi,Fs=Vi,Us=be,js=Gt.set,Js=Gt.getterFor,Bs=xs.find,Ys=xs.findIndex,Gs=0,Ks=function(e){return e.frozen||(e.frozen=new Vs)},Vs=function(){this.entries=[]},Xs=function(e,t){return Bs(e.entries,(function(e){return e[0]===t}))};Vs.prototype={get:function(e){var t=Xs(this,e);if(t)return t[1]},has:function(e){return!!Xs(this,e)},set:function(e,t){var n=Xs(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=Ys(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}};var qs,Qs={getConstructor:function(e,t,n,r){var o=e((function(e,a){Ds(e,o,t),js(e,{type:t,id:Gs++,frozen:void 0}),null!=a&&Fs(a,e[r],{that:e,AS_ENTRIES:n})})),a=Js(t),i=function(e,t,n){var r=a(e),o=ks(Ps(t),!0);return!0===o?Ks(r).set(t,n):o[r.id]=n,e};return Hs(o.prototype,{delete:function(e){var t=a(this);if(!As(e))return!1;var n=ks(e);return!0===n?Ks(t).delete(e):n&&Us(n,t.id)&&delete n[t.id]},has:function(e){var t=a(this);if(!As(e))return!1;var n=ks(e);return!0===n?Ks(t).has(e):n&&Us(n,t.id)}}),Hs(o.prototype,n?{get:function(e){var t=a(this);if(As(e)){var n=ks(e);return!0===n?Ks(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return i(this,e,t)}}:{add:function(e){return i(this,e,!0)}}),o}},Ws=p,Zs=$a,$s=za.exports,zs=Ss,ec=Qs,tc=A,nc=Gt.enforce,rc=_t,oc=!Ws.ActiveXObject&&"ActiveXObject"in Ws,ac=Object.isExtensible,ic=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},sc=zs("WeakMap",ic,ec);if(rc&&oc){qs=ec.getConstructor(ic,"WeakMap",!0),$s.enable();var cc=sc.prototype,lc=cc.delete,uc=cc.has,dc=cc.get,fc=cc.set;Zs(cc,{delete:function(e){if(tc(e)&&!ac(e)){var t=nc(this);return t.frozen||(t.frozen=new qs),lc.call(this,e)||t.frozen.delete(e)}return lc.call(this,e)},has:function(e){if(tc(e)&&!ac(e)){var t=nc(this);return t.frozen||(t.frozen=new qs),uc.call(this,e)||t.frozen.has(e)}return uc.call(this,e)},get:function(e){if(tc(e)&&!ac(e)){var t=nc(this);return t.frozen||(t.frozen=new qs),uc.call(this,e)?dc.call(this,e):t.frozen.get(e)}return dc.call(this,e)},set:function(e,t){if(tc(e)&&!ac(e)){var n=nc(this);n.frozen||(n.frozen=new qs),uc.call(this,e)?fc.call(this,e,t):n.frozen.set(e,t)}else fc.call(this,e,t);return this}})}var hc={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},pc=Ve("span").classList,vc=pc&&pc.constructor&&pc.constructor.prototype,Sc=vc===Object.prototype?void 0:vc,yc=p,Nc=hc,mc=Sc,gc=xa,bc=ht,Tc=ke,Ec=Tc("iterator"),wc=Tc("toStringTag"),_c=gc.values,Cc=function(e,t){if(e){if(e[Ec]!==_c)try{bc(e,Ec,_c)}catch(t){e[Ec]=_c}if(e[wc]||bc(e,wc,t),Nc[t])for(var n in gc)if(e[n]!==gc[n])try{bc(e,n,gc[n])}catch(t){e[n]=gc[n]}}};for(var Oc in Nc)Cc(yc[Oc]&&yc[Oc].prototype,Oc);function Rc(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Ic(e,t,n){return(Ic=Rc()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&vo(o,n.prototype),o}).apply(null,arguments)}function Mc(e){var t="function"==typeof Map?new Map:void 0;return(Mc=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return Ic(e,arguments,mo(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),vo(r,e)})(e)}function Lc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}Cc(mc,"DOMTokenList");var xc=function(e){So(r,Mc(Error));var t=Lc(r);function r(e){return n(this,r),t.call(this,e)}return r}();function Hc(e,t,n){return(Hc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=mo(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(n):o.value}})(e,t,n||e)}var kc=Be,Pc=rt,Ac=w,Dc=function(e,t,n){var r=kc(t);r in e?Pc.f(e,r,Ac(0,n)):e[r]=n},Fc=S,Uc=q,jc=ke("species"),Jc=function(e){return Uc>=51||!Fc((function(){var t=[];return(t.constructor={})[jc]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Bc=ir,Yc=S,Gc=Ns,Kc=A,Vc=Ne,Xc=gn,qc=Dc,Qc=ws,Wc=Jc,Zc=q,$c=ke("isConcatSpreadable"),zc=Zc>=51||!Yc((function(){var e=[];return e[$c]=!1,e.concat()[0]!==e})),el=Wc("concat"),tl=function(e){if(!Kc(e))return!1;var t=e[$c];return void 0!==t?!!t:Gc(e)};Bc({target:"Array",proto:!0,forced:!zc||!el},{concat:function(e){var t,n,r,o,a,i=Vc(this),s=Qc(i,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(tl(a=-1===t?i:arguments[t])){if(c+(o=Xc(a))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,c++)n in a&&qc(s,c,a[n])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");qc(s,c++,a)}return s.length=c,s}});var nl=at,rl=function(){var e=nl(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},ol=Wt.PROPER,al=pt.exports,il=at,sl=Ua,cl=S,ll=rl,ul=RegExp.prototype,dl=ul.toString,fl=cl((function(){return"/a/b"!=dl.call({source:"a",flags:"b"})})),hl=ol&&"toString"!=dl.name;(fl||hl)&&al(RegExp.prototype,"toString",(function(){var e=il(this),t=sl(e.source),n=e.flags;return"/"+t+"/"+sl(void 0===n&&e instanceof RegExp&&!("flags"in ul)?ll.call(e):n)}),{unsafe:!0});var pl,vl,Sl,yl,Nl=p.Promise,ml=j,gl=rt,bl=y,Tl=ke("species"),El=function(e){var t=ml(e),n=gl.f;bl&&t&&!t[Tl]&&n(t,Tl,{configurable:!0,get:function(){return this}})},wl=at,_l=Ir,Cl=ke("species"),Ol=function(e,t){var n,r=wl(e).constructor;return void 0===r||null==(n=wl(r)[Cl])?t:_l(n)},Rl=/(?:ipad|iphone|ipod).*applewebkit/i.test(J),Il="process"==C(p.process),Ml=p,Ll=k,xl=S,Hl=_i,kl=Dr,Pl=Ve,Al=Rl,Dl=Il,Fl=Ml.setImmediate,Ul=Ml.clearImmediate,jl=Ml.process,Jl=Ml.MessageChannel,Bl=Ml.Dispatch,Yl=0,Gl={};try{pl=Ml.location}catch(e){}var Kl=function(e){if(Gl.hasOwnProperty(e)){var t=Gl[e];delete Gl[e],t()}},Vl=function(e){return function(){Kl(e)}},Xl=function(e){Kl(e.data)},ql=function(e){Ml.postMessage(String(e),pl.protocol+"//"+pl.host)};Fl&&Ul||(Fl=function(e){for(var t=[],n=arguments.length,r=1;n>r;)t.push(arguments[r++]);return Gl[++Yl]=function(){(Ll(e)?e:Function(e)).apply(void 0,t)},vl(Yl),Yl},Ul=function(e){delete Gl[e]},Dl?vl=function(e){jl.nextTick(Vl(e))}:Bl&&Bl.now?vl=function(e){Bl.now(Vl(e))}:Jl&&!Al?(yl=(Sl=new Jl).port2,Sl.port1.onmessage=Xl,vl=Hl(yl.postMessage,yl,1)):Ml.addEventListener&&Ll(Ml.postMessage)&&!Ml.importScripts&&pl&&"file:"!==pl.protocol&&!xl(ql)?(vl=ql,Ml.addEventListener("message",Xl,!1)):vl="onreadystatechange"in Pl("script")?function(e){kl.appendChild(Pl("script")).onreadystatechange=function(){kl.removeChild(this),Kl(e)}}:function(e){setTimeout(Vl(e),0)});var Ql,Wl,Zl,$l,zl,eu,tu,nu,ru={set:Fl,clear:Ul},ou=p,au=/ipad|iphone|ipod/i.test(J)&&void 0!==ou.Pebble,iu=/web0s(?!.*chrome)/i.test(J),su=p,cu=v.f,lu=ru.set,uu=Rl,du=au,fu=iu,hu=Il,pu=su.MutationObserver||su.WebKitMutationObserver,vu=su.document,Su=su.process,yu=su.Promise,Nu=cu(su,"queueMicrotask"),mu=Nu&&Nu.value;mu||(Ql=function(){var e,t;for(hu&&(e=Su.domain)&&e.exit();Wl;){t=Wl.fn,Wl=Wl.next;try{t()}catch(e){throw Wl?$l():Zl=void 0,e}}Zl=void 0,e&&e.enter()},uu||hu||fu||!pu||!vu?!du&&yu&&yu.resolve?((tu=yu.resolve(void 0)).constructor=yu,nu=tu.then,$l=function(){nu.call(tu,Ql)}):$l=hu?function(){Su.nextTick(Ql)}:function(){lu.call(su,Ql)}:(zl=!0,eu=vu.createTextNode(""),new pu(Ql).observe(eu,{characterData:!0}),$l=function(){eu.data=zl=!zl}));var gu=mu||function(e){var t={fn:e,next:void 0};Zl&&(Zl.next=t),Wl||(Wl=t,$l()),Zl=t},bu={},Tu=ie,Eu=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Tu(t),this.reject=Tu(n)};bu.f=function(e){return new Eu(e)};var wu,_u,Cu,Ou,Ru=at,Iu=A,Mu=bu,Lu=function(e,t){if(Ru(e),Iu(t)&&t.constructor===e)return t;var n=Mu.f(e);return(0,n.resolve)(t),n.promise},xu=p,Hu="object"==typeof window,ku=ir,Pu=p,Au=j,Du=Nl,Fu=pt.exports,Uu=$a,ju=sa,Ju=Wo,Bu=El,Yu=ie,Gu=k,Ku=A,Vu=Xi,Xu=bt,qu=Vi,Qu=$i,Wu=Ol,Zu=ru.set,$u=gu,zu=Lu,ed=function(e,t){var n=xu.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},td=bu,nd=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},rd=Gt,od=$n,ad=Hu,id=Il,sd=q,cd=ke("species"),ld="Promise",ud=rd.get,dd=rd.set,fd=rd.getterFor(ld),hd=Du&&Du.prototype,pd=Du,vd=hd,Sd=Pu.TypeError,yd=Pu.document,Nd=Pu.process,md=td.f,gd=md,bd=!!(yd&&yd.createEvent&&Pu.dispatchEvent),Td=Gu(Pu.PromiseRejectionEvent),Ed=!1,wd=od(ld,(function(){var e=Xu(pd),t=e!==String(pd);if(!t&&66===sd)return!0;if(sd>=51&&/native code/.test(e))return!1;var n=new pd((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[cd]=r,!(Ed=n.then((function(){}))instanceof r)||!t&&ad&&!Td})),_d=wd||!Qu((function(e){pd.all(e).catch((function(){}))})),Cd=function(e){var t;return!(!Ku(e)||!Gu(t=e.then))&&t},Od=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;$u((function(){for(var r=e.value,o=1==e.state,a=0;n.length>a;){var i,s,c,l=n[a++],u=o?l.ok:l.fail,d=l.resolve,f=l.reject,h=l.domain;try{u?(o||(2===e.rejection&&Ld(e),e.rejection=1),!0===u?i=r:(h&&h.enter(),i=u(r),h&&(h.exit(),c=!0)),i===l.promise?f(Sd("Promise-chain cycle")):(s=Cd(i))?s.call(i,d,f):d(i)):f(r)}catch(e){h&&!c&&h.exit(),f(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Id(e)}))}},Rd=function(e,t,n){var r,o;bd?((r=yd.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),Pu.dispatchEvent(r)):r={promise:t,reason:n},!Td&&(o=Pu["on"+e])?o(r):"unhandledrejection"===e&&ed("Unhandled promise rejection",n)},Id=function(e){Zu.call(Pu,(function(){var t,n=e.facade,r=e.value;if(Md(e)&&(t=nd((function(){id?Nd.emit("unhandledRejection",r,n):Rd("unhandledrejection",n,r)})),e.rejection=id||Md(e)?2:1,t.error))throw t.value}))},Md=function(e){return 1!==e.rejection&&!e.parent},Ld=function(e){Zu.call(Pu,(function(){var t=e.facade;id?Nd.emit("rejectionHandled",t):Rd("rejectionhandled",t,e.value)}))},xd=function(e,t,n){return function(r){e(t,r,n)}},Hd=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Od(e,!0))},kd=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Sd("Promise can't be resolved itself");var r=Cd(t);r?$u((function(){var n={done:!1};try{r.call(t,xd(kd,n,e),xd(Hd,n,e))}catch(t){Hd(n,t,e)}})):(e.value=t,e.state=1,Od(e,!1))}catch(t){Hd({done:!1},t,e)}}};if(wd&&(vd=(pd=function(e){Vu(this,pd,ld),Yu(e),wu.call(this);var t=ud(this);try{e(xd(kd,t),xd(Hd,t))}catch(e){Hd(t,e)}}).prototype,(wu=function(e){dd(this,{type:ld,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=Uu(vd,{then:function(e,t){var n=fd(this),r=md(Wu(this,pd));return r.ok=!Gu(e)||e,r.fail=Gu(t)&&t,r.domain=id?Nd.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&Od(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),_u=function(){var e=new wu,t=ud(e);this.promise=e,this.resolve=xd(kd,t),this.reject=xd(Hd,t)},td.f=md=function(e){return e===pd||e===Cu?new _u(e):gd(e)},Gu(Du)&&hd!==Object.prototype)){Ou=hd.then,Ed||(Fu(hd,"then",(function(e,t){var n=this;return new pd((function(e,t){Ou.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Fu(hd,"catch",vd.catch,{unsafe:!0}));try{delete hd.constructor}catch(e){}ju&&ju(hd,vd)}ku({global:!0,wrap:!0,forced:wd},{Promise:pd}),Ju(pd,ld,!1),Bu(ld),Cu=Au(ld),ku({target:ld,stat:!0,forced:wd},{reject:function(e){var t=md(this);return t.reject.call(void 0,e),t.promise}}),ku({target:ld,stat:!0,forced:wd},{resolve:function(e){return zu(this,e)}}),ku({target:ld,stat:!0,forced:_d},{all:function(e){var t=this,n=md(t),r=n.resolve,o=n.reject,a=nd((function(){var n=Yu(t.resolve),a=[],i=0,s=1;qu(e,(function(e){var c=i++,l=!1;a.push(void 0),s++,n.call(t,e).then((function(e){l||(l=!0,a[c]=e,--s||r(a))}),o)})),--s||r(a)}));return a.error&&o(a.value),n.promise},race:function(e){var t=this,n=md(t),r=n.reject,o=nd((function(){var o=Yu(t.resolve);qu(e,(function(e){o.call(t,e).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}});var Pd={},Ad=S,Dd=p.RegExp;Pd.UNSUPPORTED_Y=Ad((function(){var e=Dd("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),Pd.BROKEN_CARET=Ad((function(){var e=Dd("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var Fd=S,Ud=p.RegExp,jd=Fd((function(){var e=Ud(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Jd=S,Bd=p.RegExp,Yd=Jd((function(){var e=Bd("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Gd=Ua,Kd=rl,Vd=Pd,Xd=de.exports,qd=Qr,Qd=Gt.get,Wd=jd,Zd=Yd,$d=RegExp.prototype.exec,zd=Xd("native-string-replace",String.prototype.replace),ef=$d,tf=function(){var e=/a/,t=/b*/g;return $d.call(e,"a"),$d.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),nf=Vd.UNSUPPORTED_Y||Vd.BROKEN_CARET,rf=void 0!==/()??/.exec("")[1];(tf||rf||nf||Wd||Zd)&&(ef=function(e){var t,n,r,o,a,i,s,c=this,l=Qd(c),u=Gd(e),d=l.raw;if(d)return d.lastIndex=c.lastIndex,t=ef.call(d,u),c.lastIndex=d.lastIndex,t;var f=l.groups,h=nf&&c.sticky,p=Kd.call(c),v=c.source,S=0,y=u;if(h&&(-1===(p=p.replace("y","")).indexOf("g")&&(p+="g"),y=u.slice(c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==u.charAt(c.lastIndex-1))&&(v="(?: "+v+")",y=" "+y,S++),n=new RegExp("^(?:"+v+")",p)),rf&&(n=new RegExp("^"+v+"$(?!\\s)",p)),tf&&(r=c.lastIndex),o=$d.call(h?n:c,y),h?o?(o.input=o.input.slice(S),o[0]=o[0].slice(S),o.index=c.lastIndex,c.lastIndex+=o[0].length):c.lastIndex=0:tf&&o&&(c.lastIndex=c.global?o.index+o[0].length:r),rf&&o&&o.length>1&&zd.call(o[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(o[a]=void 0)})),o&&f)for(o.groups=i=qd(null),a=0;a<f.length;a++)i[(s=f[a])[0]]=o[s[1]];return o});var of=ef;ir({target:"RegExp",proto:!0,forced:/./.exec!==of},{exec:of});var af=pt.exports,sf=of,cf=S,lf=ke,uf=ht,df=lf("species"),ff=RegExp.prototype,hf=function(e,t,n,r){var o=lf(e),a=!cf((function(){var t={};return t[o]=function(){return 7},7!=""[e](t)})),i=a&&!cf((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[df]=function(){return n},n.flags="",n[o]=/./[o]),n.exec=function(){return t=!0,null},n[o](""),!t}));if(!a||!i||n){var s=/./[o],c=t(o,""[e],(function(e,t,n,r,o){var i=t.exec;return i===sf||i===ff.exec?a&&!o?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}));af(String.prototype,e,c[0]),af(ff,o,c[1])}r&&uf(ff[o],"sham",!0)},pf=Ga.charAt,vf=function(e,t,n){return t+(n?pf(e,t).length:1)},Sf=Ne,yf=Math.floor,Nf="".replace,mf=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,gf=/\$([$&'`]|\d{1,2})/g,bf=at,Tf=k,Ef=C,wf=of,_f=function(e,t){var n=e.exec;if(Tf(n)){var r=n.call(e,t);return null!==r&&bf(r),r}if("RegExp"===Ef(e))return wf.call(e,t);throw TypeError("RegExp#exec called on incompatible receiver")},Cf=hf,Of=S,Rf=at,If=k,Mf=dn,Lf=Nn,xf=Ua,Hf=M,kf=vf,Pf=ce,Af=function(e,t,n,r,o,a){var i=n+e.length,s=r.length,c=gf;return void 0!==o&&(o=Sf(o),c=mf),Nf.call(a,c,(function(a,c){var l;switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(i);case"<":l=o[c.slice(1,-1)];break;default:var u=+c;if(0===u)return a;if(u>s){var d=yf(u/10);return 0===d?a:d<=s?void 0===r[d-1]?c.charAt(1):r[d-1]+c.charAt(1):a}l=r[u-1]}return void 0===l?"":l}))},Df=_f,Ff=ke("replace"),Uf=Math.max,jf=Math.min,Jf="$0"==="a".replace(/./,"$0"),Bf=!!/./[Ff]&&""===/./[Ff]("a","$0");Cf("replace",(function(e,t,n){var r=Bf?"$":"$0";return[function(e,n){var r=Hf(this),o=null==e?void 0:Pf(e,Ff);return o?o.call(e,r,n):t.call(xf(r),e,n)},function(e,o){var a=Rf(this),i=xf(e);if("string"==typeof o&&-1===o.indexOf(r)&&-1===o.indexOf("$<")){var s=n(t,a,i,o);if(s.done)return s.value}var c=If(o);c||(o=xf(o));var l=a.global;if(l){var u=a.unicode;a.lastIndex=0}for(var d=[];;){var f=Df(a,i);if(null===f)break;if(d.push(f),!l)break;""===xf(f[0])&&(a.lastIndex=kf(i,Lf(a.lastIndex),u))}for(var h,p="",v=0,S=0;S<d.length;S++){f=d[S];for(var y=xf(f[0]),N=Uf(jf(Mf(f.index),i.length),0),m=[],g=1;g<f.length;g++)m.push(void 0===(h=f[g])?h:String(h));var b=f.groups;if(c){var T=[y].concat(m,N,i);void 0!==b&&T.push(b);var E=xf(o.apply(void 0,T))}else E=Af(y,i,N,m,b,o);N>=v&&(p+=i.slice(v,N)+E,v=N+y.length)}return p+i.slice(v)}]}),!!Of((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Jf||Bf);var Yf=ir,Gf=Nl,Kf=S,Vf=j,Xf=k,qf=Ol,Qf=Lu,Wf=pt.exports;if(Yf({target:"Promise",proto:!0,real:!0,forced:!!Gf&&Kf((function(){Gf.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=qf(this,Vf("Promise")),n=Xf(e);return this.then(n?function(n){return Qf(t,e()).then((function(){return n}))}:e,n?function(n){return Qf(t,e()).then((function(){throw n}))}:e)}}),Xf(Gf)){var Zf=Vf("Promise").prototype.finally;Gf.prototype.finally!==Zf&&Wf(Gf.prototype,"finally",Zf,{unsafe:!0})}var $f=Ne,zf=xr;ir({target:"Object",stat:!0,forced:S((function(){zf(1)}))},{keys:function(e){return zf($f(e))}});var eh={},th=ke;eh.f=th;var nh=p,rh=be,oh=eh,ah=rt.f,ih=function(e){var t=nh.Symbol||(nh.Symbol={});rh(t,e)||ah(t,e,{value:oh.f(e)})},sh=ir,ch=p,lh=j,uh=y,dh=Z,fh=S,hh=be,ph=Ns,vh=k,Sh=A,yh=ne,Nh=at,mh=Ne,gh=H,bh=Be,Th=Ua,Eh=w,wh=Qr,_h=xr,Ch=cn,Oh=ei,Rh=kn,Ih=v,Mh=rt,Lh=N,xh=pt.exports,Hh=de.exports,kh=Mt,Ph=we,Ah=ke,Dh=eh,Fh=ih,Uh=Wo,jh=Gt,Jh=xs.forEach,Bh=It("hidden"),Yh=Ah("toPrimitive"),Gh=jh.set,Kh=jh.getterFor("Symbol"),Vh=Object.prototype,Xh=ch.Symbol,qh=lh("JSON","stringify"),Qh=Ih.f,Wh=Mh.f,Zh=Oh.f,$h=Lh.f,zh=Hh("symbols"),ep=Hh("op-symbols"),tp=Hh("string-to-symbol-registry"),np=Hh("symbol-to-string-registry"),rp=Hh("wks"),op=ch.QObject,ap=!op||!op.prototype||!op.prototype.findChild,ip=uh&&fh((function(){return 7!=wh(Wh({},"a",{get:function(){return Wh(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=Qh(Vh,t);r&&delete Vh[t],Wh(e,t,n),r&&e!==Vh&&Wh(Vh,t,r)}:Wh,sp=function(e,t){var n=zh[e]=wh(Xh.prototype);return Gh(n,{type:"Symbol",tag:e,description:t}),uh||(n.description=t),n},cp=function(e,t,n){e===Vh&&cp(ep,t,n),Nh(e);var r=bh(t);return Nh(n),hh(zh,r)?(n.enumerable?(hh(e,Bh)&&e[Bh][r]&&(e[Bh][r]=!1),n=wh(n,{enumerable:Eh(0,!1)})):(hh(e,Bh)||Wh(e,Bh,Eh(1,{})),e[Bh][r]=!0),ip(e,r,n)):Wh(e,r,n)},lp=function(e,t){Nh(e);var n=gh(t),r=_h(n).concat(hp(n));return Jh(r,(function(t){uh&&!up.call(n,t)||cp(e,t,n[t])})),e},up=function(e){var t=bh(e),n=$h.call(this,t);return!(this===Vh&&hh(zh,t)&&!hh(ep,t))&&(!(n||!hh(this,t)||!hh(zh,t)||hh(this,Bh)&&this[Bh][t])||n)},dp=function(e,t){var n=gh(e),r=bh(t);if(n!==Vh||!hh(zh,r)||hh(ep,r)){var o=Qh(n,r);return!o||!hh(zh,r)||hh(n,Bh)&&n[Bh][r]||(o.enumerable=!0),o}},fp=function(e){var t=Zh(gh(e)),n=[];return Jh(t,(function(e){hh(zh,e)||hh(kh,e)||n.push(e)})),n},hp=function(e){var t=e===Vh,n=Zh(t?ep:gh(e)),r=[];return Jh(n,(function(e){!hh(zh,e)||t&&!hh(Vh,e)||r.push(zh[e])})),r};(dh||(xh((Xh=function(){if(this instanceof Xh)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?Th(arguments[0]):void 0,t=Ph(e),n=function(e){this===Vh&&n.call(ep,e),hh(this,Bh)&&hh(this[Bh],t)&&(this[Bh][t]=!1),ip(this,t,Eh(1,e))};return uh&&ap&&ip(Vh,t,{configurable:!0,set:n}),sp(t,e)}).prototype,"toString",(function(){return Kh(this).tag})),xh(Xh,"withoutSetter",(function(e){return sp(Ph(e),e)})),Lh.f=up,Mh.f=cp,Ih.f=dp,Ch.f=Oh.f=fp,Rh.f=hp,Dh.f=function(e){return sp(Ah(e),e)},uh&&(Wh(Xh.prototype,"description",{configurable:!0,get:function(){return Kh(this).description}}),xh(Vh,"propertyIsEnumerable",up,{unsafe:!0}))),sh({global:!0,wrap:!0,forced:!dh,sham:!dh},{Symbol:Xh}),Jh(_h(rp),(function(e){Fh(e)})),sh({target:"Symbol",stat:!0,forced:!dh},{for:function(e){var t=Th(e);if(hh(tp,t))return tp[t];var n=Xh(t);return tp[t]=n,np[n]=t,n},keyFor:function(e){if(!yh(e))throw TypeError(e+" is not a symbol");if(hh(np,e))return np[e]},useSetter:function(){ap=!0},useSimple:function(){ap=!1}}),sh({target:"Object",stat:!0,forced:!dh,sham:!uh},{create:function(e,t){return void 0===t?wh(e):lp(wh(e),t)},defineProperty:cp,defineProperties:lp,getOwnPropertyDescriptor:dp}),sh({target:"Object",stat:!0,forced:!dh},{getOwnPropertyNames:fp,getOwnPropertySymbols:hp}),sh({target:"Object",stat:!0,forced:fh((function(){Rh.f(1)}))},{getOwnPropertySymbols:function(e){return Rh.f(mh(e))}}),qh)&&sh({target:"JSON",stat:!0,forced:!dh||fh((function(){var e=Xh();return"[null]"!=qh([e])||"{}"!=qh({a:e})||"{}"!=qh(Object(e))}))},{stringify:function(e,t,n){for(var r,o=[e],a=1;arguments.length>a;)o.push(arguments[a++]);if(r=t,(Sh(t)||void 0!==e)&&!yh(e))return ph(t)||(t=function(e,t){if(vh(r)&&(t=r.call(this,e,t)),!yh(t))return t}),o[1]=t,qh.apply(null,o)}});if(!Xh.prototype[Yh]){var pp=Xh.prototype.valueOf;xh(Xh.prototype,Yh,(function(){return pp.apply(this,arguments)}))}Uh(Xh,"Symbol"),kh[Bh]=!0;var vp=xs.filter;ir({target:"Array",proto:!0,forced:!Jc("filter")},{filter:function(e){return vp(this,e,arguments.length>1?arguments[1]:void 0)}});var Sp=ir,yp=S,Np=H,mp=v.f,gp=y,bp=yp((function(){mp(1)}));Sp({target:"Object",stat:!0,forced:!gp||bp,sham:!gp},{getOwnPropertyDescriptor:function(e,t){return mp(Np(e),t)}});var Tp=S,Ep=function(e,t){var n=[][e];return!!n&&Tp((function(){n.call(null,t||function(){throw 1},1)}))},wp=xs.forEach,_p=p,Cp=hc,Op=Sc,Rp=Ep("forEach")?[].forEach:function(e){return wp(this,e,arguments.length>1?arguments[1]:void 0)},Ip=ht,Mp=function(e){if(e&&e.forEach!==Rp)try{Ip(e,"forEach",Rp)}catch(t){e.forEach=Rp}};for(var Lp in Cp)Cp[Lp]&&Mp(_p[Lp]&&_p[Lp].prototype);Mp(Op);var xp=Fn,Hp=H,kp=v,Pp=Dc;function Ap(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ap(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ap(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fp(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}ir({target:"Object",stat:!0,sham:!y},{getOwnPropertyDescriptors:function(e){for(var t,n,r=Hp(e),o=kp.f,a=xp(r),i={},s=0;a.length>s;)void 0!==(n=o(r,t=a[s++]))&&Pp(i,t,n);return i}});var Up=new WeakMap,jp=function(){function e(){n(this,e),Fp(this,Up,{writable:!0,value:[]})}return o(e,[{key:"bindListener",value:function(e,t,n,r){bo(this,Up,To(this,Up)||[]);var o=function(e,o,a){return n.call(t,e,o,a,r)};return To(this,Up)[e]?To(this,Up)[e].push(o)-1:(To(this,Up)[e]=[o],0)}},{key:"addListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};bo(this,Up,To(this,Up)||[]);var r=function(e,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t(Dp(Dp({context:e,eventName:r},o),n))};return To(this,Up)[e]?To(this,Up)[e].push(r)-1:(To(this,Up)[e]=[r],0)}},{key:"removeListener",value:function(e,t){To(this,Up)[e]&&To(this,Up)[e][t]?delete To(this,Up)[e][t]:console.log("trying to remove non-existent event handler, event = "+e+" handle = "+t)}},{key:"destructor",value:function(){bo(this,Up,null)}},{key:"fireEvent",value:function(t,n){if(To(this,Up))for(var r in To(this,Up)[t])if(To(this,Up)[t].hasOwnProperty(r)&&To(this,Up)[t][r](this,t,arguments[1])===e.STOP_PROPAGATION)break}}]),e}();a(jp,"STOP_PROPAGATION","STOP_PROPAGATION");var Jp={exports:{}},Bp=Jp.exports=function e(t,n,r){function o(i,s){if(!n[i]){if(!t[i]){if(!s&&f)return f(i);if(a)return a(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){var n=t[i][1][e];return o(n||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var a=f,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){(function(e){var n,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var a=0,i=new o(u),s=e.document.createTextNode("");i.observe(s,{characterData:!0}),n=function(){s.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}t.exports=function(e){1!==l.push(e)||r||n()}}).call(this,void 0!==d?d:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function o(){}var a={},i=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==o&&h(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return a.reject(e,t)}r===e?a.reject(e,new TypeError("Cannot resolve promise with itself")):a.resolve(e,r)}))}function f(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function r(t){n||(n=!0,a.reject(e,t))}function o(t){n||(n=!0,a.resolve(e,t))}var i=p((function(){t(o,r)}));"error"===i.status&&r(i.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(o);return this.state!==c?d(n,this.state===s?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){a.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){a.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},a.resolve=function(e,t){var n=p(f,t);if("error"===n.status)return a.reject(e,n.value);var r=n.value;if(r)h(e,r);else{e.state=s,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},a.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:a.resolve(new this(o),e)},l.reject=function(e){var t=new this(o);return a.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),s=0,c=-1,l=new this(o);++c<n;)u(e[c],c);return l;function u(e,o){t.resolve(e).then((function(e){i[o]=e,++s!==n||r||(r=!0,a.resolve(l,i))}),(function(e){r||(r=!0,a.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i,s=-1,c=new this(o);++s<n;)i=e[s],t.resolve(i).then((function(e){r||(r=!0,a.resolve(c,e))}),(function(e){r||(r=!0,a.reject(c,e))}));return c}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==d?d:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function a(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d=void 0,f={},h=Object.prototype.toString;function p(e){return"boolean"==typeof d?i.resolve(d):function(e){return new i((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),r=a([""]);n.objectStore("local-forage-detect-blob-support").put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function v(e){var t=f[e.name],n={};n.promise=new i((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function S(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function y(e,t){var n=f[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function N(e,t){return new i((function(n,r){if(f[e.name]=f[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);v(e),e.db.close()}var a=[e.name];t&&a.push(e.version);var i=o.open.apply(o,a);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){var t=i.result;t.onversionchange=function(e){e.target.close()},n(t),S(e)}}))}function m(e){return N(e,!1)}function g(e){return N(e,!0)}function b(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var a=e.db.version+1;a>e.version&&(e.version=a)}return!0}return!1}function T(e){return a([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}(atob(e.data))],{type:e.type})}function E(e){return e&&e.__local_forage_encoded_blob}function w(e){var t=this,n=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function _(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(o){if(r>0&&(!e.db||"InvalidStateError"===o.name||"NotFoundError"===o.name))return i.resolve().then((function(){if(!e.db||"NotFoundError"===o.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),g(e)})).then((function(){return function(e){v(e);for(var t=f[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,m(e).then((function(t){return e.db=t,b(e)?g(e):t})).then((function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r})).catch((function(t){throw y(e,t),t}))}(e).then((function(){_(e,t,n,r-1)}))})).catch(n);n(o)}}var C={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=f[n.name];o||(o={forages:[],db:null,dbReady:null,deferredOperations:[]},f[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=w);var a=[];function s(){return i.resolve()}for(var c=0;c<o.forages.length;c++){var l=o.forages[c];l!==t&&a.push(l._initReady().catch(s))}var u=o.forages.slice(0);return i.all(a).then((function(){return n.db=o.db,m(n)})).then((function(e){return n.db=e,b(n,t._defaultConfig.version)?g(n):e})).then((function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var a=u[r];a!==t&&(a._dbInfo.db=n.db,a._dbInfo.version=n.version)}}))},_support:function(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).openCursor(),s=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;E(r)&&(r=T(r));var o=e(r,n.key,s++);void 0!==o?t(o):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),E(e)&&(e=T(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=new i((function(n,o){var a;r.ready().then((function(){return a=r._dbInfo,"[object Blob]"===h.call(t)?p(a.db).then((function(e){return e?t:(n=t,new i((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){_(r._dbInfo,"readwrite",(function(a,i){if(a)return o(a);try{var s=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;o(e)}}catch(e){o(e)}}))})).catch(o)}));return s(o,n),o},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){_(n._dbInfo,"readwrite",(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName).delete(e);a.oncomplete=function(){t()},a.onerror=function(){r(i.error)},a.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){_(t._dbInfo,"readwrite",(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=a.error?a.error:a.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){_(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).count();a.onsuccess=function(){e(a.result)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){e<0?t(null):n.ready().then((function(){_(n._dbInfo,"readonly",(function(o,a){if(o)return r(o);try{var i=a.objectStore(n._dbInfo.storeName),s=!1,c=i.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){_(t._dbInfo,"readonly",(function(r,o){if(r)return n(r);try{var a=o.objectStore(t._dbInfo.storeName).openKeyCursor(),i=[];a.onsuccess=function(){var t=a.result;t?(i.push(t.key),t.continue()):e(i)},a.onerror=function(){n(a.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,a=this;if(e.name){var c=e.name===n.name&&a._dbInfo.db,l=c?i.resolve(a._dbInfo.db):m(e).then((function(t){var n=f[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t}));r=e.storeName?l.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;v(e);var r=f[e.name],a=r.forages;t.close();for(var s=0;s<a.length;s++){var c=a[s];c._dbInfo.db=null,c._dbInfo.version=n}return new i((function(t,r){var a=o.open(e.name,n);a.onerror=function(e){a.result.close(),r(e)},a.onupgradeneeded=function(){a.result.deleteObjectStore(e.storeName)},a.onsuccess=function(){var e=a.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<a.length;t++){var n=a[t];n._dbInfo.db=e,S(n._dbInfo)}})).catch((function(t){throw(y(e,t)||i.resolve()).catch((function(){})),t}))}})):l.then((function(t){v(e);var n=f[e.name],r=n.forages;t.close();for(var a=0;a<r.length;a++)r[a]._dbInfo.db=null;return new i((function(t,n){var r=o.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)S(r[t]._dbInfo)})).catch((function(t){throw(y(e,t)||i.resolve()).catch((function(){})),t}))}))}else r=i.reject("Invalid arguments");return s(r,t),r}},O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=/^~~local_forage_type~([^~]+)~/,I="__lfsc__:".length,M=I+"arbf".length,L=Object.prototype.toString;function x(e){var t,n,r,o,a,i=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<s;t+=4)n=O.indexOf(e[t]),r=O.indexOf(e[t+1]),o=O.indexOf(e[t+2]),a=O.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|o>>2,u[c++]=(3&o)<<6|63&a;return l}function H(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=O[n[t]>>2],r+=O[(3&n[t])<<4|n[t+1]>>4],r+=O[(15&n[t+1])<<2|n[t+2]>>6],r+=O[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var k={serialize:function(e,t){var n="";if(e&&(n=L.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===L.call(e.buffer))){var r,o="__lfsc__:";e instanceof ArrayBuffer?(r=e,o+="arbf"):(r=e.buffer,"[object Int8Array]"===n?o+="si08":"[object Uint8Array]"===n?o+="ui08":"[object Uint8ClampedArray]"===n?o+="uic8":"[object Int16Array]"===n?o+="si16":"[object Uint16Array]"===n?o+="ur16":"[object Int32Array]"===n?o+="si32":"[object Uint32Array]"===n?o+="ui32":"[object Float32Array]"===n?o+="fl32":"[object Float64Array]"===n?o+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(o+H(r))}else if("[object Blob]"===n){var a=new FileReader;a.onload=function(){var n="~~local_forage_type~"+e.type+"~"+H(this.result);t("__lfsc__:blob"+n)},a.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,I))return JSON.parse(e);var t,n=e.substring(M),r=e.substring(I,M);if("blob"===r&&R.test(n)){var o=n.match(R);t=o[1],n=n.substring(o[0].length)}var i=x(n);switch(r){case"arbf":return i;case"blob":return a([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:x,bufferToString:H};function P(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function A(e,t,n,r,o,a){e.executeSql(n,r,o,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?a(e,i):P(e,t,(function(){e.executeSql(n,r,o,a)}),a)}),a):a(e,i)}),a)}function D(e,t,n,r){var o=this;e=l(e);var a=new i((function(a,i){o.ready().then((function(){void 0===t&&(t=null);var s=t,c=o._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(n){A(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){a(s)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void a(D.apply(o,[e,s,n,r-1]));i(t)}}))}))})).catch(i)}));return s(a,n),a}function F(e){return new i((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var o=[],a=0;a<r.rows.length;a++)o.push(r.rows.item(a).name);t({db:e,storeNames:o})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var U={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new i((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(o){P(o,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=k,o},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){A(n,o,"SELECT * FROM "+o.storeName,[],(function(n,r){for(var a=r.rows,i=a.length,s=0;s<i;s++){var c=a.item(s),l=c.value;if(l&&(l=o.serializer.deserialize(l)),void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){A(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return D.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){A(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var o=n._dbInfo;o.db.transaction((function(n){A(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return s(r=e.name?new i((function(t){var r;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(F(r))})).then((function(e){return new i((function(t,n){e.db.transaction((function(r){function o(e){return new i((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var a=[],s=0,c=e.storeNames.length;s<c;s++)a.push(o(e.storeNames[s]));i.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):i.reject("Invalid arguments"),t),r}};function j(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function J(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var B={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=j(e,this._defaultConfig),J()?(this._dbInfo=t,t.serializer=k,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,a=localStorage.length,i=1,s=0;s<a;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(o),i++)))return l}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var o=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new i((function(o,a){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)a(r);else try{localStorage.setItem(i.keyPrefix+e,t),o(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||a(e),a(e)}}))}))}));return s(o,n),o},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var a=localStorage.key(o);0===a.indexOf(e.keyPrefix)&&r.push(a.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return s(r=e.name?new i((function(t){e.storeName?t(j(e,o._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):i.reject("Invalid arguments"),t),r}},Y=function(e,t){for(var n,r,o=e.length,a=0;a<o;){if((n=e[a])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;a++}return!1},G=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},K={},V={},X={INDEXEDDB:C,WEBSQL:U,LOCALSTORAGE:B},q=[X.INDEXEDDB._driver,X.WEBSQL._driver,X.LOCALSTORAGE._driver],Q=["dropInstance"],W=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Q),Z={description:"",driver:q.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function $(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(G(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ee=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),X)if(X.hasOwnProperty(n)){var r=X[n],o=r._driver;this[n]=o,K[o]||this.defineDriver(r)}this._defaultConfig=z({},Z),this._config=z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new i((function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var a=W.concat("_initStorage"),c=0,l=a.length;c<l;c++){var u=a[c];if((!Y(Q,u)||e[u])&&"function"!=typeof e[u])return void n(o)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=i.reject(t);return s(n,arguments[arguments.length-1]),n}},n=0,r=Q.length;n<r;n++){var o=Q[n];e[o]||(e[o]=t(o))}}();var d=function(n){K[r]&&console.info("Redefining LocalForage driver: "+r),K[r]=e,V[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return c(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=K[e]?i.resolve(K[e]):i.reject(new Error("Driver not found."));return c(r,t,n),r},e.prototype.getSerializer=function(e){var t=i.resolve(k);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;G(e)||(e=[e]);var o=this._getSupportedDrivers(e);function a(){r._config.driver=r.driver()}function s(e){return r._extend(e),a(),r._ready=r._initStorage(r._config),r._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return i.resolve()})):i.resolve();return this._driverSet=l.then((function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,a(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(s).catch(n)}a();var c=new Error("No available storage method found.");return r._driverSet=i.reject(c),r._driverSet}()}}(o)}))})).catch((function(){a();var e=new Error("No available storage method found.");return r._driverSet=i.reject(e),r._driverSet})),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!V[e]},e.prototype._extend=function(e){z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=W.length;e<t;e++)$(this,W[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ee},{3:3}]},{},[4])(4);
/*!
    localForage -- Offline Storage, Improved
    Version 1.10.0
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/function Yp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Gp(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,Gp)}var Kp=/^[a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12}$/,Vp=function(e){So(r,jp);var t=Yp(r);function r(){var e;return n(this,r),a(po(e=t.call(this)),"_id",void 0),a(po(e),"_savedRemotely",!1),a(po(e),"_savedLocally",!1),a(po(e),"deleted",!1),a(po(e),"createdStamp",void 0),a(po(e),"modifiedStamp",void 0),a(po(e),"projectId",void 0),a(po(e),"isPristine",!1),e.createdStamp=Math.floor(Date.now()/1e3),e}return o(r,[{key:"unsaved",value:function(){return!(this._savedLocally&&this._savedRemotely)}},{key:"id",get:function(){return this._id||(this._id=Gp()),this._id},set:function(e){if(this._id&&e!==this._id)throw new Error("Occurrence id has already been set, when trying to set new id '".concat(e,"'."));this._id=e}},{key:"queuePost",value:function(e){var t=this;return new Promise((function(n,o){var a=function(){return console.log({"posting form data":e}),t.post(e).then(n,o)};r._tasks.push(a),r._tasks.length>1?console.log("Added post request to the queue."):(console.log("No pending tasks, starting post request immediately."),a().finally(r._next))}))}},{key:"post",value:function(e){var t=this;return fetch(this.SAVE_ENDPOINT,{method:"POST",body:e}).then((function(e){return e.ok?e.clone().json().then((function(n){switch(console.log({"returned to client after save":n}),n.saveState){case"SAVED_TO_SERVER":t._savedLocally=!0,t._savedRemotely=!0;break;case"SAVED_LOCALLY":t._savedLocally=!0,t._savedRemotely=!1;break;default:console.log("Unrecognised save state '".concat(n.saveState,"'"))}return t.createdStamp=parseInt(n.created,10),t.modifiedStamp=parseInt(n.modified,10),e.json()})):(console.log("Save failed, presumably service worker is missing and there is no network connection. Should write to IndexedDb here."),Promise.reject("IndexedDb storage not yet implemented"))}))}},{key:"_parseDescriptor",value:function(e){this._parseAttributes(e.attributes),this._parseSavedState(e.saveState),this.deleted=!0===e.deleted||"true"===e.deleted,this.createdStamp=parseInt(e.created,10),this.modifiedStamp=e.modified?parseInt(e.modified,10):0,this.projectId=parseInt(e.projectId,10)}},{key:"_parseAttributes",value:function(e){"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)?(console.log("Attributes were spuriously represented as an array rather than as an empty object"),this.attributes={}):this.attributes=e}},{key:"_parseSavedState",value:function(e){switch(e){case"SAVED_LOCALLY":this._savedRemotely=!1,this._savedLocally=!0;break;case"SAVED_TO_SERVER":this._savedRemotely=!0,this._savedLocally=!0;break;default:throw new Error("Unrecognised saved state '".concat(e))}}},{key:"touch",value:function(){this.modifiedStamp=Math.floor(Date.now()/1e3),this.isPristine&&(this.isPristine=!1,this.createdStamp=this.modifiedStamp),this._savedLocally=!1,this._savedRemotely=!1}},{key:"evaluateCompletionStatus",value:function(e){var t={},n=!0;for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];t[r]=o.validator?o.validator(r,o,this.attributes):o.field.isValid(r,o,this.attributes),null!==t[r]&&(n=n&&t[r])}return{requiredFieldsPresent:n,validity:t}}}],[{key:"_next",value:function(){if(r._tasks.shift(),r._tasks.length)return console.log("Running the next task."),r._tasks[0]().finally(r._next)}},{key:"retrieveFromLocal",value:function(e,t){return Bp.getItem("".concat(t.TYPE,".").concat(e)).then((function(n){return n?(t.id=e,t._parseDescriptor(n),t):Promise.reject("Failed to retrieve ".concat(t.TYPE,".").concat(e," locally"))}))}}]),r}();function Xp(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(Vp,"_tasks",[]);var qp=function(e){So(r,Mc(Error));var t=Xp(r);function r(){return n(this,r),t.apply(this,arguments)}return r}();function Qp(e){try{var t=document.createElement("textarea");return t.innerHTML=e,t.innerHTML.replace(/"/g,"&quot;")}catch(t){var n=document.createElement("pre");return n.appendChild(document.createTextNode(e)),n.innerHTML.replace(/"/g,"&quot;")}}var Wp=function(){function t(){n(this,t),a(this,"id",void 0),a(this,"nameString",""),a(this,"canonical",""),a(this,"hybridCanonical",""),a(this,"acceptedEntityId",""),a(this,"qualifier",""),a(this,"authority",""),a(this,"vernacular",""),a(this,"vernacularRoot",""),a(this,"used",void 0),a(this,"sortOrder",void 0),a(this,"parentIds",[])}return o(t,[{key:"formattedHTML",value:function(e){var n;return this.id!==this.acceptedEntityId&&(n=t.fromId(this.acceptedEntityId)),t.showVernacular?e?n?"<q><b>".concat(Qp(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Qp(this.authority),"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Qp(n.authority),"</span>"):"<q><b>".concat(Qp(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Qp(this.authority),"</span>"):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>").concat(this.vernacular?" <q><b>".concat(Qp(this.vernacular),"</b></q>"):"",' = <span class="italictaxon">').concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Qp(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Qp(this.authority),"</span>").concat(this.vernacular?" <q><b>".concat(Qp(this.vernacular),"</b></q>"):""):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Qp(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(Qp(this.authority),"</span>")}}],[{key:"fromId",value:function(n){if(!t.rawTaxa){if(!e.TaxonNames)throw new qp("Taxon.fromId() called before taxon list has loaded.");t.rawTaxa=e.TaxonNames}if(!t.rawTaxa.hasOwnProperty(n))throw new qp("Taxon id '".concat(n,"' not found."));var r=t.rawTaxa[n],o=new t;return o.id=n,o.nameString=r[0],o.canonical=r[1]||r[0],o.hybridCanonical=r[2]||o.canonical,o.acceptedEntityId=r[3]||n,o.qualifier=r[4],o.authority=r[5],o.vernacular=r[6],o.vernacularRoot=r[7],o.used=r[8],o.sortOrder=r[9],o.parentIds=r[10],o}}]),t}();a(Wp,"rawTaxa",e.TaxonNames),a(Wp,"showVernacular",!0);var Zp=M,$p=Ua,zp="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",ev=RegExp("^"+zp+zp+"*"),tv=RegExp(zp+zp+"*$"),nv=function(e){return function(t){var n=$p(Zp(t));return 1&e&&(n=n.replace(ev,"")),2&e&&(n=n.replace(tv,"")),n}},rv={start:nv(1),end:nv(2),trim:nv(3)},ov=Wt.PROPER,av=S,iv="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",sv=function(e){return av((function(){return!!iv[e]()||"âÂá "!=="âÂá "[e]()||ov&&iv[e].name!==e}))},cv=rv.trim;function lv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function uv(e,t,n,r){return fv(e,t),dv(n,"set"),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,n,r),r}function dv(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function fv(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}ir({target:"String",proto:!0,forced:sv("trim")},{trim:function(){return cv(this)}});var hv=function(e){So(r,jp);var t=lv(r);function r(e){var o;return n(this,r),a(po(o=t.call(this)),"_value",void 0),a(po(o),"_fieldEl",void 0),a(po(o),"label","field label"),a(po(o),"helpText",""),a(po(o),"validationMessage",""),a(po(o),"completion",r.COMPLETION_OPTIONAL),a(po(o),"parentForm",void 0),a(po(o),"attributeName",void 0),e&&(e.label&&(o.label=e.label),e.helpText&&(o.helpText=e.helpText),e.validationMessage&&(o.validationMessage=e.validationMessage),e.completion&&(o.completion=e.completion)),o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){}},{key:"fieldElement",get:function(){return this._fieldEl||this.buildField(),this._fieldEl}},{key:"addField",value:function(){this.parentForm.formElement.appendChild(this.fieldElement)}},{key:"markValidity",value:function(e){}}],[{key:"nextId",get:function(){var e,t,n;return"field".concat((uv(r,r,pv,(n=pv,fv(t=r,r),dv(n,"get"),1+(e=+function(e,t){return t.get?t.get.call(e):t.value}(t,n)))),e))}},{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}},{key:"cleanRawString",value:function(e){return e.trim().replace(/\s\s+/g," ")}},{key:"isEmpty",value:function(e){return""===e}},{key:"isValid",value:function(e,t,n){return!t.attributes.completion||t.attributes.completion!==r.COMPLETION_COMPULSORY&&t.attributes.completion!==r.COMPLETION_DESIRED?null:!(!n.hasOwnProperty(e)||t.field.isEmpty(n[e]))}},{key:"summarise",value:function(e,t,n){return!t.summary||t.summary.hasOwnProperty("summarise")&&!0!==t.summary.summarise?"":t.field.summariseImpl(e,t,n)}},{key:"summariseImpl",value:function(e,t,n){return""}}]),r}();a(hv,"COMPLETION_COMPULSORY","compulsory"),a(hv,"COMPLETION_DESIRED","desired"),a(hv,"COMPLETION_OPTIONAL","optional");var pv={writable:!0,value:1};function vv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Sv(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function yv(e,t,n,r){return gv(e,t),mv(n,"set"),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,n,r),r}function Nv(e,t,n){return gv(e,t),mv(n,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,n)}function mv(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function gv(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}a(hv,"EVENT_CHANGE","fieldChange");var bv=new WeakMap,Tv=function(e){So(r,jp);var t=vv(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return Sv(po(e=t.call.apply(t,[this].concat(i))),bv,{writable:!0,value:void 0}),a(po(e),"_formId",void 0),a(po(e),"_formContentContainer",void 0),a(po(e),"fields",void 0),a(po(e),"liveValidation",!1),a(po(e),"isValid",null),a(po(e),"_formFieldsBuilt",!1),e}return o(r,[{key:"formElement",get:function(){var e,t=this;To(this,bv)||(bo(this,bv,document.createElement("form")),To(this,bv).id=this._formId="form".concat((yv(r,r,Ev,1+(e=+Nv(r,r,Ev))),e)),To(this,bv).noValidate=!0,this.liveValidation&&(To(this,bv).className="needs-validation"),this.buildContentContainer(To(this,bv)),To(this,bv).addEventListener("change",(function(e){t.changeHandler(e)}),{capture:!1}));return To(this,bv)}},{key:"buildContentContainer",value:function(e){return this._formContentContainer=e,this._formContentContainer}},{key:"changeHandler",value:function(e){console.log({"form change event":e})}},{key:"destructor",value:function(){Hc(mo(r.prototype),"destructor",this).call(this),bo(this,bv,null)}},{key:"buildFormFields",value:function(){for(var e in this.initialiseFormFields(),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];t.parentForm=this,t.attributeName=e,this._formContentContainer.appendChild(t.fieldElement),t.addListener(hv.EVENT_CHANGE,this.changeHandler.bind(this))}this._formFieldsBuilt=!0}},{key:"conditionallyValidateForm",value:function(){this.liveValidation&&this.validateForm()}},{key:"validateForm",value:function(){this.liveValidation=!0,this.formElement.classList.add("needs-validation");var e=this.model.evaluateCompletionStatus(this.getFormSectionProperties());for(var t in this.fields){if(this.fields.hasOwnProperty(t))this.fields[t].markValidity(e.validity[t])}return this.isValid!==e.requiredFieldsPresent&&(this.isValid=e.requiredFieldsPresent,this.fireEvent(r.EVENT_VALIDATION_STATE_CHANGE,{isValid:this.isValid})),e.requiredFieldsPresent}},{key:"populateFormContent",value:function(){if(this._formFieldsBuilt){var e=this.model;for(var t in this.fields){if(this.fields.hasOwnProperty(t))this.fields[t].value=e.attributes[t]}this.conditionallyValidateForm()}}}],[{key:"nextId",get:function(){var e;return"id".concat((yv(r,r,wv,1+(e=+Nv(r,r,wv))),e))}}]),r}();a(Tv,"CHANGE_EVENT","change");var Ev={writable:!0,value:0};a(Tv,"EVENT_VALIDATION_STATE_CHANGE","validationstatechange");var wv={writable:!0,value:0};function _v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(Tv,"COMPLETION_STATUS_UNSTARTED","unstarted"),a(Tv,"COMPLETION_STATUS_COMPLETE","complete"),a(Tv,"COMPLETION_STATUS_IN_PROGRESS","inProgress");var Cv=function(e){So(r,Vp);var t=_v(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"attributes",{}),a(po(e),"_savedRemotely",!1),a(po(e),"_savedLocally",!1),a(po(e),"SAVE_ENDPOINT","/saveoccurrence.php"),a(po(e),"TYPE","occurrence"),a(po(e),"isNew",!1),e}return o(r,[{key:"taxon",get:function(){return this.attributes.taxon&&this.attributes.taxon.taxonId?Wp.fromId(this.attributes.taxon.taxonId):null}},{key:"setForm",value:function(e){return this.isNew||(e.liveValidation=!0),e.addListener(Tv.CHANGE_EVENT,this.formChangedHandler.bind(this)),e}},{key:"formChangedHandler",value:function(e){console.log("Occurrence change handler invoked."),e.form.updateModelFromContent(),e.form.conditionallyValidateForm(),this.touch(),this.fireEvent(r.EVENT_MODIFIED,{occurrenceId:this.id})}},{key:"delete",value:function(){this.deleted||(this.touch(),this.deleted=!0,this.fireEvent(r.EVENT_MODIFIED,{occurrenceId:this.id}))}},{key:"save",value:function(e){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var t=new FormData;return!e&&this.surveyId&&(e=this.surveyId),t.append("type",this.TYPE),t.append("surveyId",e),t.append("occurrenceId",this.id),t.append("id",this.id),t.append("projectId",this.projectId.toString()),t.append("attributes",JSON.stringify(this.attributes)),t.append("deleted",this.deleted.toString()),t.append("created",this.createdStamp.toString()),console.log("queueing occurrence post"),this.queuePost(t)}},{key:"_parseDescriptor",value:function(e){Hc(mo(r.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId}}]),r}();function Ov(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(Cv,"EVENT_MODIFIED","modified");var Rv=function(e){So(r,Mc(Error));var t=Ov(r);function r(){return n(this,r),t.apply(this,arguments)}return r}();function Iv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Mv(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}var Lv=new WeakMap,xv=function(e){So(r,l);var t=Iv(r);function r(e){var o;return n(this,r),a(po(o=t.call(this)),"route","/list/:action/:id"),a(po(o),"title","App homepage"),a(po(o),"app",void 0),a(po(o),"view",void 0),Mv(po(o),Lv,{writable:!0,value:""}),a(po(o),"needsFullRefresh",!0),a(po(o),"needRightPanelRefresh",!0),a(po(o),"viewSubcontext",""),a(po(o),"surveySection",void 0),a(po(o),"leftPanelBaseRoute",""),a(po(o),"viewContexts",{record:function(e){this.surveySection=null,e?To(this,Lv)!==e.id?(this.needRightPanelRefresh=!0,this.currentOccurrenceId=e.id?e.id:""):this.needRightPanelRefresh=!1:(this.currentOccurrenceId="",this.needRightPanelRefresh=!0),this.leftPanelBaseRoute="/list/record"},survey:function(e){console.log("in survey section ".concat(e.section)),this.currentOccurrenceId="",this.needRightPanelRefresh=!0,this.surveySection=e.section,this.leftPanelBaseRoute="/list/survey/".concat(e.section)}}),o.view=e,e.controller=po(o),o.handle=l.nextHandle,e.addListener(r.EVENT_SELECT_OCCURRENCE,o.occurrenceSelectionHandler.bind(po(o))),e.addListener(r.EVENT_SELECT_SURVEY_SECTION,o.surveyPartSelectionHandler.bind(po(o))),e.addListener(r.EVENT_NEW_RECORD,o.newRecordHandler.bind(po(o))),e.addListener(r.EVENT_DELETE_OCCURRENCE,o.deleteOccurrenceHandler.bind(po(o))),e.addListener(r.EVENT_BACK,o.backHandler.bind(po(o))),e.addListener(r.EVENT_NEXT_TO_RECORDS,o.nextTransitionToRecordsHandler.bind(po(o))),o}return o(r,[{key:"occurrences",get:function(){return this.app.occurrences}},{key:"currentOccurrence",get:function(){if(To(this,Lv)){if(this.app.occurrences.has(To(this,Lv)))return this.app.occurrences.get(To(this,Lv));throw new xc("Record id '".concat(To(this,Lv),"' was not found."))}return null}},{key:"currentOccurrenceId",get:function(){return To(this,Lv)},set:function(e){bo(this,Lv,e)}},{key:"survey",get:function(){return this.app.currentSurvey}},{key:"nextTransitionToRecordsHandler",value:function(){console.log("in nextTransitionToRecordsHandler()"),this.app.haveExtantOccurrences()?this.app.router.navigate("/list/record/"):this.newRecordHandler()}},{key:"deleteOccurrenceHandler",value:function(e){console.log({deleting:e.occurrenceId});var t=this.app.occurrences.get(e.occurrenceId);if(!t)throw new Rv("Occurrence id '".concat(e.occurrenceId,"' not found when trying to delete."));t.delete(),this.currentOccurrenceId===e.occurrenceId&&this.app.router.navigate("/list/record/")}},{key:"surveyPartSelectionHandler",value:function(e){console.log({"In surveyPartSelectionHandler":e}),"record"===e.sectionKey?this.app.router.navigate("/list/record/"):e.sectionKey?this.app.router.navigate("/list/survey/".concat(e.sectionKey)):this.app.router.navigate("/list/")}},{key:"newRecordHandler",value:function(){var e=this.app.addNewOccurrence();this.app.router.navigate("/list/record/".concat(e.id))}},{key:"occurrenceSelectionHandler",value:function(e){console.log({"In occurrenceSelectionHandler":e}),this.currentOccurrenceId&&e.occurrenceId&&this.currentOccurrenceId===e.occurrenceId?console.log("ignoring spurious navigation event for '".concat(e.occurrenceId,"'")):this.app.router.navigate("/list/record/".concat(e.occurrenceId))}},{key:"registerRoute",value:function(e){e.on("/list",this.mainRouteHandler.bind(this,"list","",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/help",this.mainRouteHandler.bind(this,"list","","help")),e.on("/list/record/",this.mainRouteHandler.bind(this,"list","record",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/record/help",this.mainRouteHandler.bind(this,"list","record","help")),e.on("/list/record/:id",this.mainRouteHandler.bind(this,"list","record","form"),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section",this.mainRouteHandler.bind(this,"list","survey",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section/help",this.mainRouteHandler.bind(this,"list","survey","help"))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for MainController.js"),console.log({context:e,params:t,query:r}),this.app.saveRoute();try{this.viewSubcontext=t,t&&this.viewContexts[t].call(this,r),this.app.currentControllerHandle!==this.handle&&(this.needsFullRefresh=!0,this.needRightPanelRefresh=!0,this.app.currentControllerHandle=this.handle),this.view.panelKey=n,this.view.display(),this.needsFullRefresh=!1}catch(e){this.error=e,console.log({error:e});try{this.needsFullRefresh=!0,this.view.display()}catch(e){console.log({rethrownError:e}),document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}}}},{key:"backHandler",value:function(){this.app.routeHistory.length>=2&&this.app.routeHistory[this.app.routeHistory.length-2].url===this.leftPanelBaseRoute?(this.app.routeHistory.length-=1,console.log("using standard back navigation"),window.history.back()):(console.log("navigating back using base address '".concat(this.leftPanelBaseRoute,"'")),this.app.router.navigate(this.leftPanelBaseRoute))}}]),r}();function Hv(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(xv,"EVENT_SELECT_OCCURRENCE","selectoccurrence"),a(xv,"EVENT_SELECT_SURVEY_SECTION","selectsurveysection"),a(xv,"EVENT_NEW_RECORD","newrecord"),a(xv,"EVENT_DELETE_OCCURRENCE","deleteoccurrence"),a(xv,"EVENT_BACK","back"),a(xv,"EVENT_NEXT_TO_RECORDS","nexttorecords");var kv=function(e){So(r,l);var t=Hv(r);function r(e,o){var i;return n(this,r),a(po(i=t.call(this)),"route",void 0),i.view=e,i.route=o,i.handle=l.nextHandle,i}return o(r,[{key:"routeHandler",value:function(e,t){this.app.currentControllerHandle=this.handle,this.view.display()}}]),r}(),Pv=at,Av=Nn,Dv=Ua,Fv=M,Uv=ce,jv=vf,Jv=_f;hf("match",(function(e,t,n){return[function(t){var n=Fv(this),r=null==t?void 0:Uv(t,e);return r?r.call(t,n):new RegExp(t)[e](Dv(n))},function(e){var r=Pv(this),o=Dv(e),a=n(t,r,o);if(a.done)return a.value;if(!r.global)return Jv(r,o);var i=r.unicode;r.lastIndex=0;for(var s,c=[],l=0;null!==(s=Jv(r,o));){var u=Dv(s[0]);c[l]=u,""===u&&(r.lastIndex=jv(o,Av(r.lastIndex),i)),l++}return 0===l?null:c}]}));var Bv=ir,Yv=Ns,Gv=Cr,Kv=A,Vv=vn,Xv=gn,qv=H,Qv=Dc,Wv=ke,Zv=Jc("slice"),$v=Wv("species"),zv=[].slice,eS=Math.max;Bv({target:"Array",proto:!0,forced:!Zv},{slice:function(e,t){var n,r,o,a=qv(this),i=Xv(a),s=Vv(e,i),c=Vv(void 0===t?i:t,i);if(Yv(a)&&(n=a.constructor,(Gv(n)&&(n===Array||Yv(n.prototype))||Kv(n)&&null===(n=n[$v]))&&(n=void 0),n===Array||void 0===n))return zv.call(a,s,c);for(r=new(void 0===n?Array:n)(eS(c-s,0)),o=0;s<c;s++,o++)s in a&&Qv(r,o,a[s]);return r.length=o,r}});var tS=y,nS=Wt.EXISTS,rS=rt.f,oS=Function.prototype,aS=oS.toString,iS=/^\s*function ([^ (]*)/;tS&&!nS&&rS(oS,"name",{configurable:!0,get:function(){try{return aS.call(this).match(iS)[1]}catch(e){return""}}});var sS=at,cS=Di,lS=_i,uS=Ne,dS=function(e,t,n,r){try{return r?t(sS(n)[0],n[1]):t(n)}catch(t){cS(e,"throw",t)}},fS=Ei,hS=Cr,pS=gn,vS=Dc,SS=ki,yS=Mi,NS=function(e){var t=uS(e),n=hS(this),r=arguments.length,o=r>1?arguments[1]:void 0,a=void 0!==o;a&&(o=lS(o,r>2?arguments[2]:void 0,2));var i,s,c,l,u,d,f=yS(t),h=0;if(!f||this==Array&&fS(f))for(i=pS(t),s=n?new this(i):Array(i);i>h;h++)d=a?o(t[h],h):t[h],vS(s,h,d);else for(u=(l=SS(t,f)).next,s=n?new this:[];!(c=u.call(l)).done;h++)d=a?dS(l,o,[c.value,h],!0):c.value,vS(s,h,d);return s.length=h,s};ir({target:"Array",stat:!0,forced:!$i((function(e){Array.from(e)}))},{from:NS});var mS=ir,gS=y,bS=p,TS=be,ES=k,wS=A,_S=rt.f,CS=Yn,OS=bS.Symbol;if(gS&&ES(OS)&&(!("description"in OS.prototype)||void 0!==OS().description)){var RS={},IS=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof IS?new OS(e):void 0===e?OS():OS(e);return""===e&&(RS[t]=!0),t};CS(IS,OS);var MS=IS.prototype=OS.prototype;MS.constructor=IS;var LS=MS.toString,xS="Symbol(test)"==String(OS("test")),HS=/^Symbol\((.*)\)[^)]+$/;_S(MS,"description",{configurable:!0,get:function(){var e=wS(this)?this.valueOf():this,t=LS.call(e);if(TS(RS,e))return"";var n=xS?t.slice(7,-1):t.replace(HS,"$1");return""===n?void 0:n}}),mS({global:!0,forced:!0},{Symbol:IS})}ih("iterator");var kS=ir,PS=H,AS=[].join,DS=I!=Object,FS=Ep("join",",");kS({target:"Array",proto:!0,forced:DS||!FS},{join:function(e){return AS.call(PS(this),void 0===e?",":e)}});function US(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jS(e,t){if(e){if("string"==typeof e)return US(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?US(e,t):void 0}}function JS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){s=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(s)throw o}}return a}}(e,t)||jS(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var BS=rt.f,YS=Qr,GS=$a,KS=_i,VS=Xi,XS=Vi,qS=wa,QS=El,WS=y,ZS=za.exports.fastKey,$S=Gt.set,zS=Gt.getterFor;Ss("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(e,t,n,r){var o=e((function(e,a){VS(e,o,t),$S(e,{type:t,index:YS(null),first:void 0,last:void 0,size:0}),WS||(e.size=0),null!=a&&XS(a,e[r],{that:e,AS_ENTRIES:n})})),a=zS(t),i=function(e,t,n){var r,o,i=a(e),c=s(e,t);return c?c.value=n:(i.last=c={index:o=ZS(t,!0),key:t,value:n,previous:r=i.last,next:void 0,removed:!1},i.first||(i.first=c),r&&(r.next=c),WS?i.size++:e.size++,"F"!==o&&(i.index[o]=c)),e},s=function(e,t){var n,r=a(e),o=ZS(t);if("F"!==o)return r.index[o];for(n=r.first;n;n=n.next)if(n.key==t)return n};return GS(o.prototype,{clear:function(){for(var e=a(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,WS?e.size=0:this.size=0},delete:function(e){var t=a(this),n=s(this,e);if(n){var r=n.next,o=n.previous;delete t.index[n.index],n.removed=!0,o&&(o.next=r),r&&(r.previous=o),t.first==n&&(t.first=r),t.last==n&&(t.last=o),WS?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=a(this),r=KS(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),GS(o.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return i(this,0===e?0:e,t)}}:{add:function(e){return i(this,e=0===e?0:e,e)}}),WS&&BS(o.prototype,"size",{get:function(){return a(this).size}}),o},setStrong:function(e,t,n){var r=t+" Iterator",o=zS(t),a=zS(r);qS(e,t,(function(e,t){$S(this,{type:r,target:e,state:o(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),QS(t)}});var ey=_n.includes,ty=Mo;ir({target:"Array",proto:!0},{includes:function(e){return ey(this,e,arguments.length>1?arguments[1]:void 0)}}),ty("includes");var ny=A,ry=C,oy=ke("match"),ay=function(e){var t;return ny(e)&&(void 0!==(t=e[oy])?!!t:"RegExp"==ry(e))},iy=ay,sy=ke("match"),cy=function(e){if(iy(e))throw TypeError("The method doesn't accept regular expressions");return e},ly=M,uy=Ua;ir({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[sy]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~uy(ly(this)).indexOf(uy(cy(e)),arguments.length>1?arguments[1]:void 0)}});var dy=hf,fy=ay,hy=at,py=M,vy=Ol,Sy=vf,yy=Nn,Ny=Ua,my=ce,gy=_f,by=of,Ty=S,Ey=Pd.UNSUPPORTED_Y,wy=[].push,_y=Math.min;function Cy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}dy("split",(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=Ny(py(this)),o=void 0===n?4294967295:n>>>0;if(0===o)return[];if(void 0===e)return[r];if(!fy(e))return t.call(r,e,o);for(var a,i,s,c=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,d=new RegExp(e.source,l+"g");(a=by.call(d,r))&&!((i=d.lastIndex)>u&&(c.push(r.slice(u,a.index)),a.length>1&&a.index<r.length&&wy.apply(c,a.slice(1)),s=a[0].length,u=i,c.length>=o));)d.lastIndex===a.index&&d.lastIndex++;return u===r.length?!s&&d.test("")||c.push(""):c.push(r.slice(u)),c.length>o?c.slice(0,o):c}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var o=py(this),a=null==t?void 0:my(t,e);return a?a.call(t,o,n):r.call(Ny(o),t,n)},function(e,o){var a=hy(this),i=Ny(e),s=n(r,a,i,o,r!==t);if(s.done)return s.value;var c=vy(a,RegExp),l=a.unicode,u=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(Ey?"g":"y"),d=new c(Ey?"^(?:"+a.source+")":a,u),f=void 0===o?4294967295:o>>>0;if(0===f)return[];if(0===i.length)return null===gy(d,i)?[i]:[];for(var h=0,p=0,v=[];p<i.length;){d.lastIndex=Ey?0:p;var S,y=gy(d,Ey?i.slice(p):i);if(null===y||(S=_y(yy(d.lastIndex+(Ey?p:0)),i.length))===h)p=Sy(i,p,l);else{if(v.push(i.slice(h,p)),v.length===f)return v;for(var N=1;N<=y.length-1;N++)if(v.push(y[N]),v.length===f)return v;p=h=S}}return v.push(i.slice(h)),v}]}),!!Ty((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),Ey);var Oy=function(e){So(r,jp);var t=Cy(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"controller",void 0),e}return o(r,[{key:"initialise",value:function(){}},{key:"display",value:function(){console.log("got to view display"),this.refreshHeader(),this.body()}},{key:"refreshHeader",value:function(){}},{key:"body",value:function(){}},{key:"card",value:function(e){var t=document.createElement("div");t.id=e.cardId,t.className="card";var n=t.appendChild(document.createElement("div"));n.className="card-header pointer",e.cardHeadingId&&(n.id=e.cardHeadingId),n.setAttribute("data-toggle","collapse"),n.setAttribute("data-target","#".concat(e.cardDescriptionId));var r=n.appendChild(document.createElement("h2"));r.className="mb-0";var o=r.appendChild(document.createElement("button"));if(o.className="btn btn-link".concat(e.collapsed?" collapsed":""),e.headingButtonId&&(o.id=e.headingButtonId),o.type="button",o.setAttribute("data-toggle","collapse"),e.buttonStyleString&&(o.style.cssText=e.buttonStyleString),e.cardDescriptionId&&(o.setAttribute("data-target","#".concat(e.cardDescriptionId)),o.setAttribute("aria-controls",e.cardDescriptionId)),o.setAttribute("aria-expanded",e.collapsed?"false":"true"),o.innerHTML=e.headingHTML,e.headingNonbuttonHTML){var a=r.appendChild(document.createElement("span"));a.style.display="inline-block",a.innerHTML=e.headingNonbuttonHTML}if(e.headingValidationWarningHTML){var i=n.appendChild(document.createElement("div"));i.className="card-invalid-feedback",i.innerHTML="<small>".concat(e.headingValidationWarningHTML,"</small>")}var s=t.appendChild(document.createElement("div"));if(e.cardDescriptionId&&(s.id=e.cardDescriptionId),s.className="collapse".concat(e.collapsed?"":" show"),e.cardHeadingId&&s.setAttribute("aria-labelledby",e.cardHeadingId),s.setAttribute("data-parent","#".concat(e.parentContainerId)),e.dataAttributes)for(var c in e.dataAttributes)e.dataAttributes.hasOwnProperty(c)&&s.setAttribute("data-".concat(c),e.dataAttributes[c]);var l=s.appendChild(document.createElement("div"));return l.className="card-body pl-2 pr-2 pl-md-3 pr-md-3",l.appendChild(e.bodyContentElement),t}}]),r}();function Ry(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}var Iy=function(e){So(r,Oy);var t=Ry(r);function r(){return n(this,r),t.apply(this,arguments)}return o(r,[{key:"body",value:function(){document.getElementById("body").innerHTML='<h2>Page not found</h2><p><a href="/app/list">Return to the homepage.</a>'}}]),r}();function My(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}var Ly=function(e){So(r,Tv);var t=My(r);function r(e){var o;return n(this,r),a(po(o=t.call(this)),"_survey",void 0),a(po(o),"section",void 0),o.section=e,o}return o(r,[{key:"formElement",get:function(){var e=Hc(mo(r.prototype),"formElement",this);return this._formFieldsBuilt||this.buildFormFields(),e}},{key:"updateModelFromContent",value:function(){for(var e in console.log("updating survey from SurveyForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];this._survey.attributes[e]=t.value}console.log({survey:this._survey})}},{key:"model",get:function(){return this._survey},set:function(e){this._survey=e,this.populateFormContent()}},{key:"changeHandler",value:function(e){console.log("survey form change event"),console.log({event:e}),this.fireEvent(Tv.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){Hc(mo(r.prototype),"destructor",this).call(this),this._survey=null}},{key:"initialiseFormFields",value:function(){var e=this.section.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"getFormSectionProperties",value:function(){return this.section.properties}}],[{key:"registerSection",value:function(e){r.sections[e.sectionSortOrder]=e,r.sectionsByKey[e.sectionNavigationKey]=e}}]),r}();function xy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(Ly,"sections",[]),a(Ly,"sectionsByKey",{});var Hy=function(e){So(r,Vp);var t=xy(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"SAVE_ENDPOINT","/savesurvey.php"),a(po(e),"TYPE","survey"),a(po(e),"attributes",{}),e}return o(r,[{key:"formChangedHandler",value:function(e){console.log("Survey change handler invoked."),e.form.updateModelFromContent(),e.form.conditionallyValidateForm(),this.touch(),this.fireEvent(r.EVENT_MODIFIED,{surveyId:this.id})}},{key:"registerForm",value:function(e){e.model=this,e.addListener(Tv.CHANGE_EVENT,this.formChangedHandler.bind(this))}},{key:"save",value:function(){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var e=new FormData;return e.append("type",this.TYPE),e.append("surveyId",this.id),e.append("id",this.id),e.append("projectId",this.projectId.toString()),e.append("attributes",JSON.stringify(this.attributes)),e.append("deleted",this.deleted.toString()),e.append("created",this.createdStamp.toString()),console.log("queueing survey post"),this.queuePost(e)}},{key:"generateSurveyName",value:function(){var e,t=(this.attributes.place||this.attributes.georef||"(unlocalised)").trim(),n=new Date(1e3*this.createdStamp);try{e=n.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}catch(t){e=n.toLocaleString("en-GB",{year:"numeric",month:"long",day:"numeric"})}return"".concat(Qp(t)," ").concat(e)}}]),r}();function ky(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(Hy,"EVENT_MODIFIED","modified");var Py=function(e){So(r,Vp);var t=ky(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"file",void 0),a(po(e),"TYPE","image"),a(po(e),"SAVE_ENDPOINT","/saveimage.php"),e}return o(r,[{key:"getUrl",value:function(){}},{key:"save",value:function(e,t,n){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var r=new FormData;return r.append("type",this.TYPE),r.append("surveyId",e||""),r.append("occurrenceId",t||this.occurrenceId),r.append("projectId",n?n.toString():""),r.append("imageId",this.id),r.append("id",this.id),r.append("image",this.file),r.append("deleted",this.deleted.toString()),console.log("queueing image post, image id ".concat(this.id)),this.queuePost(r)}},{key:"_parseDescriptor",value:function(e){Hc(mo(r.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId,this.occurrenceId=e.occurrenceId,this.file=e.image}}],[{key:"fromFile",value:function(e){var t=new r;return t.file=e,t}},{key:"placeholder",value:function(e){var t=new r;return t._id=e,r.imageCache.set(e,t),t}},{key:"imageLink",value:function(e,t,n,r){t=t||0,n=n||0;var o="";r.className&&(o+=' class="'.concat(r.className,'"'));var a=t>n?'width="'.concat(t,'"'):'height="'.concat(n,'"');return'<picture><source srcset="/image.php?imageid='.concat(e,'&amp;height=128&amp;format=webp" type="image/webp"><img').concat(o,' src="/image.php?imageid=').concat(e,"&amp;width=").concat(t,"&amp;height=").concat(n,'&amp;format=jpeg" ').concat(a,' alt="photo"></picture>')}}]),r}();function Ay(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Dy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dy(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function Dy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Uy(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}a(Py,"imageCache",new Map),a(Py,"EVENT_MODIFIED","modified");var jy=new WeakMap,Jy=new WeakMap,By=function(e){So(r,jp);var t=Fy(r);function r(){var e;return n(this,r),Uy(po(e=t.call(this)),jy,{writable:!0,value:void 0}),Uy(po(e),Jy,{writable:!0,value:void 0}),a(po(e),"controllers",[]),a(po(e),"currentControllerHandle",!1),a(po(e),"routeHistory",[]),a(po(e),"occurrences",void 0),a(po(e),"surveys",void 0),a(po(e),"currentSurvey",void 0),a(po(e),"layout",void 0),e.reset(),e}return o(r,[{key:"reset",value:function(){this.surveys=new Map,this.clearCurrentSurvey()}},{key:"clearCurrentSurvey",value:function(){this.occurrences=new Map,this.currentSurvey=null}},{key:"router",get:function(){return To(this,jy)},set:function(e){bo(this,jy,e)}},{key:"containerId",set:function(e){var t=document.getElementById(e);if(!t)throw new Error("App container '".concat(e,"' not found."));bo(this,Jy,t)}},{key:"container",get:function(){return To(this,Jy)}},{key:"registerController",value:function(e){e.handle=this.controllers.length,this.controllers[this.controllers.length]=e,e.app=this,e.registerRoute(To(this,jy))}},{key:"initialise",value:function(){var e=this;this.layout.initialise(),To(this,jy).notFound((function(e){console.log("no route found for '".concat(e,"'")),(new Iy).display()})),To(this,jy).on((function(){console.log("redirecting from '/' to '/list'"),To(e,jy).pause(),e.currentSurvey&&e.currentSurvey.isPristine?To(e,jy).navigate("/list/survey/welcome").resume():To(e,jy).navigate("/list").resume(),To(e,jy).resolve()}));var t,n=Ay(this.controllers);try{for(n.s();!(t=n.n()).done;){t.value.initialise()}}catch(e){n.e(e)}finally{n.f()}}},{key:"display",value:function(){console.log("App display"),To(this,jy).resolve()}},{key:"saveRoute",value:function(){var e=To(this,jy).lastRouteResolved();this.routeHistory.length?this.routeHistory[this.routeHistory.length-1]!==e&&(this.routeHistory[this.routeHistory.length]=e):this.routeHistory[0]=e}},{key:"markAllNotPristine",value:function(){var e,t=Ay(this.occurrences);try{for(t.s();!(e=t.n()).done;){e.value[1].isPristine=!1}}catch(e){t.e(e)}finally{t.f()}}},{key:"setLayout",value:function(e){this.layout=e,e.setApp(this)}},{key:"addSurvey",value:function(e){var t=this;if(e.projectId!==this.projectId)throw new Error("Survey project id '".concat(e.projectId," does not match with current project ('").concat(this.projectId,"')"));this.surveys.has(e.id)||(console.log("setting survey's modified/save handler"),e.addListener(Hy.EVENT_MODIFIED,(function(){return t.fireEvent(r.EVENT_SURVEYS_CHANGED),e.save()}))),this.surveys.set(e.id,e),this.fireEvent(r.EVENT_SURVEYS_CHANGED)}},{key:"haveExtantOccurrences",value:function(){var e,t=Ay(this.occurrences);try{for(t.s();!(e=t.n()).done;){if(!e.value.deleted)return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"addOccurrence",value:function(e){var t=this;if(!e.surveyId)throw new Rv("Survey id must set prior to registering occurrence.");0===this.occurrences.size&&(this.surveys.get(e.surveyId).createdStamp=e.createdStamp);console.log("in addOccurrence setting id '".concat(e.id,"'")),this.occurrences.set(e.id,e),e.addListener(Cv.EVENT_MODIFIED,(function(){var n=t.surveys.get(e.surveyId);if(!n)throw new Error("Failed to look up survey id ".concat(e.surveyId));n.isPristine=!1,n.unsaved()&&n.save(),e.save(n.id)}))}},{key:"refreshFromServer",value:function(e){var t,n=this,r=new FormData,o=0,a=Ay(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;r.append("surveyId[".concat(o++,"]"),i)}}catch(e){a.e(e)}finally{a.f()}return fetch(ExampleApp.LOAD_SURVEYS_ENDPOINT,{method:"POST",body:r}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response from server when refreshing survey ids")})).then((function(e){console.log({"refresh from server json response":e});var t=[];for(var r in e)if(e.hasOwnProperty(r)){var o,a=Ay(e[r]);try{for(a.s();!(o=a.n()).done;){var i=o.value;t.push(n._conditionallyReplaceObject(i))}}catch(e){a.e(e)}finally{a.f()}}return Promise.all(t)}))}},{key:"_conditionallyReplaceObject",value:function(e){var t=e.type,n=e.id,r="".concat(t,".").concat(n);return Bp.getItem(r).then((function(t){return t&&!e.deleted&&t.modified>=e.modified?(console.log("Local copy of ".concat(r," is the same or newer than the server copy. (").concat(t.modified," >= ").concat(e.modified,") ")),Promise.resolve()):(console.log("Adding or replacing local copy of ".concat(r)),Bp.setItem(r,e))}))}},{key:"seekKeys",value:function(e){return Bp.keys().then((function(t){var n,r=Ay(t);try{for(r.s();!(n=r.n()).done;){var o,a,i=n.value,s=JS(i.split(".",2),2);o=s[0],a=s[1],e.hasOwnProperty(o)?e[o].includes(a)||e[o].push(a):console.log("Unrecognised stored key type '".concat(o,"."))}}catch(e){r.e(e)}finally{r.f()}return e}))}},{key:"syncAll",value:function(){var e=this;return this.seekKeys({survey:[],occurrence:[],image:[]}).then((function(t){return e._syncLocalUnsaved(t)}),(function(e){return console.log("Failed to sync all: ".concat(e)),!1}))}},{key:"_syncLocalUnsaved",value:function(e){var t,n=[],r=Ay(e.survey);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(Hy.retrieveFromLocal(o,new Hy).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){r.e(e)}finally{r.f()}var a,i=Ay(e.occurrence);try{for(i.s();!(a=i.n()).done;){var s=a.value;n.push(Cv.retrieveFromLocal(s,new Cv).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){i.e(e)}finally{i.f()}var c,l=Ay(e.image);try{for(l.s();!(c=l.n()).done;){var u=c.value;n.push(Py.retrieveFromLocal(u,new Py).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){l.e(e)}finally{l.f()}return Promise.all(n).catch((function(e){console.log("Save failure: ".concat(e))}))}},{key:"restoreOccurrences",value:function(e){var t=this;if(this.surveys.has(e)){var n=this.surveys.get(e);if(n.isPristine)return this.clearCurrentSurvey(),this.currentSurvey=n,this.fireEvent(r.EVENT_SURVEYS_CHANGED),Promise.resolve()}var o={survey:[],occurrence:[],image:[]};return e&&(o.survey[0]=e),console.log("pre-seek keys"),console.log(o),this.seekKeys(o).then((function(e){return e.survey.length?t.refreshFromServer(e.survey).finally((function(){return t.seekKeys(e)})):null})).finally((function(){return o.survey.length?t._restoreSurveyFromLocal(o.survey[0],o).finally((function(){return t.currentSurvey=t.surveys.get(o.survey[0]),t.currentSurvey?(t.currentSurvey.deleted?t.setNewSurvey():t.fireEvent(r.EVENT_SURVEYS_CHANGED),Promise.resolve()):(console.log("Failed to retrieve survey id '".concat(e,"'")),Promise.reject(new Error("Failed to retrieve survey id '".concat(e,"'"))))})):(t.setNewSurvey(),Promise.resolve())}))}},{key:"setNewSurvey",value:function(){this.currentSurvey=new Hy,this.currentSurvey.projectId=this.projectId,this.currentSurvey.isPristine=!0,this.addSurvey(this.currentSurvey)}},{key:"addNewOccurrence",value:function(){var e=new Cv;return e.surveyId=this.currentSurvey.id,e.projectId=this.projectId,e.isNew=!0,e.isPristine=!0,this.addOccurrence(e),this.fireEvent(ExampleApp.EVENT_OCCURRENCE_ADDED,{occurrenceId:e.id,surveyId:e.surveyId}),e}},{key:"_restoreSurveyFromLocal",value:function(e,t){var n=this;return Hy.retrieveFromLocal(e,new Hy).then((function(r){n.clearCurrentSurvey(),n.addSurvey(r);var o,a=[],i=Ay(t.occurrence);try{var s=function(){var t=o.value;a.push(Cv.retrieveFromLocal(t,new Cv).then((function(r){r.surveyId===e&&(console.log("adding occurrence ".concat(t)),n.addOccurrence(r))})))};for(i.s();!(o=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}return Promise.all(a)})).finally((function(){var n,r=[],o=Ay(t.image);try{var a=function(){var t=n.value;r.push(Py.retrieveFromLocal(t,new Py).then((function(n){console.log("restoring image id '".concat(t,"'")),n.surveyId===e&&Py.imageCache.set(t,n)}),(function(e){console.log("Failed to retrieve an image: ".concat(e))})))};for(o.s();!(n=o.n()).done;)a()}catch(e){o.e(e)}finally{o.f()}return Promise.all(r)}))}},{key:"clearLocalForage",value:function(){return Bp.clear()}}]),r}();function Yy(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Gy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gy(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function Gy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ky(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(By,"EVENT_ADD_SURVEY_USER_REQUEST","useraddsurveyrequest"),a(By,"EVENT_RESET_SURVEYS","userresetsurveys"),a(By,"LOAD_SURVEYS_ENDPOINT","/loadsurveys.php"),a(By,"EVENT_OCCURRENCE_ADDED","occurrenceadded"),a(By,"EVENT_SURVEYS_CHANGED","surveyschanged"),a(By,"devMode",!1);var Vy=function(e){So(r,jp);var t=Ky(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"app",void 0),a(po(e),"surveysMenuId",void 0),e}return o(r,[{key:"setApp",value:function(e){var t=this;this.app=e,e.addListener(By.EVENT_SURVEYS_CHANGED,(function(){t.refreshSurveysMenu()}))}},{key:"initialise",value:function(){var e=this;this.refreshSurveysMenu();var t=document.createElement("div");t.innerHTML='\x3c!-- begin: templates/newSurveyModal.html --\x3e\r\n<div class="modal fade" id="newsurveymodal" tabindex="-1" role="dialog" aria-labelledby="newsurveymodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="newsurveymodalTitle">Start a new survey?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to start a new survey. You only need to do this if you wish to send a set of records from a different locality, otherwise please add more records to your current report.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="newsurveymodalconfirmed">New survey</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/newSurveyModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/resetModal.html --\x3e\r\n<div class="modal fade" id="resetmodal" tabindex="-1" role="dialog" aria-labelledby="resetmodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="resetmodalTitle">Reset?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to clear out your survey data.\r\n                <p>Warning: any unsaved changes will be lost.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="resetmodalconfirmed">Reset</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/resetModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncSuccessModal.html --\x3e\r\n<div class="modal fade" id="saveallsuccess" tabindex="-1" role="dialog" aria-labelledby="saveallsuccessTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallsuccessTitle">All records sent</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Your data has been synchronised with the server.\r\n                <p>Thank you.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncSuccessModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncFailureModal.html --\x3e\r\n<div class="modal fade" id="saveallfailure" tabindex="-1" role="dialog" aria-labelledby="saveallfailureTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallfailureTitle">One or more records could not be saved</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please check your connection to the network and try again.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncFailureModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),setTimeout((function(){document.getElementById("".concat(r.NEW_SURVEY_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(By.EVENT_ADD_SURVEY_USER_REQUEST)})),document.getElementById("".concat(r.RESET_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(By.EVENT_RESET_SURVEYS)}))}),100)}},{key:"refreshSurveysMenu",value:function(){var e,t=document.getElementById(this.surveysMenuId),n=[],r=this.app.currentSurvey?this.app.currentSurvey.id:null,o=Yy(this.app.surveys);try{for(o.s();!(e=o.n()).done;){var a=e.value,i=a[1].generateSurveyName()+(a[0]===r?' <span style="color: green">â</span>':"");n[n.length]='<a class="dropdown-item" href="/app/survey/add/'.concat(a[0],'" data-navigo="survey/add/').concat(a[0],'">').concat(i,"</a>")}}catch(e){o.e(e)}finally{o.f()}t.innerHTML='<a class="dropdown-item" href="/app/survey/save" data-navigo="survey/save">save all</a>\n    <div class="dropdown-divider"></div>\n    '.concat(n.join(""),'\n    <div class="dropdown-divider"></div>\n    <a class="dropdown-item" href="/app/survey/new" data-navigo="survey/new">new survey</a>\n    <a class="dropdown-item" href="/app/survey/reset" data-navigo="survey/reset">reset</a>'),this.app.router.updatePageLinks()}}]),r}();function Xy(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}a(Vy,"NEW_SURVEY_MODAL_ID","newsurveymodal"),a(Vy,"RESET_MODAL_ID","resetmodal"),a(Vy,"SAVE_ALL_SUCCESS_MODAL_ID","saveallsuccess"),a(Vy,"SAVE_ALL_FAILURE_MODAL_ID","saveallfailure");var qy=function(e){So(r,l);var t=Xy(r);function r(e){var o;return n(this,r),a(po(o=t.call(this)),"route","/survey/:action/:id"),a(po(o),"title","Survey picker"),a(po(o),"app",void 0),a(po(o),"view",void 0),o.view=e,e.controller=po(o),o.handle=l.nextHandle,o}return o(r,[{key:"survey",get:function(){return this.app.currentSurvey}},{key:"registerRoute",value:function(e){e.on("/survey",this.mainRouteHandler.bind(this,"survey","",""),{}),e.on("/survey/new",this.newSurveyHandler.bind(this,"survey","new",""),{before:this.beforeNewHandler.bind(this)}),e.on("/survey/reset",this.mainRouteHandler.bind(this,"survey","reset",""),{before:this.beforeResetHandler.bind(this)}),e.on("/survey/save",this.mainRouteHandler.bind(this,"survey","save",""),{before:this.beforeSaveAllHandler.bind(this)}),e.on("/survey/add/:surveyId",this.addSurveyHandler.bind(this,"survey","add","")),this.app.addListener(By.EVENT_ADD_SURVEY_USER_REQUEST,this.addNewSurveyHandler.bind(this)),this.app.addListener(By.EVENT_RESET_SURVEYS,this.resetSurveysHandler.bind(this))}},{key:"beforeNewHandler",value:function(e){$("#".concat(Vy.NEW_SURVEY_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeResetHandler",value:function(e){$("#".concat(Vy.RESET_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeSaveAllHandler",value:function(e){this.app.syncAll().then((function(e){console.log("In save all handler, success result: ".concat(e)),Array.isArray(e)?$("#".concat(Vy.SAVE_ALL_SUCCESS_MODAL_ID)).modal():$("#".concat(Vy.SAVE_ALL_FAILURE_MODAL_ID)).modal()}),(function(e){console.log("In save all handler, failure result: ".concat(e)),$("#".concat(Vy.SAVE_ALL_FAILURE_MODAL_ID)).modal()})).finally((function(){})),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"newSurveyHandler",value:function(e,t,n,r){}},{key:"addNewSurveyHandler",value:function(){console.log("reached addNewSurveyHandler"),this.app.currentControllerHandle=this.handle,this.app.clearCurrentSurvey(),this.app.setNewSurvey(),this.app.router.pause(),this.app.router.navigate("/list/survey/welcome").resume(),this.app.router.resolve()}},{key:"resetSurveysHandler",value:function(){var e=this;this.app.clearLocalForage().then((function(){e.app.reset(),e.addNewSurveyHandler()}))}},{key:"addSurveyHandler",value:function(e,t,n,r){var o=this;console.log("reached addSurveyHandler"),console.log({context:e,params:t,query:r}),this.app.currentControllerHandle=this.handle;var a=r.surveyId;if(!a||!a.match(Kp))throw new xc("Failed to match survey id '".concat(a,"', the id format appears to be incorrect"));a=a.toLowerCase(),this.app.restoreOccurrences(a).then((function(){o.app.markAllNotPristine(),o.app.router.pause(),o.app.router.navigate("/list").resume(),o.app.router.resolve()}),(function(e){console.log({"failed survey restoration":e})}))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for SurveyPickerController.js"),console.log({context:e,params:t,query:r})}}]),r}();a(qy,"EVENT_BACK","back");var Qy=ir,Wy=ra,Zy=M,$y=Nn,zy=Ua,eN=at,tN=ay,nN=rl,rN=ce,oN=pt.exports,aN=S,iN=Ol,sN=vf,cN=_f,lN=Gt,uN=ke("matchAll"),dN=lN.set,fN=lN.getterFor("RegExp String Iterator"),hN=RegExp.prototype,pN="".matchAll,vN=!!pN&&!aN((function(){"a".matchAll(/./)})),SN=Wy((function(e,t,n,r){dN(this,{type:"RegExp String Iterator",regexp:e,string:t,global:n,unicode:r,done:!1})}),"RegExp String",(function(){var e=fN(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,n=e.string,r=cN(t,n);return null===r?{value:void 0,done:e.done=!0}:e.global?(""===zy(r[0])&&(t.lastIndex=sN(n,$y(t.lastIndex),e.unicode)),{value:r,done:!1}):(e.done=!0,{value:r,done:!1})})),yN=function(e){var t,n,r,o,a,i,s=eN(this),c=zy(e);return t=iN(s,RegExp),void 0===(n=s.flags)&&s instanceof RegExp&&!("flags"in hN)&&(n=nN.call(s)),r=void 0===n?"":zy(n),o=new t(t===RegExp?s.source:s,r),a=!!~r.indexOf("g"),i=!!~r.indexOf("u"),o.lastIndex=$y(s.lastIndex),new SN(o,c,a,i)};Qy({target:"String",proto:!0,forced:vN},{matchAll:function(e){var t,n,r=Zy(this);if(null!=e){if(tN(e)&&!~zy(Zy("flags"in hN?e.flags:nN.call(e))).indexOf("g"))throw TypeError("`.matchAll` does not allow non-global regexes");if(vN)return pN.apply(r,arguments);if(n=rN(e,uN))return n.call(e,r)}else if(vN)return pN.apply(r,arguments);return t=zy(r),new RegExp(e,"g")[uN](t)}}),uN in hN||oN(hN,uN,yN);var NN=xs.map;function mN(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return gN(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gN(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function gN(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}ir({target:"Array",proto:!0,forced:!Jc("map")},{map:function(e){return NN(this,e,arguments.length>1?arguments[1]:void 0)}});var bN=function(){function e(){n(this,e)}return o(e,null,[{key:"fromPostedData",value:function(t){var n,r={saveState:"SAVED_LOCALLY"},o=mN(t.entries());try{for(o.s();!(n=o.n()).done;){var a=n.value;r[a[0]]=a[1]}}catch(e){o.e(e)}finally{o.f()}if(!r.type)throw new Error("Missing type in form data.");if(e.responses.hasOwnProperty(r.type))return new e.responses[r.type](r,{});throw new Error("Unrecognised post type '".concat(r.type,"'"))}},{key:"fromPostResponse",value:function(t){if(!t)throw new Error("Invalid empty post response.");if(!t.type)throw new Error("Missing type in returned response.");if(e.responses.hasOwnProperty(t.type))return console.log("in fromPostResponse returning a ".concat(t.type)),new e.responses[t.type]({},t);throw new Error("Unrecognised post type '".concat(t.type,"'"))}}]),e}();function TN(e){var t=new Headers;return t.set("Content-Type","application/json"),new Response(JSON.stringify(e),{status:e.error?500:200,headers:t})}a(bN,"responses",{});var EN=function(){function e(t,r){n(this,e),a(this,"toSaveLocally",void 0),a(this,"returnedToClient",void 0),a(this,"prebuiltResponse",void 0),a(this,"failureErrorMessage","Failed to save a local copy on your device."),a(this,"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),this.toSaveLocally=t,this.returnedToClient=r}return o(e,[{key:"setPrebuiltResponse",value:function(e){return this.prebuiltResponse=e,this}},{key:"storeLocally",value:function(){var e=this;return Bp.setItem(this.localKey(),this.toSaveLocally).then((function(){return console.log("Stored object ".concat(e.localKey()," locally")),e.prebuiltResponse?e.prebuiltResponse:TN(e.returnedToClient)}),(function(t){return console.log("Failed to store object ".concat(e.localKey()," locally")),console.log({reason:t}),e.returnedToClient.error=e.failureErrorMessage,e.returnedToClient.errorHelp=e.failureErrorHelp,TN(e.returnedToClient)}))}},{key:"localKey",value:function(){throw new Error("LocalKey must be implemented in a subclass for ".concat(this.toSaveLocally.type))}}]),e}();function wN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}var _N=function(e){So(r,EN);var t=wN(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"failureErrorMessage","Failed to store image."),a(po(e),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),e}return o(r,[{key:"populateClientResponse",value:function(){return this.returnedToClient.id=this.toSaveLocally.imageId?this.toSaveLocally.imageId:this.toSaveLocally.id,this.returnedToClient.imageId=this.toSaveLocally.imageId?this.toSaveLocally.imageId:this.toSaveLocally.id,this.returnedToClient.type="image",this.returnedToClient.surveyId=this.toSaveLocally.surveyId,this.returnedToClient.occurrenceId=this.toSaveLocally.occurrenceId,this.returnedToClient.created=parseInt(this.toSaveLocally.created,10),this.returnedToClient.modified=parseInt(this.toSaveLocally.modified,10),this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=parseInt(this.toSaveLocally.projectId,10),this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.surveyId,this.toSaveLocally.type="image",this.toSaveLocally.occurrenceId=this.returnedToClient.occurrenceId,this.toSaveLocally.imageId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.imageId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.imageId,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=!0===this.returnedToClient.deleted||"true"===this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"image.".concat(this.toSaveLocally.imageId)}}],[{key:"register",value:function(){bN.responses.image=r}}]),r}();function CN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}var ON=function(e){So(r,EN);var t=CN(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"failureErrorMessage","Failed to store survey."),a(po(e),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),e}return o(r,[{key:"populateClientResponse",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.returnedToClient.type="survey",this.returnedToClient.attributes=this.toSaveLocally.attributes,this.returnedToClient.created=this.toSaveLocally.created,this.returnedToClient.modified=this.toSaveLocally.modified,this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=this.toSaveLocally.projectId,this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.type="survey",this.toSaveLocally.attributes=this.returnedToClient.attributes,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"survey.".concat(this.toSaveLocally.surveyId)}}],[{key:"register",value:function(){bN.responses.survey=r}}]),r}();function RN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}var IN=function(e){So(r,EN);var t=RN(r);function r(){var e;n(this,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return a(po(e=t.call.apply(t,[this].concat(i))),"failureErrorMessage","Failed to store occurrence."),a(po(e),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),e}return o(r,[{key:"populateClientResponse",value:function(){return this.returnedToClient.id=this.toSaveLocally.occurrenceId?this.toSaveLocally.occurrenceId:this.toSaveLocally.id,this.returnedToClient.occurrenceId=this.toSaveLocally.occurrenceId?this.toSaveLocally.occurrenceId:this.toSaveLocally.id,this.returnedToClient.type="occurrence",this.returnedToClient.surveyId=this.toSaveLocally.surveyId,this.returnedToClient.attributes=this.toSaveLocally.attributes,this.returnedToClient.created=parseInt(this.toSaveLocally.created,10),this.returnedToClient.modified=parseInt(this.toSaveLocally.modified,10),this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=parseInt(this.toSaveLocally.projectId,10),this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.occurrenceId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.occurrenceId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.occurrenceId,this.toSaveLocally.type="occurrence",this.toSaveLocally.surveyId=this.returnedToClient.surveyId,this.toSaveLocally.attributes=this.returnedToClient.attributes,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=!0===this.returnedToClient.deleted||"true"===this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"occurrence.".concat(this.toSaveLocally.occurrenceId)}}],[{key:"register",value:function(){bN.responses.occurrence=r}}]),r}(),MN=function(){function e(){n(this,e),a(this,"URL_CACHE_SET",void 0)}return o(e,[{key:"initialise",value:function(e){var t=this;Promise.prototype.finally||(Promise.prototype.finally=function(e){return this.then(e).catch(e)}),_N.register(),ON.register(),IN.register(),this.CACHE_VERSION="version-1.0.2.1634056820-".concat(e.version);var n=e.postPassThroughWhitelist,r=e.postImageUrlMatch,o=e.getImageUrlMatch,a=e.interceptUrlMatches,i=e.ignoreUrlMatches,s=e.indexUrl;this.URL_CACHE_SET=e.urlCacheSet,Bp.config({name:e.forageName}),self.addEventListener("install",(function(e){console.log("BSBI app service worker is being installed."),self.skipWaiting(),e.waitUntil(t.precache().then((function(){return self.skipWaiting()})))})),self.addEventListener("activate",(function(e){e.waitUntil(self.clients.matchAll({includeUncontrolled:!0}).then((function(e){var t=e.map((function(e){return e.url}));console.log("[ServiceWorker] Matching clients:",t.join(", "))})).then((function(){return caches.keys()})).then((function(e){return Promise.all(e.map((function(e){if(e!==t.CACHE_VERSION)return console.log("[ServiceWorker] Deleting old cache:",e),caches.delete(e)})))})).then((function(){return console.log("[ServiceWorker] Claiming clients for version",t.CACHE_VERSION),self.clients.claim()})))})),self.addEventListener("fetch",(function(e){if(console.log("The service worker is serving: '".concat(e.request.url,"'")),e.preventDefault(),"POST"===e.request.method)console.log("Got a post request"),e.request.url.match(n)?(console.log("Passing through whitelisted post request for: ".concat(e.request.url)),e.respondWith(fetch(e.request))):e.request.url.match(r)?t.handle_image_post(e):t.handle_post(e);else if(a.test(e.request.url)&&!i.test(e.request.url)){console.log("redirecting to the root of the SPA");var c=new Request(s);e.respondWith(t.fromCache(c)),e.waitUntil(t.update(c))}else e.request.url.match(o)?(console.log("request is for an image '".concat(e.request.url,"'")),t.handleImageFetch(e)):(console.log("request is for non-image '".concat(e.request.url,"'")),e.respondWith(t.fromCache(e.request)),e.waitUntil(t.update(e.request)))}))}},{key:"handle_post",value:function(e){var t;try{t=e.request.clone()}catch(e){console.log("Failed to clone request."),console.log({"Cloning error":e})}e.respondWith(fetch(e.request).then((function(e){return e.ok?Promise.resolve(e).then((function(e){return e.clone().json()})).then((function(t){return console.log("Following successful remote post about to save locally."),bN.fromPostResponse(t).setPrebuiltResponse(e).populateLocalSave().storeLocally()})).catch((function(t){return console.log({error:t}),Promise.resolve(e)})):(console.log("Failed to save, moving on to attempt IndexedDb"),Promise.reject("Failed to save to server."))})).catch((function(e){return console.log("post fetch failed (probably no network), (reason: ".concat(e,")")),t.formData().then((function(e){return console.log("got to form data handler"),bN.fromPostedData(e).populateClientResponse().storeLocally()}),(function(e){console.log("failed to read form data locally"),console.log({reason:e});return TN({error:"Failed to process posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})}))})))}},{key:"handle_image_post",value:function(e){var t;console.log("posting image");try{t=e.request.clone()}catch(e){console.log("Failed to clone request."),console.log({"Cloning error":e})}e.respondWith(t.formData().then((function(e){return console.log("got to form data handler"),bN.fromPostedData(e).populateClientResponse().storeLocally()}),(function(e){console.log("failed to read form data locally"),console.log({reason:e});return TN({error:"Failed to process posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})}))),e.waitUntil(fetch(e.request).then((function(e){if(console.log("posted image to server in waitUntil part of fetch cycle"),e.ok)return console.log("posted image to server in waitUntil part of fetch cycle: got OK response"),Promise.resolve(e).then((function(e){return e.clone().json()})).then((function(t){return bN.fromPostResponse(t).setPrebuiltResponse(e).populateLocalSave().storeLocally()})).catch((function(t){return console.log({error:t}),Promise.resolve(e)}));return TN({error:"Failed to save posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})})))}},{key:"precache",value:function(){var e=this;return caches.open(this.CACHE_VERSION).then((function(t){return t.addAll(e.URL_CACHE_SET)}))}},{key:"fromCache",value:function(e){var t=this;return console.log("attempting fromCache response"),caches.open(this.CACHE_VERSION).then((function(n){return console.log("cache is open"),n.match(e).then((function(n){return console.log(n?"cache matched ".concat(e.url):"no cache match for ".concat(e.url)),n||t.update(e)}))}))}},{key:"handleImageFetch",value:function(e){var t=this;e.respondWith(this.fromCache(e.request).then((function(n){if(console.log("In handleImageFetch promise"),n&&n.ok)return console.log("Responding with image from cache (or remotely if no cache)."),n;var r=e.request.url;console.log("Attempting image match for '".concat(r,"'"));var o=r.match(/imageid=([a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12})/);if(o){var a=o[1];return console.log("Returning image match for '".concat(r,"' from local database")),t.imageFromLocalDatabase(a)}console.log("Failed to match image id in url '".concat(r,"'"))})).catch((function(n){var r=e.request.url;console.log(n),console.log("caught ".concat(n)),console.log("In catch following failed network fetch, attempting image match for '".concat(r,"'"));var o=r.match(/imageid=([a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12})/);if(o){var a=o[1];return console.log("(via catch) Returning image match for '".concat(r,"' from local database")),t.imageFromLocalDatabase(a)}console.log("(via catch) Failed to match image id in url '".concat(r,"'"))})))}},{key:"imageFromLocalDatabase",value:function(e){var t=new Py;return console.log("attempting retrieval of image data from local database"),Vp.retrieveFromLocal(e,t).then((function(t){if(console.log("Retrieved image '".concat(e,"' from indexeddb.")),t.file)return(new Headers).append("Content-Type",t.file.type),new Response(t.file,{status:200,statusText:"OK image response from IndexedDb"});console.log("No local file object associated with retrieved image '".concat(e,"' from indexeddb."))}))}},{key:"update",value:function(e){return e=new Request(e,{mode:"cors",credentials:"omit"}),console.log("Attempting fetch and cache update of ".concat(e.url)),caches.open(this.CACHE_VERSION).then((function(t){return fetch(e,{cache:"no-cache"}).then((function(n){return n.ok?(console.log("(re-)caching ".concat(e.url)),t.put(e,n).then((function(){return t.match(e)}))):(console.log("Request during cache update failed for ".concat(e.url)),console.log({"failed cache response":n}),Promise.reject("Request during cache update failed, not caching."))})).catch((function(t){console.log("Cache attempt failed for ".concat(e.url,": error was ").concat(t))}))}))}}]),e}(),LN="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function xN(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function HN(e,t,n){this.root=null,this._routes=[],this._useHash=t,this._hash=void 0===n?"#":n,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!t&&xN(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=t?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):t&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function kN(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function PN(e,t){return 0===t.length?null:e?e.slice(1,e.length).reduce((function(e,n,r){return null===e&&(e={}),e[t[r]]=decodeURIComponent(n),e}),null):null}function AN(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(HN.PARAMETER_REGEXP,(function(e,n,r){return t.push(r),HN.REPLACE_VARIABLE_REGEXP})).replace(HN.WILDCARD_REGEXP,HN.REPLACE_WILDCARD)+HN.FOLLOWED_BY_SLASH_REGEXP,HN.MATCH_REGEXP_FLAGS),paramNames:t}}function DN(e){return e.replace(/\/$/,"").split("/").length}function FN(e,t){return DN(t)-DN(e)}function UN(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){var n=AN(kN(t.route)),r=n.regexp,o=n.paramNames,a=e.replace(/^\/+/,"/").match(r),i=PN(a,o);return!!a&&{match:a,route:t,params:i}})).filter((function(e){return e}))}(e,t)[0]||!1}function jN(e,t){var n=t.map((function(t){return""===t.route||"*"===t.route?e:e.split(new RegExp(t.route+"($|/)"))[0]})),r=kN(e);return n.length>1?n.reduce((function(e,t){return e.length>t.length&&(e=t),e}),n[0]):1===n.length?n[0]:r}function JN(e,t,n){var r,o=function(e){return e.split(/\?(.*)?$/)[0]};return void 0===n&&(n="#"),xN()&&!t?o(e).split(n)[0]:(r=e.split(n)).length>1?o(r[1]):o(r[0])}function BN(e,t,n){if(t&&"object"===(void 0===t?"undefined":LN(t))){if(t.before)return void t.before((function(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r&&(e(),t.after&&t.after(n))}),n);if(t.after)return e(),void(t.after&&t.after(n))}e()}function YN(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}HN.prototype={helpers:{match:UN,root:jN,clean:kN,getOnlyURL:JN},navigate:function(e,t){var n;return e=e||"",this._usePushState?(n=(n=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",n),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if("function"==typeof n[0])this._defaultHandler={handler:n[0],hooks:n[1]};else if(n.length>=2)if("/"===n[0]){var o=n[1];"object"===LN(n[1])&&(o=n[1].uses),this._defaultHandler={handler:o,hooks:n[2]}}else this._add(n[0],n[1],n[2]);else if("object"===LN(n[0])){var a=Object.keys(n[0]).sort(FN);a.forEach((function(t){e.on(t,n[0][t])}))}return this},off:function(e){return null!==this._defaultHandler&&e===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&e===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce((function(t,n){return n.handler!==e&&t.push(n),t}),[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var t,n,r=this,o=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(o=o.replace(new RegExp("^/"+this._hash),"/"));var a=function(e){return e.split(/\?(.*)?$/).slice(1).join("")}(e||this._cLoc()),i=JN(o,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&i===this._lastRouteResolved.url&&a===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(n=UN(i,this._routes))?(this._callLeave(),this._lastRouteResolved={url:i,query:a,hooks:n.route.hooks,params:n.params,name:n.route.name},t=n.route.handler,BN((function(){BN((function(){n.route.route instanceof RegExp?t.apply(void 0,n.match.slice(1,n.match.length)):t(n.params,a)}),n.route.hooks,n.params,r._genericHooks)}),this._genericHooks,n.params),n):this._defaultHandler&&(""===i||"/"===i||i===this._hash||function(e,t,n){if(xN()&&!t)return!1;if(!e.match(n))return!1;var r=e.split(n);return r.length<2||""===r[1]}(i,this._useHash,this._hash))?(BN((function(){BN((function(){r._callLeave(),r._lastRouteResolved={url:i,query:a,hooks:r._defaultHandler.hooks},r._defaultHandler.handler(a)}),r._defaultHandler.hooks)}),this._genericHooks),!0):(this._notFoundHandler&&BN((function(){BN((function(){r._callLeave(),r._lastRouteResolved={url:i,query:a,hooks:r._notFoundHandler.hooks},r._notFoundHandler.handler(a)}),r._notFoundHandler.hooks)}),this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var e=this;"undefined"!=typeof document&&this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(n){if((n.ctrlKey||n.metaKey)&&"a"==n.target.tagName.toLowerCase())return!1;var r=e.getLinkPath(t);e._destroyed||(n.preventDefault(),e.navigate(r.replace(/\/+$/,"").replace(/^\/+/,"/")))})),t.hasListenerAttached=!0)}))},generate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._routes.reduce((function(n,r){var o;if(r.name===e)for(o in n=r.route,t)n=n.toString().replace(":"+o,t[o]);return n}),"");return this._useHash?this._hash+n:n},link:function(e){return this._getRoot()+e},pause:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=e,this._historyAPIUpdateMethod=e?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=e,e)},disableIfAPINotAvailable:function(){xN()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof e&&(e=encodeURI(e)),this._routes.push("object"===(void 0===t?"undefined":LN(t))?{route:e,handler:t.uses,name:t.as,hooks:n||t.hooks}:{route:e,handler:t,hooks:n}),this._add},_getRoot:function(){return null!==this.root||(this.root=jN(this._cLoc().split("?")[0],this._routes)),this.root},_listen:function(){var e=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var t=this._cLoc(),n=void 0,r=void 0;(r=function(){n=e._cLoc(),t!==n&&(t=n,e.resolve()),e._listeningInterval=setTimeout(r,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:kN(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var e=this._lastRouteResolved;e&&e.hooks&&e.hooks.leave&&e.hooks.leave(e.params)}},HN.PARAMETER_REGEXP=/([:*])(\w+)/g,HN.WILDCARD_REGEXP=/\*/g,HN.REPLACE_VARIABLE_REGEXP="([^/]+)",HN.REPLACE_WILDCARD="(?:.*)",HN.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",HN.MATCH_REGEXP_FLAGS="";var GN=function(e){So(r,HN);var t=YN(r);function r(){return n(this,r),t.apply(this,arguments)}return o(r,[{key:"updatePageLinks",value:function(){var e=this;if("undefined"!=typeof document){var t=document.createElement("a");t.href=this.root;var n=t.pathname;this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(r){if((r.ctrlKey||r.metaKey)&&"a"==r.target.tagName.toLowerCase())return!1;if(!e._destroyed){var o=t.pathname.replace(n,"");r.preventDefault(),e.navigate(o)}})),t.hasListenerAttached=!0)}))}}}]),r}(),KN=y,VN=p,XN=$n,qN=ns,QN=ht,WN=rt.f,ZN=cn.f,$N=ay,zN=Ua,em=rl,tm=Pd,nm=pt.exports,rm=S,om=be,am=Gt.enforce,im=El,sm=jd,cm=Yd,lm=ke("match"),um=VN.RegExp,dm=um.prototype,fm=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,hm=/a/g,pm=/a/g,vm=new um(hm)!==hm,Sm=tm.UNSUPPORTED_Y,ym=KN&&(!vm||Sm||sm||cm||rm((function(){return pm[lm]=!1,um(hm)!=hm||um(pm)==pm||"/a/i"!=um(hm,"i")})));if(XN("RegExp",ym)){for(var Nm=function(e,t){var n,r,o,a,i,s,c=this instanceof Nm,l=$N(e),u=void 0===t,d=[],f=e;if(!c&&l&&u&&e.constructor===Nm)return e;if((l||e instanceof Nm)&&(e=e.source,u&&(t="flags"in f?f.flags:em.call(f))),e=void 0===e?"":zN(e),t=void 0===t?"":zN(t),f=e,sm&&"dotAll"in hm&&(r=!!t&&t.indexOf("s")>-1)&&(t=t.replace(/s/g,"")),n=t,Sm&&"sticky"in hm&&(o=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,"")),cm&&(e=(a=function(e){for(var t,n=e.length,r=0,o="",a=[],i={},s=!1,c=!1,l=0,u="";r<=n;r++){if("\\"===(t=e.charAt(r)))t+=e.charAt(++r);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:fm.test(e.slice(r+1))&&(r+=2,c=!0),o+=t,l++;continue;case">"===t&&c:if(""===u||om(i,u))throw new SyntaxError("Invalid capture group name");i[u]=!0,a.push([u,l]),c=!1,u="";continue}c?u+=t:o+=t}return[o,a]}(e))[0],d=a[1]),i=qN(um(e,t),c?this:dm,Nm),(r||o||d.length)&&(s=am(i),r&&(s.dotAll=!0,s.raw=Nm(function(e){for(var t,n=e.length,r=0,o="",a=!1;r<=n;r++)"\\"!==(t=e.charAt(r))?a||"."!==t?("["===t?a=!0:"]"===t&&(a=!1),o+=t):o+="[\\s\\S]":o+=t+e.charAt(++r);return o}(e),n)),o&&(s.sticky=!0),d.length&&(s.groups=d)),e!==f)try{QN(i,"source",""===f?"(?:)":f)}catch(e){}return i},mm=function(e){e in Nm||WN(Nm,e,{configurable:!0,get:function(){return um[e]},set:function(t){um[e]=t}})},gm=ZN(um),bm=0;gm.length>bm;)mm(gm[bm++]);dm.constructor=Nm,Nm.prototype=dm,nm(VN,"RegExp",Nm)}im("RegExp");var Tm=Math.floor,Em=function(e,t){var n=e.length,r=Tm(n/2);return n<8?wm(e,t):_m(Em(e.slice(0,r),t),Em(e.slice(r),t),t)},wm=function(e,t){for(var n,r,o=e.length,a=1;a<o;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},_m=function(e,t,n){for(var r=e.length,o=t.length,a=0,i=0,s=[];a<r||i<o;)a<r&&i<o?s.push(n(e[a],t[i])<=0?e[a++]:t[i++]):s.push(a<r?e[a++]:t[i++]);return s},Cm=Em,Om=J.match(/firefox\/(\d+)/i),Rm=!!Om&&+Om[1],Im=/MSIE|Trident/.test(J),Mm=J.match(/AppleWebKit\/(\d+)\./),Lm=!!Mm&&+Mm[1],xm=ir,Hm=ie,km=Ne,Pm=gn,Am=Ua,Dm=S,Fm=Cm,Um=Ep,jm=Rm,Jm=Im,Bm=q,Ym=Lm,Gm=[],Km=Gm.sort,Vm=Dm((function(){Gm.sort(void 0)})),Xm=Dm((function(){Gm.sort(null)})),qm=Um("sort"),Qm=!Dm((function(){if(Bm)return Bm<70;if(!(jm&&jm>3)){if(Jm)return!0;if(Ym)return Ym<603;var e,t,n,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Gm.push({k:t+r,v:n})}for(Gm.sort((function(e,t){return t.v-e.v})),r=0;r<Gm.length;r++)t=Gm[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return"DGBEFHACIJK"!==o}}));xm({target:"Array",proto:!0,forced:Vm||!Xm||!qm||!Qm},{sort:function(e){void 0!==e&&Hm(e);var t=km(this);if(Qm)return void 0===e?Km.call(t):Km.call(t,e);var n,r,o=[],a=Pm(t);for(r=0;r<a;r++)r in t&&o.push(t[r]);for(n=(o=Fm(o,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Am(t)>Am(n)?1:-1}}(e))).length,r=0;r<n;)t[r]=o[r++];for(;r<a;)delete t[r++];return t}});var Wm=ir,Zm=vn,$m=dn,zm=gn,eg=Ne,tg=ws,ng=Dc,rg=Jc("splice"),og=Math.max,ag=Math.min;Wm({target:"Array",proto:!0,forced:!rg},{splice:function(e,t){var n,r,o,a,i,s,c=eg(this),l=zm(c),u=Zm(e,l),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=l-u):(n=d-2,r=ag(og($m(t),0),l-u)),l+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(o=tg(c,r),a=0;a<r;a++)(i=u+a)in c&&ng(o,a,c[i]);if(o.length=r,n<r){for(a=u;a<l-r;a++)s=a+n,(i=a+r)in c?c[s]=c[i]:delete c[s];for(a=l;a>l-r+n;a--)delete c[a-1]}else if(n>r)for(a=l-r;a>u;a--)s=a+n-1,(i=a+r-1)in c?c[s]=c[i]:delete c[s];for(a=0;a<n;a++)c[a+u]=arguments[a+2];return c.length=l-r+n,o}});var ig=function(){function e(){if(n(this,e),a(this,"minimumRankSort",null),a(this,"requireExtantDDbRecords",!1),a(this,"skipJunk",!0),!Wp.rawTaxa&&(Wp.rawTaxa=BsbiDb.TaxonNames,!Wp.rawTaxa))throw new Error("Taxon list has failed to load in TaxonSearch")}return o(e,[{key:"lookup",value:function(t){var n,r,o,a,i={};if(r=e.normaliseTaxonName(decodeURIComponent(t).trim()).replace(/\s+x$/i,""),a=/ x\b/.test(r),""!==r){var s=r.match(e.abbreviatedGenusRegex);if(s){var c,l;for(var u in"X"===s[2]||"x"===s[2]?l=c=new RegExp("^(X\\s|X[a-z]+\\s+)(x )?\\b".concat(e.generate_hybrid_combinations_regex(s[3]),".*"),"i"):(c=new RegExp("^(X )?".concat(e.escapeRegExp(s[2]),"[a-z]+ (x )?.*\\b").concat(e.generate_hybrid_combinations_regex(s[3]),".*"),"i"),l=new RegExp("^(X )?".concat(e.escapeRegExp(s[2]),"[a-z]+ (x )?\\b").concat(e.generate_hybrid_combinations_regex(s[3]),".*"),"i")),Wp.rawTaxa){var d=Wp.rawTaxa[u];o=0===d[e.canonicalColumn]?d[e.nameStringColumn]:d[e.canonicalColumn],(c.test(o)||""!==d[e.hybridCanonicalColumn]&&c.test(d[e.hybridCanonicalColumn]))&&(i[u]={exact:d[e.nameStringColumn]===r,near:l.test(d[e.nameStringColumn])})}n=this.compile_results(i,a)}else{var f,h,p=e.escapeRegExp(r);-1!==r.indexOf(" ")?(f="".concat(e.escapeRegExp(r.substr(0,r.indexOf(" ")))," (x )?.*\\b").concat(e.generate_hybrid_combinations_regex(r.substr(r.indexOf(" ")+1)),".*"),h=new RegExp("^(?:Xs+)?".concat(e.escapeRegExp(r.substr(0,r.indexOf(" ")))," (x )?\\b").concat(e.generate_hybrid_combinations_regex(r.substr(r.indexOf(" ")+1)),".*"),"i")):(f="".concat(p,".*"),h=new RegExp("^".concat(p,".*")));var v="^".concat(p,".*"),S=new RegExp("^(?:Xs+)?".concat(f),"i");if(e.showVernacular){var y=new RegExp(v,"i");for(var N in Wp.rawTaxa){var m=Wp.rawTaxa[N];o=0===m[e.canonicalColumn]?m[e.nameStringColumn]:m[e.canonicalColumn],S.test(m[e.nameStringColumn])||o!==m[e.nameStringColumn]&&S.test(o)?i[N]={exact:m[e.nameStringColumn]===r,near:h.test(m[e.nameStringColumn])||h.test(o)}:(y.test(m[e.vernacularColumn])||y.test(m[e.vernacularRootColumn]))&&(i[N]={exact:m[e.vernacularColumn]===r,vernacular:!0})}if((n=this.compile_results(i,a)).length<5){var g=new RegExp("\\b".concat(p,".*"),"i");for(var b in Wp.rawTaxa)if(!i.hasOwnProperty(b)){var T=Wp.rawTaxa[b];g.test(T[e.nameStringColumn])?i[b]={exact:T[e.nameStringColumn]===r}:(0!==T[e.canonicalColumn]&&g.test(T[e.canonicalColumn])||g.test(T[e.vernacularColumn]))&&(i[b]={exact:T[e.nameStringColumn]===r,vernacular:!0})}n=this.compile_results(i,a)}}else{for(var E in Wp.rawTaxa){var w=Wp.rawTaxa[E];o=0===w[e.canonicalColumn]?w[e.nameStringColumn]:w[e.canonicalColumn],(S.test(w[e.nameStringColumn])||o!==w[e.nameStringColumn]&&S.test(o))&&(i[E]={exact:w[e.nameStringColumn]===r})}n=this.compile_results(i,a)}}}else n=[];return n}},{key:"compile_results",value:function(t,n){var r=[];for(var o in t)if(t.hasOwnProperty(o)){var a=Wp.rawTaxa[o];if((!this.requireExtantDDbRecords||this.requireExtantDDbRecords&&1===a[e.usedColumn])&&(!this.minimumRankSort||this.minimumRankSort>0&&a[e.minRankColumn]>=this.minimumRankSort)){var i=a[e.nameStringColumn]+(a[e.qualifierColumn]?" ".concat(a[e.qualifierColumn]):""),s={entityId:o,vernacular:a[e.vernacularColumn],qname:i,name:i,qualifier:a[e.qualifierColumn],authority:a[e.authorityColumn],uname:a[e.nameStringColumn],vernacularMatched:t[o].hasOwnProperty("vernacular"),exact:t[o].hasOwnProperty("exact")&&t[o].exact,near:t[o].hasOwnProperty("near")&&t[o].near};if(s.formatted=e.formatter(s),a[e.acceptedEntityIdColumn]){var c=Wp.rawTaxa[a[e.acceptedEntityIdColumn]];if(!c)throw Wp.rawTaxa?new Error("Failed to find taxon for accepted entity id ".concat(a[e.acceptedEntityIdColumn])):new Error("Taxon.rawTaxa set is undefined, when trying to find taxon for accepted entity id ".concat(a[e.acceptedEntityIdColumn]));s.acceptedEntityId=a[e.acceptedEntityIdColumn],s.acceptedNameString=c[e.nameStringColumn],s.acceptedQualifier=c[e.qualifierColumn],s.acceptedAuthority=c[e.authorityColumn]}r.push(s)}}return r.length&&(r.sort((function(e,t){if(e.exact)return t.exact?e.acceptedEntityId?1:0:-1;if(t.exact)return 1;if(e.near){if(!t.near)return-1}else if(t.near)return 1;var r=null!==e.uname.match(/\bx\b/i),o=null!==t.uname.match(/\bx\b/i);if(r)return o?e.uname===t.uname?e.acceptedEntityId?1:0:e.qname<t.qname?-1:1:n?-1:1;if(o)return n?1:-1;if(e.uname===t.uname){if(!e.acceptedEntityId&&!t.acceptedEntityId||e.acceptedEntityId&&t.acceptedEntityId){var a=["s.s.","",null,"s.l.","agg."].indexOf(e.qualifier),i=["s.s.","",null,"s.l.","agg."].indexOf(t.qualifier);return a===i?0:a<i?1:-1}return e.acceptedEntityId?1:-1}return e.uname<t.uname?-1:1})),r.length>e.MAXIMUM_RESULTS&&(r.length=e.MAXIMUM_RESULTS)),r}}],[{key:"formatter",value:function(t){return e.showVernacular?t.vernacularMatched?t.acceptedEntityId?"<q><b>".concat(t.vernacular,'</b></q> <span class="italictaxon">').concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")+' = <span class="italictaxon">'.concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):"<q><b>".concat(t.vernacular,'</b></q> <span class="italictaxon">').concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>"):t.acceptedEntityId?'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>").concat(t.vernacular?" <q><b>".concat(t.vernacular,"</b></q>"):"",' = <span class="italictaxon">').concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>").concat(t.vernacular?" <q><b>".concat(t.vernacular,"</b></q>"):""):t.acceptedEntityId?'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")+' = <span class="italictaxon">'.concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")}},{key:"normaliseTaxonName",value:function(t){for(var n=0,r=e.taxonRankNameSearchRegex.length;n<r;n++)t=t.replace(e.taxonRankNameSearchRegex[n],e.taxonRankNameReplacement[n]);for(var o=0,a=e.taxonQualifierSearchRegex.length;o<a;o++)t=t.replace(e.taxonQualifierSearchRegex[o],e.taxonQualifierReplacement[o]);return t}},{key:"escapeRegExp",value:function(t){return t.replace(e.cleanRegex,"\\$&")}},{key:"generate_hybrid_combinations_regex",value:function(t){var n=e.escapeRegExp(t).split(/\s+x\s+/i);if(n.length<2)return n[0];var r=[];return function e(t,n){if(0===t.length)r[r.length]=n.join("[a-zA-Z]* x ");else for(var o=t.length-1;o>=0;--o){var a=t.slice(0),i=n.slice(0);i.unshift(a.splice(o,1)[0]),e(a,i)}}(n,[]),"(?:".concat(r.join("|"),")")}}]),e}();a(ig,"showVernacular",!0),a(ig,"MIN_SEARCH_LENGTH",2),a(ig,"MAXIMUM_RESULTS",25),a(ig,"abbreviatedGenusRegex",/^(X\s+)?([a-z])[.\s]+(.*?)$/i),a(ig,"nameStringColumn",0),a(ig,"canonicalColumn",1),a(ig,"hybridCanonicalColumn",2),a(ig,"acceptedEntityIdColumn",3),a(ig,"qualifierColumn",4),a(ig,"authorityColumn",5),a(ig,"vernacularColumn",6),a(ig,"vernacularRootColumn",7),a(ig,"usedColumn",8),a(ig,"minRankColumn",9),a(ig,"taxonRankNameSearchRegex",[/\s+sub-?g(?:en(?:us)?)?[.\s]+/i,/\s+sect(?:ion)?[.\s]+/i,/\s+subsect(?:ion)?[.\s]+/i,/\s+ser(?:ies)?[.\s]+/i,/\s+gp[.\s]+/i,/\s+s(?:ub)?-?sp(?:ecies)?[.\s]+/i,/\s+morphotype\s+/i,/\s+var[.\s]+/i,/\s+cv[.\s]+/i,/\s+n(?:otho)?v(?:ar)?[.\s]+/i,/\s+f[.\s]+|\s+forma?\s+/i,/\s+n(?:otho)?ssp[.\s]+/i]),a(ig,"taxonRankNameReplacement",[" subg. "," sect. "," subsect. "," ser. "," group "," subsp. "," morph. "," var. "," cv. "," nothovar. "," f. "," nothosubsp. "]),a(ig,"cleanRankNamesRegex",/\s(subfam\.|subg\.|sect\.|subsect\.|ser\.|subser\.|subsp\.|nothosubsp\.|microsp\.|praesp\.|agsp\.|race|convar\.|nm\.|microgene|f\.|subvar\.|var\.|nothovar\.|cv\.|sublusus|taxon|morph\.|group|sp\.)\s/),a(ig,"taxonQualifierSearchRegex",[/\s*\(?\bf\s*x\s*m or m\s*x\s*f\)?\s*$/i,/\s*\(?\bm\s*x\s*f or f\s*x\s*m\)?\s*$/i,/\s*\(?\bf\s*x\s*m\)?\s*$/i,/\s*\(?\bm\s*x\s*f\)?\s*$/i,/\s*\(?\bfemale\s*x\s*male\)?\s*$/i,/\s*\(?\bmale\s*x\s*female\)?\s*$/i,/\s*'male'\s*$/i,/\s*'female'\s*$/i,/\b\s*sens\.?\s*lat[.\s]+/i,/\b\s*s\.\s*lat\.?\s*\b/i,/\b\s*s\.?\s*l\.?\s+\b/i,/\b\s*sensu\s*lato\s+\b|\(\s*sensu\s*lato\s*\)/i,/\b\s*sensu\s*stricto\s+\b|\(\s*sensu\s*stricto\s*\)/i,/\b\s*sens\.?\s*strict[.\s]+/i,/\b\s*sens\.?\s*str\.?\s*(?=\))|\b\s*sens\.?\s*str[.\s]+/i,/\b\s*s\.\s*str[.\s]+/i,/\b\s*s\.?\s*s\.?\s+\b/i,/\b\s*sens\.?\s*lat\.?\s*$/i,/\b\s*s\.\s*lat\.?\s*$/i,/\b\s*s\.?\s*l\.?\s*$/i,/\b\s*sensu\s*lato\s*$/i,/\b\s*sensu\s*stricto\s*$/i,/\b\s*sens\.?\s*strict\.?\s*$/i,/\b\s*sens\.?\s*str\.?\s*$/i,/\b\s*s\.\s*str\.?\s*$/i,/\b\s*s\.?\s*s\.?\s*$/i,/\b\s*agg\.?\s*$/i,/\b\s*aggregate\s*$/i,/\b\s*sp\.?\s*cultivar\s*$/i,/\b\s*sp\.?\s*cv\.?\s*$/i,/\b\s*cultivars?\s*$/i,/\b\s*cv\s+$/i,/\b\s*cv$/i,/\b\s*cf\s*$/i,/\b\s*aff\s*$/i,/\b\s*s\.?n\.?\s*$/i,/\b\s*sp\.?\s*nov\.?\s*$/i,/\b\s*auct[.\s]*$/i,/\b\s*ined[.\s]*$/i,/\b\s*nom\.?\snud[.\s]*$/i,/\b\s*p\.p[.\s?]*$/i,/\b\s*spp?\.?[\s?]*$/i,/\b\s*species\s*$/i,/\b\s*spp?\.?\s*\(/i,/\b\s*species\s*\(/i]),a(ig,"taxonQualifierReplacement",[" "," "," (f x m)"," (m x f)"," (f x m)"," (m x f)"," male"," female"," s.l. "," s.l. "," s.l. "," s.l. "," s.s. "," s.s. "," s.s. "," s.s. "," s.s. "," s.l."," s.l."," s.l."," s.l."," s.s."," s.s."," s.s."," s.s."," s.s."," agg."," agg."," cv. "," cv. "," cv. "," cv. "," cv. "," cf."," aff."," sp.nov."," sp.nov."," auct."," ined."," nom. nud."," pro parte","",""," ("," ("]),a(ig,"cleanRegex",/[.*+?^${}()|[\]\\]/g);var sg=function(){function e(){n(this,e)}return o(e,null,[{key:"taxaLoadedEntryPoint",value:function(){for(Wp.rawTaxa=BsbiDb.TaxonNames;e.callbackStack.length;){var t=e.callbackStack.shift();try{t()}catch(e){console.log({"Exception after taxon load":e})}}}},{key:"onceTaxaLoaded",value:function(){return BsbiDb.hasOwnProperty("TaxonNames")?Promise.resolve():(BsbiDb.taxonNamesLoadedEntryPoint||(BsbiDb.taxonNamesLoadedEntryPoint=e.taxaLoadedEntryPoint),new Promise((function(t){e.callbackStack.push(t)})))}}]),e}();function cg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function lg(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}a(sg,"callbackStack",[]),ir({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var ug=new WeakMap,dg=new WeakMap,fg=function(e){So(r,hv);var t=cg(r);function r(e){var o;return n(this,r),lg(po(o=t.call(this,e)),ug,{writable:!0,value:void 0}),lg(po(o),dg,{writable:!0,value:void 0}),a(po(o),"_value",""),a(po(o),"_inputType","date"),a(po(o),"_autocomplete",""),o._value=(new Date).toJSON().slice(0,10),e&&(e.placeholder&&(o.placeholder=e.placeholder),e.autocomplete&&(o._autocomplete=e.autocomplete)),o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?(new Date).toJSON().slice(0,10):e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(To(this,ug)).value=hv.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",bo(this,dg,e.id=hv.nextId),bo(this,ug,hv.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=To(this,ug),t.textContent=this.label;var n=e.appendChild(document.createElement("input"));n.className="form-control",n.id=To(this,ug);try{n.type=this._inputType}catch(e){console.log("Failed to set type '".concat(this._inputType,"'"))}if(this.placeholder&&(n.placeholder=this.placeholder),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=Gp())),this.completion===hv.COMPLETION_COMPULSORY&&(n.required=!0),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(To(this,ug));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got date field change event"),this.value=hv.cleanRawString(document.getElementById(To(this,ug)).value),this.fireEvent(hv.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Qp(n[e].trim()):""}}]),r}();function hg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return pg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pg(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function pg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Sg(e,t){Ng(e,t),t.add(e)}function yg(e,t,n){Ng(e,t),t.set(e,n)}function Ng(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function mg(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}Ss("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Qs);var gg=new WeakMap,bg=new WeakMap,Tg=new WeakMap,Eg=new WeakSet,wg=new WeakSet,_g=function(e){So(r,hv);var t=vg(r);function r(e){var o;return n(this,r),Sg(po(o=t.call(this,e)),wg),Sg(po(o),Eg),yg(po(o),gg,{writable:!0,value:void 0}),yg(po(o),bg,{writable:!0,value:void 0}),yg(po(o),Tg,{writable:!0,value:void 0}),a(po(o),"parentForm",void 0),a(po(o),"_value",{images:[]}),a(po(o),"includeCamera",!0),a(po(o),"placeholder",""),e&&(e.hasOwnProperty("includeCamera")&&(o.includeCamera=e.includeCamera),e.placeholder&&(o.placeholder=e.placeholder)),o}return o(r,[{key:"value",get:function(){var e=[];if(this._value&&this._value.images){var t,n=hg(this._value.images);try{for(n.s();!(t=n.n()).done;){var r=t.value;e[e.length]=r.id}}catch(e){n.e(e)}finally{n.f()}}return e},set:function(e){if(this._value={images:[]},e){var t,n=hg(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;Py.imageCache.has(r)?this._value.images.push(Py.imageCache.get(r)):(console.log("Creating placeholder image object '".concat(r,"'")),this._value.images.push(Py.placeholder(r)))}}catch(e){n.e(e)}finally{n.f()}}this.updateView()}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=[],n=hg(this._value.images);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push('<picture style="cursor: pointer;" data-imageid="'.concat(r.id,'"><source srcset="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=webp" type="image/webp"><img data-imageid="').concat(r.id,'" src="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=jpeg" height="128" alt="photo"></picture>'))}}catch(e){n.e(e)}finally{n.f()}document.getElementById(To(this,Tg)).innerHTML=t.join("\n")}}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",bo(this,bg,e.id=hv.nextId),bo(this,gg,hv.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=To(this,gg),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="input-group";var r=document.createElement("div");r.className="custom-file",n.appendChild(r);var o=r.appendChild(document.createElement("input"));if(o.type="file",o.className="custom-file-input",o.id=To(this,gg),o.accept=".jpeg, .jpg, image/png, image/jpeg",o.multiple=!0,this.placeholder){var a=r.appendChild(document.createElement("label"));a.className="custom-file-label",a.htmlFor=To(this,gg),a.textContent=this.placeholder}if(this.includeCamera){var i=document.createElement("div");i.className="input-group-append";var s=i.appendChild(document.createElement("span"));s.className="input-group-text";var c=s.appendChild(document.createElement("label"));c.className="pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0 material-icons";var l=c.appendChild(document.createElement("i"));l.className="material-icons pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0",l.textContent="add_a_photo";var u=c.appendChild(document.createElement("input"));u.type="file",u.capture="environment",u.accept="image/*",u.style.display="none",u.id=hv.nextId,n.appendChild(i),u.addEventListener("change",this.inputChangeHandler.bind(this,u.id))}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);var d=e.appendChild(document.createElement("p"));if(bo(this,Tg,d.id=hv.nextId),d.addEventListener("click",this.imageClickHandler.bind(this)),this.validationMessage){var f=e.appendChild(document.createElement("div"));f.className="invalid-feedback",f.innerHTML=this.validationMessage}o.addEventListener("change",this.inputChangeHandler.bind(this,o.id)),this._fieldEl=e,this.parentForm.addListener("deleteimage",this.deleteImageHandler.bind(this))}},{key:"deleteImageHandler",value:function(e){var t;for(var n in console.log("delete image ".concat(e.imageId)),this._value.images)if(this._value.images.hasOwnProperty(n)&&this._value.images[n].id===e.imageId){t=this._value.images.splice(n,1)[0];break}t?(this.updateView(),this.fireEvent(hv.EVENT_CHANGE)):console.log("Failed to find image id ".concat(e.imageId))}},{key:"imageClickHandler",value:function(e){var t=e.target.closest("picture");t||(t=e.target.closest("img")),console.log({"clicked image":t});var n=t.getAttribute("data-imageid");n&&(document.getElementById("imagemodal").getElementsByTagName("picture")[0].innerHTML='<source srcset="/image.php?imageid='.concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=webp" type="image/webp">\n                <img src="/image.php?imageid=').concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=jpeg" width="auto" style="max-height: 48vh; max-width: 100%;" alt="photo">'),document.getElementById("imagemodaldelete").setAttribute("data-imageid",n),$("#".concat("imagemodal")).modal({}))}},{key:"inputChangeHandler",value:function(e,t){var n=this;t.stopPropagation(),console.log("got image field input change event");var r=document.getElementById(e);r.files.length?mg(this,Eg,Cg).call(this,r.files).then((function(){n.fireEvent(hv.EVENT_CHANGE)})):this.fireEvent(hv.EVENT_CHANGE)}}],[{key:"isEmpty",value:function(e){return!e||0===e.length}},{key:"licenseModal",value:function(){var e=document.createElement("div");return e.innerHTML='<div class="modal fade" id="'.concat(r.LICENSE_MODAL,'" tabindex="-1" role="dialog" aria-labelledby="').concat(r.LICENSE_MODAL,'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat(r.LICENSE_MODAL,'Title">Image licensing</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>By choosing to submit images with your Garden Wildflower Hunt records you agree to license the image under the terms of the Creative Common Attribution 4.0 International license (CC BY 4.0).</p>\n        <p>The following is a summary of (and not a substitute for) the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">license</a>.</p>\n        <p>Licensees are free to:</p>\n        <ul class="license-properties">\n<li>\n<strong>Share</strong> â copy and redistribute the material in any medium or format\n</li>\n<li>\n<strong>Adapt</strong> â remix, transform, and build upon the material for any purpose, even commercially.\n</li>\n</ul>\n<p>Licensees are most follow these term:</p>\n<ul>\n<li>\n<p>\n<strong>Attribution</strong> â licensees must give appropriate credit, provide a link to the license, and indicate if changes were made.\n</p>\n</li>\n</ul>\n<p>Full details of the license are here: <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0 license</a></p>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),e.firstChild}}]),r}();function Cg(e){this.parentForm.pingOccurrence();var t,n=[],r=hg(e);try{for(r.s();!(t=r.n()).done;){var o=t.value;n.push(Py.fromFile(o))}}catch(e){r.e(e)}finally{r.f()}return mg(this,wg,Og).call(this,n)}function Og(e){var t=this;if(e.length){var n=e.shift();return n.save(this.parentForm.surveyId,this.parentForm.occurrenceId,this.parentForm.projectId).then((function(e){console.log("Added image '".concat(n.id,"'")),console.log({jsonDescription:e}),t._value.images.push(n),t.updateView()}),(function(e){console.log("Failed to add image ".concat(n.id)),console.log({"Failure reason":e})})).finally((function(){return mg(t,wg,Og).call(t,e)}))}return Promise.resolve()}function Rg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Ig(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}a(_g,"LICENSE_MODAL","imagelicensemodal");var Mg=new WeakMap,Lg=new WeakMap,xg=function(e){So(r,hv);var t=Rg(r);function r(e){var o;return n(this,r),Ig(po(o=t.call(this,e)),Mg,{writable:!0,value:void 0}),Ig(po(o),Lg,{writable:!0,value:void 0}),a(po(o),"_value",""),a(po(o),"_inputType","text"),a(po(o),"_autocomplete",""),e&&(e.type&&(o._inputType=e.type),e.placeholder&&(o.placeholder=e.placeholder),e.autocomplete&&(o._autocomplete=e.autocomplete)),o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(To(this,Mg)).value=hv.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",bo(this,Lg,e.id=hv.nextId),bo(this,Mg,hv.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=To(this,Mg),t.textContent=this.label;var n=e.appendChild(document.createElement("input"));n.className="form-control",n.id=To(this,Mg);try{n.type=this._inputType}catch(e){console.log("Failed to set type '".concat(this._inputType,"'"))}if(this.placeholder&&(n.placeholder=this.placeholder),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=Gp())),this.completion===hv.COMPLETION_COMPULSORY&&(n.required=!0),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(To(this,Mg));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got input field change event"),this.value=hv.cleanRawString(document.getElementById(To(this,Mg)).value),this.fireEvent(hv.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Qp(n[e].trim()):""}}]),r}();function Hg(e,t,n){if(n.length>2){var r=n.pop();return"".concat(n.join(e+" ")," ").concat(t," ").concat(r)}return n.join(" ".concat(t," "))}function kg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Pg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Pg(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function Pg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ag(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Dg(e,t,n){Fg(e,t),t.set(e,n)}function Fg(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ug(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function jg(e,t,n){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}(n,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,n)}var Jg=new WeakMap,Bg=new WeakMap,Yg=new WeakSet,Gg=function(e){So(r,hv);var t=Ag(r);function r(e){var o,i,s;return n(this,r),o=t.call(this,e),Fg(i=po(o),s=Yg),s.add(i),Dg(po(o),Jg,{writable:!0,value:void 0}),Dg(po(o),Bg,{writable:!0,value:void 0}),a(po(o),"options",{}),a(po(o),"includeOtherFreeText",!0),a(po(o),"_value",{selection:[],other:null}),e&&(e.options&&(o.options=e.options),e.hasOwnProperty("includeOtherFreeText")&&(o.includeOtherFreeText=e.includeOtherFreeText)),o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){this._value=e||{selection:[],other:null},this.updateView()}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=kg(document.querySelectorAll("".concat(jg(r,r,Vg),"#").concat(To(this,Jg),' input[type="checkbox"]')));try{for(t.s();!(e=t.n()).done;){var n=e.value,o=n.checked=this._value.selection.includes(n.name);if(n.name===r.KEY_OTHER&&To(this,Bg)){var a=document.getElementById(To(this,Bg));a.style.display=o?"block":"none",a.value=null===this._value.other?"":this._value.other.trim()}}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(jg(r,r,Vg));e.className="form-group",bo(this,Jg,e.id=hv.nextId);var t=e.appendChild(document.createElement("label"));(t.style.display="block",t.textContent=this.label,this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);for(var n in this.options)this.options.hasOwnProperty(n)&&Ug(this,Yg,Kg).call(this,e,n,this.options[n]);if(this.validationMessage){var o=e.appendChild(document.createElement("div"));o.className="invalid-feedback",o.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,n={selection:[],other:null};To(this,Bg)&&(t=document.getElementById(To(this,Bg)));var o,a=kg(document.querySelectorAll("".concat(jg(r,r,Vg),"#").concat(To(this,Jg),' input[type="checkbox"]:checked')));try{for(a.s();!(o=a.n()).done;){var i=o.value;n.selection[n.selection.length]=i.name,i.name===r.KEY_OTHER&&To(this,Bg)&&(n.other=hv.cleanRawInput(t),!0)}}catch(e){a.e(e)}finally{a.f()}this.value=n,this.fireEvent(hv.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){var r=t.summary,o=[];if(n[e].selection.length){var a,i=kg(n[e].selection);try{for(i.s();!(a=i.n()).done;){var s=a.value;"other"===s&&n[e].other?o[o.length]="".concat(t.attributes.options[s].summary||t.attributes.options[s].label," (").concat(n[e].other,")"):o[o.length]=t.attributes.options[s].summary||t.attributes.options[s].label}}catch(e){i.e(e)}finally{i.f()}return Qp("".concat(r.summaryPrefix," ").concat(Hg(",","or",o)))}return""}}]),r}();function Kg(e,t,n){var r=e.appendChild(document.createElement("div"));r.className="form-check";var o=r.appendChild(document.createElement("input"));o.type="checkbox",o.className="form-check-input",o.id=hv.nextId,o.name=t;var a=r.appendChild(document.createElement("label"));if(a.htmlFor=o.id,a.className="form-check-label",a.textContent=n.label,Gg.KEY_OTHER===t&&this.includeOtherFreeText){var i=r.appendChild(document.createElement("input"));i.id=bo(this,Bg,hv.nextId),i.className="form-control",i.style.display="none"}}a(Gg,"KEY_OTHER","other");var Vg={writable:!0,value:"fieldset"};function Xg(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return qg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qg(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function qg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qg(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Wg(e,t,n){Zg(e,t),t.set(e,n)}function Zg(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function $g(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function zg(e,t,n){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}(n,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,n)}var eb=new WeakMap,tb=new WeakMap,nb=new WeakMap,rb=new WeakSet,ob=function(e){So(r,hv);var t=Qg(r);function r(e){var o,i,s;return n(this,r),o=t.call(this,e),Zg(i=po(o),s=rb),s.add(i),Wg(po(o),eb,{writable:!0,value:void 0}),Wg(po(o),tb,{writable:!0,value:void 0}),Wg(po(o),nb,{writable:!0,value:void 0}),a(po(o),"options",{}),a(po(o),"placeholder",""),a(po(o),"includeOtherFreeText",!0),a(po(o),"_value",{selection:[],other:null}),e&&(e.options&&(o.options=e.options),e.hasOwnProperty("includeOtherFreeText")&&(o.includeOtherFreeText=e.includeOtherFreeText),e.placeholder&&(o.placeholder=e.placeholder)),o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){this._value=e||{selection:[],other:null},this.updateView()}},{key:"markValidity",value:function(e){var t=document.getElementById(To(this,tb));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=Xg(document.querySelectorAll("select#".concat(To(this,tb)," option")));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(""!==n.value){var r=n.selected=this._value.selection.includes(n.value);if(n.value===Gg.KEY_OTHER&&To(this,nb)){var o=document.getElementById(To(this,nb));o.style.display=r?"block":"none",o.value=null===this._value.other?"":this._value.other.trim()}}else n.selected=0===this._value.selection.length}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(zg(r,r,ib));e.className="form-group",bo(this,eb,e.id=hv.nextId),bo(this,tb,hv.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=To(this,tb),t.style.display="block",t.innerHTML=this.label;var n=document.createElement("select");(n.id=To(this,tb),n.className="custom-select",this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);for(var o in this.placeholder&&$g(this,rb,ab).call(this,e,n,"",{label:this.placeholder}),this.options)this.options.hasOwnProperty(o)&&$g(this,rb,ab).call(this,e,n,o,this.options[o]);if(e.appendChild(n),this.validationMessage){var a=e.appendChild(document.createElement("div"));a.className="invalid-feedback",a.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,n={selection:[],other:null};To(this,nb)&&(t=document.getElementById(To(this,nb)));var r,o=Xg(document.querySelectorAll("select#".concat(To(this,tb)," option:checked")));try{for(o.s();!(r=o.n()).done;){var a=r.value;""!==a.value&&(n.selection[n.selection.length]=a.value,a.name===Gg.KEY_OTHER&&To(this,nb)&&(n.other=hv.cleanRawInput(t),!0))}}catch(e){o.e(e)}finally{o.f()}this.value=n,this.fireEvent(hv.EVENT_CHANGE)}}],[{key:"isEmpty",value:function(e){return 0===e.selection.length||""===e.selection[0]}},{key:"summariseImpl",value:function(e,t,n){var r=t.summary,o=[];if(n[e].selection.length){var a,i=Xg(n[e].selection);try{for(i.s();!(a=i.n()).done;){var s=a.value;"other"===s&&n[e].other?o[o.length]="".concat(t.attributes.options[s].summary||t.attributes.options[s].label," (").concat(n[e].other,")"):o[o.length]=t.attributes.options[s].summary||t.attributes.options[s].label}}catch(e){i.e(e)}finally{i.f()}return Qp("".concat(r.summaryPrefix," ").concat(Hg(",","or",o)))}return""}}]),r}();function ab(e,t,n,r){var o=t.appendChild(document.createElement("option"));if(o.value=n,o.innerText=r.label,Gg.KEY_OTHER===n&&this.includeOtherFreeText){var a=e.appendChild(document.createElement("input"));a.id=bo(this,nb,hv.nextId),a.className="form-control"}}var ib={writable:!0,value:"fieldset"},sb=ir,cb=rv.start,lb=sv("trimStart"),ub=lb?function(){return cb(this)}:"".trimStart;sb({target:"String",proto:!0,name:"trimStart",forced:lb},{trimStart:ub,trimLeft:ub});var db=ir,fb=xs.find,hb=Mo,pb=!0;function vb(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return Sb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sb(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function Sb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Nb(e,t,n){mb(e,t),t.set(e,n)}function mb(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function gb(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}"find"in[]&&Array(1).find((function(){pb=!1})),db({target:"Array",proto:!0,forced:pb},{find:function(e){return fb(this,e,arguments.length>1?arguments[1]:void 0)}}),hb("find");var bb=new WeakMap,Tb=new WeakMap,Eb=new WeakMap,wb=new WeakMap,_b=new WeakMap,Cb=new WeakMap,Ob=new WeakMap,Rb=new WeakMap,Ib=new WeakSet,Mb=function(e){So(r,hv);var t=yb(r);function r(e){var o,i,s;return n(this,r),o=t.call(this,e),mb(i=po(o),s=Ib),s.add(i),a(po(o),"taxonSearch",void 0),Nb(po(o),bb,{writable:!0,value:void 0}),Nb(po(o),Tb,{writable:!0,value:void 0}),Nb(po(o),Eb,{writable:!0,value:void 0}),Nb(po(o),wb,{writable:!0,value:void 0}),Nb(po(o),_b,{writable:!0,value:null}),Nb(po(o),Cb,{writable:!0,value:null}),Nb(po(o),Ob,{writable:!0,value:null}),a(po(o),"_lastInputValue",""),Nb(po(o),Rb,{writable:!0,value:[]}),a(po(o),"_value",{taxonId:"",taxonName:"",vernacularMatch:!1}),o.taxonSearch=new ig,o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){var t;e&&e.taxonId?(t=Wp.fromId(e.taxonId),this._value={taxonId:t.id,taxonName:e.vernacularMatch?t.vernacular:t.nameString,vernacularMatch:e.vernacularMatch}):this._value={taxonId:"",taxonName:e&&e.taxonName?e.taxonName:"",vernacularMatch:null},this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(To(this,bb)).value=this._value.taxonName,this._lastInputValue=this._value.taxonName)}},{key:"markValidity",value:function(e){var t=document.getElementById(To(this,bb));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",bo(this,wb,e.id=hv.nextId),bo(this,bb,hv.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=To(this,bb),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="dropdown-wrapper";var r=n.appendChild(document.createElement("input"));if(r.className="form-control dropdown-input",r.id=To(this,bb),r.autocomplete="off",r.spellcheck=!1,this.validationMessage){var o=n.appendChild(document.createElement("div"));o.className="invalid-feedback",o.innerHTML=this.validationMessage}var a=n.appendChild(document.createElement("div"));(a.className="dropdown-list",bo(this,Tb,a.id=hv.nextId),bo(this,Eb,hv.nextId),this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);r.addEventListener("keydown",this.keydownHandler.bind(this)),r.addEventListener("input",this.inputHandler.bind(this)),r.addEventListener("change",this.inputChangeHandler.bind(this)),e.addEventListener("focusin",this.focusHandler.bind(this)),e.addEventListener("focusout",this.blurHandler.bind(this)),a.addEventListener("click",this.dropboxClickHandler.bind(this)),this._fieldEl=e}},{key:"keydownHandler",value:function(e){switch(this._lastInputValue=e.target.value.trimLeft(),e.key){case"Enter":case"ArrowUp":case"ArrowDown":e.preventDefault()}}},{key:"inputHandler",value:function(e){e.target.value.trimLeft()!==this._lastInputValue&&gb(this,Ib,Lb).call(this,e.target)}},{key:"keyupHandler",value:function(e){!e.key||1!==e.key.length&&"Backspace"!==e.key&&"Delete"!==e.key||gb(this,Ib,Lb).call(this,e.target)}},{key:"focusHandler",value:function(e){console.log("focused");var t=document.getElementById(To(this,Tb));if(!t.classList.contains("dropdown-focused")){var n=document.getElementById(To(this,bb));gb(this,Ib,Lb).call(this,n),t.classList.add("dropdown-focused")}}},{key:"blurHandler",value:function(e){var t=this;To(this,_b)&&(clearTimeout(To(this,_b)),bo(this,_b,null)),setTimeout((function(){document.getElementById(To(t,Tb)).classList.remove("dropdown-focused")}),500)}},{key:"refreshSearchResultsList",value:function(){var e=document.getElementById(To(this,Tb));if(To(this,Rb).length){var t,n=[],r=0,o=vb(To(this,Rb));try{for(o.s();!(t=o.n()).done;){var a=t.value;n[n.length]='<a class="list-group-item list-group-item-action" href="#" data-occurrenceId="'.concat(a.entityId,'" data-resultnumber="').concat(r,'">').concat(ig.formatter(a),"</a>"),++r}}catch(e){o.e(e)}finally{o.f()}e.innerHTML='<div class="list-group" id="'.concat(To(this,Eb),'">').concat(n.join(""),"</div>")}else e.innerHTML="";bo(this,Ob,null)}},{key:"dropboxClickHandler",value:function(e){console.log("click handler"),console.log(e);var t=e.target.closest("a");if(console.log(t),To(this,Cb)&&(clearTimeout(To(this,Cb)),bo(this,Cb,null),console.log("cleared a pending change event")),t&&t.dataset.occurrenceid){e.preventDefault(),console.log("got target ".concat(t.dataset.occurrenceid));var n=To(this,Rb)[t.dataset.resultnumber];this.value={taxonId:n.entityId,taxonName:n.vernacularMatched?n.vernacular:n.qname,vernacularMatch:n.vernacularMatched},this.fireEvent(hv.EVENT_CHANGE)}}},{key:"inputChangeHandler",value:function(e){var t=this;e.stopPropagation(),console.log("got taxon field input change event"),To(this,Cb)&&clearTimeout(To(this,Cb)),bo(this,Cb,setTimeout((function(){console.log("processing taxon field input change event");var e=To(t,Rb).find((function(e){return e.exact}));e?(console.log("exact match"),t.value={taxonId:e.entityId,taxonName:e.vernacularMatched?e.vernacular:e.qname,vernacularMatch:e.vernacularMatched}):(console.log("no match"),t.value={taxonId:"",taxonName:document.getElementById(To(t,bb)).value.trim(),vernacularMatch:null}),console.log(t._value),t.fireEvent(hv.EVENT_CHANGE)}),500))}}],[{key:"isEmpty",value:function(e){return!e||e&&!e.taxonName}},{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}}]),r}();function Lb(e){var t=this,n=hv.cleanRawInput(e);To(this,_b)&&clearTimeout(To(this,_b)),n.length>=ig.MIN_SEARCH_LENGTH?bo(this,_b,setTimeout((function(){bo(t,Rb,t.taxonSearch.lookup(hv.cleanRawInput(document.getElementById(To(t,bb))))),console.log(To(t,Rb)),t.refreshSearchResultsList(),bo(t,_b,null)}),Mb.timeoutDelay)):(bo(this,Rb,[]),this.refreshSearchResultsList())}function xb(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function Hb(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}a(Mb,"timeoutDelay",50);var kb=new WeakMap,Pb=new WeakMap,Ab=function(e){So(r,hv);var t=xb(r);function r(e){var o;return n(this,r),Hb(po(o=t.call(this,e)),kb,{writable:!0,value:void 0}),Hb(po(o),Pb,{writable:!0,value:void 0}),a(po(o),"_value",""),a(po(o),"_autocomplete",""),e&&(e.options&&(o.options=e.options),e.placeholder&&(o.placeholder=e.placeholder),e.autocomplete&&(o._autocomplete=e.autocomplete)),o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(To(this,kb)).value=hv.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",bo(this,Pb,e.id=hv.nextId),bo(this,kb,hv.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=To(this,kb),t.textContent=this.label;var n=e.appendChild(document.createElement("textarea"));(n.className="form-control",n.id=To(this,kb),this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);if(this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=Gp())),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got text area field input change event"),this.value=hv.cleanRawString(document.getElementById(To(this,kb)).value),this.fireEvent(hv.EVENT_CHANGE)}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Qp(n[e].trim()):""}}]),r}(),Db=function(){var e=function(){};return e.tetradOffsets={E:[0,8e3],J:[2e3,8e3],P:[4e3,8e3],U:[6e3,8e3],Z:[8e3,8e3],D:[0,6e3],I:[2e3,6e3],N:[4e3,6e3],T:[6e3,6e3],Y:[8e3,6e3],C:[0,4e3],H:[2e3,4e3],M:[4e3,4e3],S:[6e3,4e3],X:[8e3,4e3],B:[0,2e3],G:[2e3,2e3],L:[4e3,2e3],R:[6e3,2e3],W:[8e3,2e3],A:[0,0],F:[2e3,0],K:[4e3,0],Q:[6e3,0],V:[8e3,0]},e.quadrantOffsets={NW:[0,5e3],NE:[5e3,5e3],SW:[0,0],SE:[5e3,0]},e.letterMapping={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,J:8,K:9,L:10,M:11,N:12,O:13,P:14,Q:15,R:16,S:17,T:18,U:19,V:20,W:21,X:22,Y:23,Z:24},e.tetradLetters="ABCDEFGHIJKLMNPQRSTUVWXYZ",e.prototype.preciseGridRef="",e.prototype.length=0,e.prototype.hectad="",e.prototype.tetrad="",e.prototype.tetradLetter="",e.prototype.quadrant="",e.prototype.quadrantCode="",e.prototype.set_tetrad=function(){if(this.tetradLetter=e.tetradLetters.substr(5*(Math.floor(this.gridCoords.x%1e4/1e3)>>1)+(Math.floor(this.gridCoords.y%1e4/1e3)>>1),1),!this.tetradLetter)throw new Error("Failed to get tetrad letter when processing '"+this.preciseGridRef+"', easting="+this.gridCoords.x+" northing="+this.gridCoords.y);this.tetrad=this.hectad+this.tetradLetter},e.get_normalized_precision=function(e,t){return e>2e3?1e4:e>1e3?2e3:e>100?1e3:e>10?100:e>1?10:t||1},e}(),Fb=function(e,t){this.lat=e,this.lng=t},Ub=Math.PI/180,jb=180/Math.PI,Jb=function(e,t){this.lat=e,this.lng=t};Jb.prototype.to_WGS84=function(){var e=6377563.396,t=.00667054007,n=this.lat*Ub,r=Math.sin(n),o=this.lng*Ub,a=e/Math.sqrt(1-t*(r*r)),i=a*Math.cos(n)*Math.cos(o),s=a*Math.cos(n)*Math.sin(o),c=(1-t)*a*r,l=-204894e-10,u=7.28190110241429e-7,d=119748977294801e-20,f=446.448+i*(1+l)+-u*s+d*c,h=408261589226812e-20*i-124.157+s*(1+l)+-u*c,p=542.06+-d*i+u*s+c*(1+l);e=6378137,t=.00669438003;for(var v=Math.sqrt(f*f+h*h),S=Math.atan(p/(v*(1-t))),y=1;y<10;++y){var N=Math.sin(S);S=Math.atan((p+t*(e/Math.sqrt(1-t*(N*N)))*N)/v)}return new Fb(jb*S,jb*Math.atan(h/f))},Jb.from_wgs84=function(e){var t=e.lat*Ub,n=e.lng*Ub,r=.00669438037928458,o=.0066705397616,a=20.4894*1e-6,i=6378137/Math.sqrt(1-r*Math.sin(t)*Math.sin(t)),s=(i+0)*Math.cos(t)*Math.cos(n),c=(i+0)*Math.cos(t)*Math.sin(n),l=((1-r)*i+0)*Math.sin(t),u=-.1502/3600*Ub,d=-.247/3600*Ub,f=-.8421/3600*Ub,h=s+s*a-c*f+l*d-446.448,p=s*f+c+c*a-l*u+125.157,v=-1*s*d+c*u+l+l*a+-542.06,S=Math.atan(p/h),y=Math.sqrt(h*h+p*p),N=Math.atan(v/(y*(1-o)));i=6377563.396/Math.sqrt(1-o*(Math.sin(N)*Math.sin(N)));for(var m=1,g=0;m>.001;)g=Math.atan((v+o*i*Math.sin(N))/y),m=Math.abs(g-N),N=g;return new Jb(N*jb,S*jb)};var Bb=function(){var e=function(e,t){this.lat=e,this.lng=t};return e._transform=function(t,n,r,o,a,i,s,c,l,u,d,f,h,p){var v=1e-6*p,S=r/Math.sqrt(1-o*(Math.sin(t)*Math.sin(t))),y=(S+a)*Math.cos(t)*Math.cos(n),N=(S+a)*Math.cos(t)*Math.sin(n),m=((1-o)*S+a)*Math.sin(t),g=d/3600*Ub,b=f/3600*Ub,T=h/3600*Ub,E=y+y*v-N*T+m*b+c,w=y*T+N+N*v-m*g+l,_=-1*y*b+N*g+m+m*v+u;n=Math.atan(w/E);var C=Math.sqrt(E*E+w*w);t=Math.atan(_/(C*(1-s))),S=i/Math.sqrt(1-s*(Math.sin(t)*Math.sin(t)));for(var O=1,R=0;O>.001;)R=Math.atan((_+s*S*Math.sin(t))/C),O=Math.abs(R-t),t=R;return new e(t,n)},e._Marc=function(e,t,n,r){return e*((1+t+5/4*(t*t)+5/4*(t*t*t))*(r-n)-(3*t+t*t*3+21/8*(t*t*t))*Math.sin(r-n)*Math.cos(r+n)+(15/8*(t*t)+15/8*(t*t*t))*Math.sin(2*(r-n))*Math.cos(2*(r+n))-35/24*(t*t*t)*Math.sin(3*(r-n))*Math.cos(3*(r+n)))},e}(),Yb=function(){var e=function(e,t){this.lat=e,this.lng=t};return e.from_wgs84=function(t){var n=t.lat*Ub,r=t.lng*Ub,o=Bb._transform(n,r,6378137,.00669438037928458,0,6378388,.0067226700223333,83.901,98.127,118.635,0,0,0,0);return new e(o.lat*jb,o.lng*jb)},e}(),Gb=function(e,t){this.lat=e,this.lng=t};Gb.prototype.to_WGS84=function(){var e=Bb._transform(this.lat*Ub,this.lng*Ub,6377340.189,.00667054015,0,6378137,.00669438037928458,482.53,-130.596,564.557,-1.042,-.214,-.631,-8.15);return new Fb(e.lat*jb,e.lng*jb)},Gb.from_wgs84=function(e){var t=e.lat*Ub,n=e.lng*Ub,r=Bb._transform(t,n,6378137,.00669438037928458,0,6377340.189,.00667054015,-482.53,130.596,-564.557,1.042,.214,.631,8.15);return new Gb(r.lat*jb,r.lng*jb)};var Kb=function(){};Kb.tetradLetters="ABCDEFGHIJKLMNPQRSTUVWXYZ",Kb.tetradLettersRowFirst="AFKQVBGLRWCHMSXDINTYEJPUZ",Kb.from_latlng=function(e,t){if(t>=-8.74&&e>49.88){var n=new Jb.from_wgs84(new Fb(e,t)).to_os_coords();if(n.x>=0&&n.is_gb_hectad())return n}if(t<-5.3&&e>51.34&&t>-11&&e<55.73){var r=new Gb.from_wgs84(new Fb(e,t)).to_os_coords();return r.x<0||r.y<0?null:r}var o=new Yb.from_wgs84(new Fb(e,t)).to_os_coords();return o.x>=5e5&&o.x<6e5&&o.y>=54e5&&o.y<56e5?o:null},Kb.calculate_tetrad=function(e,t){return e>=0&&t>=0?Kb.tetradLetters.charAt(5*Math.floor(e%1e4/2e3)+Math.floor(t%1e4/2e3)):""},Kb.prototype.toString=function(){return this.x+","+this.y};var Vb=function(e,t,n,r){var o="00000"+Math.floor(t),a="00000"+Math.floor(n);if(2e3===r)return e+o.charAt(o.length-5)+a.charAt(a.length-5)+Kb.calculate_tetrad(t,n);if(1e5===r)return e;5e3===r&&(r=1e4);var i=Math.round(Math.log10(r));return e+(i?o.slice(-5,-i)+a.slice(-5,-i):o.slice(-5)+a.slice(-5))},Xb=function(e,t){this.x=e,this.y=t};(Xb.prototype=new Kb).constructor=Xb,Xb.prototype.country="CI",Xb.prototype.to_latLng=function(){var e=.0067226700223333,t=6375836.6448,n=6354369.181221601,r=this.x-5e5,o=qb(this.y,0,t,0,.0016863406508729017,n),a=t/Math.sqrt(1-e*(Math.sin(o)*Math.sin(o))),i=a*(1-e)/(1-e*Math.sin(o)*Math.sin(o)),s=a/i-1,c=Math.tan(o)*Math.tan(o),l=Math.pow(Math.tan(o),4),u=Math.pow(Math.tan(o),6),d=Math.pow(Math.cos(o),-1),f=Math.tan(o)/(2*i*a),h=Math.tan(o)/(24*i*(a*a*a))*(5+3*c+s-9*s*c),p=Math.tan(o)/(720*i*Math.pow(a,5))*(61+90*c+45*l),v=o-r*r*f+Math.pow(r,4)*h-Math.pow(r,6)*p,S=Math.pow(Math.cos(o),-1)/a,y=d/(a*a*a*6)*(a/i+2*c),N=d/(120*Math.pow(a,5))*(5+28*c+24*l),m=d/(5040*Math.pow(a,7))*(61+662*c+1320*l+720*u),g=r*S-.0523598775598-r*r*r*y+Math.pow(r,5)*N-Math.pow(r,7)*m,b=Xb.convert_to_wgs(v,g);return new Fb(b.lat*jb,b.lng*jb)};var qb=function(e,t,n,r,o,a){for(var i=(e-t)/n+r,s=Xb.marc(a,o,r,i),c=(e-t-s)/n+i,l=0;Math.abs(e-t-s)>1e-5&&l<20;)l+=1,c=(e-t-s)/n+i,s=Bb._Marc(a,o,r,c),i=c;return c};Xb.prototype.to_gridref=function(e){return this.y>=55e5?Vb("WA",this.x-5e5,this.y-55e5,e||1):this.y<55e5?Vb("WV",this.x-5e5,this.y-54e5,e||1):null},Xb.prototype.to_hectad=function(){return this.y>55e5?"WA"+this.x.toString().substring(1,2)+this.y.toString().substring(2,3):this.y<55e5?"WV"+this.x.toString().substring(1,2)+this.y.toString().substring(2,3):null};var Qb=function(){var e=function(){};return(e.prototype=new Db).constructor=e,e.prototype.country="CI",e.prototype.GridCoords=Xb,e.prototype.from_string=function(t){var n,r=t.replace(/[\[\]\s\t\.\/-]+/g,"").toUpperCase(),o="";/[ABCDEFGHIJKLMNPQRSTUVWXYZ]$/.test(r)&&(Db.quadrantOffsets.hasOwnProperty(r.substr(r.length-2))?(this.quadrantCode=r.substr(r.length-2),r=r.substr(0,r.length-2)):(o=r.substr(r.length-1),r=r.substr(0,r.length-1))),/^(W[AV](?:\d\d){1,5})$/.test(r)?(n=e.gridref_string_to_e_n_l(r))?(this.length=n.length,this.gridCoords=new Xb(n.e,n.n),this.hectad=this.gridCoords.to_gridref(1e4),1e4===this.length&&(o||this.quadrantCode)?o?(this.preciseGridRef=r+o,this.tetrad=this.hectad+o,this.tetradLetter=o,this.length=2e3,this.gridCoords.x+=Db.tetradOffsets[o][0],this.gridCoords.y+=Db.tetradOffsets[o][1]):(this.preciseGridRef=r+this.quadrantCode,this.tetradLetter="",this.tetrad="",this.quadrant=this.preciseGridRef,this.length=5e3,this.gridCoords.x+=Db.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=Db.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=r,this.length<=1e3&&this.set_tetrad())):(this.error=!0,this.errorMessage="Grid reference format not understood (odd length)."):(this.error=!0,this.errorMessage="Channel Island grid reference format not understood. ('"+t+"')")},e.prototype.parse_well_formed=e.prototype.from_string,e.gridref_string_to_e_n_l=function(e){var t,n,r,o,a=e.substr(0,2);if("WA"===a)t=55e5;else{if("WV"!==a)return Logger("Bad Channel Island grid letters: '"+a+"'"),!1;t=54e5}var i=e.substr(2);switch(i.length){case 2:n=1e4*i.charAt(0),r=1e4*i.charAt(1),o=1e4;break;case 4:n=1e3*i.substr(0,2),r=1e3*i.substr(2),o=1e3;break;case 6:n=100*i.substr(0,3),r=100*i.substr(3),o=100;break;case 8:n=10*i.substr(0,4),r=10*i.substr(4),o=10;break;case 10:n=parseInt(i.substr(0,5),10),r=parseInt(i.substr(5),10),o=1;break;default:return Logger("Bad length for Channel Island grid ref '"+e+"'"),!1}return{e:n+5e5,n:r+t,length:o}},e}(),Wb=function(e,t){this.x=e,this.y=t};(Wb.prototype=new Kb).constructor=Wb,Wb.prototype.country="GB",Wb.gbHectads="SV80SV81SV90SV91SW32SW33SW42SW43SW44SW52SW53SW54SW61SW62SW63SW64SW65SW71SW72SW73SW74SW75SW76SW81SW82SW83SW84SW85SW86SW87SW95SW96SW97SS10SS11SS20SS21SS30SW83SW84SW85SW93SW94SW95SW96SW97SW98SX03SX04SX05SX06SX07SX08SX09SX14SX15SX16SX17SX18SX19SX25SX26SX27SX28SX29SX35SX36SX37SX38SX39SX44SX45SX46SX47SS70SS80SS81SS90SS91ST00ST01ST10ST11ST20ST21ST30SX37SX44SX45SX46SX47SX48SX54SX55SX56SX57SX58SX63SX64SX65SX66SX67SX68SX69SX73SX74SX75SX76SX77SX78SX79SX83SX84SX85SX86SX87SX88SX89SX94SX95SX96SX97SX98SX99SY07SY08SY09SY18SY19SY28SY29SY38SY39SS14SS20SS21SS22SS30SS31SS32SS40SS41SS42SS43SS44SS50SS51SS52SS53SS54SS60SS61SS62SS63SS64SS70SS71SS72SS73SS74SS75SS80SS81SS82SS83SS91SS92ST01ST02SX28SX29SX37SX38SX39SX48SX49SX58SX59SX68SX69SX79SS73SS74SS82SS83SS84SS92SS93SS94ST01ST02ST03ST04ST11ST12ST13ST14ST20ST21ST22ST23ST24ST25ST30ST31ST32ST33ST34ST40ST41ST42ST50ST51ST52ST61ST62ST71ST72ST24ST25ST26ST32ST33ST34ST35ST36ST37ST42ST43ST44ST45ST46ST47ST52ST53ST54ST55ST56ST57ST62ST63ST64ST65ST66ST67ST72ST73ST74ST75ST76ST77ST83ST84ST85ST86SP00SP10ST76ST77ST85ST86ST87ST88ST89ST96ST97ST98ST99SU06SU07SU08SU09SU16SU17SU18SU19SU26SU27SU28SU29SU36SU37ST73ST74ST75ST76ST82ST83ST84ST85ST86ST91ST92ST93ST94ST95ST96SU01SU02SU03SU04SU05SU06SU11SU12SU13SU14SU15SU16SU21SU22SU23SU24SU25SU26SU31SU32SU34SU35SU36ST20ST30ST40ST50ST51ST60ST61ST70ST71ST72ST73ST80ST81ST82ST83ST90ST91ST92SU00SU01SU02SU10SU11SY39SY48SY49SY58SY59SY66SY67SY68SY69SY77SY78SY79SY87SY88SY89SY97SY98SY99SZ07SZ08SZ09SZ28SZ38SZ39SZ47SZ48SZ49SZ57SZ58SZ59SZ68SZ69SU00SU01SU02SU10SU11SU12SU20SU21SU22SU23SU30SU31SU32SU33SU40SU41SU42SU43SU50SU51SU52SU60SU61SU62SU70SU71SU72SZ08SZ09SZ19SZ29SZ38SZ39SZ49SZ59SZ69SZ79SU23SU24SU25SU33SU34SU35SU36SU42SU43SU44SU45SU46SU52SU53SU54SU55SU56SU62SU63SU64SU65SU66SU72SU73SU74SU75SU76SU82SU83SU84SU85SU86SU70SU71SU72SU80SU81SU82SU83SU90SU91SU92SU93SZ79SZ89SZ99TQ00TQ01TQ02TQ03TQ10TQ11TQ12TQ13TQ20TQ21TQ22TQ23TQ30TQ31TQ32TQ20TQ21TQ22TQ23TQ30TQ31TQ32TQ33TQ40TQ41TQ42TQ43TQ44TQ50TQ51TQ52TQ53TQ54TQ60TQ61TQ62TQ63TQ70TQ71TQ72TQ80TQ81TQ82TQ91TQ92TV49TV59TV69TQ65TQ72TQ73TQ74TQ75TQ76TQ77TQ82TQ83TQ84TQ85TQ86TQ87TQ91TQ92TQ93TQ94TQ95TQ96TQ97TR01TR02TR03TR04TR05TR06TR07TR12TR13TR14TR15TR16TR23TR24TR25TR26TR27TR33TR34TR35TR36TR37TR46TR47TQ35TQ36TQ37TQ38TQ43TQ44TQ45TQ46TQ47TQ48TQ53TQ54TQ55TQ56TQ57TQ58TQ63TQ64TQ65TQ66TQ67TQ72TQ73TQ74TQ75TQ76TQ77TQ78TQ87TQ88TQ97SU83SU84SU85SU86SU93SU94SU95SU96SU97TQ03TQ04TQ05TQ06TQ07TQ13TQ14TQ15TQ16TQ17TQ23TQ24TQ25TQ26TQ27TQ33TQ34TQ35TQ36TQ37TQ38TQ43TQ44TQ45TL30TL40TL50TL60TL70TL80TL90TM00TQ38TQ39TQ47TQ48TQ49TQ57TQ58TQ59TQ67TQ68TQ69TQ77TQ78TQ79TQ88TQ89TQ98TQ99TR08TR09TR19TL30TL31TL34TL40TL41TL42TL43TL44TL50TL51TL52TL53TL54TL60TL61TL62TL63TL64TL70TL71TL72TL73TL74TL80TL81TL82TL83TL84TL90TL91TL92TL93TM01TM02TM03TM11TM12TM13TM21TM22TM23TQ49SP81SP90SP91TL00TL01TL02TL10TL11TL12TL13TL20TL21TL22TL23TL24TL30TL31TL32TL33TL34TL41TL42TL43TL44TL51TL52TQ09TQ19TQ29TQ39TL20TL30TQ06TQ07TQ08TQ09TQ16TQ17TQ18TQ19TQ27TQ28TQ29TQ37TQ38TQ39SP20SP30SP40SP41SP50SU19SU26SU27SU28SU29SU36SU37SU38SU39SU46SU47SU48SU49SU56SU57SU58SU59SU66SU67SU68SU69SU76SU77SU78SU86SU87SU88SU96SU97SU98SP10SP20SP21SP22SP23SP30SP31SP32SP33SP34SP40SP41SP42SP43SP44SP45SP50SP51SP52SP53SP54SP60SP61SP62SP63SP70SU29SU39SU49SU57SU58SU59SU67SU68SU69SU77SU78SU79SP51SP53SP60SP61SP62SP63SP64SP70SP71SP72SP73SP74SP80SP81SP82SP83SP84SP85SP90SP91SP92SP93SP94SP95SU78SU79SU88SU89SU97SU98SU99TL00TL01TQ07TQ08TQ09TG40TG50TM03TM04TM05TM06TM07TM13TM14TM15TM16TM17TM23TM24TM25TM26TM27TM28TM33TM34TM35TM36TM37TM38TM39TM44TM45TM46TM47TM48TM49TM57TM58TM59TL64TL65TL66TL67TL68TL74TL75TL76TL77TL78TL83TL84TL85TL86TL87TL88TL93TL94TL95TL96TL97TL98TM03TM04TM05TM06TM07TM08TG00TG01TG02TG03TG04TG10TG11TG12TG13TG14TG20TG21TG22TG23TG24TG30TG31TG32TG33TG40TG41TG42TG50TG51TM07TM08TM09TM17TM18TM19TM27TM28TM29TM38TM39TM49TM59TF40TF41TF42TF50TF51TF52TF53TF60TF61TF62TF63TF64TF70TF71TF72TF73TF74TF80TF81TF82TF83TF84TF90TF91TF92TF93TF94TG00TG01TG02TG03TG04TL49TL59TL68TL69TL78TL79TL87TL88TL89TL98TL99TM07TM08TM09TF20TF30TF31TF40TF41TF50TL15TL19TL23TL24TL25TL26TL28TL29TL33TL34TL35TL36TL37TL38TL39TL44TL45TL46TL47TL48TL49TL54TL55TL56TL57TL58TL59TL63TL64TL65TL66TL67TL68TL69TL75TL76SP91SP92SP93SP94SP95SP96TL01TL02TL03TL04TL05TL06TL07TL11TL12TL13TL14TL15TL16TL23TL24TL25TL06TL07TL08TL09TL15TL16TL17TL18TL19TL25TL26TL27TL28TL29TL36TL37TL38TL39SK90SP43SP44SP45SP46SP53SP54SP55SP56SP57SP58SP63SP64SP65SP66SP67SP68SP73SP74SP75SP76SP77SP78SP79SP84SP85SP86SP87SP88SP89SP95SP96SP97SP98SP99TF00TF10TF20TL06TL07TL08TL09TL18TL19TL29SO70SO71SO80SO81SO82SO83SO90SO91SO92SO93SO94SP00SP01SP02SP03SP04SP10SP11SP12SP13SP14SP15SP20SP21SP22SP23SP24SP25ST99SU09SU19SU29SO50SO51SO60SO61SO62SO63SO70SO71SO72SO73SO80SO81SO82SO83SO90ST57ST58ST59ST66ST67ST68ST69ST76ST77ST78ST79ST87ST88ST89ST98ST99SO10SO11SO20SO21SO22SO23SO30SO31SO32SO40SO41SO42SO50SO51ST18ST19ST27ST28ST29ST37ST38ST39ST47ST48ST49ST58ST59SO22SO23SO24SO25SO26SO32SO33SO34SO35SO36SO37SO41SO42SO43SO44SO45SO46SO47SO51SO52SO53SO54SO55SO56SO57SO61SO62SO63SO64SO65SO66SO73SO74SO75SO76SO56SO64SO65SO66SO67SO72SO73SO74SO75SO76SO77SO78SO82SO83SO84SO85SO86SO87SO88SO93SO94SO95SO96SO97SO98SO99SP03SP04SP05SP06SP07SP08SP13SP14SP16SP17SP18SK10SK20SK30SP04SP05SP06SP07SP08SP09SP14SP15SP16SP17SP18SP19SP22SP23SP24SP25SP26SP27SP28SP29SP33SP34SP35SP36SP37SP38SP39SP44SP45SP46SP47SP48SP49SP55SP56SP57SP58SJ63SJ70SJ71SJ72SJ73SJ74SJ75SJ80SJ81SJ82SJ83SJ84SJ85SJ86SJ90SJ91SJ92SJ93SJ94SJ95SJ96SK00SK01SK02SK03SK04SK05SK06SK10SK11SK12SK13SK14SK15SK16SK20SK21SK22SO77SO78SO79SO88SO89SO98SO99SP08SP09SP19SP29SJ20SJ21SJ22SJ23SJ30SJ31SJ32SJ33SJ34SJ40SJ41SJ42SJ43SJ50SJ51SJ52SJ53SJ54SJ60SJ61SJ62SJ63SJ64SJ70SJ71SJ72SJ73SJ74SJ80SO17SO18SO27SO28SO29SO37SO38SO39SO46SO47SO48SO49SO56SO57SO58SO59SO66SO67SO68SO69SO77SO78SO79SO88SO89SN50SN60SN61SN70SN71SN80SN81SN90SO00SO01SO10SO11SS38SS39SS48SS49SS58SS59SS68SS69SS77SS78SS79SS87SS88SS89SS96SS97SS98SS99ST06ST07ST08ST09ST16ST17ST18ST19ST26ST27ST28SN70SN71SN74SN80SN81SN82SN83SN84SN85SN86SN90SN91SN92SN93SN94SN95SN96SO00SO01SO02SO03SO04SO05SO06SO10SO11SO12SO13SO14SO21SO22SO23SO24SN86SN87SN96SN97SO04SO05SO06SO07SO08SO13SO14SO15SO16SO17SO18SO24SO25SO26SO27SO36SO37SN01SN02SN10SN11SN12SN20SN21SN22SN23SN24SN30SN31SN32SN33SN34SN40SN41SN42SN43SN44SN50SN51SN52SN53SN54SN60SN61SN62SN63SN64SN65SN71SN72SN73SN74SN75SN81SN82SN83SN84SS39SS49SS59SM50SM62SM70SM71SM72SM73SM80SM81SM82SM83SM84SM90SM91SM92SM93SM94SN00SN01SN02SN03SN04SN10SN11SN12SN13SN14SN22SN23SN24SR89SR99SS09SS19SN14SN15SN24SN25SN33SN34SN35SN36SN44SN45SN46SN54SN55SN56SN57SN58SN64SN65SN66SN67SN68SN69SN74SN75SN76SN77SN78SN79SN84SN85SN86SN87SN88SN89SH70SH71SH80SH81SH90SH91SH92SJ00SJ01SJ02SJ03SJ10SJ11SJ12SJ20SJ21SJ22SJ31SN69SN78SN79SN87SN88SN89SN97SN98SN99SO07SO08SO09SO18SO19SO28SO29SO39SH50SH51SH52SH53SH54SH60SH61SH62SH63SH64SH70SH71SH72SH73SH74SH80SH81SH82SH83SH84SH91SH92SH93SH94SH95SJ03SJ04SJ05SJ13SJ14SN59SN69SN79SH12SH13SH22SH23SH24SH32SH33SH34SH43SH44SH45SH46SH53SH54SH55SH56SH57SH64SH65SH66SH67SH74SH75SH76SH77SH78SH84SH85SH86SH87SH88SH74SH75SH76SH77SH84SH85SH86SH87SH88SH94SH95SH96SH97SH98SJ02SJ03SJ04SJ05SJ06SJ07SJ08SJ12SJ13SJ14SJ15SJ16SJ17SJ22SJ23SJ24SJ25SJ26SJ33SJ34SJ35SJ43SJ44SJ45SJ53SJ54SH97SH98SJ06SJ07SJ08SJ15SJ16SJ17SJ18SJ25SJ26SJ27SJ35SJ36SJ37SH27SH28SH29SH36SH37SH38SH39SH46SH47SH48SH49SH56SH57SH58SH59SH67SH68SK81SK82SK83SK84SK85SK86SK87SK90SK91SK92SK93SK94SK95SK96SK97TF00TF01TF02TF03TF04TF05TF06TF07TF10TF11TF12TF13TF14TF15TF16TF17TF20TF21TF22TF23TF24TF25TF30TF31TF32TF33TF34TF41TF42TF43TF44TF52SE60SE70SE71SE80SE81SE82SE90SE91SE92SK78SK79SK87SK88SK89SK97SK98SK99TA00TA01TA02TA10TA11TA12TA20TA21TA30TA31TA40TF07TF08TF09TF15TF16TF17TF18TF19TF24TF25TF26TF27TF28TF29TF33TF34TF35TF36TF37TF38TF39TF43TF44TF45TF46TF47TF48TF49TF54TF55TF56TF57TF58SK20SK21SK30SK31SK32SK40SK41SK42SK43SK50SK51SK52SK60SK61SK62SK70SK71SK72SK73SK74SK80SK81SK82SK83SK84SK90SK91SP39SP48SP49SP57SP58SP59SP68SP69SP78SP79SP89SP99TF00TF01SE60SE70SK42SK43SK44SK45SK46SK52SK53SK54SK55SK56SK57SK58SK59SK62SK63SK64SK65SK66SK67SK68SK69SK72SK73SK74SK75SK76SK77SK78SK79SK84SK85SK86SK87SK88SK89SK97SJ98SJ99SK03SK06SK07SK08SK09SK11SK12SK13SK14SK15SK16SK17SK18SK19SK21SK22SK23SK24SK25SK26SK27SK28SK31SK32SK33SK34SK35SK36SK37SK38SK42SK43SK44SK45SK46SK47SK48SK53SK56SK57SD90SE00SE10SJ18SJ19SJ27SJ28SJ29SJ35SJ36SJ37SJ38SJ39SJ44SJ45SJ46SJ47SJ48SJ54SJ55SJ56SJ57SJ58SJ63SJ64SJ65SJ66SJ67SJ68SJ69SJ74SJ75SJ76SJ77SJ78SJ79SJ85SJ86SJ87SJ88SJ89SJ96SJ97SJ98SJ99SK06SK07SK08SK09SK19SD20SD21SD22SD30SD31SD32SD40SD41SD42SD50SD51SD52SD53SD60SD61SD62SD63SD70SD71SD72SD73SD74SD80SD81SD82SD83SD84SD90SD91SD92SD93SD94SJ29SJ38SJ39SJ48SJ49SJ58SJ59SJ68SJ69SJ79SJ88SJ89SJ99SD22SD23SD32SD33SD34SD35SD36SD42SD43SD44SD45SD46SD47SD52SD53SD54SD55SD56SD57SD63SD64SD65SD66SD67SD68SD73SD78SE53SE54SE62SE63SE64SE65SE72SE73SE74SE75SE76SE82SE83SE84SE85SE86SE87SE92SE93SE94SE95SE96SE97SE98TA02TA03TA04TA05TA06TA07TA08TA12TA13TA14TA15TA16TA17TA18TA21TA22TA23TA24TA26TA27TA31TA32TA33TA41TA42NZ30NZ31NZ40NZ41NZ42NZ50NZ51NZ52NZ60NZ61NZ62NZ70NZ71NZ72NZ80NZ81NZ90NZ91SE37SE38SE39SE46SE47SE48SE49SE55SE56SE57SE58SE59SE64SE65SE66SE67SE68SE69SE75SE76SE77SE78SE79SE86SE87SE88SE89SE97SE98SE99TA08TA09TA18SD84SD90SD91SD92SD93SD94SD95SE00SE01SE02SE03SE04SE10SE11SE12SE13SE14SE20SE21SE22SE23SE30SE31SE32SE33SE40SE41SE42SE50SE51SE52SE60SE61SE62SE70SE71SE72SE81SE82SK18SK19SK28SK29SK38SK39SK47SK48SK49SK57SK58SK59SK69SD54SD55SD64SD65SD66SD67SD68SD73SD74SD75SD76SD77SD78SD84SD85SD86SD87SD88SD94SD95SD96SD97SD98SE04SE05SE06SE07SE13SE14SE15SE16SE17SE23SE24SE25SE26SE27SE32SE33SE34SE35SE36SE37SE42SE43SE44SE45SE46SE52SE53SE54SE55SE56SE62SE63SE64SE65SE72NY72NY80NY81NY82NY90NY91NY92NZ00NZ01NZ02NZ10NZ11NZ20NZ21NZ30NZ31SD68SD69SD78SD79SD88SD89SD97SD98SD99SE07SE08SE09SE17SE18SE19SE27SE28SE29SE36SE37SE38SE39SE46SE47NY73NY74NY82NY83NY84NY92NY93NY94NY95NZ01NZ02NZ03NZ04NZ05NZ11NZ12NZ13NZ14NZ15NZ16NZ20NZ21NZ22NZ23NZ24NZ25NZ26NZ30NZ31NZ32NZ33NZ34NZ35NZ36NZ41NZ42NZ43NZ44NZ45NZ46NZ52NZ53NT60NT70NT80NT90NU00NU10NU20NY58NY59NY64NY65NY66NY67NY68NY69NY74NY75NY76NY77NY78NY79NY84NY85NY86NY87NY88NY89NY94NY95NY96NY97NY98NY99NZ04NZ05NZ06NZ07NZ08NZ09NZ15NZ16NZ17NZ18NZ19NZ26NZ27NZ28NZ29NZ36NZ37NZ38NZ39NT70NT71NT73NT80NT81NT82NT83NT84NT90NT91NT92NT93NT94NT95NU00NU01NU02NU03NU04NU05NU10NU11NU12NU13NU14NU20NU21NU22NU23NZ09NZ19NY20NY21NY30NY31NY40NY41NY42NY50NY51NY52NY53NY60NY61NY62NY63NY70NY71NY72NY73NY80NY81NY82NY83SD16SD17SD18SD19SD26SD27SD28SD29SD36SD37SD38SD39SD46SD47SD48SD49SD57SD58SD59SD67SD68SD69SD78SD79SD89NX90NX91NX92NX93NY00NY01NY02NY03NY04NY05NY10NY11NY12NY13NY14NY15NY16NY20NY21NY22NY23NY24NY25NY26NY31NY32NY33NY34NY35NY36NY37NY41NY42NY43NY44NY45NY46NY47NY48NY52NY53NY54NY55NY56NY57NY58NY62NY63NY64NY65NY66NY67NY68NY73NY74NY75NY84SD08SD09SD17SD18SD19SD28SD29NX30NX40SC16SC17SC26SC27SC28SC36SC37SC38SC39SC47SC48SC49NS60NS61NS70NS71NS72NS80NS81NS90NT00NT01NT10NT11NT20NT21NT30NX69NX78NX79NX88NX89NX96NX97NX98NX99NY05NY06NY07NY08NY09NY16NY17NY18NY19NY26NY27NY28NY29NY36NY37NY38NY39NY47NY48NY49NS50NS60NX36NX37NX38NX45NX46NX47NX48NX49NX54NX55NX56NX57NX58NX59NX64NX65NX66NX67NX68NX69NX74NX75NX76NX77NX78NX79NX84NX85NX86NX87NX88NX95NX96NX97NX98NY05NY06NW95NW96NW97NX03NX04NX05NX06NX07NX13NX14NX15NX16NX17NX24NX25NX26NX27NX33NX34NX35NX36NX37NX43NX44NX45NX46NS00NS10NS14NS15NS16NS20NS21NS23NS24NS25NS26NS30NS31NS32NS33NS34NS35NS36NS40NS41NS42NS43NS44NS45NS50NS51NS52NS53NS54NS55NS60NS61NS62NS63NS64NS71NS72NS73NX07NX08NX09NX17NX18NX19NX27NX28NX29NX37NX38NX39NX48NX49NX59NS16NS17NS26NS27NS35NS36NS37NS44NS45NS46NS47NS54NS55NS56NS64NS65NS66NS53NS54NS55NS56NS57NS63NS64NS65NS66NS67NS71NS72NS73NS74NS75NS76NS77NS80NS81NS82NS83NS84NS85NS86NS87NS90NS91NS92NS93NS94NS95NS96NT00NT01NT02NT03NT04NT05NT14NT01NT02NT03NT04NT05NT11NT12NT13NT14NT15NT21NT22NT23NT24NT25NT32NT33NT34NT10NT11NT20NT21NT22NT23NT30NT31NT32NT33NT34NT41NT42NT43NT44NT53NT20NT30NT31NT40NT41NT42NT43NT44NT50NT51NT52NT53NT54NT60NT61NT62NT63NT64NT70NT71NT72NT73NT74NT81NT82NT83NY39NY47NY48NY49NY58NY59NY69NT44NT45NT46NT53NT54NT55NT56NT63NT64NT65NT66NT73NT74NT75NT76NT77NT83NT84NT85NT86NT87NT94NT95NT96NT36NT37NT45NT46NT47NT48NT55NT56NT57NT58NT65NT66NT67NT68NT76NT77NS95NS96NT05NT06NT15NT16NT17NT24NT25NT26NT27NT34NT35NT36NT37NT43NT44NT45NT46NS86NS87NS95NS96NS97NS98NT06NT07NT08NT16NT17NO00NO01NO10NO11NO20NO21NO22NO30NO31NO32NO40NO41NO42NO50NO51NO52NO60NO61NS99NT08NT09NT18NT19NT28NT29NT39NT49NT59NT69NN30NN31NN40NN41NS38NS39NS47NS48NS49NS57NS58NS59NS67NS68NS69NS77NS78NS79NS86NS87NS88NS89NS97NS98NN21NN22NN30NN31NN32NN40NN41NN42NN50NN51NN52NN60NN61NN70NN71NN80NN81NN90NN91NO00NS49NS59NS69NS79NS88NS89NS98NS99NT08NT09NN22NN23NN32NN33NN34NN35NN42NN43NN44NN45NN46NN47NN51NN52NN53NN54NN55NN56NN57NN61NN62NN63NN64NN65NN66NN67NN71NN72NN73NN74NN75NN76NN77NN81NN82NN83NN84NN85NN86NN90NN91NN92NN93NN94NN95NN96NO00NO01NO02NO03NO04NO11NO12NO13NO21NN56NN57NN66NN67NN68NN76NN77NN78NN86NN87NN88NN94NN95NN96NN97NN98NO02NO03NO04NO05NO06NO07NO08NO11NO12NO13NO14NO15NO16NO17NO21NO22NO23NO24NO25NO32NO33NO34NO15NO16NO17NO23NO24NO25NO26NO27NO28NO32NO33NO34NO35NO36NO37NO38NO42NO43NO44NO45NO46NO47NO48NO53NO54NO55NO56NO57NO58NO63NO64NO65NO66NO67NO74NO75NO76NJ60NJ70NJ80NJ90NO57NO58NO66NO67NO68NO69NO76NO77NO78NO79NO86NO87NO88NO89NO99NH90NJ00NJ10NJ11NJ20NJ21NJ30NJ31NJ32NJ40NJ41NJ42NJ50NJ51NJ52NJ60NJ61NJ62NJ70NJ71NJ72NJ80NJ81NJ82NJ90NJ91NJ92NK02NN98NN99NO07NO08NO09NO17NO18NO19NO27NO28NO29NO37NO38NO39NO48NO49NO58NO59NO68NO69NO79NO89NJ31NJ32NJ33NJ34NJ42NJ43NJ44NJ52NJ53NJ54NJ55NJ62NJ63NJ64NJ65NJ72NJ73NJ74NJ75NJ76NJ82NJ83NJ84NJ85NJ86NJ92NJ93NJ94NJ95NJ96NK02NK03NK04NK05NK06NK13NK14NK15NH90NJ00NJ01NJ10NJ11NJ12NJ13NJ14NJ21NJ22NJ23NJ24NJ25NJ32NJ33NJ34NJ35NJ36NJ42NJ43NJ44NJ45NJ46NJ54NJ55NJ56NJ64NJ65NJ66NJ74NJ75NJ76NJ86NN99NH72NH81NH82NH91NH92NH93NH94NH95NH96NJ00NJ01NJ02NJ03NJ04NJ05NJ06NJ11NJ12NJ13NJ14NJ15NJ16NJ17NJ23NJ24NJ25NJ26NJ27NJ34NJ35NJ36NJ45NH01NH02NH10NH11NH12NH13NH14NH20NH21NH22NH23NH24NH30NH31NH32NH33NH34NH40NH41NH42NH43NH44NH50NH51NH52NH53NH54NH60NH61NH62NH63NH64NH70NH71NH72NH73NH74NH75NH80NH81NH82NH83NH84NH85NH90NH91NH92NH93NH94NH95NH96NJ00NJ01NN39NN46NN47NN48NN49NN56NN57NN58NN59NN67NN68NN69NN77NN78NN79NN88NN89NN98NN99NG60NG70NG71NG72NG80NG81NG82NG90NG91NH00NH01NH10NH20NH30NM46NM47NM54NM55NM56NM57NM64NM65NM66NM67NM68NM69NM74NM75NM76NM77NM78NM79NM84NM85NM86NM87NM88NM89NM95NM96NM97NM98NM99NN05NN06NN07NN08NN09NN16NN17NN18NN19NN26NN27NN28NN29NN35NN36NN37NN38NN39NN46NN47NN48NN49NN57NN58NN59NM70NM71NM72NM73NM80NM81NM82NM83NM84NM90NM91NM92NM93NM94NM95NN00NN01NN02NN03NN04NN05NN10NN11NN12NN13NN14NN15NN16NN20NN21NN22NN23NN24NN25NN26NN30NN33NN34NN35NN36NN44NN45NN46NR79NR88NR89NR96NR97NR98NR99NS06NS07NS08NS09NS16NS17NS18NS19NS28NS29NN20NN21NN30NN31NS28NS29NS37NS38NS39NS46NS47NS48NS56NS57NR82NR83NR84NR92NR93NR94NR95NR96NR97NS01NS02NS03NS04NS05NS06NS07NS15NS16NR50NR51NR60NR61NR62NR63NR64NR65NR67NR68NR70NR71NR72NR73NR74NR75NR76NR77NR78NR79NR83NR84NR85NR86NR87NR88NR89NR95NR96NM40NM60NM61NM70NM71NR15NR16NR24NR25NR26NR27NR34NR35NR36NR37NR38NR39NR44NR45NR46NR47NR48NR49NR56NR57NR58NR59NR67NR68NR69NR79NL93NL94NM04NM05NM15NM16NM21NM22NM23NM24NM25NM26NM31NM32NM33NM34NM35NM41NM42NM43NM44NM45NM51NM52NM53NM54NM55NM61NM62NM63NM64NM72NM73NG13NG14NG15NG20NG23NG24NG25NG26NG30NG31NG32NG33NG34NG35NG36NG37NG38NG40NG41NG42NG43NG44NG45NG46NG47NG50NG51NG52NG53NG54NG55NG56NG60NG61NG62NG63NG64NG65NG66NG71NG72NG82NM19NM29NM37NM38NM39NM47NM48NM49NM59NB90NB91NC00NC01NC10NC11NC20NC21NG63NG64NG65NG72NG73NG74NG75NG76NG77NG78NG79NG82NG83NG84NG85NG86NG87NG88NG89NG91NG92NG93NG94NG95NG96NG97NG98NG99NH00NH01NH02NH03NH04NH05NH06NH07NH08NH09NH10NH11NH15NH16NH17NH18NH19NH27NH28NH29NC10NC20NC21NC30NC31NC40NH02NH03NH04NH05NH06NH07NH12NH13NH14NH15NH16NH17NH19NH23NH24NH25NH26NH27NH28NH29NH34NH35NH36NH37NH38NH39NH44NH45NH46NH47NH48NH49NH54NH55NH56NH57NH58NH59NH64NH65NH66NH67NH68NH69NH75NH76NH77NH78NH86NH87NH88NH97NH98NC22NC30NC31NC32NC33NC40NC41NC42NC43NC50NC51NC52NC60NC61NC62NC63NC70NC71NC72NC73NC74NC80NC81NC82NC83NC84NC90NC91NC92NC93ND01ND02NH49NH59NH68NH69NH78NH79NH88NH89NC01NC02NC03NC10NC11NC12NC13NC14NC15NC16NC20NC21NC22NC23NC24NC25NC26NC27NC31NC32NC33NC34NC35NC36NC37NC42NC43NC44NC45NC46NC52NC53NC54NC55NC56NC62NC63NC64NC65NC66NC73NC74NC75NC76NC83NC84NC85NC86NC93NC94NC95NC96NC92NC93NC94NC95NC96ND01ND02ND03ND04ND05ND06ND07ND12ND13ND14ND15ND16ND17ND23ND24ND25ND26ND27ND33ND34ND35ND36ND37ND47HW63HW83HX62NA00NA10NA64NA74NA81NA90NA91NA92NA93NB00NB01NB02NB03NB10NB11NB12NB13NB14NB20NB21NB22NB23NB24NB30NB31NB32NB33NB34NB35NB40NB41NB42NB43NB44NB45NB46NB52NB53NB54NB55NB56NF09NF19NF56NF58NF60NF61NF66NF67NF68NF70NF71NF72NF73NF74NF75NF76NF77NF80NF81NF82NF83NF84NF85NF86NF87NF88NF89NF95NF96NF97NF98NF99NG07NG08NG09NG18NG19NG29NG49NL57NL58NL68NL69NL79HY10HY20HY21HY22HY23HY30HY31HY32HY33HY34HY35HY40HY41HY42HY43HY44HY45HY50HY51HY52HY53HY54HY55HY60HY61HY62HY63HY64HY73HY74HY75ND19ND28ND29ND38ND39ND47ND48ND49ND59HP40HP50HP51HP60HP61HT93HT94HU14HU15HU16HU24HU25HU26HU27HU28HU30HU31HU32HU33HU34HU35HU36HU37HU38HU39HU40HU41HU42HU43HU44HU45HU46HU47HU48HU49HU53HU54HU55HU56HU57HU58HU59HU66HU67HU68HU69HZ16HZ17HZ26HZ27",Wb.prototype.to_gridref=function(e){var t=this.x/1e5|0,n=this.y/1e5|0,r="";r=n<5?t<5?"S":"T":n<10?t<5?"N":"O":t<5?"H":"J";var o=65+5*(4-n%5)+t%5;o>=73&&o++;var a=String.fromCharCode(o);return Vb(r+a,this.x-1e5*t,this.y-1e5*n,e||1)},Wb.prototype.to_hectad=function(){var e=this.x/1e5|0,t=this.y/1e5|0,n=65+5*(4-t%5)+e%5;return n>=73&&n++,(t<5?e<5?"S":"T":t<10?e<5?"N":"O":e<5?"H":"J")+String.fromCharCode(n)+((this.x-1e5*e)/1e4|0)+((this.y-1e5*t)/1e4|0)},Wb.prototype.is_gb_hectad=function(){return-1!==Wb.gbHectads.indexOf(this.to_hectad())},Wb.prototype.to_latLng=function(){var e,t=4e5,n=.85521133347722,r=6377563.396,o=this.x,a=this.y,i=.0016732203289875,s=(a+1e5)/(.9996012717*r)+n;do{s+=(e=a+1e5-6353722.489*(1.0016767257674*(s-n)-.00502807228247412*Math.sin(s-n)*Math.cos(s+n)+5258157614724887e-21*Math.sin(2*(s-n))*Math.cos(2*(s+n))-35/24*i*i*i*Math.sin(3*(s-n))*Math.cos(3*(s+n))))/6375020.48098897}while(e>=.001);var c=Math.sin(s)*Math.sin(s),l=Math.tan(s)*Math.tan(s),u=1/Math.cos(s),d=.9996012717*r*Math.pow(1-.00667054007*c,-.5),f=6332495.651423464*Math.pow(1-.00667054007*c,-1.5),h=d/f-1,p=Math.tan(s)/(2*f*d),v=Math.tan(s)/(24*f*Math.pow(d,3))*(5+3*l+h-9*l*h),S=Math.tan(s)/(720*f*Math.pow(d,5))*(61+90*l+45*l*l),y=u/d,N=u/(6*d*d*d)*(d/f+2*l),m=u/(120*Math.pow(d,5))*(5+28*l+24*l*l),g=u/(5040*Math.pow(d,7))*(61+662*l+1320*l*l+720*l*l*l),b=s-p*Math.pow(o-t,2)+v*Math.pow(o-t,4)-S*Math.pow(o-t,6),T=y*(o-t)-.034906585039887-N*Math.pow(o-t,3)+m*Math.pow(o-t,5)-g*Math.pow(o-t,7);return new Jb(jb*b,jb*T).to_WGS84()};var Zb=function(){var e=function(){};return(e.prototype=new Db).constructor=e,e.prototype.country="GB",e.prototype.GridCoords=Wb,e.prototype.parse_well_formed=function(e){e.length>=5&&/^[A-Z]/.test(e.charAt(4))&&(Db.quadrantOffsets.hasOwnProperty(e.substr(e.length-2))?this.quadrantCode=e.substr(e.length-2):this.tetradLetter=e.charAt(4),e=e.substr(0,4)),this.parse_wellformed_gb_gr_string_no_tetrads(e),this.tetradLetter||this.quadrantCode?this.tetradLetter?(this.preciseGridRef=this.tetrad=this.hectad+this.tetradLetter,this.length=2e3,this.gridCoords.x+=Db.tetradOffsets[this.tetradLetter][0],this.gridCoords.y+=Db.tetradOffsets[this.tetradLetter][1]):(this.preciseGridRef=this.quadrant=e+this.quadrantCode,this.length=5e3,this.gridCoords.x+=Db.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=Db.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=e,this.length<=1e3&&this.set_tetrad())},e.prototype.from_string=function(e){var t,n=e.replace(/[\[\]\s\t\.-]+/g,"").toUpperCase(),r="";if(/[ABCDEFGHIJKLMNPQRSTUVWXYZ]$/.test(n)&&(Db.quadrantOffsets.hasOwnProperty(n.substr(n.length-2))?(this.quadrantCode=n.substr(n.length-2),n=n.substr(0,n.length-2)):(r=n.substr(n.length-1),n=n.substr(0,n.length-1))),n===parseInt(n,10).toString()?n=n.substr(0,2)+"/"+n.substr(2):n.length>3&&"/"===n.charAt(2)&&/^[A-Z]{2}$/.test(n.substr(0,2))&&(n=n.replace("/","")),"VC"===n.substr(0,2))this.error=!0,this.errorMessage="Misplaced vice-county code in grid-reference field. ('"+n+"')",this.gridCoords=null,this.length=0;else if(null!==(t=n.match(/^([A-Z]{2}(?:\d\d){1,5})$/)))n=t[0],this.parse_wellformed_gb_gr_string_no_tetrads(n),this.length>0?1e4===this.length&&(r||this.quadrantCode)?r?(this.preciseGridRef=n+r,this.tetradLetter=r,this.tetrad=this.hectad+r,this.length=2e3,this.gridCoords.x+=Db.tetradOffsets[r][0],this.gridCoords.y+=Db.tetradOffsets[r][1]):(this.preciseGridRef=n+this.quadrantCode,this.tetradLetter="",this.tetrad="",this.quadrant=this.preciseGridRef,this.length=5e3,this.gridCoords.x+=Db.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=Db.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=n,this.length<=1e3&&this.set_tetrad()):(this.error=!0,this.errorMessage="GB grid reference format not understood (strange length).");else if(/^([\d]{2})\/((?:\d\d){1,5})$/.test(n)){switch(this.parse_gr_string_without_tetrads(n),this.length){case 1e4:n=this.gridCoords.to_gridref(1e4),this.hectad=n,r?(n+=r,this.tetradLetter=r,this.tetrad=this.hectad+r,this.length=2e3,this.gridCoords.x+=Db.tetradOffsets[r][0],this.gridCoords.y+=Db.tetradOffsets[r][1]):this.quadrantCode&&(n+=this.quadrantCode,this.quadrant=n,this.length=5e3,this.gridCoords.x+=Db.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=Db.quadrantOffsets[this.quadrantCode][1]);break;case 1e3:case 100:case 10:case 1:n=this.gridCoords.to_gridref(this.length),this.hectad=this.gridCoords.to_gridref(1e4),this.set_tetrad();break;default:this.error=!0,this.errorMessage="Bad grid square dimension ("+this.length+" m).",this.gridCoords=null,this.length=0}this.preciseGridRef=n}else this.gridCoords=null,this.length=0,this.error=!0,this.errorMessage="Grid reference format not understood. ('"+e+"')"},e.prototype.parse_gr_string_without_tetrads=function(e){var t,n,r,o;if(null!==(t=e.match(/^(\d{2})\/((?:\d\d){1,5})$/))){switch(t[1]){case"57":n=3e5,r=1e6;break;case"67":n=4e5,r=1e6;break;case"58":n=3e5,r=11e5;break;case"68":n=4e5,r=11e5;break;case"69":n=4e5,r=12e5;break;default:n=1e5*e.charAt(0),r=1e5*e.charAt(1)}o=t[2]}else{if(!Db.letterMapping.hasOwnProperty(e.charAt(0))||!Db.letterMapping.hasOwnProperty(e.charAt(1)))return this.length=0,void(this.gridCoords=null);var a=Db.letterMapping[e.charAt(0)],i=Db.letterMapping[e.charAt(1)];o=e.substr(2),n=a%5*5e5+i%5*1e5-1e6,r=5e5*-Math.floor(a/5)-1e5*Math.floor(i/5)+19e5}switch(o.length){case 2:this.gridCoords=new Wb(n+1e4*o.charAt(0),r+1e4*o.charAt(1)),this.length=1e4;break;case 4:this.gridCoords=new Wb(n+1e3*Math.floor(o/100),r+o%100*1e3),this.length=1e3;break;case 6:this.gridCoords=new Wb(n+100*Math.floor(o/1e3),r+o%1e3*100),this.length=100;break;case 8:this.gridCoords=new Wb(n+10*Math.floor(o/1e4),r+o%1e4*10),this.length=10;break;case 10:this.gridCoords=new Wb(n+Math.floor(o/1e5),r+o%1e5),this.length=1;break;default:Logger("Bad grid ref length, ref="+e),this.gridCoords=null,this.length=0}},e.prototype.parse_wellformed_gb_gr_string_no_tetrads=function(e){var t,n,r,o,a;switch(t=Db.letterMapping[e.charAt(0)],n=Db.letterMapping[e.charAt(1)],r=e.substr(2),o=t%5*5e5+n%5*1e5-1e6,a=5e5*-Math.floor(t/5)-1e5*Math.floor(n/5)+19e5,r.length){case 2:this.gridCoords=new Wb(o+1e4*r.charAt(0),a+1e4*r.charAt(1)),this.length=1e4,this.hectad=e;break;case 4:this.gridCoords=new Wb(o+1e3*Math.floor(r/100),a+r%100*1e3),this.length=1e3,this.hectad=e.substr(0,3)+e.substr(4,1);break;case 6:this.gridCoords=new Wb(o+100*Math.floor(r/1e3),a+r%1e3*100),this.length=100,this.hectad=e.substr(0,3)+e.substr(5,1);break;case 8:this.gridCoords=new Wb(o+10*Math.floor(r/1e4),a+r%1e4*10),this.length=10,this.hectad=e.substr(0,3)+e.substr(6,1);break;case 10:this.gridCoords=new Wb(o+Math.floor(r/1e5),a+r%1e5),this.length=1,this.hectad=e.substr(0,3)+e.substr(7,1);break;default:throw this.gridCoords=null,new Error("Bad grid ref length when parsing supposedly well-formed ref, ref='"+e+"'")}},e}(),$b=function(){var e=function(e,t){this.x=e,this.y=t};return(e.prototype=new Kb).constructor=e,e.prototype.country="IE",e.irishGrid={0:["V","Q","L","F","A"],1:["W","R","M","G","B"],2:["X","S","N","H","C"],3:["Y","T","O","J","D"]},e.prototype.to_latLng=function(){var e=6377340.189,t=.0066705402933363,n=.0016732203841521,r=this.x-2e5,o=(5929615.3530033+(this.y-25e4)/1.000035)/6366691.7742864415,a=o+.002509826623715886*Math.sin(2*o)+36745487490091978e-22*Math.sin(4*o)+151*n*n*n/96*Math.sin(6*o),i=e/Math.sqrt(1-t*Math.sin(a)*Math.sin(a)),s=Math.tan(a)*Math.tan(a),c=.0067153352074207*Math.cos(a)*Math.cos(a),l=e*(1-t)/Math.pow(1-t*Math.sin(a)*Math.sin(a),1.5),u=r/(1.000035*i),d=a-i*Math.tan(a)/l*(u*u/2-(5+3*s+10*c-4*c*c-.0604380168667863)*u*u*u*u/24+(61+90*s+298*c+45*s*s-1.6922644722700164-3*c*c)*u*u*u*u*u*u/720);d*=jb;var f=(u-(1+2*s+c)*u*u*u/6+(5-2*c+28*s-3*c*c+.0537226816593656+24*s*s)*u*u*u*u*u/120)/Math.cos(a);return new Gb(d,f=f*jb-8).to_WGS84()},e.prototype.to_gridref=function(t){var n=Math.floor(this.x/1e5),r=Math.floor(this.y/1e5);return e.irishGrid[n]&&e.irishGrid[n][r]?Vb(e.irishGrid[n][r],this.x-1e5*n,this.y-1e5*r,t||1):null},e.prototype.to_hectad=function(){var t=Math.floor(this.x/1e5),n=Math.floor(this.y/1e5);return e.irishGrid[t]&&e.irishGrid[t][n]?e.irishGrid[t][n]+Math.floor(this.x%1e5/1e4)+Math.floor(this.y%1e5/1e4):""},e}(),zb=function(){var e=function(){};return(e.prototype=new Db).constructor=e,e.prototype.country="IE",e.prototype.GridCoords=$b,e.gridLetter={A:[0,4],B:[1,4],C:[2,4],D:[3,4],F:[0,3],G:[1,3],H:[2,3],J:[3,3],L:[0,2],M:[1,2],N:[2,2],O:[3,2],Q:[0,1],R:[1,1],S:[2,1],T:[3,1],V:[0,0],W:[1,0],X:[2,0],Y:[3,0]},e.prototype.from_string=function(t){var n=t.replace(/[\[\]\s\t\.-]+/g,"").toUpperCase();/[ABCDEFGHIJKLMNPQRSTUVWXYZ]$/.test(n)&&(e.quadrantOffsets.hasOwnProperty(n.substr(n.length-2))?(this.quadrantCode=n.substr(n.length-2),n=n.substr(0,n.length-2)):(this.tetradLetter=n.substr(n.length-1),n=n.substr(0,n.length-1))),this.parse_gr_string_without_tetrads(n),this.length>0?this.tetradLetter||this.quadrantCode?this.tetradLetter?(this.preciseGridRef=this.hectad+this.tetradLetter,this.tetrad=this.preciseGridRef,this.length=2e3,this.gridCoords.x+=e.tetradOffsets[this.tetradLetter][0],this.gridCoords.y+=e.tetradOffsets[this.tetradLetter][1]):(this.preciseGridRef=this.hectad+this.quadrantCode,this.quadrant=this.preciseGridRef,this.length=5e3,this.gridCoords.x+=e.quadrantOffsets[this.quadrantCode][0],this.gridCoords.y+=e.quadrantOffsets[this.quadrantCode][1]):(this.preciseGridRef=n,this.length<=1e3&&this.set_tetrad()):(this.error=!0,this.errorMessage="Irish grid reference format not understood. ('"+t+"')")},e.prototype.parse_well_formed=e.prototype.from_string,e._IE_GRID_LETTERS="VQLFAWRMGBXSNHCYTOJD",e.prototype.parse_gr_string_without_tetrads=function(t){var n,r,o,a;if(/^\d{2}\/(?:\d\d){1,5}$/.test(t)){if(n=parseInt(t.charAt(0),10),r=parseInt(t.charAt(1),10),n>3||r>4)return Logger("bad grid square, ref='"+t+"' (Ireland)"),this.length=0,!1;o=t.substr(3),a=e._IE_GRID_LETTERS.charAt(5*n+r),n*=1e5,r*=1e5}else{if(t=t.replace("/",""),!/^[ABCDFGHJLMNOQRSTVWXY](?:\d\d){1,5}$/.test(t))return this.length=0,this.gridCoords=null,!1;if(!t)return Logger("Bad (empty) Irish grid ref"),this.length=0,this.gridCoords=null,!1;a=t.charAt(0);var i=e._IE_GRID_LETTERS.indexOf(a);if(-1===i)return Logger("Bad grid ref grid-letter, ref='"+t+"' (Ireland)"),this.length=0,this.gridCoords=null,!1;n=1e5*Math.floor(i/5),r=i%5*1e5,o=t.substr(1)}switch(o.length){case 2:this.gridCoords=new $b(n+1e4*o.charAt(0),r+1e4*o.charAt(1)),this.length=1e4,this.hectad=a+o;break;case 4:this.gridCoords=new $b(n+1e3*Math.floor(o/100),r+o%100*1e3),this.length=1e3,this.hectad=a+o.charAt(0)+o.charAt(2);break;case 6:this.gridCoords=new $b(n+100*Math.floor(o/1e3),r+o%1e3*100),this.length=100,this.hectad=a+o.charAt(0)+o.charAt(3);break;case 8:this.gridCoords=new $b(n+10*Math.floor(o/1e4),r+o%1e4*10),this.length=10,this.hectad=a+o.charAt(0)+o.charAt(4);break;case 10:this.gridCoords=new $b(n+Math.floor(o/1e5),r+o%1e5),this.length=1,this.hectad=a+o.charAt(0)+o.charAt(5);break;default:return Logger("Bad grid ref length, ref='"+t+"' (Ireland)"),this.length=0,this.gridCoords=null,!1}return!0},e}();Db.from_string=function(e){var t,n=e.replace(/\s+/g,"").toUpperCase();if(!n)return!1;if(/^[A-Z]{1,2}\d{2}(?:[A-Z]|[NS][EW]|(?:\d{2}){0,4})?$/.test(n))return(t=/^.\d/.test(n)?new Db.GridRefIE:"W"===n.charAt(0)?new Qb:new Zb).parse_well_formed(n),!(!t.length||t.error)&&t;if((t=new Zb).from_string(n),t.length&&!t.error)return t;if("W"===n.charAt(0)){if((t=new Qb).from_string(n),t.length&&!t.error)return t}else if((t=new zb).from_string(n),t.length&&!t.error)return t;return!1};var eT=Wb;Jb.prototype.to_os_coords=function(){var e=this.lat*Ub,t=this.lng*Ub,n=.9996012717,r=.0066705397616,o=6377563.396*n,a=6356256.91*n,i=Math.sin(e)*Math.sin(e),s=o/Math.sqrt(1-r*i),c=s*(1-r)/(1-r*i),l=s/c-1,u=t- -.03490658503988659,d=s*Math.cos(e),f=Math.pow(Math.cos(e),3),h=Math.tan(e)*Math.tan(e),p=s/6*f*(s/c-h),v=Math.pow(Math.cos(e),5),S=Math.pow(Math.tan(e),4),y=s/120*v*(5-18*h+S+14*l-58*h*l),N=4e5+u*d+Math.pow(u,3)*p+Math.pow(u,5)*y,m=Bb._Marc(a,.0016732202503250907,.8552113334772214,e)+-1e5,g=s/2*Math.sin(e)*Math.cos(e),b=s/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*l),T=s/720*Math.sin(e)*v*(61-58*h+S),E=m+u*u*g+Math.pow(u,4)*b+Math.pow(u,6)*T;return new eT(Math.round(N),Math.round(E))};var tT=$b;Gb.prototype.to_os_coords=function(){var e=this.lat*Ub,t=this.lng*Ub,n=.00667054015,r=6377563.395906615,o=6356256.908205645,a=Math.sin(e)*Math.sin(e),i=r/Math.sqrt(1-n*a),s=i*(1-n)/(1-n*a),c=i/s-1,l=t- -.13962634015954636,u=i*Math.cos(e),d=Math.pow(Math.cos(e),3),f=Math.tan(e)*Math.tan(e),h=i/6*d*(i/s-f),p=Math.pow(Math.cos(e),5),v=Math.pow(Math.tan(e),4),S=i/120*p*(5-18*f+v+14*c-58*f*c),y=2e5+l*u+Math.pow(l,3)*h+Math.pow(l,5)*S,N=Bb._Marc(o,.0016732203841520518,.9337511498169663,e)+25e4,m=i/2*Math.sin(e)*Math.cos(e),g=i/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*c),b=i/720*Math.sin(e)*p*(61-58*f+v),T=N+l*l*m+Math.pow(l,4)*g+Math.pow(l,6)*b;return new tT(Math.round(y),Math.round(T))};var nT=Xb;function rT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function oT(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}Yb.prototype.to_os_coords=function(){var e=this.lat*Ub,t=this.lng*Ub,n=.0067226700223333,r=6375836.6448,o=6354369.181221601,a=Math.sin(e)*Math.sin(e),i=r/Math.sqrt(1-n*a),s=i*(1-n)/(1-n*a),c=i/s-1,l=t- -.0523598775598,u=i*Math.cos(e),d=Math.pow(Math.cos(e),3),f=Math.tan(e)*Math.tan(e),h=i/6*d*(i/s-f),p=Math.pow(Math.cos(e),5),v=Math.pow(Math.tan(e),4),S=i/120*p*(5-18*f+v+14*c-58*f*c),y=5e5+l*u+Math.pow(l,3)*h+Math.pow(l,5)*S,N=Bb._Marc(o,.0016863406508729017,0,e)+0,m=i/2*Math.sin(e)*Math.cos(e),g=i/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*c),b=i/720*Math.sin(e)*p*(61-58*f+v),T=N+l*l*m+Math.pow(l,4)*g+Math.pow(l,6)*b;return new nT(Math.round(y),Math.round(T))};var aT=new WeakMap,iT=new WeakMap,sT=function(e){So(r,hv);var t=rT(r);function r(e){var o;return n(this,r),oT(po(o=t.call(this,e)),aT,{writable:!0,value:void 0}),oT(po(o),iT,{writable:!0,value:void 0}),a(po(o),"_value",""),a(po(o),"_inputType","text"),a(po(o),"_autocomplete",""),e&&(e.type&&(o._inputType=e.type),e.placeholder&&(o.placeholder=e.placeholder),e.autocomplete&&(o._autocomplete=e.autocomplete)),o}return o(r,[{key:"value",get:function(){return this._value},set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()}},{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(To(this,aT)).value=hv.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",bo(this,iT,e.id=hv.nextId),bo(this,aT,hv.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=To(this,aT),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="input-group";var r=n.appendChild(document.createElement("input"));r.className="form-control",r.id=To(this,aT),r.type="text",this.placeholder&&(r.placeholder=this.placeholder),this._autocomplete&&(r.autocomplete=this._autocomplete,"off"===this._autocomplete&&(r.name=Gp()));var o=n.appendChild(document.createElement("span"));if(o.className="input-group-btn",navigator.geolocation){var a=o.appendChild(document.createElement("button"));a.id=hv.nextId,a.type="button",a.className="btn btn-outline-secondary btn-sm",a.title="use GPS";var i=a.appendChild(document.createElement("span"));i.className="material-icons",i.innerText="gps_not_fixed",a.addEventListener("click",this.gpsButtonClickHandler.bind(this))}if(this.completion===hv.COMPLETION_COMPULSORY&&(r.required=!0),this.validationMessage){var s=e.appendChild(document.createElement("div"));s.className="invalid-feedback",s.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);r.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(To(this,aT));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got input field change event"),this.value=hv.cleanRawString(document.getElementById(To(this,aT)).value),this.fireEvent(hv.EVENT_CHANGE)}},{key:"gpsButtonClickHandler",value:function(e){var t=this;console.log("got gps button click event"),navigator.geolocation.getCurrentPosition((function(e){var n=e.coords.latitude,r=e.coords.longitude;console.log("Got GPS fix ".concat(n," , ").concat(r));var o=Kb.from_latlng(n,r).to_gridref(1e3);console.log("Got grid-ref: ".concat(o)),t.value=o,t.fireEvent(hv.EVENT_CHANGE)}),(function(e){console.log("gps look-up failed"),console.log(e)}))}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?Qp(n[e].trim()):""}}]),r}();function cT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}var lT=function(e){So(r,Tv);var t=cT(r);function r(e){var o;if(n(this,r),a(po(o=t.call(this)),"_occurrence",void 0),a(po(o),"surveyId",""),(this instanceof r?this.constructor:void 0)===r)throw new TypeError("Cannot construct OccurrenceForm instances directly, class should be overridden.");return e&&(o.model=e),o}return o(r,[{key:"formElement",get:function(){var e=arguments,t=Hc(mo(r.prototype),"formElement",this);return this._formFieldsBuilt||(this.buildFormFields(),t.addEventListener("change",(function(){console.log("occurrence form change event"),console.log(e)}),{capture:!1})),t}},{key:"buildContentContainer",value:function(e){var t=e.appendChild(document.createElement("div"));t.className="card mt-3 ml-0 mr-0 mb-3";var n=t.appendChild(document.createElement("div"));return n.className="card-header",n.textContent=r.sectionTitle,this._formContentContainer=t.appendChild(document.createElement("div")),this._formContentContainer.className="card-body",this._formContentContainer}},{key:"occurrenceId",get:function(){return this._occurrence?this._occurrence.id:null}},{key:"projectId",get:function(){return this._occurrence?this._occurrence.projectId:null}},{key:"initialiseFormFields",value:function(){var e=r.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"updateModelFromContent",value:function(){for(var e in console.log("updating occurrence from OccurrenceForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];this._occurrence.attributes[e]=t.value}console.log({occurrence:this._occurrence})}},{key:"model",get:function(){return this._occurrence},set:function(e){this._occurrence=e,this.populateFormContent()}},{key:"changeHandler",value:function(e){console.log("occurrence form change event"),console.log({event:e}),this.fireEvent(Tv.CHANGE_EVENT,{form:this})}},{key:"pingOccurrence",value:function(){this._occurrence.unsaved()&&this.fireEvent(Tv.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){this._occurrence=null,Hc(mo(r.prototype),"destructor",this).call(this)}},{key:"getFormSectionProperties",value:function(){return r.properties}}]),r}();a(lT,"properties",void 0),a(lT,"sectionTitle","Occurrence form"),a(lT,"help","Records help text, should normally be initialised with an imported html template");var uT=function e(){n(this,e)};function dT(e){return function(e){if(Array.isArray(e))return US(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||jS(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}a(uT,"sectionTitle",void 0),a(uT,"sectionSortOrder",void 0),a(uT,"sectionNavigationKey",void 0),a(uT,"help",""),a(uT,"properties",void 0);function fT(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return hT(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hT(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){s=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(s)throw a}}}}function hT(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pT(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=mo(e);if(t){var o=mo(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return No(this,n)}}function vT(e,t){yT(e,t),t.add(e)}function ST(e,t,n){yT(e,t),t.set(e,n)}function yT(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function NT(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var mT=new WeakMap,gT=new WeakMap,bT=new WeakMap,TT=new WeakSet,ET=new WeakSet,wT=new WeakSet,_T=new WeakSet,CT=new WeakSet,OT=new WeakSet,RT=new WeakSet,IT=new WeakSet,MT=new WeakSet,LT=new WeakSet,xT=new WeakSet,HT=new WeakSet,kT=function(e){So(i,Oy);var r=pT(i);function i(){var e;n(this,i);for(var t=arguments.length,o=new Array(t),s=0;s<t;s++)o[s]=arguments[s];return vT(po(e=r.call.apply(r,[this].concat(o))),HT),vT(po(e),xT),vT(po(e),LT),vT(po(e),MT),vT(po(e),IT),vT(po(e),RT),vT(po(e),OT),vT(po(e),CT),vT(po(e),_T),vT(po(e),wT),vT(po(e),ET),vT(po(e),TT),a(po(e),"controller",void 0),ST(po(e),mT,{writable:!0,value:{}}),ST(po(e),gT,{writable:!0,value:void 0}),ST(po(e),bT,{writable:!0,value:{}}),a(po(e),"panelKey",""),a(po(e),"OCCURRENCES_ARE_LAST_SECTION",!0),a(po(e),"occurrenceSummaryText","Placeholder occurrence summary text in MainView.js"),a(po(e),"welcomeContent","Placeholder welcome text in MainView.js"),a(po(e),"defaultRightHandSideHelp","Default right-hand side help text in MainView.js"),e}return o(i,[{key:"initialise",value:function(){this.controller.app.addListener(By.EVENT_OCCURRENCE_ADDED,this.occurrenceAddedHandler.bind(this))}},{key:"setLayout",value:function(){var e=this;document.getElementById("body").innerHTML='\r\n<div class="container-fluid">\r\n    <div class="row" style="height: 90vh;">\r\n        <div class="col d-md-block pr-md-0 pt-3" id="col1panel" style="overflow-y: auto; max-height: calc(100vh - 5rem);">\r\n        </div>\r\n        <div class="col d-md-none pl-0 pr-0" id="ctrlpanel" style="background-color: aliceblue; width: 28px; max-width: 28px; overflow-y: hidden; ">\r\n            <button class="navbar-light navbar-toggler pl-0 pr-0" type="button" aria-label="Back" id="right-panel-back">\r\n                <i class="material-icons-round" style="color: gray;">view_list</i>\r\n            </button>\r\n        </div>\r\n        <div class="col d-md-block pr-md-0" id="col2panel" style="overflow-y: auto; height: 100%;">\r\n        </div>\r\n    </div>\r\n</div>\r\n',document.getElementById("right-panel-back").addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent(xv.EVENT_BACK)}))}},{key:"refreshLeftPanelAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat(this.leftPanelAccordionId,' div[data-parent="#').concat(this.leftPanelAccordionId,'"].collapse'));e=this.controller.viewSubcontext?"record"===this.controller.viewSubcontext?"record":this.controller.surveySection:"";var n,r=fT(t);try{for(r.s();!(n=r.n()).done;){var o=n.value;o.getAttribute("data-sectionkey")===e?o.classList.add("show"):o.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}this._refreshOccurrenceAccordionState()}},{key:"_refreshOccurrenceAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat("occurrencelistcontainer",' div[data-parent="#').concat("occurrencelistcontainer",'"].collapse')),n=this.controller.currentOccurrenceId,r=fT(t);try{for(r.s();!(e=r.n()).done;){var o=e.value;o.getAttribute("data-occurrenceid")===n?o.classList.add("show"):o.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}}},{key:"display",value:function(){if(this.controller.needsFullRefresh?(console.log("Full refresh triggered."),this.setLayout(),NT(this,CT,UT).call(this)):this.refreshLeftPanelAccordionState(),this.controller.needRightPanelRefresh)switch(this.controller.viewSubcontext){case"record":NT(this,ET,AT).call(this);break;case"survey":NT(this,TT,PT).call(this);break;default:NT(this,wT,DT).call(this)}this.setResponsivePanel(""===this.panelKey?"left":"right")}},{key:"refreshOccurrenceFooterControls",value:function(e){var n=this,r=e.appendChild(document.createElement("div")),o=r.appendChild(document.createElement("button"));if(o.className="btn btn-secondary btn-md-lg mt-2 mb-3 mr-2",o.type="button",o.textContent="back to list",o.setAttribute("data-buttonaction","back"),this.occurrenceIsMostRecent(this.controller.currentOccurrence)){var a=r.appendChild(document.createElement("button"));a.className="btn btn-primary btn-md-lg mt-2 mb-3 mr-2",a.type="button",a.textContent="add another",a.setAttribute("data-buttonaction","new")}if(this.OCCURRENCES_ARE_LAST_SECTION){var i=r.appendChild(document.createElement("button"));i.className="btn btn-primary btn-md-lg mt-2 mb-3",i.type="button",i.textContent="finish",i.setAttribute("data-buttonaction","finish")}else{var s=Ly.sections[1],c=r.appendChild(document.createElement("button"));c.className="btn btn-primary btn-md-lg mt-2 mb-3",c.type="button",c.textContent="next Â»",c.setAttribute("data-buttonaction","next"),c.title=s.sectionTitle}r.addEventListener("click",(function(e){var r=e.target.closest("button");if(r&&r.hasAttribute("data-buttonaction"))switch(r.getAttribute("data-buttonaction")){case"new":n.fireEvent(xv.EVENT_NEW_RECORD);break;case"back":n.controller.app.router.navigate("/list/record/");break;case"finish":n.controller.app.router.navigate("/list/record/"),t("#".concat("finishmodal")).modal();break;case"next":n.controller.app.router.navigate("/list/survey/".concat(nextSection.sectionNavigationKey));break;default:throw new Error("Unrecognised button action ".concat(r.getAttribute("data-buttonaction")))}}))}},{key:"occurrenceIsMostRecent",value:function(e){var t,n=fT(this.controller.occurrences.entries());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r[1].createdStamp>e.createdStamp&&!r[1].deleted)return!1}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"newButtonClickHandler",value:function(e){e.preventDefault(),e.stopPropagation(),this.fireEvent(xv.EVENT_NEW_RECORD)}},{key:"occurrenceAddedHandler",value:function(e){var t=document.getElementById("occurrencelistcontainer");if(t){var n=this.controller.occurrences.get(e.occurrenceId),r=document.createElement("div");r.className="card",r.id="card_".concat(n.id),r.innerHTML=NT(this,HT,VT).call(this,n),To(this,bT)[n.id]=n.addListener(Cv.EVENT_MODIFIED,this.occurrenceChangeHandler.bind(this),{occurrenceId:n.id}),t.insertBefore(r,t.firstChild)}}},{key:"refreshOccurrenceValiditySummary",value:function(e){var t=document.getElementById("card_".concat(e.id));t&&(e.evaluateCompletionStatus(lT.properties).requiredFieldsPresent?t.classList.remove("is-invalid"):t.classList.add("is-invalid"))}},{key:"occurrenceChangeHandler",value:function(e){var t=this.controller.occurrences.get(e.occurrenceId),n=document.getElementById("card_".concat(e.occurrenceId));n&&(t.deleted?(n.parentElement.removeChild(n),To(this,bT)[e.occurrenceId]&&(t.removeListener(Cv.EVENT_MODIFIED,To(this,bT)[e.occurrenceId]),To(this,bT)[e.occurrenceId]=null)):(n.innerHTML=NT(this,HT,VT).call(this,t),this.refreshOccurrenceValiditySummary(t)))}},{key:"occurrenceSummaryBodyHTML",value:function(e){var t="";for(var n in e.attributes)if(e.attributes.hasOwnProperty(n)&&lT.properties.hasOwnProperty(n)&&!lT.properties[n].field.isEmpty(e.attributes[n])){var r=lT.properties[n].field.summarise(n,lT.properties[n],e.attributes);r&&(t+='<p class="ellipsed-line mb-0">'.concat(r,"</p>"))}return By.devMode&&(t+='<p class="mb-0">(<i>id '.concat(e.id,"</i>)</p>")),t}},{key:"occurrenceSummaryHeadingHTML",value:function(e){var t="";if(e.attributes.hasOwnProperty("images")&&e.attributes.images.length){var n=e.attributes.images[0];t+=Py.imageLink(n,48,48,{className:"mr-1"})}return e.attributes.taxon&&e.attributes.taxon.taxonId?t+=e.taxon.formattedHTML(e.attributes.taxon.vernacularMatch):e.attributes.taxon&&e.attributes.taxon.taxonName?t+=Qp(e.attributes.taxon.taxonName):t+="<span>(unnamed plant)</span>",t}},{key:"setResponsivePanel",value:function(e){var t=document.getElementById("col2panel"),n=document.getElementById("col1panel"),r=document.getElementById("ctrlpanel");switch(e){case"left":n.classList.remove("d-none"),n.classList.add("d-block"),t.classList.remove("d-block"),t.classList.add("d-none"),r.classList.remove("d-md-none"),r.classList.add("d-none");break;case"right":n.classList.remove("d-block"),n.classList.add("d-none"),t.classList.remove("d-none"),t.classList.add("d-block"),r.classList.remove("d-none"),r.classList.add("d-md-none");break;default:throw new Error("Unrecognised panel value '".concat(e))}}}]),i}();function PT(){var e=document.getElementById("col2panel"),t=this.controller.surveySection,n=Ly.sectionsByKey[t]?Ly.sectionsByKey[t].help:"";e.innerHTML=n||("welcome"===t?this.defaultRightHandSideHelp:"<p>placeholder survey help content for '".concat(t,"'</p>"))}function AT(){try{var e=this.controller.currentOccurrence,n=document.getElementById("col2panel");if(e){To(this,gT)&&To(this,gT).occurrenceId===e.id||(To(this,gT)&&To(this,gT).destructor(),bo(this,gT,e.setForm(new lT(e))),To(this,gT).surveyId=this.controller.app.currentSurvey.id,n.scrollTop=0),n.innerHTML="";var r=To(this,gT).formElement;n.appendChild(r),To(this,gT).populateFormContent(),this.refreshOccurrenceFooterControls(n),t("#description_".concat(e.id)).collapse("show")}else NT(this,wT,DT).call(this,lT.help)}catch(e){console.log({error:e});var o=document.getElementById("col2panel");o?o.innerHTML="<p>".concat(e.message,"</p>"):document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}}function DT(e){document.getElementById("col2panel").innerHTML=e||this.defaultRightHandSideHelp}function FT(){for(var e in To(this,bT)){var t=this.controller.occurrences.get[e];t&&t.removeListener(Cv.EVENT_MODIFIED,To(this,bT)[e])}bo(this,bT,{})}function UT(){var e=this,t=document.getElementById("col1panel").appendChild(document.createElement("div"));t.className="accordion",this.leftPanelAccordionId=t.id=Tv.nextId,NT(this,IT,BT).call(this),NT(this,MT,YT).call(this,0,t,kT.NEXT_RECORDS),NT(this,LT,GT).call(this),NT(this,xT,KT).call(this),t.addEventListener("click",(function(t){var n=t.target.closest("a");n&&n.hasAttribute("data-help-link")&&(t.preventDefault(),t.stopPropagation(),e.controller.app.router.navigate(n.getAttribute("data-help-link")))})),NT(this,RT,JT).call(this),NT(this,OT,jT).call(this)}function jT(){var e=this,n=document.body,r='<div class="modal fade" id="'.concat("deleteoccurrencemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("deleteoccurrencemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("deleteoccurrencemodal",'Title">Delete record?</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        Please confirm that you wish to delete the record.\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\n        <button type="button" class="btn btn-danger" data-dismiss="modal" id="').concat("deleteoccurrencemodal",'confirmed">Delete record</button>\n      </div>\n    </div>\n  </div>\n</div>'),o=document.createElement("div");o.innerHTML=r,n.appendChild(o.firstChild),t("#".concat("deleteoccurrencemodal")).on("show.bs.modal",(function(e){var n=t(e.relatedTarget);if(n&&n.data("occurrenceid")){var r=n.data("occurrenceid");document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",r)}})),document.getElementById("".concat("deleteoccurrencemodal","confirmed")).addEventListener("click",(function(t){var n=t.target.closest("button");if(n&&n.hasAttribute("data-occurrenceid")){var r=n.getAttribute("data-occurrenceid");console.log("Deleting occurrence ".concat(r,".")),e.fireEvent(xv.EVENT_DELETE_OCCURRENCE,{occurrenceId:r})}}));var a=document.createElement("div");a.innerHTML='<div class="modal fade" id="'.concat("finishmodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("finishmodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("finishmodal",'Title">Thank you</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>Thank you! Your form responses have been sent. If you wish, you can continue to make changes and edit or add further records.</p>\n        <p>If you provided an email address, then we will send you a message with a link to this form, so that you can return to it later if needed.</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),n.appendChild(a.firstChild),n.appendChild(_g.licenseModal());var i=document.createElement("div");i.innerHTML='<div class="modal fade" id="'.concat("imagemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("imagemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header d-none d-md-flex">\n        <h5 class="modal-title" id="').concat("imagemodal",'Title">Photo</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body" style="position: relative;">\n        <picture>\n        </picture>\n      </div>\n      <div class="modal-footer">\n        <button type="button" id="').concat("imagemodaldelete",'" class="btn btn-outline-danger delete-occurrence-button mr-3" data-toggle="modal" data-target="#').concat("deleteimagemodal",'" data-imageid=""><i class="material-icons">delete</i></button>\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),n.appendChild(i.firstChild),document.getElementById("imagemodaldelete").addEventListener("click",(function(n){var r=n.target.closest("button");if(r&&r.hasAttribute("data-imageid")){var o=r.getAttribute("data-imageid");To(e,gT).fireEvent("deleteimage",{imageId:o}),t("#".concat("imagemodal")).modal("hide")}}))}function JT(){var e=this;t("#".concat("col1panel")).on("show.bs.collapse",(function(t){t.target.dataset.occurrenceid?(console.log({"left panel accordion show event (with occ id)":t}),e.fireEvent(xv.EVENT_SELECT_OCCURRENCE,{occurrenceId:t.target.dataset.occurrenceid})):t.target.dataset.sectionkey?(console.log({"left panel accordion show event (with section key)":t}),e.fireEvent(xv.EVENT_SELECT_SURVEY_SECTION,{sectionKey:t.target.dataset.sectionkey})):console.log({"left panel accordion show event (other)":t})})).on("hidden.bs.collapse",(function(t){if(console.log({"left panel accordion hide event":t}),t.target.dataset.occurrenceid){var n=e.controller.occurrences.get(t.target.dataset.occurrenceid);n.isNew&&!n.isPristine&&(n.isNew=!1,e.refreshOccurrenceValiditySummary(n)),e.controller.currentOccurrenceId===t.target.dataset.occurrenceid&&e.fireEvent(xv.EVENT_SELECT_OCCURRENCE,{occurrenceId:""})}else if(t.target.dataset.sectionkey)if("record"===t.target.dataset.sectionkey)"record"===e.controller.viewSubcontext&&e.fireEvent(xv.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""});else if(To(e,mT)[t.target.dataset.sectionkey]){var r=To(e,mT)[t.target.dataset.sectionkey].validateForm();console.log({"survey section validity":r}),e.controller.surveySection===t.target.dataset.sectionkey&&e.fireEvent(xv.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""})}}))}function BT(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createElement("button");t.className="btn btn-primary",t.type="button",t.textContent="get started Â»",t.setAttribute("data-toggle","collapse"),t.setAttribute("data-target","#survey-0-about");var n=Tv.nextId,r=document.createElement("div");r.innerHTML=this.welcomeContent,r.appendChild(t);var o=document.createElement("span");o.className="d-md-none pl-2",o.innerHTML='(<a href="/app/list/survey/welcome/help" data-navigo="list/survey/welcome/help">more info</a>)',r.appendChild(o),e.appendChild(this.card({cardId:n,cardHeadingId:Tv.nextId,collapsed:"welcome"!==this.controller.surveySection,headingButtonId:Tv.nextId,headingHTML:'<img src="/img/BSBIlong.png" alt="" style="float:right; max-width: 40%; max-height: 48px;"><div style="float: left;">Welcome</div>',buttonStyleString:"width: 100%",headingNonbuttonHTML:"",headingValidationWarningHTML:"",cardDescriptionId:"survey-welcome",parentContainerId:e.id,bodyContentElement:r,dataAttributes:{sectionkey:"welcome"}}))}function YT(e,n,r){var o=this,a=Ly.sections[e],i=new Ly(a);To(this,mT)[a.sectionNavigationKey]=i;var s=i.formElement,c=document.createElement("button");switch(c.className="btn btn-primary",c.type="button",c.textContent="next Â»",r){case kT.NEXT_RECORDS:c.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),o.fireEvent(xv.EVENT_NEXT_TO_RECORDS)}));break;case kT.NEXT_SURVEY_SECTION:var l=Ly.sections[e+1];c.setAttribute("data-toggle","collapse"),c.setAttribute("data-target","#survey-".concat(e+1,"-").concat(l.sectionNavigationKey)),c.title=l.sectionTitle;break;case kT.NEXT_IS_FINAL:c.textContent="finish",c.className="btn btn-primary btn-md-lg mt-2 mb-3",c.type="button",c.addEventListener("click",(function(){o.controller.app.router.navigate("/list/"),t("#".concat("finishmodal")).modal()}));break;default:throw new Error("Unrecognized next section keyword '".concat(r,"'"))}s.appendChild(c);var u=Tv.nextId;n.appendChild(this.card({cardId:u,cardHeadingId:Tv.nextId,collapsed:this.controller.surveySection!==a.sectionNavigationKey,headingButtonId:Tv.nextId,headingHTML:a.sectionTitle,headingNonbuttonHTML:'<small class="btn d-md-none" style="margin: 0; padding: 0;">(<a href="/app/list/survey/'.concat(a.sectionNavigationKey,'/help" data-help-link="/list/survey/').concat(a.sectionNavigationKey,'/help">help</a>)</small>'),headingValidationWarningHTML:"Please check the form for some missing responses.",cardDescriptionId:"survey-".concat(e,"-").concat(a.sectionNavigationKey),parentContainerId:n.id,bodyContentElement:s,dataAttributes:{sectionkey:a.sectionNavigationKey}})),this.controller.survey.registerForm(i),i.addListener(Ly.EVENT_VALIDATION_STATE_CHANGE,(function(e){var t=document.getElementById(u);e.isValid?t.classList.remove("is-invalid"):t.classList.add("is-invalid")}))}function GT(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createDocumentFragment();t.appendChild(document.createElement("p")).innerHTML="".concat(this.occurrenceSummaryText,'<small class="d-block d-md-none"><a href="/app/list/record/help">(help)</a></small>');var n=t.appendChild(document.createElement("button"));n.type="button",n.className="btn btn-primary btn-lg mb-2",n.innerText="Add a plant record.",n.addEventListener("click",this.newButtonClickHandler.bind(this)),t.appendChild(document.createElement("div")).id="occurrencelistcontainer",e.appendChild(this.card({cardId:Tv.nextId,cardHeadingId:Tv.nextId,collapsed:"record"!==this.controller.viewSubcontext,headingButtonId:Tv.nextId,headingHTML:"Your plant records",cardDescriptionId:Tv.nextId,parentContainerId:e.id,bodyContentElement:t,dataAttributes:{sectionkey:"record"}}))}function KT(){var e=document.getElementById("occurrencelistcontainer");if(!e)throw new Rv("Failed to find list container.");NT(this,_T,FT).call(this);var n,r=[],o=fT(dT(this.controller.occurrences.entries()).sort((function(e,t){return t[1].createdStamp-e[1].createdStamp})));try{for(o.s();!(n=o.n()).done;){var a=n.value[1];if(console.log("displaying '".concat(a.id,"'")),!a.deleted){var i=a.isNew||a.evaluateCompletionStatus(lT.properties).requiredFieldsPresent;r.push('<div class="card'.concat(i?"":" is-invalid",'" id="card_').concat(a.id,'">\n    ').concat(NT(this,HT,VT).call(this,a),"\n</div>")),To(this,bT)[a.id]=a.addListener(Cv.EVENT_MODIFIED,this.occurrenceChangeHandler.bind(this),{occurrenceId:a.id})}}}catch(e){o.e(e)}finally{o.f()}e.className="accordion",e.innerHTML=r.join(""),e.addEventListener("click",(function(e){var n=e.target.closest("button");n&&n.hasAttribute("data-toggle")&&"modal"===n.getAttribute("data-toggle")&&(document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",n.getAttribute("data-occurrenceid")),t(n.getAttribute("data-target")).modal(),e.preventDefault(),e.stopPropagation())}))}function VT(e){return'<div class="card-header pointer pl-2 pr-2 pt-2 pb-2" id="heading_'.concat(e.id,'" data-toggle="collapse" data-target="#description_').concat(e.id,'">\n    <div class="float-right">\n        <button type="button" class="btn btn-outline-danger delete-occurrence-button" data-toggle="modal" data-target="#').concat("deleteoccurrencemodal",'" data-occurrenceid="').concat(e.id,'"><i class="material-icons">delete</i></button>\n    </div>\n    <h2 class="mb-0 pb-0 mt-0 pt-0 pl-0 ml-0">\n        <button class="btn btn-link').concat(this.controller.currentOccurrenceId===e.id?"":" collapsed",' pt-0 pb-0 pl-0" id="headingbutton_').concat(e.id,'" type="button" data-toggle="collapse" data-target="#description_').concat(e.id,'" aria-expanded="').concat(this.controller.currentOccurrenceId===e.id?"true":"false",'" aria-controls="description_').concat(e.id,'">\n          ').concat(this.occurrenceSummaryHeadingHTML(e),'\n        </button>\n    </h2>\n    <div class="card-invalid-feedback">\n        <small>Please check for errors or missing details.</small>\n    </div>\n</div>\n<div id="description_').concat(e.id,'" class="collapse').concat(this.controller.currentOccurrenceId===e.id?" show":"",'" aria-labelledby="heading_').concat(e.id,'" data-parent="#').concat("occurrencelistcontainer",'" data-occurrenceid="').concat(e.id,'">\n  <div class="card-body">\n    ').concat(this.occurrenceSummaryBodyHTML(e),"\n  </div>\n</div>")}a(kT,"NEXT_RECORDS","records"),a(kT,"NEXT_SURVEY_SECTION","survey"),a(kT,"NEXT_IS_FINAL","last");export{By as App,l as AppController,MN as BSBIServiceWorker,fg as DateField,jp as EventHarness,Tv as Form,hv as FormField,_g as ImageField,xg as InputField,Rv as InternalAppError,Vy as Layout,xv as MainController,kT as MainView,Vp as Model,xc as NotFoundError,Cv as Occurrence,lT as OccurrenceForm,Py as OccurrenceImage,Gg as OptionsField,Oy as Page,GN as PatchedNavigo,ob as SelectField,kv as StaticContentController,Hy as Survey,Ly as SurveyForm,uT as SurveyFormSection,qy as SurveyPickerController,sg as TaxaLoadedHook,Wp as Taxon,qp as TaxonError,Mb as TaxonPickerField,ig as TaxonSearch,Ab as TextAreaField,sT as TextGeorefField};
//# sourceMappingURL=bsbiappframework.js.map
