import e from"BsbiDb";import t from"jquery";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function a(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,n){return(h=d()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&u(a,n.prototype),a}).apply(null,arguments)}function f(e){var t="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,l(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,e)})(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?v(e):t}function p(e){return function(){var t,n=l(e);if(d()){var r=l(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return S(this,t)}}function N(e,t,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=l(e)););return e}(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(n):a.value}})(e,t,n||e)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,o=void 0;try{for(var i,s=e[Symbol.iterator]();!(r=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return n}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=g(e))){var t=0,n=function(){};return{s:n,n:function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a,o=!0,i=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){i=!0,a=e},f:function(){try{o||null==r.return||r.return()}finally{if(i)throw a}}}}function E(e,t){var n=t.get(e);if(!n)throw new TypeError("attempted to get private field on non-instance");return n.get?n.get.call(e):n.value}function _(e,t,n){var r=t.get(e);if(!r)throw new TypeError("attempted to set private field on non-instance");if(r.set)r.set.call(e,n);else{if(!r.writable)throw new TypeError("attempted to set read only private field");r.value=n}return n}function w(e,t,n){if(e!==t)throw new TypeError("Private static access of wrong provenance");return n.get?n.get.call(e):n.value}function C(e,t,n,r){if(e!==t)throw new TypeError("Private static access of wrong provenance");if(n.set)n.set.call(e,r);else{if(!n.writable)throw new TypeError("attempted to set read only private field");n.value=r}return r}function O(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}var L=function(){function e(){n(this,e),o(this,"route",null),o(this,"view",void 0),o(this,"title","untitled"),o(this,"handle",void 0),o(this,"app",void 0)}return a(e,[{key:"initialise",value:function(){this.view.initialise()}},{key:"registerRoute",value:function(e){if(null===this.route)throw new Error("No route set for '".concat(this.title,"' controller."));console.log({route:this.route}),e.on(this.route,this.routeHandler.bind(this),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null})}},{key:"routeHandler",value:function(e,t){}}],[{key:"nextHandle",get:function(){var t;return C(e,e,I,1+(t=+w(e,e,I))),t}}]),e}(),I={writable:!0,value:0},M=function(e){try{return!!e()}catch(e){return!0}},H={}.toString,R=function(e){return H.call(e).slice(8,-1)},x="".split,k=M((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==R(e)?x.call(e,""):Object(e)}:Object,P=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},A=function(e){return k(P(e))},D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function F(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}function U(e,t){return e(t={exports:{}},t.exports),t.exports}var J,Y=function(e){return e&&e.Math==Math&&e},j=Y("object"==typeof globalThis&&globalThis)||Y("object"==typeof window&&window)||Y("object"==typeof self&&self)||Y("object"==typeof D&&D)||Function("return this")(),K=!M((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),V=function(e){return"object"==typeof e?null!==e:"function"==typeof e},X=j.document,G=V(X)&&V(X.createElement),B=function(e){return G?X.createElement(e):{}},Q=!K&&!M((function(){return 7!=Object.defineProperty(B("div"),"a",{get:function(){return 7}}).a})),W=function(e){if(!V(e))throw TypeError(String(e)+" is not an object");return e},q=function(e,t){if(!V(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!V(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!V(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!V(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},Z=Object.defineProperty,z={f:K?Z:function(e,t,n){if(W(e),t=q(t,!0),W(n),Q)try{return Z(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},ee=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},te=K?function(e,t,n){return z.f(e,t,ee(1,n))}:function(e,t,n){return e[t]=n,e},ne=function(e,t){try{te(j,e,t)}catch(n){j[e]=t}return t},re=j["__core-js_shared__"]||ne("__core-js_shared__",{}),ae=U((function(e){(e.exports=function(e,t){return re[e]||(re[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.4",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),oe={}.hasOwnProperty,ie=function(e,t){return oe.call(e,t)},se=0,ce=Math.random(),le=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++se+ce).toString(36)},ue=!!Object.getOwnPropertySymbols&&!M((function(){return!String(Symbol())})),de=ue&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,he=ae("wks"),fe=j.Symbol,ve=de?fe:fe&&fe.withoutSetter||le,Se=function(e){return ie(he,e)||(ue&&ie(fe,e)?he[e]=fe[e]:he[e]=ve("Symbol."+e)),he[e]},pe=Math.ceil,Ne=Math.floor,me=function(e){return isNaN(e=+e)?0:(e>0?Ne:pe)(e)},ye=Math.min,ge=function(e){return e>0?ye(me(e),9007199254740991):0},Te=Math.max,be=Math.min,Ee=function(e,t){var n=me(e);return n<0?Te(n+t,0):be(n,t)},_e=function(e){return function(t,n,r){var a,o=A(t),i=ge(o.length),s=Ee(r,i);if(e&&n!=n){for(;i>s;)if((a=o[s++])!=a)return!0}else for(;i>s;s++)if((e||s in o)&&o[s]===n)return e||s||0;return!e&&-1}},we={includes:_e(!0),indexOf:_e(!1)},Ce={},Oe=we.indexOf,Le=function(e,t){var n,r=A(e),a=0,o=[];for(n in r)!ie(Ce,n)&&ie(r,n)&&o.push(n);for(;t.length>a;)ie(r,n=t[a++])&&(~Oe(o,n)||o.push(n));return o},Ie=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Me=Object.keys||function(e){return Le(e,Ie)},He=K?Object.defineProperties:function(e,t){W(e);for(var n,r=Me(t),a=r.length,o=0;a>o;)z.f(e,n=r[o++],t[n]);return e},Re=j,xe=function(e){return"function"==typeof e?e:void 0},ke=function(e,t){return arguments.length<2?xe(Re[e])||xe(j[e]):Re[e]&&Re[e][t]||j[e]&&j[e][t]},Pe=ke("document","documentElement"),Ae=ae("keys"),De=function(e){return Ae[e]||(Ae[e]=le(e))},Fe=De("IE_PROTO"),Ue=function(){},Je=function(e){return"<script>"+e+"<\/script>"},Ye=function(){try{J=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;Ye=J?function(e){e.write(Je("")),e.close();var t=e.parentWindow.Object;return e=null,t}(J):((t=B("iframe")).style.display="none",Pe.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Je("document.F=Object")),e.close(),e.F);for(var n=Ie.length;n--;)delete Ye.prototype[Ie[n]];return Ye()};Ce[Fe]=!0;var je=Object.create||function(e,t){var n;return null!==e?(Ue.prototype=W(e),n=new Ue,Ue.prototype=null,n[Fe]=e):n=Ye(),void 0===t?n:He(n,t)},Ke=Se("unscopables"),Ve=Array.prototype;null==Ve[Ke]&&z.f(Ve,Ke,{configurable:!0,value:je(null)});var Xe=function(e){Ve[Ke][e]=!0},Ge={},Be=Function.toString;"function"!=typeof re.inspectSource&&(re.inspectSource=function(e){return Be.call(e)});var Qe,We,qe,Ze=re.inspectSource,$e=j.WeakMap,ze="function"==typeof $e&&/native code/.test(Ze($e)),et=j.WeakMap;if(ze){var tt=new et,nt=tt.get,rt=tt.has,at=tt.set;Qe=function(e,t){return at.call(tt,e,t),t},We=function(e){return nt.call(tt,e)||{}},qe=function(e){return rt.call(tt,e)}}else{var ot=De("state");Ce[ot]=!0,Qe=function(e,t){return te(e,ot,t),t},We=function(e){return ie(e,ot)?e[ot]:{}},qe=function(e){return ie(e,ot)}}var it,st,ct,lt={set:Qe,get:We,has:qe,enforce:function(e){return qe(e)?We(e):Qe(e,{})},getterFor:function(e){return function(t){var n;if(!V(t)||(n=We(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},ut={}.propertyIsEnumerable,dt=Object.getOwnPropertyDescriptor,ht={f:dt&&!ut.call({1:2},1)?function(e){var t=dt(this,e);return!!t&&t.enumerable}:ut},ft=Object.getOwnPropertyDescriptor,vt={f:K?ft:function(e,t){if(e=A(e),t=q(t,!0),Q)try{return ft(e,t)}catch(e){}if(ie(e,t))return ee(!ht.f.call(e,t),e[t])}},St=U((function(e){var t=lt.get,n=lt.enforce,r=String(String).split("String");(e.exports=function(e,t,a,o){var i=!!o&&!!o.unsafe,s=!!o&&!!o.enumerable,c=!!o&&!!o.noTargetGet;"function"==typeof a&&("string"!=typeof t||ie(a,"name")||te(a,"name",t),n(a).source=r.join("string"==typeof t?t:"")),e!==j?(i?!c&&e[t]&&(s=!0):delete e[t],s?e[t]=a:te(e,t,a)):s?e[t]=a:ne(t,a)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||Ze(this)}))})),pt=Ie.concat("length","prototype"),Nt={f:Object.getOwnPropertyNames||function(e){return Le(e,pt)}},mt={f:Object.getOwnPropertySymbols},yt=ke("Reflect","ownKeys")||function(e){var t=Nt.f(W(e)),n=mt.f;return n?t.concat(n(e)):t},gt=function(e,t){for(var n=yt(t),r=z.f,a=vt.f,o=0;o<n.length;o++){var i=n[o];ie(e,i)||r(e,i,a(t,i))}},Tt=/#|\.prototype\./,bt=function(e,t){var n=_t[Et(e)];return n==Ct||n!=wt&&("function"==typeof t?M(t):!!t)},Et=bt.normalize=function(e){return String(e).replace(Tt,".").toLowerCase()},_t=bt.data={},wt=bt.NATIVE="N",Ct=bt.POLYFILL="P",Ot=bt,Lt=vt.f,It=function(e,t){var n,r,a,o,i,s=e.target,c=e.global,l=e.stat;if(n=c?j:l?j[s]||ne(s,{}):(j[s]||{}).prototype)for(r in t){if(o=t[r],a=e.noTargetGet?(i=Lt(n,r))&&i.value:n[r],!Ot(c?r:s+(l?".":"#")+r,e.forced)&&void 0!==a){if(typeof o==typeof a)continue;gt(o,a)}(e.sham||a&&a.sham)&&te(o,"sham",!0),St(n,r,o,e)}},Mt=function(e){return Object(P(e))},Ht=!M((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Rt=De("IE_PROTO"),xt=Object.prototype,kt=Ht?Object.getPrototypeOf:function(e){return e=Mt(e),ie(e,Rt)?e[Rt]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?xt:null},Pt=Se("iterator"),At=!1;[].keys&&("next"in(ct=[].keys())?(st=kt(kt(ct)))!==Object.prototype&&(it=st):At=!0),null==it&&(it={}),ie(it,Pt)||te(it,Pt,(function(){return this}));var Dt={IteratorPrototype:it,BUGGY_SAFARI_ITERATORS:At},Ft=z.f,Ut=Se("toStringTag"),Jt=function(e,t,n){e&&!ie(e=n?e:e.prototype,Ut)&&Ft(e,Ut,{configurable:!0,value:t})},Yt=Dt.IteratorPrototype,jt=function(){return this},Kt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return W(n),function(e){if(!V(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),Vt=Dt.IteratorPrototype,Xt=Dt.BUGGY_SAFARI_ITERATORS,Gt=Se("iterator"),Bt=function(){return this},Qt=function(e,t,n,r,a,o,i){!function(e,t,n){var r=t+" Iterator";e.prototype=je(Yt,{next:ee(1,n)}),Jt(e,r,!1),Ge[r]=jt}(n,t,r);var s,c,l,u=function(e){if(e===a&&S)return S;if(!Xt&&e in f)return f[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,f=e.prototype,v=f[Gt]||f["@@iterator"]||a&&f[a],S=!Xt&&v||u(a),p="Array"==t&&f.entries||v;if(p&&(s=kt(p.call(new e)),Vt!==Object.prototype&&s.next&&(kt(s)!==Vt&&(Kt?Kt(s,Vt):"function"!=typeof s[Gt]&&te(s,Gt,Bt)),Jt(s,d,!0))),"values"==a&&v&&"values"!==v.name&&(h=!0,S=function(){return v.call(this)}),f[Gt]!==S&&te(f,Gt,S),Ge[t]=S,a)if(c={values:u("values"),keys:o?S:u("keys"),entries:u("entries")},i)for(l in c)(Xt||h||!(l in f))&&St(f,l,c[l]);else It({target:t,proto:!0,forced:Xt||h},c);return c},Wt=lt.set,qt=lt.getterFor("Array Iterator"),Zt=Qt(Array,"Array",(function(e,t){Wt(this,{type:"Array Iterator",target:A(e),index:0,kind:t})}),(function(){var e=qt(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");Ge.Arguments=Ge.Array,Xe("keys"),Xe("values"),Xe("entries");var $t={};$t[Se("toStringTag")]="z";var zt="[object z]"===String($t),en=Se("toStringTag"),tn="Arguments"==R(function(){return arguments}()),nn=zt?R:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),en))?n:tn?R(t):"Object"==(r=R(t))&&"function"==typeof t.callee?"Arguments":r},rn=zt?{}.toString:function(){return"[object "+nn(this)+"]"};zt||St(Object.prototype,"toString",rn,{unsafe:!0});var an=function(e){return function(t,n){var r,a,o=String(P(t)),i=me(n),s=o.length;return i<0||i>=s?e?"":void 0:(r=o.charCodeAt(i))<55296||r>56319||i+1===s||(a=o.charCodeAt(i+1))<56320||a>57343?e?o.charAt(i):r:e?o.slice(i,i+2):a-56320+(r-55296<<10)+65536}},on={codeAt:an(!1),charAt:an(!0)},sn=on.charAt,cn=lt.set,ln=lt.getterFor("String Iterator");Qt(String,"String",(function(e){cn(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e,t=ln(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=sn(n,r),t.index+=e.length,{value:e,done:!1})}));var un=function(e,t,n){for(var r in t)St(e,r,t[r],n);return e},dn=!M((function(){return Object.isExtensible(Object.preventExtensions({}))})),hn=U((function(e){var t=z.f,n=le("meta"),r=0,a=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},i=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!V(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!ie(e,n)){if(!a(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!ie(e,n)){if(!a(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return dn&&i.REQUIRED&&a(e)&&!ie(e,n)&&o(e),e}};Ce[n]=!0})),fn=(hn.REQUIRED,hn.fastKey,hn.getWeakData,hn.onFreeze,Se("iterator")),vn=Array.prototype,Sn=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},pn=function(e,t,n){if(Sn(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,a){return e.call(t,n,r,a)}}return function(){return e.apply(t,arguments)}},Nn=Se("iterator"),mn=function(e,t,n,r){try{return r?t(W(n)[0],n[1]):t(n)}catch(t){var a=e.return;throw void 0!==a&&W(a.call(e)),t}},yn=U((function(e){var t=function(e,t){this.stopped=e,this.result=t};(e.exports=function(e,n,r,a,o){var i,s,c,l,u,d,h,f,v=pn(n,r,a?2:1);if(o)i=e;else{if("function"!=typeof(s=function(e){if(null!=e)return e[Nn]||e["@@iterator"]||Ge[nn(e)]}(e)))throw TypeError("Target is not iterable");if(void 0!==(f=s)&&(Ge.Array===f||vn[fn]===f)){for(c=0,l=ge(e.length);l>c;c++)if((u=a?v(W(h=e[c])[0],h[1]):v(e[c]))&&u instanceof t)return u;return new t(!1)}i=s.call(e)}for(d=i.next;!(h=d.call(i)).done;)if("object"==typeof(u=mn(i,v,h.value,a))&&u&&u instanceof t)return u;return new t(!1)}).stop=function(e){return new t(!0,e)}})),gn=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},Tn=Se("iterator"),bn=!1;try{var En=0,_n={next:function(){return{done:!!En++}},return:function(){bn=!0}};_n[Tn]=function(){return this},Array.from(_n,(function(){throw 2}))}catch(e){}var wn=function(e,t){if(!t&&!bn)return!1;var n=!1;try{var r={};r[Tn]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},Cn=function(e,t,n){var r,a;return Kt&&"function"==typeof(r=t.constructor)&&r!==n&&V(a=r.prototype)&&a!==n.prototype&&Kt(e,a),e},On=function(e,t,n){var r=-1!==e.indexOf("Map"),a=-1!==e.indexOf("Weak"),o=r?"set":"add",i=j[e],s=i&&i.prototype,c=i,l={},u=function(e){var t=s[e];St(s,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(a&&!V(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return a&&!V(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(a&&!V(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Ot(e,"function"!=typeof i||!(a||s.forEach&&!M((function(){(new i).entries().next()})))))c=n.getConstructor(t,e,r,o),hn.REQUIRED=!0;else if(Ot(e,!0)){var d=new c,h=d[o](a?{}:-0,1)!=d,f=M((function(){d.has(1)})),v=wn((function(e){new i(e)})),S=!a&&M((function(){for(var e=new i,t=5;t--;)e[o](t,t);return!e.has(-0)}));v||((c=t((function(t,n){gn(t,c,e);var a=Cn(new i,t,c);return null!=n&&yn(n,a[o],a,r),a}))).prototype=s,s.constructor=c),(f||S)&&(u("delete"),u("has"),r&&u("get")),(S||h)&&u(o),a&&s.clear&&delete s.clear}return l[e]=c,It({global:!0,forced:c!=i},l),Jt(c,e),a||n.setStrong(c,e,r),c},Ln=Array.isArray||function(e){return"Array"==R(e)},In=Se("species"),Mn=function(e,t){var n;return Ln(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Ln(n.prototype)?V(n)&&null===(n=n[In])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},Hn=[].push,Rn=function(e){var t=1==e,n=2==e,r=3==e,a=4==e,o=6==e,i=5==e||o;return function(s,c,l,u){for(var d,h,f=Mt(s),v=k(f),S=pn(c,l,3),p=ge(v.length),N=0,m=u||Mn,y=t?m(s,p):n?m(s,0):void 0;p>N;N++)if((i||N in v)&&(h=S(d=v[N],N,f),e))if(t)y[N]=h;else if(h)switch(e){case 3:return!0;case 5:return d;case 6:return N;case 2:Hn.call(y,d)}else if(a)return!1;return o?-1:r||a?a:y}},xn={forEach:Rn(0),map:Rn(1),filter:Rn(2),some:Rn(3),every:Rn(4),find:Rn(5),findIndex:Rn(6)},kn=hn.getWeakData,Pn=lt.set,An=lt.getterFor,Dn=xn.find,Fn=xn.findIndex,Un=0,Jn=function(e){return e.frozen||(e.frozen=new Yn)},Yn=function(){this.entries=[]},jn=function(e,t){return Dn(e.entries,(function(e){return e[0]===t}))};Yn.prototype={get:function(e){var t=jn(this,e);if(t)return t[1]},has:function(e){return!!jn(this,e)},set:function(e,t){var n=jn(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=Fn(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}};var Kn={getConstructor:function(e,t,n,r){var a=e((function(e,o){gn(e,a,t),Pn(e,{type:t,id:Un++,frozen:void 0}),null!=o&&yn(o,e[r],e,n)})),o=An(t),i=function(e,t,n){var r=o(e),a=kn(W(t),!0);return!0===a?Jn(r).set(t,n):a[r.id]=n,e};return un(a.prototype,{delete:function(e){var t=o(this);if(!V(e))return!1;var n=kn(e);return!0===n?Jn(t).delete(e):n&&ie(n,t.id)&&delete n[t.id]},has:function(e){var t=o(this);if(!V(e))return!1;var n=kn(e);return!0===n?Jn(t).has(e):n&&ie(n,t.id)}}),un(a.prototype,n?{get:function(e){var t=o(this);if(V(e)){var n=kn(e);return!0===n?Jn(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return i(this,e,t)}}:{add:function(e){return i(this,e,!0)}}),a}},Vn=(U((function(e){var t,n=lt.enforce,r=!j.ActiveXObject&&"ActiveXObject"in j,a=Object.isExtensible,o=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},i=e.exports=On("WeakMap",o,Kn);if(ze&&r){t=Kn.getConstructor(o,"WeakMap",!0),hn.REQUIRED=!0;var s=i.prototype,c=s.delete,l=s.has,u=s.get,d=s.set;un(s,{delete:function(e){if(V(e)&&!a(e)){var r=n(this);return r.frozen||(r.frozen=new t),c.call(this,e)||r.frozen.delete(e)}return c.call(this,e)},has:function(e){if(V(e)&&!a(e)){var r=n(this);return r.frozen||(r.frozen=new t),l.call(this,e)||r.frozen.has(e)}return l.call(this,e)},get:function(e){if(V(e)&&!a(e)){var r=n(this);return r.frozen||(r.frozen=new t),l.call(this,e)?u.call(this,e):r.frozen.get(e)}return u.call(this,e)},set:function(e,r){if(V(e)&&!a(e)){var o=n(this);o.frozen||(o.frozen=new t),l.call(this,e)?d.call(this,e,r):o.frozen.set(e,r)}else d.call(this,e,r);return this}})}})),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),Xn=Se("iterator"),Gn=Se("toStringTag"),Bn=Zt.values;for(var Qn in Vn){var Wn=j[Qn],qn=Wn&&Wn.prototype;if(qn){if(qn[Xn]!==Bn)try{te(qn,Xn,Bn)}catch(e){qn[Xn]=Bn}if(qn[Gn]||te(qn,Gn,Qn),Vn[Qn])for(var Zn in Zt)if(qn[Zn]!==Zt[Zn])try{te(qn,Zn,Zt[Zn])}catch(e){qn[Zn]=Zt[Zn]}}}var $n,zn,er=function(e){c(r,f(Error));var t=p(r);function r(e){return n(this,r),t.call(this,e)}return r}(),tr=function(e,t,n){var r=q(t);r in e?z.f(e,r,ee(0,n)):e[r]=n},nr=ke("navigator","userAgent")||"",rr=j.process,ar=rr&&rr.versions,or=ar&&ar.v8;or?zn=($n=or.split("."))[0]+$n[1]:nr&&(!($n=nr.match(/Edge\/(\d+)/))||$n[1]>=74)&&($n=nr.match(/Chrome\/(\d+)/))&&(zn=$n[1]);var ir=zn&&+zn,sr=Se("species"),cr=function(e){return ir>=51||!M((function(){var t=[];return(t.constructor={})[sr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},lr=Se("isConcatSpreadable"),ur=ir>=51||!M((function(){var e=[];return e[lr]=!1,e.concat()[0]!==e})),dr=cr("concat"),hr=function(e){if(!V(e))return!1;var t=e[lr];return void 0!==t?!!t:Ln(e)};It({target:"Array",proto:!0,forced:!ur||!dr},{concat:function(e){var t,n,r,a,o,i=Mt(this),s=Mn(i,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(o=-1===t?i:arguments[t],hr(o)){if(c+(a=ge(o.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<a;n++,c++)n in o&&tr(s,c,o[n])}else{if(c>=9007199254740991)throw TypeError("Maximum allowed index exceeded");tr(s,c++,o)}return s.length=c,s}});var fr,vr,Sr,pr=j.Promise,Nr=Se("species"),mr=function(e){var t=ke(e),n=z.f;K&&t&&!t[Nr]&&n(t,Nr,{configurable:!0,get:function(){return this}})},yr=Se("species"),gr=function(e,t){var n,r=W(e).constructor;return void 0===r||null==(n=W(r)[yr])?t:Sn(n)},Tr=/(iphone|ipod|ipad).*applewebkit/i.test(nr),br=j.location,Er=j.setImmediate,_r=j.clearImmediate,wr=j.process,Cr=j.MessageChannel,Or=j.Dispatch,Lr=0,Ir={},Mr=function(e){if(Ir.hasOwnProperty(e)){var t=Ir[e];delete Ir[e],t()}},Hr=function(e){return function(){Mr(e)}},Rr=function(e){Mr(e.data)},xr=function(e){j.postMessage(e+"",br.protocol+"//"+br.host)};Er&&_r||(Er=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return Ir[++Lr]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},fr(Lr),Lr},_r=function(e){delete Ir[e]},"process"==R(wr)?fr=function(e){wr.nextTick(Hr(e))}:Or&&Or.now?fr=function(e){Or.now(Hr(e))}:Cr&&!Tr?(Sr=(vr=new Cr).port2,vr.port1.onmessage=Rr,fr=pn(Sr.postMessage,Sr,1)):!j.addEventListener||"function"!=typeof postMessage||j.importScripts||M(xr)?fr="onreadystatechange"in B("script")?function(e){Pe.appendChild(B("script")).onreadystatechange=function(){Pe.removeChild(this),Mr(e)}}:function(e){setTimeout(Hr(e),0)}:(fr=xr,j.addEventListener("message",Rr,!1)));var kr,Pr,Ar,Dr,Fr,Ur,Jr,Yr,jr={set:Er,clear:_r},Kr=vt.f,Vr=jr.set,Xr=j.MutationObserver||j.WebKitMutationObserver,Gr=j.process,Br=j.Promise,Qr="process"==R(Gr),Wr=Kr(j,"queueMicrotask"),qr=Wr&&Wr.value;qr||(kr=function(){var e,t;for(Qr&&(e=Gr.domain)&&e.exit();Pr;){t=Pr.fn,Pr=Pr.next;try{t()}catch(e){throw Pr?Dr():Ar=void 0,e}}Ar=void 0,e&&e.enter()},Qr?Dr=function(){Gr.nextTick(kr)}:Xr&&!Tr?(Fr=!0,Ur=document.createTextNode(""),new Xr(kr).observe(Ur,{characterData:!0}),Dr=function(){Ur.data=Fr=!Fr}):Br&&Br.resolve?(Jr=Br.resolve(void 0),Yr=Jr.then,Dr=function(){Yr.call(Jr,kr)}):Dr=function(){Vr.call(j,kr)});var Zr,$r,zr,ea,ta=qr||function(e){var t={fn:e,next:void 0};Ar&&(Ar.next=t),Pr||(Pr=t,Dr()),Ar=t},na=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Sn(t),this.reject=Sn(n)},ra={f:function(e){return new na(e)}},aa=function(e,t){if(W(e),V(t)&&t.constructor===e)return t;var n=ra.f(e);return(0,n.resolve)(t),n.promise},oa=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},ia=jr.set,sa=Se("species"),ca="Promise",la=lt.get,ua=lt.set,da=lt.getterFor(ca),ha=pr,fa=j.TypeError,va=j.document,Sa=j.process,pa=ke("fetch"),Na=ra.f,ma=Na,ya="process"==R(Sa),ga=!!(va&&va.createEvent&&j.dispatchEvent),Ta=Ot(ca,(function(){if(!(Ze(ha)!==String(ha))){if(66===ir)return!0;if(!ya&&"function"!=typeof PromiseRejectionEvent)return!0}if(ir>=51&&/native code/.test(ha))return!1;var e=ha.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[sa]=t,!(e.then((function(){}))instanceof t)})),ba=Ta||!wn((function(e){ha.all(e).catch((function(){}))})),Ea=function(e){var t;return!(!V(e)||"function"!=typeof(t=e.then))&&t},_a=function(e,t,n){if(!t.notified){t.notified=!0;var r=t.reactions;ta((function(){for(var a=t.value,o=1==t.state,i=0;r.length>i;){var s,c,l,u=r[i++],d=o?u.ok:u.fail,h=u.resolve,f=u.reject,v=u.domain;try{d?(o||(2===t.rejection&&La(e,t),t.rejection=1),!0===d?s=a:(v&&v.enter(),s=d(a),v&&(v.exit(),l=!0)),s===u.promise?f(fa("Promise-chain cycle")):(c=Ea(s))?c.call(s,h,f):h(s)):f(a)}catch(e){v&&!l&&v.exit(),f(e)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&Ca(e,t)}))}},wa=function(e,t,n){var r,a;ga?((r=va.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),j.dispatchEvent(r)):r={promise:t,reason:n},(a=j["on"+e])?a(r):"unhandledrejection"===e&&function(e,t){var n=j.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},Ca=function(e,t){ia.call(j,(function(){var n,r=t.value;if(Oa(t)&&(n=oa((function(){ya?Sa.emit("unhandledRejection",r,e):wa("unhandledrejection",e,r)})),t.rejection=ya||Oa(t)?2:1,n.error))throw n.value}))},Oa=function(e){return 1!==e.rejection&&!e.parent},La=function(e,t){ia.call(j,(function(){ya?Sa.emit("rejectionHandled",e):wa("rejectionhandled",e,t.value)}))},Ia=function(e,t,n,r){return function(a){e(t,n,a,r)}},Ma=function(e,t,n,r){t.done||(t.done=!0,r&&(t=r),t.value=n,t.state=2,_a(e,t,!0))},Ha=function(e,t,n,r){if(!t.done){t.done=!0,r&&(t=r);try{if(e===n)throw fa("Promise can't be resolved itself");var a=Ea(n);a?ta((function(){var r={done:!1};try{a.call(n,Ia(Ha,e,r,t),Ia(Ma,e,r,t))}catch(n){Ma(e,r,n,t)}})):(t.value=n,t.state=1,_a(e,t,!1))}catch(n){Ma(e,{done:!1},n,t)}}};Ta&&(ha=function(e){gn(this,ha,ca),Sn(e),Zr.call(this);var t=la(this);try{e(Ia(Ha,this,t),Ia(Ma,this,t))}catch(e){Ma(this,t,e)}},(Zr=function(e){ua(this,{type:ca,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=un(ha.prototype,{then:function(e,t){var n=da(this),r=Na(gr(this,ha));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=ya?Sa.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&_a(this,n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),$r=function(){var e=new Zr,t=la(e);this.promise=e,this.resolve=Ia(Ha,e,t),this.reject=Ia(Ma,e,t)},ra.f=Na=function(e){return e===ha||e===zr?new $r(e):ma(e)},"function"==typeof pr&&(ea=pr.prototype.then,St(pr.prototype,"then",(function(e,t){var n=this;return new ha((function(e,t){ea.call(n,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof pa&&It({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return aa(ha,pa.apply(j,arguments))}}))),It({global:!0,wrap:!0,forced:Ta},{Promise:ha}),Jt(ha,ca,!1),mr(ca),zr=ke(ca),It({target:ca,stat:!0,forced:Ta},{reject:function(e){var t=Na(this);return t.reject.call(void 0,e),t.promise}}),It({target:ca,stat:!0,forced:Ta},{resolve:function(e){return aa(this,e)}}),It({target:ca,stat:!0,forced:ba},{all:function(e){var t=this,n=Na(t),r=n.resolve,a=n.reject,o=oa((function(){var n=Sn(t.resolve),o=[],i=0,s=1;yn(e,(function(e){var c=i++,l=!1;o.push(void 0),s++,n.call(t,e).then((function(e){l||(l=!0,o[c]=e,--s||r(o))}),a)})),--s||r(o)}));return o.error&&a(o.value),n.promise},race:function(e){var t=this,n=Na(t),r=n.reject,a=oa((function(){var a=Sn(t.resolve);yn(e,(function(e){a.call(t,e).then(n.resolve,r)}))}));return a.error&&r(a.value),n.promise}});var Ra=function(){var e=W(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},xa=RegExp.prototype,ka=xa.toString,Pa=M((function(){return"/a/b"!=ka.call({source:"a",flags:"b"})})),Aa="toString"!=ka.name;(Pa||Aa)&&St(RegExp.prototype,"toString",(function(){var e=W(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in xa)?Ra.call(e):n)}),{unsafe:!0});var Da=!!pr&&M((function(){pr.prototype.finally.call({then:function(){}},(function(){}))}));function Fa(e,t){return RegExp(e,t)}It({target:"Promise",proto:!0,real:!0,forced:Da},{finally:function(e){var t=gr(this,ke("Promise")),n="function"==typeof e;return this.then(n?function(n){return aa(t,e()).then((function(){return n}))}:e,n?function(n){return aa(t,e()).then((function(){throw n}))}:e)}}),"function"!=typeof pr||pr.prototype.finally||St(pr.prototype,"finally",ke("Promise").prototype.finally);var Ua={UNSUPPORTED_Y:M((function(){var e=Fa("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:M((function(){var e=Fa("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},Ja=RegExp.prototype.exec,Ya=String.prototype.replace,ja=Ja,Ka=function(){var e=/a/,t=/b*/g;return Ja.call(e,"a"),Ja.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),Va=Ua.UNSUPPORTED_Y||Ua.BROKEN_CARET,Xa=void 0!==/()??/.exec("")[1];(Ka||Xa||Va)&&(ja=function(e){var t,n,r,a,o=this,i=Va&&o.sticky,s=Ra.call(o),c=o.source,l=0,u=e;return i&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),u=String(e).slice(o.lastIndex),o.lastIndex>0&&(!o.multiline||o.multiline&&"\n"!==e[o.lastIndex-1])&&(c="(?: "+c+")",u=" "+u,l++),n=new RegExp("^(?:"+c+")",s)),Xa&&(n=new RegExp("^"+c+"$(?!\\s)",s)),Ka&&(t=o.lastIndex),r=Ja.call(i?n:o,u),i?r?(r.input=r.input.slice(l),r[0]=r[0].slice(l),r.index=o.lastIndex,o.lastIndex+=r[0].length):o.lastIndex=0:Ka&&r&&(o.lastIndex=o.global?r.index+r[0].length:t),Xa&&r&&r.length>1&&Ya.call(r[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(r[a]=void 0)})),r});var Ga=ja;It({target:"RegExp",proto:!0,forced:/./.exec!==Ga},{exec:Ga});var Ba=Se("species"),Qa=!M((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),Wa="$0"==="a".replace(/./,"$0"),qa=Se("replace"),Za=!!/./[qa]&&""===/./[qa]("a","$0"),$a=!M((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),za=function(e,t,n,r){var a=Se(e),o=!M((function(){var t={};return t[a]=function(){return 7},7!=""[e](t)})),i=o&&!M((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Ba]=function(){return n},n.flags="",n[a]=/./[a]),n.exec=function(){return t=!0,null},n[a](""),!t}));if(!o||!i||"replace"===e&&(!Qa||!Wa||Za)||"split"===e&&!$a){var s=/./[a],c=n(a,""[e],(function(e,t,n,r,a){return t.exec===Ga?o&&!a?{done:!0,value:s.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Wa,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Za}),l=c[0],u=c[1];St(String.prototype,e,l),St(RegExp.prototype,a,2==t?function(e,t){return u.call(e,this,t)}:function(e){return u.call(e,this)})}r&&te(RegExp.prototype[a],"sham",!0)},eo=on.charAt,to=function(e,t,n){return t+(n?eo(e,t).length:1)},no=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==R(e))throw TypeError("RegExp#exec called on incompatible receiver");return Ga.call(e,t)},ro=Math.max,ao=Math.min,oo=Math.floor,io=/\$([$&'`]|\d\d?|<[^>]*>)/g,so=/\$([$&'`]|\d\d?)/g;za("replace",2,(function(e,t,n,r){var a=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,i=a?"$":"$0";return[function(n,r){var a=P(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,a,r):t.call(String(a),n,r)},function(e,r){if(!a&&o||"string"==typeof r&&-1===r.indexOf(i)){var c=n(t,e,this,r);if(c.done)return c.value}var l=W(e),u=String(this),d="function"==typeof r;d||(r=String(r));var h=l.global;if(h){var f=l.unicode;l.lastIndex=0}for(var v=[];;){var S=no(l,u);if(null===S)break;if(v.push(S),!h)break;""===String(S[0])&&(l.lastIndex=to(u,ge(l.lastIndex),f))}for(var p,N="",m=0,y=0;y<v.length;y++){S=v[y];for(var g=String(S[0]),T=ro(ao(me(S.index),u.length),0),b=[],E=1;E<S.length;E++)b.push(void 0===(p=S[E])?p:String(p));var _=S.groups;if(d){var w=[g].concat(b,T,u);void 0!==_&&w.push(_);var C=String(r.apply(void 0,w))}else C=s(g,u,T,b,_,r);T>=m&&(N+=u.slice(m,T)+C,m=T+g.length)}return N+u.slice(m)}];function s(e,n,r,a,o,i){var s=r+e.length,c=a.length,l=so;return void 0!==o&&(o=Mt(o),l=io),t.call(i,l,(function(t,i){var l;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(s);case"<":l=o[i.slice(1,-1)];break;default:var u=+i;if(0===u)return t;if(u>c){var d=oo(u/10);return 0===d?t:d<=c?void 0===a[d-1]?i.charAt(1):a[d-1]+i.charAt(1):t}l=a[u-1]}return void 0===l?"":l}))}}));var co=function(){function e(){n(this,e),lo.set(this,{writable:!0,value:[]})}return a(e,[{key:"bindListener",value:function(e,t,n,r){_(this,lo,E(this,lo)||[]);var a=function(e,a,o){return n.call(t,e,a,o,r)};return E(this,lo)[e]?E(this,lo)[e].push(a)-1:(E(this,lo)[e]=[a],0)}},{key:"addListener",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_(this,lo,E(this,lo)||[]);var r=function(e,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t(s({context:e,eventName:r},a,{},n))};return E(this,lo)[e]?E(this,lo)[e].push(r)-1:(E(this,lo)[e]=[r],0)}},{key:"removeListener",value:function(e,t){E(this,lo)[e]&&E(this,lo)[e][t]?delete E(this,lo)[e][t]:console.log("trying to remove non-existent event handler, event = "+e+" handle = "+t)}},{key:"destructor",value:function(){_(this,lo,null)}},{key:"fireEvent",value:function(t,n){if(E(this,lo))for(var r in E(this,lo)[t])if(E(this,lo)[t].hasOwnProperty(r)&&E(this,lo)[t][r](this,t,arguments[1])===e.STOP_PROPAGATION)break}}]),e}(),lo=new WeakMap;o(co,"STOP_PROPAGATION","STOP_PROPAGATION");var uo=U((function(e,t){
/*!
    localForage -- Offline Storage, Improved
    Version 1.7.3
    https://localforage.github.io/localForage
    (c) 2013-2017 Mozilla, Apache License 2.0
*/
e.exports=function e(t,n,r){function a(i,s){if(!n[i]){if(!t[i]){if(!s&&F)return F();if(o)return o(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[i]={exports:{}};t[i][0].call(l.exports,(function(e){var n=t[i][1][e];return a(n||e)}),l,l.exports,e,t,n,r)}return n[i].exports}for(var o=F,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(e,t,n){(function(e){var n,r,a=e.MutationObserver||e.WebKitMutationObserver;if(a){var o=0,i=new a(u),s=e.document.createTextNode("");i.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){u(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(u,0)};else{var c=new e.MessageChannel;c.port1.onmessage=u,n=function(){c.port2.postMessage(0)}}var l=[];function u(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}t.exports=function(e){1!==l.push(e)||r||n()}}).call(this,void 0!==D?D:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function a(){}var o={},i=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==a&&f(this,e)}function u(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function d(e,t,n){r((function(){var r;try{r=t(n)}catch(t){return o.reject(e,t)}r===e?o.reject(e,new TypeError("Cannot resolve promise with itself")):o.resolve(e,r)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function f(e,t){var n=!1;function r(t){n||(n=!0,o.reject(e,t))}function a(t){n||(n=!0,o.resolve(e,t))}var i=v((function(){t(a,r)}));"error"===i.status&&r(i.value)}function v(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===i)return this;var n=new this.constructor(a);return this.state!==c?d(n,this.state===s?e:t,this.outcome):this.queue.push(new u(n,e,t)),n},u.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},u.prototype.otherCallFulfilled=function(e){d(this.promise,this.onFulfilled,e)},u.prototype.callRejected=function(e){o.reject(this.promise,e)},u.prototype.otherCallRejected=function(e){d(this.promise,this.onRejected,e)},o.resolve=function(e,t){var n=v(h,t);if("error"===n.status)return o.reject(e,n.value);var r=n.value;if(r)f(e,r);else{e.state=s,e.outcome=t;for(var a=-1,i=e.queue.length;++a<i;)e.queue[a].callFulfilled(t)}return e},o.reject=function(e,t){e.state=i,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},l.resolve=function(e){return e instanceof this?e:o.resolve(new this(a),e)},l.reject=function(e){var t=new this(a);return o.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i=new Array(n),s=0,c=-1,l=new this(a);++c<n;)u(e[c],c);return l;function u(e,a){t.resolve(e).then((function(e){i[a]=e,++s!==n||r||(r=!0,o.resolve(l,i))}),(function(e){r||(r=!0,o.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var i,s=-1,c=new this(a);++s<n;)i=e[s],t.resolve(i).then((function(e){r||(r=!0,o.resolve(c,e))}),(function(e){r||(r=!0,o.reject(c,e))}));return c}},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==D?D:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function o(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var i=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function c(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function l(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function u(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var d=void 0,h={},f=Object.prototype.toString;function v(e){return"boolean"==typeof d?i.resolve(d):function(e){return new i((function(t){var n=e.transaction("local-forage-detect-blob-support","readwrite"),r=o([""]);n.objectStore("local-forage-detect-blob-support").put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return d=e}))}function S(e){var t=h[e.name],n={};n.promise=new i((function(e,t){n.resolve=e,n.reject=t})),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then((function(){return n.promise})):t.dbReady=n.promise}function p(e){var t=h[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function N(e,t){var n=h[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function m(e,t){return new i((function(n,r){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);S(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var i=a.open.apply(a,o);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore("local-forage-detect-blob-support")}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){n(i.result),p(e)}}))}function y(e){return m(e,!1)}function g(e){return m(e,!0)}function T(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,a=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),a||n){if(n){var o=e.db.version+1;o>e.version&&(e.version=o)}return!0}return!1}function b(e){return o([function(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),a=0;a<t;a++)r[a]=e.charCodeAt(a);return n}(atob(e.data))],{type:e.type})}function E(e){return e&&e.__local_forage_encoded_blob}function _(e){var t=this,n=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return c(n,e,e),n}function w(e,t,n,r){void 0===r&&(r=1);try{var a=e.db.transaction(e.storeName,t);n(null,a)}catch(a){if(r>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return i.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),g(e)})).then((function(){return function(e){S(e);for(var t=h[e.name],n=t.forages,r=0;r<n.length;r++){var a=n[r];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,y(e).then((function(t){return e.db=t,T(e)?g(e):t})).then((function(r){e.db=t.db=r;for(var a=0;a<n.length;a++)n[a]._dbInfo.db=r})).catch((function(t){throw N(e,t),t}))}(e).then((function(){w(e,t,n,r-1)}))})).catch(n);n(a)}}var C={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var a=h[n.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},h[n.name]=a),a.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=_);var o=[];function s(){return i.resolve()}for(var c=0;c<a.forages.length;c++){var l=a.forages[c];l!==t&&o.push(l._initReady().catch(s))}var u=a.forages.slice(0);return i.all(o).then((function(){return n.db=a.db,y(n)})).then((function(e){return n.db=e,T(n,t._defaultConfig.version)?g(n):e})).then((function(e){n.db=a.db=e,t._dbInfo=n;for(var r=0;r<u.length;r++){var o=u[r];o!==t&&(o._dbInfo.db=n.db,o._dbInfo.version=n.version)}}))},_support:function(){try{if(!a)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){w(n._dbInfo,"readonly",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName).openCursor(),s=1;i.onsuccess=function(){var n=i.result;if(n){var r=n.value;E(r)&&(r=b(r));var a=e(r,n.key,s++);void 0!==a?t(a):n.continue()}else t()},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){w(n._dbInfo,"readonly",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName).get(e);i.onsuccess=function(){var e=i.result;void 0===e&&(e=null),E(e)&&(e=b(e)),t(e)},i.onerror=function(){r(i.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var a=new i((function(n,a){var o;r.ready().then((function(){return o=r._dbInfo,"[object Blob]"===f.call(t)?v(o.db).then((function(e){return e?t:(n=t,new i((function(e,t){var r=new FileReader;r.onerror=t,r.onloadend=function(t){var r=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:r,type:n.type})},r.readAsBinaryString(n)})));var n})):t})).then((function(t){w(r._dbInfo,"readwrite",(function(o,i){if(o)return a(o);try{var s=i.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);i.oncomplete=function(){void 0===t&&(t=null),n(t)},i.onabort=i.onerror=function(){var e=c.error?c.error:c.transaction.error;a(e)}}catch(e){a(e)}}))})).catch(a)}));return s(a,n),a},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){w(n._dbInfo,"readwrite",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName).delete(e);o.oncomplete=function(){t()},o.onerror=function(){r(i.error)},o.onabort=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){w(t._dbInfo,"readwrite",(function(r,a){if(r)return n(r);try{var o=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){w(t._dbInfo,"readonly",(function(r,a){if(r)return n(r);try{var o=a.objectStore(t._dbInfo.storeName).count();o.onsuccess=function(){e(o.result)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){e<0?t(null):n.ready().then((function(){w(n._dbInfo,"readonly",(function(a,o){if(a)return r(a);try{var i=o.objectStore(n._dbInfo.storeName),s=!1,c=i.openCursor();c.onsuccess=function(){var n=c.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(e){r(e)}}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){w(t._dbInfo,"readonly",(function(r,a){if(r)return n(r);try{var o=a.objectStore(t._dbInfo.storeName).openCursor(),i=[];o.onsuccess=function(){var t=o.result;t?(i.push(t.key),t.continue()):e(i)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;if(e.name){var c=e.name===n.name&&o._dbInfo.db,l=c?i.resolve(o._dbInfo.db):y(e).then((function(t){var n=h[e.name],r=n.forages;n.db=t;for(var a=0;a<r.length;a++)r[a]._dbInfo.db=t;return t}));r=e.storeName?l.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;S(e);var r=h[e.name],o=r.forages;t.close();for(var s=0;s<o.length;s++){var c=o[s];c._dbInfo.db=null,c._dbInfo.version=n}return new i((function(t,r){var o=a.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}})).then((function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,p(n._dbInfo)}})).catch((function(t){throw(N(e,t)||i.resolve()).catch((function(){})),t}))}})):l.then((function(t){S(e);var n=h[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;return new i((function(t,n){var r=a.deleteDatabase(e.name);r.onerror=r.onblocked=function(e){var t=r.result;t&&t.close(),n(e)},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<r.length;t++)p(r[t]._dbInfo)})).catch((function(t){throw(N(e,t)||i.resolve()).catch((function(){})),t}))}))}else r=i.reject("Invalid arguments");return s(r,t),r}},O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=/^~~local_forage_type~([^~]+)~/,I="__lfsc__:".length,M=I+"arbf".length,H=Object.prototype.toString;function R(e){var t,n,r,a,o,i=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);var l=new ArrayBuffer(i),u=new Uint8Array(l);for(t=0;t<s;t+=4)n=O.indexOf(e[t]),r=O.indexOf(e[t+1]),a=O.indexOf(e[t+2]),o=O.indexOf(e[t+3]),u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|a>>2,u[c++]=(3&a)<<6|63&o;return l}function x(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=O[n[t]>>2],r+=O[(3&n[t])<<4|n[t+1]>>4],r+=O[(15&n[t+1])<<2|n[t+2]>>6],r+=O[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}var k={serialize:function(e,t){var n="";if(e&&(n=H.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===H.call(e.buffer))){var r,a="__lfsc__:";e instanceof ArrayBuffer?(r=e,a+="arbf"):(r=e.buffer,"[object Int8Array]"===n?a+="si08":"[object Uint8Array]"===n?a+="ui08":"[object Uint8ClampedArray]"===n?a+="uic8":"[object Int16Array]"===n?a+="si16":"[object Uint16Array]"===n?a+="ur16":"[object Int32Array]"===n?a+="si32":"[object Uint32Array]"===n?a+="ui32":"[object Float32Array]"===n?a+="fl32":"[object Float64Array]"===n?a+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(a+x(r))}else if("[object Blob]"===n){var o=new FileReader;o.onload=function(){var n="~~local_forage_type~"+e.type+"~"+x(this.result);t("__lfsc__:blob"+n)},o.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if("__lfsc__:"!==e.substring(0,I))return JSON.parse(e);var t,n=e.substring(M),r=e.substring(I,M);if("blob"===r&&L.test(n)){var a=n.match(L);t=a[1],n=n.substring(a[0].length)}var i=R(n);switch(r){case"arbf":return i;case"blob":return o([i],{type:t});case"si08":return new Int8Array(i);case"ui08":return new Uint8Array(i);case"uic8":return new Uint8ClampedArray(i);case"si16":return new Int16Array(i);case"ur16":return new Uint16Array(i);case"si32":return new Int32Array(i);case"ui32":return new Uint32Array(i);case"fl32":return new Float32Array(i);case"fl64":return new Float64Array(i);default:throw new Error("Unkown type: "+r)}},stringToBuffer:R,bufferToString:x};function P(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function A(e,t,n,r,a,o){e.executeSql(n,r,a,(function(e,i){i.code===i.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?o(e,i):P(e,t,(function(){e.executeSql(n,r,a,o)}),o)}),o):o(e,i)}),o)}function D(e,t,n,r){var a=this;e=l(e);var o=new i((function(o,i){a.ready().then((function(){void 0===t&&(t=null);var s=t,c=a._dbInfo;c.serializer.serialize(t,(function(t,l){l?i(l):c.db.transaction((function(n){A(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){o(s)}),(function(e,t){i(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void o(D.apply(a,[e,s,n,r-1]));i(t)}}))}))})).catch(i)}));return s(o,n),o}function F(e){return new i((function(t,n){e.transaction((function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(n,r){for(var a=[],o=0;o<r.rows.length;o++)a.push(r.rows.item(o).name);t({db:e,storeNames:a})}),(function(e,t){n(t)}))}),(function(e){n(e)}))}))}var U={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var a=new i((function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return r(e)}n.db.transaction((function(a){P(a,n,(function(){t._dbInfo=n,e()}),(function(e,t){r(t)}))}),r)}));return n.serializer=k,a},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){A(n,a,"SELECT * FROM "+a.storeName,[],(function(n,r){for(var o=r.rows,i=o.length,s=0;s<i;s++){var c=o.item(s),l=c.value;if(l&&(l=a.serializer.deserialize(l)),void 0!==(l=e(l,c.key,s+1)))return void t(l)}t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){A(n,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=a.serializer.deserialize(r)),t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},setItem:function(e,t,n){return D.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=l(e);var r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){A(n,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},clear:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"DELETE FROM "+r.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],(function(t,n){var r=n.rows.item(0).c;e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,r=new i((function(t,r){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){A(n,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)}),(function(e,t){r(t)}))}))})).catch(r)}));return s(r,t),r},keys:function(e){var t=this,n=new i((function(e,n){t.ready().then((function(){var r=t._dbInfo;r.db.transaction((function(t){A(t,r,"SELECT key FROM "+r.storeName,[],(function(t,n){for(var r=[],a=0;a<n.rows.length;a++)r.push(n.rows.item(a).key);e(r)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=u.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,a=this;return s(r=e.name?new i((function(t){var r;r=e.name===n.name?a._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(F(r))})).then((function(e){return new i((function(t,n){e.db.transaction((function(r){function a(e){return new i((function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}for(var o=[],s=0,c=e.storeNames.length;s<c;s++)o.push(a(e.storeNames[s]));i.all(o).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):i.reject("Invalid arguments"),t),r}};function J(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Y(){return!function(){try{return localStorage.setItem("_localforage_support_test",!0),localStorage.removeItem("_localforage_support_test"),!1}catch(e){return!0}}()||localStorage.length>0}var j={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=J(e,this._defaultConfig),Y()?(this._dbInfo=t,t.serializer=k,i.resolve()):i.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,r=n.ready().then((function(){for(var t=n._dbInfo,r=t.keyPrefix,a=r.length,o=localStorage.length,i=1,s=0;s<o;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(a),i++)))return l}}}));return s(r,t),r},getItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r}));return s(r,t),r},setItem:function(e,t,n){var r=this;e=l(e);var a=r.ready().then((function(){void 0===t&&(t=null);var n=t;return new i((function(a,o){var i=r._dbInfo;i.serializer.serialize(t,(function(t,r){if(r)o(r);else try{localStorage.setItem(i.keyPrefix+e,t),a(n)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||o(e),o(e)}}))}))}));return s(a,n),a},removeItem:function(e,t){var n=this;e=l(e);var r=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(r,t),r},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,r=n.ready().then((function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t}));return s(r,t),r},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,r=[],a=0;a<n;a++){var o=localStorage.key(a);0===o.indexOf(e.keyPrefix)&&r.push(o.substring(e.keyPrefix.length))}return r}));return s(n,e),n},dropInstance:function(e,t){if(t=u.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,a=this;return s(r=e.name?new i((function(t){e.storeName?t(J(e,a._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):i.reject("Invalid arguments"),t),r}},K=function(e,t){for(var n,r,a=e.length,o=0;o<a;){if((n=e[o])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;o++}return!1},V=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},X={},G={},B={INDEXEDDB:C,WEBSQL:U,LOCALSTORAGE:j},Q=[B.INDEXEDDB._driver,B.WEBSQL._driver,B.LOCALSTORAGE._driver],W=["dropInstance"],q=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(W),Z={description:"",driver:Q.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function $(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}function z(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(V(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var ee=new(function(){function e(t){for(var n in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),B)if(B.hasOwnProperty(n)){var r=B[n],a=r._driver;this[n]=a,X[a]||this.defineDriver(r)}this._defaultConfig=z({},Z),this._config=z({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new i((function(t,n){try{var r=e._driver,a=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(a);for(var o=q.concat("_initStorage"),c=0,l=o.length;c<l;c++){var u=o[c];if((!K(W,u)||e[u])&&"function"!=typeof e[u])return void n(a)}!function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=i.reject(t);return s(n,arguments[arguments.length-1]),n}},n=0,r=W.length;n<r;n++){var a=W[n];e[a]||(e[a]=t(a))}}();var d=function(n){X[r]&&console.info("Redefining LocalForage driver: "+r),X[r]=e,G[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(e){n(e)}}));return c(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=X[e]?i.resolve(X[e]):i.reject(new Error("Driver not found."));return c(r,t,n),r},e.prototype.getSerializer=function(e){var t=i.resolve(k);return c(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return c(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;V(e)||(e=[e]);var a=this._getSupportedDrivers(e);function o(){r._config.driver=r.driver()}function s(e){return r._extend(e),o(),r._ready=r._initStorage(r._config),r._ready}var l=null!==this._driverSet?this._driverSet.catch((function(){return i.resolve()})):i.resolve();return this._driverSet=l.then((function(){var e=a[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then((function(e){r._driver=e._driver,o(),r._wrapLibraryMethodsWithReady(),r._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var a=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(a).then(s).catch(n)}o();var c=new Error("No available storage method found.");return r._driverSet=i.reject(c),r._driverSet}()}}(a)}))})).catch((function(){o();var e=new Error("No available storage method found.");return r._driverSet=i.reject(e),r._driverSet})),c(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!G[e]},e.prototype._extend=function(e){z(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];this.supports(a)&&t.push(a)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=q.length;e<t;e++)$(this,q[e])},e.prototype.createInstance=function(t){return new e(t)},e}());t.exports=ee},{3:3}]},{},[4])(4)}));function ho(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,ho)}var fo=/^[a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12}$/,vo=function(e){c(r,co);var t=p(r);function r(){var e;return n(this,r),o(v(e=t.call(this)),"_id",void 0),o(v(e),"_savedRemotely",!1),o(v(e),"_savedLocally",!1),o(v(e),"deleted",!1),o(v(e),"createdStamp",void 0),o(v(e),"modifiedStamp",void 0),o(v(e),"projectId",void 0),o(v(e),"isPristine",!1),e.createdStamp=Math.floor(Date.now()/1e3),e}return a(r,[{key:"unsaved",value:function(){return!(this._savedLocally&&this._savedRemotely)}},{key:"queuePost",value:function(e){var t=this;return new Promise((function(n,a){var o=function(){return console.log({"posting form data":e}),t.post(e).then(n,a)};r._tasks.push(o),r._tasks.length>1?console.log("Added post request to the queue."):(console.log("No pending tasks, starting post request immediately."),o().finally(r._next))}))}},{key:"post",value:function(e){var t=this;return fetch(this.SAVE_ENDPOINT,{method:"POST",body:e}).then((function(e){return e.ok?e.clone().json().then((function(n){switch(console.log({"returned to client after save":n}),n.saveState){case"SAVED_TO_SERVER":t._savedLocally=!0,t._savedRemotely=!0;break;case"SAVED_LOCALLY":t._savedLocally=!0,t._savedRemotely=!1;break;default:console.log("Unrecognised save state '".concat(n.saveState,"'"))}return t.createdStamp=parseInt(n.created,10),t.modifiedStamp=parseInt(n.modified,10),e.json()})):(console.log("Save failed, presumably service worker is missing and there is no network connection. Should write to IndexedDb here."),Promise.reject("IndexedDb storage not yet implemented"))}))}},{key:"_parseDescriptor",value:function(e){this._parseAttributes(e.attributes),this._parseSavedState(e.saveState),this.deleted=!0===e.deleted||"true"===e.deleted,this.createdStamp=parseInt(e.created,10),this.modifiedStamp=e.modified?parseInt(e.modified,10):0,this.projectId=parseInt(e.projectId,10)}},{key:"_parseAttributes",value:function(e){"string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)?(console.log("Attributes were spuriously represented as an array rather than as an empty object"),this.attributes={}):this.attributes=e}},{key:"_parseSavedState",value:function(e){switch(e){case"SAVED_LOCALLY":this._savedRemotely=!1,this._savedLocally=!0;break;case"SAVED_TO_SERVER":this._savedRemotely=!0,this._savedLocally=!0;break;default:throw new Error("Unrecognised saved state '".concat(e))}}},{key:"touch",value:function(){this.modifiedStamp=Math.floor(Date.now()/1e3),this.isPristine&&(this.isPristine=!1,this.createdStamp=this.modifiedStamp),this._savedLocally=!1,this._savedRemotely=!1}},{key:"evaluateCompletionStatus",value:function(e){var t={},n=!0;for(var r in e)if(e.hasOwnProperty(r)){var a=e[r];t[r]=a.validator?a.validator(r,a,this.attributes):a.field.isValid(r,a,this.attributes),null!==t[r]&&(n=n&&t[r])}return{requiredFieldsPresent:n,validity:t}}},{key:"id",get:function(){return this._id||(this._id=ho()),this._id},set:function(e){if(this._id&&e!==this._id)throw new Error("Occurrence id has already been set, when trying to set new id '".concat(e,"'."));this._id=e}}],[{key:"_next",value:function(){if(r._tasks.shift(),r._tasks.length)return console.log("Running the next task."),r._tasks[0]().finally(r._next)}},{key:"retrieveFromLocal",value:function(e,t){return uo.getItem("".concat(t.TYPE,".").concat(e)).then((function(n){return n?(t.id=e,t._parseDescriptor(n),t):Promise.reject("Failed to retrieve ".concat(t.TYPE,".").concat(e," locally"))}))}}]),r}();o(vo,"_tasks",[]);var So=function(e){c(r,f(Error));var t=p(r);function r(){return n(this,r),t.apply(this,arguments)}return r}();function po(e){try{var t=document.createElement("textarea");return t.innerHTML=e,t.innerHTML.replace(/"/g,"&quot;")}catch(t){var n=document.createElement("pre");return n.appendChild(document.createTextNode(e)),n.innerHTML.replace(/"/g,"&quot;")}}var No=function(){function t(){n(this,t),o(this,"id",void 0),o(this,"nameString",""),o(this,"canonical",""),o(this,"hybridCanonical",""),o(this,"acceptedEntityId",""),o(this,"qualifier",""),o(this,"authority",""),o(this,"vernacular",""),o(this,"vernacularRoot",""),o(this,"used",void 0),o(this,"sortOrder",void 0),o(this,"parentIds",[])}return a(t,[{key:"formattedHTML",value:function(e){var n;return this.id!==this.acceptedEntityId&&(n=t.fromId(this.acceptedEntityId)),t.showVernacular?e?n?"<q><b>".concat(po(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(po(this.authority),"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(po(n.authority),"</span>"):"<q><b>".concat(po(this.vernacular),'</b></q> <span class="italictaxon">').concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(po(this.authority),"</span>"):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>").concat(this.vernacular?" <q><b>".concat(po(this.vernacular),"</b></q>"):"",' = <span class="italictaxon">').concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(po(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(po(this.authority),"</span>").concat(this.vernacular?" <q><b>".concat(po(this.vernacular),"</b></q>"):""):n?'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(this.authority,"</span>")+' = <span class="italictaxon">'.concat(n.nameString).concat(n.qualifier?" <b>".concat(n.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(po(n.authority),"</span>"):'<span class="italictaxon">'.concat(this.nameString).concat(this.qualifier?" <b>".concat(this.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(po(this.authority),"</span>")}}],[{key:"fromId",value:function(n){if(!t.rawTaxa){if(!e.TaxonNames)throw new So("Taxon.fromId() called before taxon list has loaded.");t.rawTaxa=e.TaxonNames}if(!t.rawTaxa.hasOwnProperty(n))throw new So("Taxon id '".concat(n,"' not found."));var r=t.rawTaxa[n],a=new t;return a.id=n,a.nameString=r[0],a.canonical=r[1]||r[0],a.hybridCanonical=r[2]||a.canonical,a.acceptedEntityId=r[3]||n,a.qualifier=r[4],a.authority=r[5],a.vernacular=r[6],a.vernacularRoot=r[7],a.used=r[8],a.sortOrder=r[9],a.parentIds=r[10],a}}]),t}();o(No,"rawTaxa",e.TaxonNames),o(No,"showVernacular",!0);var mo="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",yo="["+mo+"]",go=RegExp("^"+yo+yo+"*"),To=RegExp(yo+yo+"*$"),bo=function(e){return function(t){var n=String(P(t));return 1&e&&(n=n.replace(go,"")),2&e&&(n=n.replace(To,"")),n}},Eo={start:bo(1),end:bo(2),trim:bo(3)},_o=function(e){return M((function(){return!!mo[e]()||"âÂá "!="âÂá "[e]()||mo[e].name!==e}))},wo=Eo.trim;It({target:"String",proto:!0,forced:_o("trim")},{trim:function(){return wo(this)}});var Co=function(e){c(r,co);var t=p(r);function r(e){var a;return n(this,r),o(v(a=t.call(this)),"_value",void 0),o(v(a),"_fieldEl",void 0),o(v(a),"label","field label"),o(v(a),"helpText",""),o(v(a),"validationMessage",""),o(v(a),"completion",r.COMPLETION_OPTIONAL),o(v(a),"parentForm",void 0),o(v(a),"attributeName",void 0),e&&(e.label&&(a.label=e.label),e.helpText&&(a.helpText=e.helpText),e.validationMessage&&(a.validationMessage=e.validationMessage),e.completion&&(a.completion=e.completion)),a}return a(r,[{key:"addField",value:function(){this.parentForm.formElement.appendChild(this.fieldElement)}},{key:"markValidity",value:function(e){}},{key:"value",get:function(){return this._value},set:function(e){}},{key:"fieldElement",get:function(){return this._fieldEl||this.buildField(),this._fieldEl}}],[{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}},{key:"cleanRawString",value:function(e){return e.trim().replace(/\s\s+/g," ")}},{key:"isEmpty",value:function(e){return""===e}},{key:"isValid",value:function(e,t,n){return!t.attributes.completion||t.attributes.completion!==r.COMPLETION_COMPULSORY&&t.attributes.completion!==r.COMPLETION_DESIRED?null:!(!n.hasOwnProperty(e)||t.field.isEmpty(n[e]))}},{key:"summarise",value:function(e,t,n){return!t.summary||t.summary.hasOwnProperty("summarise")&&!0!==t.summary.summarise?"":t.field.summariseImpl(e,t,n)}},{key:"summariseImpl",value:function(e,t,n){return""}},{key:"nextId",get:function(){var e;return"field".concat((C(r,r,Oo,1+(e=+w(r,r,Oo))),e))}}]),r}();o(Co,"COMPLETION_COMPULSORY","compulsory"),o(Co,"COMPLETION_DESIRED","desired"),o(Co,"COMPLETION_OPTIONAL","optional");var Oo={writable:!0,value:1};o(Co,"EVENT_CHANGE","fieldChange");var Lo=function(e){c(r,co);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return e=t.call.apply(t,[this].concat(i)),Io.set(v(e),{writable:!0,value:void 0}),o(v(e),"_formId",void 0),o(v(e),"_formContentContainer",void 0),o(v(e),"fields",void 0),o(v(e),"liveValidation",!1),o(v(e),"isValid",null),o(v(e),"_formFieldsBuilt",!1),e}return a(r,[{key:"buildContentContainer",value:function(e){return this._formContentContainer=e,this._formContentContainer}},{key:"changeHandler",value:function(e){console.log({"form change event":e})}},{key:"destructor",value:function(){N(l(r.prototype),"destructor",this).call(this),_(this,Io,null)}},{key:"buildFormFields",value:function(){for(var e in this.initialiseFormFields(),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];t.parentForm=this,t.attributeName=e,this._formContentContainer.appendChild(t.fieldElement),t.addListener(Co.EVENT_CHANGE,this.changeHandler.bind(this))}this._formFieldsBuilt=!0}},{key:"conditionallyValidateForm",value:function(){this.liveValidation&&this.validateForm()}},{key:"validateForm",value:function(){this.liveValidation=!0,this.formElement.classList.add("needs-validation");var e=this.model.evaluateCompletionStatus(this.getFormSectionProperties());for(var t in this.fields){if(this.fields.hasOwnProperty(t))this.fields[t].markValidity(e.validity[t])}return this.isValid!==e.requiredFieldsPresent&&(this.isValid=e.requiredFieldsPresent,this.fireEvent(r.EVENT_VALIDATION_STATE_CHANGE,{isValid:this.isValid})),e.requiredFieldsPresent}},{key:"populateFormContent",value:function(){if(this._formFieldsBuilt){var e=this.model;for(var t in this.fields){if(this.fields.hasOwnProperty(t))this.fields[t].value=e.attributes[t]}this.conditionallyValidateForm()}}},{key:"formElement",get:function(){var e,t=this;E(this,Io)||(_(this,Io,document.createElement("form")),E(this,Io).id=this._formId="form".concat((C(r,r,Mo,1+(e=+w(r,r,Mo))),e)),E(this,Io).noValidate=!0,this.liveValidation&&(E(this,Io).className="needs-validation"),this.buildContentContainer(E(this,Io)),E(this,Io).addEventListener("change",(function(e){t.changeHandler(e)}),{capture:!1}));return E(this,Io)}}],[{key:"nextId",get:function(){var e;return"id".concat((C(r,r,Ho,1+(e=+w(r,r,Ho))),e))}}]),r}(),Io=new WeakMap;o(Lo,"CHANGE_EVENT","change");var Mo={writable:!0,value:0};o(Lo,"EVENT_VALIDATION_STATE_CHANGE","validationstatechange");var Ho={writable:!0,value:0};o(Lo,"COMPLETION_STATUS_UNSTARTED","unstarted"),o(Lo,"COMPLETION_STATUS_COMPLETE","complete"),o(Lo,"COMPLETION_STATUS_IN_PROGRESS","inProgress");var Ro=function(e){c(r,vo);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"attributes",{}),o(v(e),"_savedRemotely",!1),o(v(e),"_savedLocally",!1),o(v(e),"SAVE_ENDPOINT","/saveoccurrence.php"),o(v(e),"TYPE","occurrence"),o(v(e),"isNew",!1),e}return a(r,[{key:"setForm",value:function(e){return this.isNew||(e.liveValidation=!0),e.addListener(Lo.CHANGE_EVENT,this.formChangedHandler.bind(this)),e}},{key:"formChangedHandler",value:function(e){console.log("Occurrence change handler invoked."),e.form.updateModelFromContent(),e.form.conditionallyValidateForm(),this.touch(),this.fireEvent(r.EVENT_MODIFIED,{occurrenceId:this.id})}},{key:"delete",value:function(){this.deleted||(this.touch(),this.deleted=!0,this.fireEvent(r.EVENT_MODIFIED,{occurrenceId:this.id}))}},{key:"save",value:function(e){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var t=new FormData;return!e&&this.surveyId&&(e=this.surveyId),t.append("type",this.TYPE),t.append("surveyId",e),t.append("occurrenceId",this.id),t.append("id",this.id),t.append("projectId",this.projectId.toString()),t.append("attributes",JSON.stringify(this.attributes)),t.append("deleted",this.deleted.toString()),t.append("created",this.createdStamp.toString()),console.log("queueing occurrence post"),this.queuePost(t)}},{key:"_parseDescriptor",value:function(e){N(l(r.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId}},{key:"taxon",get:function(){return this.attributes.taxon&&this.attributes.taxon.taxonId?No.fromId(this.attributes.taxon.taxonId):null}}]),r}();o(Ro,"EVENT_MODIFIED","modified");var xo=function(e){c(r,f(Error));var t=p(r);function r(){return n(this,r),t.apply(this,arguments)}return r}(),ko=function(e){c(r,L);var t=p(r);function r(e){var a;return n(this,r),o(v(a=t.call(this)),"route","/list/:action/:id"),o(v(a),"title","App homepage"),o(v(a),"app",void 0),o(v(a),"view",void 0),Po.set(v(a),{writable:!0,value:""}),o(v(a),"needsFullRefresh",!0),o(v(a),"needRightPanelRefresh",!0),o(v(a),"viewSubcontext",""),o(v(a),"surveySection",void 0),o(v(a),"leftPanelBaseRoute",""),o(v(a),"viewContexts",{record:function(e){this.surveySection=null,e?E(this,Po)!==e.id?(this.needRightPanelRefresh=!0,this.currentOccurrenceId=e.id?e.id:""):this.needRightPanelRefresh=!1:(this.currentOccurrenceId="",this.needRightPanelRefresh=!0),this.leftPanelBaseRoute="/list/record"},survey:function(e){console.log("in survey section ".concat(e.section)),this.currentOccurrenceId="",this.needRightPanelRefresh=!0,this.surveySection=e.section,this.leftPanelBaseRoute="/list/survey/".concat(e.section)}}),a.view=e,e.controller=v(a),a.handle=L.nextHandle,e.addListener(r.EVENT_SELECT_OCCURRENCE,a.occurrenceSelectionHandler.bind(v(a))),e.addListener(r.EVENT_SELECT_SURVEY_SECTION,a.surveyPartSelectionHandler.bind(v(a))),e.addListener(r.EVENT_NEW_RECORD,a.newRecordHandler.bind(v(a))),e.addListener(r.EVENT_DELETE_OCCURRENCE,a.deleteOccurrenceHandler.bind(v(a))),e.addListener(r.EVENT_BACK,a.backHandler.bind(v(a))),e.addListener(r.EVENT_NEXT_TO_RECORDS,a.nextTransitionToRecordsHandler.bind(v(a))),a}return a(r,[{key:"occurrences",get:function(){return this.app.occurrences}},{key:"currentOccurrence",get:function(){if(E(this,Po)){if(this.app.occurrences.has(E(this,Po)))return this.app.occurrences.get(E(this,Po));throw new er("Record id '".concat(E(this,Po),"' was not found."))}return null}},{key:"currentOccurrenceId",get:function(){return E(this,Po)},set:function(e){_(this,Po,e)}},{key:"survey",get:function(){return this.app.currentSurvey}}]),a(r,[{key:"nextTransitionToRecordsHandler",value:function(){console.log("in nextTransitionToRecordsHandler()"),this.app.haveExtantOccurrences()?this.app.router.navigate("/list/record/"):this.newRecordHandler()}},{key:"deleteOccurrenceHandler",value:function(e){console.log({deleting:e.occurrenceId});var t=this.app.occurrences.get(e.occurrenceId);if(!t)throw new xo("Occurrence id '".concat(e.occurrenceId,"' not found when trying to delete."));t.delete(),this.currentOccurrenceId===e.occurrenceId&&this.app.router.navigate("/list/record/")}},{key:"surveyPartSelectionHandler",value:function(e){console.log({"In surveyPartSelectionHandler":e}),"record"===e.sectionKey?this.app.router.navigate("/list/record/"):e.sectionKey?this.app.router.navigate("/list/survey/".concat(e.sectionKey)):this.app.router.navigate("/list/")}},{key:"newRecordHandler",value:function(){var e=this.app.addNewOccurrence();this.app.router.navigate("/list/record/".concat(e.id))}},{key:"occurrenceSelectionHandler",value:function(e){console.log({"In occurrenceSelectionHandler":e}),this.currentOccurrenceId&&e.occurrenceId&&this.currentOccurrenceId===e.occurrenceId?console.log("ignoring spurious navigation event for '".concat(e.occurrenceId,"'")):this.app.router.navigate("/list/record/".concat(e.occurrenceId))}},{key:"registerRoute",value:function(e){e.on("/list",this.mainRouteHandler.bind(this,"list","",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/help",this.mainRouteHandler.bind(this,"list","","help")),e.on("/list/record/",this.mainRouteHandler.bind(this,"list","record",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/record/help",this.mainRouteHandler.bind(this,"list","record","help")),e.on("/list/record/:id",this.mainRouteHandler.bind(this,"list","record","form"),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section",this.mainRouteHandler.bind(this,"list","survey",""),{before:this.beforeRouteHandler?this.beforeRouteHandler.bind(this):null,after:this.afterRouteHandler?this.afterRouteHandler.bind(this):null,leave:this.leaveRouteHandler?this.leaveRouteHandler.bind(this):null,already:this.alreadyRouteHandler?this.alreadyRouteHandler.bind(this):null}),e.on("/list/survey/:section/help",this.mainRouteHandler.bind(this,"list","survey","help"))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for MainController.js"),console.log({context:e,params:t,query:r}),this.app.saveRoute();try{this.viewSubcontext=t,t&&this.viewContexts[t].call(this,r),this.app.currentControllerHandle!==this.handle&&(this.needsFullRefresh=!0,this.needRightPanelRefresh=!0,this.app.currentControllerHandle=this.handle),this.view.panelKey=n,this.view.display(),this.needsFullRefresh=!1}catch(e){this.error=e,console.log({error:e});try{this.needsFullRefresh=!0,this.view.display()}catch(e){console.log({rethrownError:e}),document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}}}},{key:"backHandler",value:function(){this.app.routeHistory.length>=2&&this.app.routeHistory[this.app.routeHistory.length-2].url===this.leftPanelBaseRoute?(this.app.routeHistory.length-=1,console.log("using standard back navigation"),window.history.back()):(console.log("navigating back using base address '".concat(this.leftPanelBaseRoute,"'")),this.app.router.navigate(this.leftPanelBaseRoute))}}]),r}(),Po=new WeakMap;o(ko,"EVENT_SELECT_OCCURRENCE","selectoccurrence"),o(ko,"EVENT_SELECT_SURVEY_SECTION","selectsurveysection"),o(ko,"EVENT_NEW_RECORD","newrecord"),o(ko,"EVENT_DELETE_OCCURRENCE","deleteoccurrence"),o(ko,"EVENT_BACK","back"),o(ko,"EVENT_NEXT_TO_RECORDS","nexttorecords");var Ao=function(e){c(r,L);var t=p(r);function r(e,a){var i;return n(this,r),o(v(i=t.call(this)),"route",void 0),i.view=e,i.route=a,i.handle=L.nextHandle,i}return a(r,[{key:"routeHandler",value:function(e,t){this.app.currentControllerHandle=this.handle,this.view.display()}}]),r}();za("match",1,(function(e,t,n){return[function(t){var n=P(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var a=W(e),o=String(this);if(!a.global)return no(a,o);var i=a.unicode;a.lastIndex=0;for(var s,c=[],l=0;null!==(s=no(a,o));){var u=String(s[0]);c[l]=u,""===u&&(a.lastIndex=to(o,ge(a.lastIndex),i)),l++}return 0===l?null:c}]}));var Do=function(e,t){var n=[][e];return!!n&&M((function(){n.call(null,t||function(){throw 1},1)}))},Fo=[].join,Uo=k!=Object,Jo=Do("join",",");It({target:"Array",proto:!0,forced:Uo||!Jo},{join:function(e){return Fo.call(A(this),void 0===e?",":e)}});var Yo=Object.defineProperty,jo={},Ko=function(e){throw e},Vo=function(e,t){if(ie(jo,e))return jo[e];t||(t={});var n=[][e],r=!!ie(t,"ACCESSORS")&&t.ACCESSORS,a=ie(t,0)?t[0]:Ko,o=ie(t,1)?t[1]:void 0;return jo[e]=!!n&&!M((function(){if(r&&!K)return!0;var e={length:-1};r?Yo(e,1,{enumerable:!0,get:Ko}):e[1]=1,n.call(e,a,o)}))},Xo=we.includes,Go=Vo("indexOf",{ACCESSORS:!0,1:0});It({target:"Array",proto:!0,forced:!Go},{includes:function(e){return Xo(this,e,arguments.length>1?arguments[1]:void 0)}}),Xe("includes");var Bo=z.f,Qo=hn.fastKey,Wo=lt.set,qo=lt.getterFor,Zo=(On("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(e,t,n,r){var a=e((function(e,o){gn(e,a,t),Wo(e,{type:t,index:je(null),first:void 0,last:void 0,size:0}),K||(e.size=0),null!=o&&yn(o,e[r],e,n)})),o=qo(t),i=function(e,t,n){var r,a,i=o(e),c=s(e,t);return c?c.value=n:(i.last=c={index:a=Qo(t,!0),key:t,value:n,previous:r=i.last,next:void 0,removed:!1},i.first||(i.first=c),r&&(r.next=c),K?i.size++:e.size++,"F"!==a&&(i.index[a]=c)),e},s=function(e,t){var n,r=o(e),a=Qo(t);if("F"!==a)return r.index[a];for(n=r.first;n;n=n.next)if(n.key==t)return n};return un(a.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,K?e.size=0:this.size=0},delete:function(e){var t=o(this),n=s(this,e);if(n){var r=n.next,a=n.previous;delete t.index[n.index],n.removed=!0,a&&(a.next=r),r&&(r.previous=a),t.first==n&&(t.first=r),t.last==n&&(t.last=a),K?t.size--:this.size--}return!!n},forEach:function(e){for(var t,n=o(this),r=pn(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!s(this,e)}}),un(a.prototype,n?{get:function(e){var t=s(this,e);return t&&t.value},set:function(e,t){return i(this,0===e?0:e,t)}}:{add:function(e){return i(this,e=0===e?0:e,e)}}),K&&Bo(a.prototype,"size",{get:function(){return o(this).size}}),a},setStrong:function(e,t,n){var r=t+" Iterator",a=qo(t),o=qo(r);Qt(e,t,(function(e,t){Wo(this,{type:r,target:e,state:a(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),mr(t)}}),Se("match")),$o=function(e){var t;return V(e)&&(void 0!==(t=e[Zo])?!!t:"RegExp"==R(e))},zo=function(e){if($o(e))throw TypeError("The method doesn't accept regular expressions");return e},ei=Se("match");It({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[ei]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~String(P(this)).indexOf(zo(e),arguments.length>1?arguments[1]:void 0)}});var ti=[].push,ni=Math.min,ri=!M((function(){return!RegExp(4294967295,"y")}));za("split",2,(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(P(this)),a=void 0===n?4294967295:n>>>0;if(0===a)return[];if(void 0===e)return[r];if(!$o(e))return t.call(r,e,a);for(var o,i,s,c=[],l=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),u=0,d=new RegExp(e.source,l+"g");(o=Ga.call(d,r))&&!((i=d.lastIndex)>u&&(c.push(r.slice(u,o.index)),o.length>1&&o.index<r.length&&ti.apply(c,o.slice(1)),s=o[0].length,u=i,c.length>=a));)d.lastIndex===o.index&&d.lastIndex++;return u===r.length?!s&&d.test("")||c.push(""):c.push(r.slice(u)),c.length>a?c.slice(0,a):c}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var a=P(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,a,n):r.call(String(a),t,n)},function(e,a){var o=n(r,e,this,a,r!==t);if(o.done)return o.value;var i=W(e),s=String(this),c=gr(i,RegExp),l=i.unicode,u=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(ri?"y":"g"),d=new c(ri?i:"^(?:"+i.source+")",u),h=void 0===a?4294967295:a>>>0;if(0===h)return[];if(0===s.length)return null===no(d,s)?[s]:[];for(var f=0,v=0,S=[];v<s.length;){d.lastIndex=ri?v:0;var p,N=no(d,ri?s:s.slice(v));if(null===N||(p=ni(ge(d.lastIndex+(ri?0:v)),s.length))===f)v=to(s,v,l);else{if(S.push(s.slice(f,v)),S.length===h)return S;for(var m=1;m<=N.length-1;m++)if(S.push(N[m]),S.length===h)return S;v=f=p}}return S.push(s.slice(f)),S}]}),!ri);var ai=function(e){c(r,co);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"controller",void 0),e}return a(r,[{key:"initialise",value:function(){}},{key:"display",value:function(){console.log("got to view display"),this.refreshHeader(),this.body()}},{key:"refreshHeader",value:function(){}},{key:"body",value:function(){}},{key:"card",value:function(e){var t=document.createElement("div");t.id=e.cardId,t.className="card";var n=t.appendChild(document.createElement("div"));n.className="card-header pointer",e.cardHeadingId&&(n.id=e.cardHeadingId),n.setAttribute("data-toggle","collapse"),n.setAttribute("data-target","#".concat(e.cardDescriptionId));var r=n.appendChild(document.createElement("h2"));r.className="mb-0";var a=r.appendChild(document.createElement("button"));if(a.className="btn btn-link".concat(e.collapsed?" collapsed":""),e.headingButtonId&&(a.id=e.headingButtonId),a.type="button",a.setAttribute("data-toggle","collapse"),e.buttonStyleString&&(a.style.cssText=e.buttonStyleString),e.cardDescriptionId&&(a.setAttribute("data-target","#".concat(e.cardDescriptionId)),a.setAttribute("aria-controls",e.cardDescriptionId)),a.setAttribute("aria-expanded",e.collapsed?"false":"true"),a.innerHTML=e.headingHTML,e.headingNonbuttonHTML){var o=r.appendChild(document.createElement("span"));o.style.display="inline-block",o.innerHTML=e.headingNonbuttonHTML}if(e.headingValidationWarningHTML){var i=n.appendChild(document.createElement("div"));i.className="card-invalid-feedback",i.innerHTML="<small>".concat(e.headingValidationWarningHTML,"</small>")}var s=t.appendChild(document.createElement("div"));if(e.cardDescriptionId&&(s.id=e.cardDescriptionId),s.className="collapse".concat(e.collapsed?"":" show"),e.cardHeadingId&&s.setAttribute("aria-labelledby",e.cardHeadingId),s.setAttribute("data-parent","#".concat(e.parentContainerId)),e.dataAttributes)for(var c in e.dataAttributes)e.dataAttributes.hasOwnProperty(c)&&s.setAttribute("data-".concat(c),e.dataAttributes[c]);var l=s.appendChild(document.createElement("div"));return l.className="card-body pl-2 pr-2 pl-md-3 pr-md-3",l.appendChild(e.bodyContentElement),t}}]),r}(),oi=function(e){c(r,ai);var t=p(r);function r(){return n(this,r),t.apply(this,arguments)}return a(r,[{key:"body",value:function(){document.getElementById("body").innerHTML='<h2>Page not found</h2><p><a href="/app/list">Return to the homepage.</a>'}}]),r}(),ii=function(e){c(r,Lo);var t=p(r);function r(e){var a;return n(this,r),o(v(a=t.call(this)),"_survey",void 0),o(v(a),"section",void 0),a.section=e,a}return a(r,[{key:"updateModelFromContent",value:function(){for(var e in console.log("updating survey from SurveyForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];this._survey.attributes[e]=t.value}console.log({survey:this._survey})}},{key:"changeHandler",value:function(e){console.log("survey form change event"),console.log({event:e}),this.fireEvent(Lo.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){N(l(r.prototype),"destructor",this).call(this),this._survey=null}},{key:"initialiseFormFields",value:function(){var e=this.section.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"getFormSectionProperties",value:function(){return this.section.properties}},{key:"formElement",get:function(){var e=N(l(r.prototype),"formElement",this);return this._formFieldsBuilt||this.buildFormFields(),e}},{key:"model",set:function(e){this._survey=e,this.populateFormContent()},get:function(){return this._survey}}],[{key:"registerSection",value:function(e){r.sections[e.sectionSortOrder]=e,r.sectionsByKey[e.sectionNavigationKey]=e}}]),r}();o(ii,"sections",[]),o(ii,"sectionsByKey",{});var si=function(e){c(r,vo);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"SAVE_ENDPOINT","/savesurvey.php"),o(v(e),"TYPE","survey"),o(v(e),"attributes",{}),e}return a(r,[{key:"formChangedHandler",value:function(e){console.log("Survey change handler invoked."),e.form.updateModelFromContent(),e.form.conditionallyValidateForm(),this.touch(),this.fireEvent(r.EVENT_MODIFIED,{surveyId:this.id})}},{key:"registerForm",value:function(e){e.model=this,e.addListener(Lo.CHANGE_EVENT,this.formChangedHandler.bind(this))}},{key:"save",value:function(){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var e=new FormData;return e.append("type",this.TYPE),e.append("surveyId",this.id),e.append("id",this.id),e.append("projectId",this.projectId.toString()),e.append("attributes",JSON.stringify(this.attributes)),e.append("deleted",this.deleted.toString()),e.append("created",this.createdStamp.toString()),console.log("queueing survey post"),this.queuePost(e)}},{key:"generateSurveyName",value:function(){var e,t=(this.attributes.place||this.attributes.georef||"(unlocalised)").trim(),n=new Date(1e3*this.createdStamp);try{e=n.toLocaleString("default",{year:"numeric",month:"long",day:"numeric"})}catch(t){e=n.toLocaleString("en-GB",{year:"numeric",month:"long",day:"numeric"})}return"".concat(po(t)," ").concat(e)}}]),r}();o(si,"EVENT_MODIFIED","modified");var ci=function(e){c(r,vo);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"file",void 0),o(v(e),"TYPE","image"),o(v(e),"SAVE_ENDPOINT","/saveimage.php"),e}return a(r,[{key:"getUrl",value:function(){}},{key:"save",value:function(e,t,n){if(this._savedRemotely)return Promise.reject("".concat(this.id," has already been saved."));var r=new FormData;return r.append("type",this.TYPE),r.append("surveyId",e||""),r.append("occurrenceId",t||this.occurrenceId),r.append("projectId",n?n.toString():""),r.append("imageId",this.id),r.append("id",this.id),r.append("image",this.file),r.append("deleted",this.deleted.toString()),console.log("queueing image post, image id ".concat(this.id)),this.queuePost(r)}},{key:"_parseDescriptor",value:function(e){N(l(r.prototype),"_parseDescriptor",this).call(this,e),this.surveyId=e.surveyId,this.occurrenceId=e.occurrenceId,this.file=e.image}}],[{key:"fromFile",value:function(e){var t=new r;return t.file=e,t}},{key:"placeholder",value:function(e){var t=new r;return t._id=e,r.imageCache.set(e,t),t}},{key:"imageLink",value:function(e,t,n,r){t=t||0,n=n||0;var a="";r.className&&(a+=' class="'.concat(r.className,'"'));var o=t>n?'width="'.concat(t,'"'):'height="'.concat(n,'"');return'<picture><source srcset="/image.php?imageid='.concat(e,'&amp;height=128&amp;format=webp" type="image/webp"><img').concat(a,' src="/image.php?imageid=').concat(e,"&amp;width=").concat(t,"&amp;height=").concat(n,'&amp;format=jpeg" ').concat(o,' alt="photo"></picture>')}}]),r}();o(ci,"imageCache",new Map),o(ci,"EVENT_MODIFIED","modified");var li=function(e){c(r,co);var t=p(r);function r(){var e;return n(this,r),e=t.call(this),ui.set(v(e),{writable:!0,value:void 0}),di.set(v(e),{writable:!0,value:void 0}),o(v(e),"controllers",[]),o(v(e),"currentControllerHandle",!1),o(v(e),"routeHistory",[]),o(v(e),"occurrences",void 0),o(v(e),"surveys",void 0),o(v(e),"currentSurvey",void 0),o(v(e),"layout",void 0),e.reset(),e}return a(r,[{key:"reset",value:function(){this.surveys=new Map,this.clearCurrentSurvey()}},{key:"clearCurrentSurvey",value:function(){this.occurrences=new Map,this.currentSurvey=null}},{key:"registerController",value:function(e){e.handle=this.controllers.length,this.controllers[this.controllers.length]=e,e.app=this,e.registerRoute(E(this,ui))}},{key:"initialise",value:function(){var e=this;this.layout.initialise(),E(this,ui).notFound((function(e){console.log("no route found for '".concat(e,"'")),(new oi).display()})),E(this,ui).on((function(){console.log("redirecting from '/' to '/list'"),E(e,ui).pause(),e.currentSurvey&&e.currentSurvey.isPristine?E(e,ui).navigate("/list/survey/welcome").resume():E(e,ui).navigate("/list").resume(),E(e,ui).resolve()}));var t,n=b(this.controllers);try{for(n.s();!(t=n.n()).done;){t.value.initialise()}}catch(e){n.e(e)}finally{n.f()}}},{key:"display",value:function(){console.log("App display"),E(this,ui).resolve()}},{key:"saveRoute",value:function(){var e=E(this,ui).lastRouteResolved();this.routeHistory.length?this.routeHistory[this.routeHistory.length-1]!==e&&(this.routeHistory[this.routeHistory.length]=e):this.routeHistory[0]=e}},{key:"markAllNotPristine",value:function(){var e,t=b(this.occurrences);try{for(t.s();!(e=t.n()).done;){e.value[1].isPristine=!1}}catch(e){t.e(e)}finally{t.f()}}},{key:"setLayout",value:function(e){this.layout=e,e.setApp(this)}},{key:"addSurvey",value:function(e){var t=this;if(e.projectId!==this.projectId)throw new Error("Survey project id '".concat(e.projectId," does not match with current project ('").concat(this.projectId,"')"));this.surveys.has(e.id)||(console.log("setting survey's modified/save handler"),e.addListener(si.EVENT_MODIFIED,(function(){return t.fireEvent(r.EVENT_SURVEYS_CHANGED),e.save()}))),this.surveys.set(e.id,e),this.fireEvent(r.EVENT_SURVEYS_CHANGED)}},{key:"haveExtantOccurrences",value:function(){var e,t=b(this.occurrences);try{for(t.s();!(e=t.n()).done;){if(!e.value.deleted)return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"addOccurrence",value:function(e){var t=this;if(!e.surveyId)throw new xo("Survey id must set prior to registering occurrence.");0===this.occurrences.size&&(this.surveys.get(e.surveyId).createdStamp=e.createdStamp);console.log("in addOccurrence setting id '".concat(e.id,"'")),this.occurrences.set(e.id,e),e.addListener(Ro.EVENT_MODIFIED,(function(){var n=t.surveys.get(e.surveyId);if(!n)throw new Error("Failed to look up survey id ".concat(e.surveyId));n.isPristine=!1,n.unsaved()&&n.save(),e.save(n.id)}))}},{key:"refreshFromServer",value:function(e){var t,n=this,r=new FormData,a=0,o=b(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;r.append("surveyId[".concat(a++,"]"),i)}}catch(e){o.e(e)}finally{o.f()}return fetch(ExampleApp.LOAD_SURVEYS_ENDPOINT,{method:"POST",body:r}).then((function(e){return e.ok?e.json():Promise.reject("Invalid response from server when refreshing survey ids")})).then((function(e){console.log({"refresh from server json response":e});var t=[];for(var r in e)if(e.hasOwnProperty(r)){var a,o=b(e[r]);try{for(o.s();!(a=o.n()).done;){var i=a.value;t.push(n._conditionallyReplaceObject(i))}}catch(e){o.e(e)}finally{o.f()}}return Promise.all(t)}))}},{key:"_conditionallyReplaceObject",value:function(e){var t=e.type,n=e.id,r="".concat(t,".").concat(n);return uo.getItem(r).then((function(t){return t&&!e.deleted&&t.modified>=e.modified?(console.log("Local copy of ".concat(r," is the same or newer than the server copy. (").concat(t.modified," >= ").concat(e.modified,") ")),Promise.resolve()):(console.log("Adding or replacing local copy of ".concat(r)),uo.setItem(r,e))}))}},{key:"seekKeys",value:function(e){return uo.keys().then((function(t){var n,r=b(t);try{for(r.s();!(n=r.n()).done;){var a,o,i=n.value,s=m(i.split(".",2),2);a=s[0],o=s[1],e.hasOwnProperty(a)?e[a].includes(o)||e[a].push(o):console.log("Unrecognised stored key type '".concat(a,"."))}}catch(e){r.e(e)}finally{r.f()}return e}))}},{key:"syncAll",value:function(){var e=this;return this.seekKeys({survey:[],occurrence:[],image:[]}).then((function(t){return e._syncLocalUnsaved(t)}),(function(e){return console.log("Failed to sync all: ".concat(e)),!1}))}},{key:"_syncLocalUnsaved",value:function(e){var t,n=[],r=b(e.survey);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(si.retrieveFromLocal(a,new si).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){r.e(e)}finally{r.f()}var o,i=b(e.occurrence);try{for(i.s();!(o=i.n()).done;){var s=o.value;n.push(Ro.retrieveFromLocal(s,new Ro).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){i.e(e)}finally{i.f()}var c,l=b(e.image);try{for(l.s();!(c=l.n()).done;){var u=c.value;n.push(ci.retrieveFromLocal(u,new ci).then((function(e){if(e.unsaved())return e.save()})))}}catch(e){l.e(e)}finally{l.f()}return Promise.all(n).catch((function(e){console.log("Save failure: ".concat(e))}))}},{key:"restoreOccurrences",value:function(e){var t=this;if(this.surveys.has(e)){var n=this.surveys.get(e);if(n.isPristine)return this.clearCurrentSurvey(),this.currentSurvey=n,this.fireEvent(r.EVENT_SURVEYS_CHANGED),Promise.resolve()}var a={survey:[],occurrence:[],image:[]};return e&&(a.survey[0]=e),console.log("pre-seek keys"),console.log(a),this.seekKeys(a).then((function(e){return e.survey.length?t.refreshFromServer(e.survey).finally((function(){return t.seekKeys(e)})):null})).finally((function(){return a.survey.length?t._restoreSurveyFromLocal(a.survey[0],a).finally((function(){return t.currentSurvey=t.surveys.get(a.survey[0]),t.currentSurvey?(t.currentSurvey.deleted?t.setNewSurvey():t.fireEvent(r.EVENT_SURVEYS_CHANGED),Promise.resolve()):(console.log("Failed to retrieve survey id '".concat(e,"'")),Promise.reject(new Error("Failed to retrieve survey id '".concat(e,"'"))))})):(t.setNewSurvey(),Promise.resolve())}))}},{key:"setNewSurvey",value:function(){this.currentSurvey=new si,this.currentSurvey.projectId=this.projectId,this.currentSurvey.isPristine=!0,this.addSurvey(this.currentSurvey)}},{key:"addNewOccurrence",value:function(){var e=new Ro;return e.surveyId=this.currentSurvey.id,e.projectId=this.projectId,e.isNew=!0,e.isPristine=!0,this.addOccurrence(e),this.fireEvent(ExampleApp.EVENT_OCCURRENCE_ADDED,{occurrenceId:e.id,surveyId:e.surveyId}),e}},{key:"_restoreSurveyFromLocal",value:function(e,t){var n=this;return si.retrieveFromLocal(e,new si).then((function(r){n.clearCurrentSurvey(),n.addSurvey(r);var a,o=[],i=b(t.occurrence);try{var s=function(){var t=a.value;o.push(Ro.retrieveFromLocal(t,new Ro).then((function(r){r.surveyId===e&&(console.log("adding occurrence ".concat(t)),n.addOccurrence(r))})))};for(i.s();!(a=i.n()).done;)s()}catch(e){i.e(e)}finally{i.f()}return Promise.all(o)})).finally((function(){var n,r=[],a=b(t.image);try{var o=function(){var t=n.value;r.push(ci.retrieveFromLocal(t,new ci).then((function(n){console.log("restoring image id '".concat(t,"'")),n.surveyId===e&&ci.imageCache.set(t,n)}),(function(e){console.log("Failed to retrieve an image: ".concat(e))})))};for(a.s();!(n=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return Promise.all(r)}))}},{key:"clearLocalForage",value:function(){return uo.clear()}},{key:"router",set:function(e){_(this,ui,e)},get:function(){return E(this,ui)}},{key:"containerId",set:function(e){var t=document.getElementById(e);if(!t)throw new Error("App container '".concat(e,"' not found."));_(this,di,t)}},{key:"container",get:function(){return E(this,di)}}]),r}(),ui=new WeakMap,di=new WeakMap;o(li,"EVENT_ADD_SURVEY_USER_REQUEST","useraddsurveyrequest"),o(li,"EVENT_RESET_SURVEYS","userresetsurveys"),o(li,"LOAD_SURVEYS_ENDPOINT","/loadsurveys.php"),o(li,"EVENT_OCCURRENCE_ADDED","occurrenceadded"),o(li,"EVENT_SURVEYS_CHANGED","surveyschanged"),o(li,"devMode",!1);var hi=function(e){c(r,co);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"app",void 0),o(v(e),"surveysMenuId",void 0),e}return a(r,[{key:"setApp",value:function(e){var t=this;this.app=e,e.addListener(li.EVENT_SURVEYS_CHANGED,(function(){t.refreshSurveysMenu()}))}},{key:"initialise",value:function(){var e=this;this.refreshSurveysMenu();var t=document.createElement("div");t.innerHTML='\x3c!-- begin: templates/newSurveyModal.html --\x3e\r\n<div class="modal fade" id="newsurveymodal" tabindex="-1" role="dialog" aria-labelledby="newsurveymodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="newsurveymodalTitle">Start a new survey?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to start a new survey. You only need to do this if you wish to send a set of records from a different locality, otherwise please add more records to your current report.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="newsurveymodalconfirmed">New survey</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/newSurveyModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/resetModal.html --\x3e\r\n<div class="modal fade" id="resetmodal" tabindex="-1" role="dialog" aria-labelledby="resetmodalTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="resetmodalTitle">Reset?</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please confirm that you wish to clear out your survey data.\r\n                <p>Warning: any unsaved changes will be lost.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\r\n                <button type="button" class="btn btn-danger" data-dismiss="modal" id="resetmodalconfirmed">Reset</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/resetModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncSuccessModal.html --\x3e\r\n<div class="modal fade" id="saveallsuccess" tabindex="-1" role="dialog" aria-labelledby="saveallsuccessTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallsuccessTitle">All records sent</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Your data has been synchronised with the server.\r\n                <p>Thank you.</p>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncSuccessModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),(t=document.createElement("div")).innerHTML='\x3c!-- begin: templates/syncFailureModal.html --\x3e\r\n<div class="modal fade" id="saveallfailure" tabindex="-1" role="dialog" aria-labelledby="saveallfailureTitle" aria-hidden="true">\r\n    <div class="modal-dialog modal-dialog-centered" role="document">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <h5 class="modal-title" id="saveallfailureTitle">One or more records could not be saved</h5>\r\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close">\r\n                    <span aria-hidden="true">&times;</span>\r\n                </button>\r\n            </div>\r\n            <div class="modal-body">\r\n                Please check your connection to the network and try again.\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\x3c!-- end: templates/syncFailureModal.html --\x3e\r\n',document.body.appendChild(t.getElementsByTagName("div")[0]),setTimeout((function(){document.getElementById("".concat(r.NEW_SURVEY_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(li.EVENT_ADD_SURVEY_USER_REQUEST)})),document.getElementById("".concat(r.RESET_MODAL_ID,"confirmed")).addEventListener("click",(function(t){e.app.fireEvent(li.EVENT_RESET_SURVEYS)}))}),100)}},{key:"refreshSurveysMenu",value:function(){var e,t=document.getElementById(this.surveysMenuId),n=[],r=this.app.currentSurvey?this.app.currentSurvey.id:null,a=b(this.app.surveys);try{for(a.s();!(e=a.n()).done;){var o=e.value,i=o[1].generateSurveyName()+(o[0]===r?' <span style="color: green">â</span>':"");n[n.length]='<a class="dropdown-item" href="/app/survey/add/'.concat(o[0],'" data-navigo="survey/add/').concat(o[0],'">').concat(i,"</a>")}}catch(e){a.e(e)}finally{a.f()}t.innerHTML='<a class="dropdown-item" href="/app/survey/save" data-navigo="survey/save">save all</a>\n    <div class="dropdown-divider"></div>\n    '.concat(n.join(""),'\n    <div class="dropdown-divider"></div>\n    <a class="dropdown-item" href="/app/survey/new" data-navigo="survey/new">new survey</a>\n    <a class="dropdown-item" href="/app/survey/reset" data-navigo="survey/reset">reset</a>'),this.app.router.updatePageLinks()}}]),r}();o(hi,"NEW_SURVEY_MODAL_ID","newsurveymodal"),o(hi,"RESET_MODAL_ID","resetmodal"),o(hi,"SAVE_ALL_SUCCESS_MODAL_ID","saveallsuccess"),o(hi,"SAVE_ALL_FAILURE_MODAL_ID","saveallfailure");var fi=function(e){c(r,L);var t=p(r);function r(e){var a;return n(this,r),o(v(a=t.call(this)),"route","/survey/:action/:id"),o(v(a),"title","Survey picker"),o(v(a),"app",void 0),o(v(a),"view",void 0),a.view=e,e.controller=v(a),a.handle=L.nextHandle,a}return a(r,[{key:"survey",get:function(){return this.app.currentSurvey}}]),a(r,[{key:"registerRoute",value:function(e){e.on("/survey",this.mainRouteHandler.bind(this,"survey","",""),{}),e.on("/survey/new",this.newSurveyHandler.bind(this,"survey","new",""),{before:this.beforeNewHandler.bind(this)}),e.on("/survey/reset",this.mainRouteHandler.bind(this,"survey","reset",""),{before:this.beforeResetHandler.bind(this)}),e.on("/survey/save",this.mainRouteHandler.bind(this,"survey","save",""),{before:this.beforeSaveAllHandler.bind(this)}),e.on("/survey/add/:surveyId",this.addSurveyHandler.bind(this,"survey","add","")),this.app.addListener(li.EVENT_ADD_SURVEY_USER_REQUEST,this.addNewSurveyHandler.bind(this)),this.app.addListener(li.EVENT_RESET_SURVEYS,this.resetSurveysHandler.bind(this))}},{key:"beforeNewHandler",value:function(e){$("#".concat(hi.NEW_SURVEY_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeResetHandler",value:function(e){$("#".concat(hi.RESET_MODAL_ID)).modal(),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"beforeSaveAllHandler",value:function(e){this.app.syncAll().then((function(e){console.log("In save all handler, success result: ".concat(e)),Array.isArray(e)?$("#".concat(hi.SAVE_ALL_SUCCESS_MODAL_ID)).modal():$("#".concat(hi.SAVE_ALL_FAILURE_MODAL_ID)).modal()}),(function(e){console.log("In save all handler, failure result: ".concat(e)),$("#".concat(hi.SAVE_ALL_FAILURE_MODAL_ID)).modal()})).finally((function(){})),this.app.router.pause(),window.history.back(),this.app.router.resume(),e(!1)}},{key:"newSurveyHandler",value:function(e,t,n,r){}},{key:"addNewSurveyHandler",value:function(){console.log("reached addNewSurveyHandler"),this.app.currentControllerHandle=this.handle,this.app.clearCurrentSurvey(),this.app.setNewSurvey(),this.app.router.pause(),this.app.router.navigate("/list/survey/welcome").resume(),this.app.router.resolve()}},{key:"resetSurveysHandler",value:function(){var e=this;this.app.clearLocalForage().then((function(){e.app.reset(),e.addNewSurveyHandler()}))}},{key:"addSurveyHandler",value:function(e,t,n,r){var a=this;console.log("reached addSurveyHandler"),console.log({context:e,params:t,query:r}),this.app.currentControllerHandle=this.handle;var o=r.surveyId;if(!o||!o.match(fo))throw new er("Failed to match survey id '".concat(o,"', the id format appears to be incorrect"));o=o.toLowerCase(),this.app.restoreOccurrences(o).then((function(){a.app.markAllNotPristine(),a.app.router.pause(),a.app.router.navigate("/list").resume(),a.app.router.resolve()}),(function(e){console.log({"failed survey restoration":e})}))}},{key:"mainRouteHandler",value:function(e,t,n,r){console.log("reached special route handler for SurveyPickerController.js"),console.log({context:e,params:t,query:r})}}]),r}();o(fi,"EVENT_BACK","back");var vi=xn.map,Si=cr("map"),pi=Vo("map");It({target:"Array",proto:!0,forced:!Si||!pi},{map:function(e){return vi(this,e,arguments.length>1?arguments[1]:void 0)}});var Ni=function(){function e(){n(this,e)}return a(e,null,[{key:"fromPostedData",value:function(t){var n,r={saveState:"SAVED_LOCALLY"},a=b(t.entries());try{for(a.s();!(n=a.n()).done;){var o=n.value;r[o[0]]=o[1]}}catch(e){a.e(e)}finally{a.f()}if(!r.type)throw new Error("Missing type in form data.");if(e.responses.hasOwnProperty(r.type))return new e.responses[r.type](r,{});throw new Error("Unrecognised post type '".concat(r.type,"'"))}},{key:"fromPostResponse",value:function(t){if(!t)throw new Error("Invalid empty post response.");if(!t.type)throw new Error("Missing type in returned response.");if(e.responses.hasOwnProperty(t.type))return console.log("in fromPostResponse returning a ".concat(t.type)),new e.responses[t.type]({},t);throw new Error("Unrecognised post type '".concat(t.type,"'"))}}]),e}();function mi(e){var t=new Headers;return t.set("Content-Type","application/json"),new Response(JSON.stringify(e),{status:e.error?500:200,headers:t})}o(Ni,"responses",{});var yi=function(){function e(t,r){n(this,e),o(this,"toSaveLocally",void 0),o(this,"returnedToClient",void 0),o(this,"prebuiltResponse",void 0),o(this,"failureErrorMessage","Failed to save a local copy on your device."),o(this,"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),this.toSaveLocally=t,this.returnedToClient=r}return a(e,[{key:"setPrebuiltResponse",value:function(e){return this.prebuiltResponse=e,this}},{key:"storeLocally",value:function(){var e=this;return uo.setItem(this.localKey(),this.toSaveLocally).then((function(){return console.log("Stored object ".concat(e.localKey()," locally")),e.prebuiltResponse?e.prebuiltResponse:mi(e.returnedToClient)}),(function(t){return console.log("Failed to store object ".concat(e.localKey()," locally")),console.log({reason:t}),e.returnedToClient.error=e.failureErrorMessage,e.returnedToClient.errorHelp=e.failureErrorHelp,mi(e.returnedToClient)}))}},{key:"localKey",value:function(){throw new Error("LocalKey must be implemented in a subclass for ".concat(this.toSaveLocally.type))}}]),e}(),gi=function(e){c(r,yi);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"failureErrorMessage","Failed to store image."),o(v(e),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),e}return a(r,[{key:"populateClientResponse",value:function(){return this.returnedToClient.id=this.toSaveLocally.imageId?this.toSaveLocally.imageId:this.toSaveLocally.id,this.returnedToClient.imageId=this.toSaveLocally.imageId?this.toSaveLocally.imageId:this.toSaveLocally.id,this.returnedToClient.type="image",this.returnedToClient.surveyId=this.toSaveLocally.surveyId,this.returnedToClient.occurrenceId=this.toSaveLocally.occurrenceId,this.returnedToClient.created=parseInt(this.toSaveLocally.created,10),this.returnedToClient.modified=parseInt(this.toSaveLocally.modified,10),this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=parseInt(this.toSaveLocally.projectId,10),this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.surveyId,this.toSaveLocally.type="image",this.toSaveLocally.occurrenceId=this.returnedToClient.occurrenceId,this.toSaveLocally.imageId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.imageId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.imageId,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=!0===this.returnedToClient.deleted||"true"===this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"image.".concat(this.toSaveLocally.imageId)}}],[{key:"register",value:function(){Ni.responses.image=r}}]),r}(),Ti=function(e){c(r,yi);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"failureErrorMessage","Failed to store survey."),o(v(e),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),e}return a(r,[{key:"populateClientResponse",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.returnedToClient.type="survey",this.returnedToClient.attributes=this.toSaveLocally.attributes,this.returnedToClient.created=this.toSaveLocally.created,this.returnedToClient.modified=this.toSaveLocally.modified,this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=this.toSaveLocally.projectId,this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.surveyId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.surveyId,this.toSaveLocally.type="survey",this.toSaveLocally.attributes=this.returnedToClient.attributes,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"survey.".concat(this.toSaveLocally.surveyId)}}],[{key:"register",value:function(){Ni.responses.survey=r}}]),r}(),bi=function(e){c(r,yi);var t=p(r);function r(){var e;n(this,r);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return o(v(e=t.call.apply(t,[this].concat(i))),"failureErrorMessage","Failed to store occurrence."),o(v(e),"failureErrorHelp","Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. Perhaps there is insufficient space? Please try to re-establish a network connection and try again."),e}return a(r,[{key:"populateClientResponse",value:function(){return this.returnedToClient.id=this.toSaveLocally.occurrenceId?this.toSaveLocally.occurrenceId:this.toSaveLocally.id,this.returnedToClient.occurrenceId=this.toSaveLocally.occurrenceId?this.toSaveLocally.occurrenceId:this.toSaveLocally.id,this.returnedToClient.type="occurrence",this.returnedToClient.surveyId=this.toSaveLocally.surveyId,this.returnedToClient.attributes=this.toSaveLocally.attributes,this.returnedToClient.created=parseInt(this.toSaveLocally.created,10),this.returnedToClient.modified=parseInt(this.toSaveLocally.modified,10),this.returnedToClient.saveState="SAVED_LOCALLY",this.returnedToClient.deleted=this.toSaveLocally.deleted,this.returnedToClient.projectId=parseInt(this.toSaveLocally.projectId,10),this}},{key:"populateLocalSave",value:function(){return this.toSaveLocally.occurrenceId=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.occurrenceId,this.toSaveLocally.id=this.returnedToClient.id?this.returnedToClient.id:this.returnedToClient.occurrenceId,this.toSaveLocally.type="occurrence",this.toSaveLocally.surveyId=this.returnedToClient.surveyId,this.toSaveLocally.attributes=this.returnedToClient.attributes,this.toSaveLocally.created=parseInt(this.returnedToClient.created,10),this.toSaveLocally.modified=parseInt(this.returnedToClient.modified,10),this.toSaveLocally.saveState="SAVED_TO_SERVER",this.toSaveLocally.deleted=!0===this.returnedToClient.deleted||"true"===this.returnedToClient.deleted,this.toSaveLocally.projectId=parseInt(this.returnedToClient.projectId,10),this}},{key:"localKey",value:function(){return"occurrence.".concat(this.toSaveLocally.occurrenceId)}}],[{key:"register",value:function(){Ni.responses.occurrence=r}}]),r}(),Ei=function(){function e(){n(this,e),o(this,"URL_CACHE_SET",void 0)}return a(e,[{key:"initialise",value:function(e){var t=this;Promise.prototype.finally||(Promise.prototype.finally=function(e){return this.then(e).catch(e)}),gi.register(),Ti.register(),bi.register(),this.CACHE_VERSION="version-1.0.2.1591826936-".concat(e.version);var n=e.postPassThroughWhitelist,r=e.postImageUrlMatch,a=e.getImageUrlMatch,o=e.interceptUrlMatches,i=e.ignoreUrlMatches,s=e.indexUrl;this.URL_CACHE_SET=e.urlCacheSet,uo.config({name:e.forageName}),self.addEventListener("install",(function(e){console.log("BSBI app service worker is being installed."),self.skipWaiting(),e.waitUntil(t.precache().then((function(){return self.skipWaiting()})))})),self.addEventListener("activate",(function(e){e.waitUntil(self.clients.matchAll({includeUncontrolled:!0}).then((function(e){var t=e.map((function(e){return e.url}));console.log("[ServiceWorker] Matching clients:",t.join(", "))})).then((function(){return caches.keys()})).then((function(e){return Promise.all(e.map((function(e){if(e!==t.CACHE_VERSION)return console.log("[ServiceWorker] Deleting old cache:",e),caches.delete(e)})))})).then((function(){return console.log("[ServiceWorker] Claiming clients for version",t.CACHE_VERSION),self.clients.claim()})))})),self.addEventListener("fetch",(function(e){if(console.log("The service worker is serving: '".concat(e.request.url,"'")),e.preventDefault(),"POST"===e.request.method)console.log("Got a post request"),e.request.url.match(n)?(console.log("Passing through whitelisted post request for: ".concat(e.request.url)),e.respondWith(fetch(e.request))):e.request.url.match(r)?t.handle_image_post(e):t.handle_post(e);else if(o.test(e.request.url)&&!i.test(e.request.url)){console.log("redirecting to the root of the SPA");var c=new Request(s);e.respondWith(t.fromCache(c)),e.waitUntil(t.update(c))}else e.request.url.match(a)?(console.log("request is for an image '".concat(e.request.url,"'")),t.handleImageFetch(e)):(console.log("request is for non-image '".concat(e.request.url,"'")),e.respondWith(t.fromCache(e.request)),e.waitUntil(t.update(e.request)))}))}},{key:"handle_post",value:function(e){var t;try{t=e.request.clone()}catch(e){console.log("Failed to clone request."),console.log({"Cloning error":e})}e.respondWith(fetch(e.request).then((function(e){return e.ok?Promise.resolve(e).then((function(e){return e.clone().json()})).then((function(t){return console.log("Following successful remote post about to save locally."),Ni.fromPostResponse(t).setPrebuiltResponse(e).populateLocalSave().storeLocally()})).catch((function(t){return console.log({error:t}),Promise.resolve(e)})):(console.log("Failed to save, moving on to attempt IndexedDb"),Promise.reject("Failed to save to server."))})).catch((function(e){return console.log("post fetch failed (probably no network), (reason: ".concat(e,")")),t.formData().then((function(e){return console.log("got to form data handler"),Ni.fromPostedData(e).populateClientResponse().storeLocally()}),(function(e){console.log("failed to read form data locally"),console.log({reason:e});return mi({error:"Failed to process posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})}))})))}},{key:"handle_image_post",value:function(e){var t;console.log("posting image");try{t=e.request.clone()}catch(e){console.log("Failed to clone request."),console.log({"Cloning error":e})}e.respondWith(t.formData().then((function(e){return console.log("got to form data handler"),Ni.fromPostedData(e).populateClientResponse().storeLocally()}),(function(e){console.log("failed to read form data locally"),console.log({reason:e});return mi({error:"Failed to process posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})}))),e.waitUntil(fetch(e.request).then((function(e){if(console.log("posted image to server in waitUntil part of fetch cycle"),e.ok)return console.log("posted image to server in waitUntil part of fetch cycle: got OK response"),Promise.resolve(e).then((function(e){return e.clone().json()})).then((function(t){return Ni.fromPostResponse(t).setPrebuiltResponse(e).populateLocalSave().storeLocally()})).catch((function(t){return console.log({error:t}),Promise.resolve(e)}));return mi({error:"Failed to save posted response data. (internal error)",errorHelp:"Your internet connection may have failed (or there could be a problem with the server). It wasn't possible to save a temporary copy on your device. (an unexpected error occurred) Please try to re-establish a network connection and try again."})})))}},{key:"precache",value:function(){var e=this;return caches.open(this.CACHE_VERSION).then((function(t){return t.addAll(e.URL_CACHE_SET)}))}},{key:"fromCache",value:function(e){var t=this;return console.log("attempting fromCache response"),caches.open(this.CACHE_VERSION).then((function(n){return console.log("cache is open"),n.match(e).then((function(n){return console.log(n?"cache matched ".concat(e.url):"no cache match for ".concat(e.url)),n||t.update(e)}))}))}},{key:"handleImageFetch",value:function(e){var t=this;e.respondWith(this.fromCache(e.request).then((function(n){if(console.log("In handleImageFetch promise"),n&&n.ok)return console.log("Responding with image from cache (or remotely if no cache)."),n;var r=e.request.url;console.log("Attempting image match for '".concat(r,"'"));var a=r.match(/imageid=([a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12})/);if(a){var o=a[1];return console.log("Returning image match for '".concat(r,"' from local database")),t.imageFromLocalDatabase(o)}console.log("Failed to match image id in url '".concat(r,"'"))})).catch((function(n){var r=e.request.url;console.log(n),console.log("caught ".concat(n)),console.log("In catch following failed network fetch, attempting image match for '".concat(r,"'"));var a=r.match(/imageid=([a-fA-F0-9]{8}-(?:[a-fA-F0-9]{4}-){3}[a-fA-F0-9]{12})/);if(a){var o=a[1];return console.log("(via catch) Returning image match for '".concat(r,"' from local database")),t.imageFromLocalDatabase(o)}console.log("(via catch) Failed to match image id in url '".concat(r,"'"))})))}},{key:"imageFromLocalDatabase",value:function(e){var t=new ci;return console.log("attempting retrieval of image data from local database"),vo.retrieveFromLocal(e,t).then((function(t){if(console.log("Retrieved image '".concat(e,"' from indexeddb.")),t.file)return(new Headers).append("Content-Type",t.file.type),new Response(t.file,{status:200,statusText:"OK image response from IndexedDb"});console.log("No local file object associated with retrieved image '".concat(e,"' from indexeddb."))}))}},{key:"update",value:function(e){return e=new Request(e,{mode:"cors",credentials:"omit"}),console.log("Attempting fetch and cache update of ".concat(e.url)),caches.open(this.CACHE_VERSION).then((function(t){return fetch(e,{cache:"no-cache"}).then((function(n){return n.ok?(console.log("(re-)caching ".concat(e.url)),t.put(e,n).then((function(){return t.match(e)}))):(console.log("Request during cache update failed for ".concat(e.url)),console.log({"failed cache response":n}),Promise.reject("Request during cache update failed, not caching."))})).catch((function(t){console.log("Cache attempt failed for ".concat(e.url,": error was ").concat(t))}))}))}}]),e}(),_i=xn.forEach,wi=Do("forEach"),Ci=Vo("forEach"),Oi=wi&&Ci?[].forEach:function(e){return _i(this,e,arguments.length>1?arguments[1]:void 0)};for(var Li in It({target:"Array",proto:!0,forced:[].forEach!=Oi},{forEach:Oi}),Vn){var Ii=j[Li],Mi=Ii&&Ii.prototype;if(Mi&&Mi.forEach!==Oi)try{te(Mi,"forEach",Oi)}catch(e){Mi.forEach=Oi}}var Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function Ri(){return!("undefined"==typeof window||!window.history||!window.history.pushState)}function xi(e,t,n){this.root=null,this._routes=[],this._useHash=t,this._hash=void 0===n?"#":n,this._paused=!1,this._destroyed=!1,this._lastRouteResolved=null,this._notFoundHandler=null,this._defaultHandler=null,this._usePushState=!t&&Ri(),this._onLocationChange=this._onLocationChange.bind(this),this._genericHooks=null,this._historyAPIUpdateMethod="pushState",e?this.root=t?e.replace(/\/$/,"/"+this._hash):e.replace(/\/$/,""):t&&(this.root=this._cLoc().split(this._hash)[0].replace(/\/$/,"/"+this._hash)),this._listen(),this.updatePageLinks()}function ki(e){return e instanceof RegExp?e:e.replace(/\/+$/,"").replace(/^\/+/,"^/")}function Pi(e,t){return 0===t.length?null:e?e.slice(1,e.length).reduce((function(e,n,r){return null===e&&(e={}),e[t[r]]=decodeURIComponent(n),e}),null):null}function Ai(e){var t=[];return{regexp:e instanceof RegExp?e:new RegExp(e.replace(xi.PARAMETER_REGEXP,(function(e,n,r){return t.push(r),xi.REPLACE_VARIABLE_REGEXP})).replace(xi.WILDCARD_REGEXP,xi.REPLACE_WILDCARD)+xi.FOLLOWED_BY_SLASH_REGEXP,xi.MATCH_REGEXP_FLAGS),paramNames:t}}function Di(e){return e.replace(/\/$/,"").split("/").length}function Fi(e,t){return Di(t)-Di(e)}function Ui(e,t){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return t.map((function(t){var n=Ai(ki(t.route)),r=n.regexp,a=n.paramNames,o=e.replace(/^\/+/,"/").match(r),i=Pi(o,a);return!!o&&{match:o,route:t,params:i}})).filter((function(e){return e}))}(e,t)[0]||!1}function Ji(e,t){var n=t.map((function(t){return""===t.route||"*"===t.route?e:e.split(new RegExp(t.route+"($|/)"))[0]})),r=ki(e);return n.length>1?n.reduce((function(e,t){return e.length>t.length&&(e=t),e}),n[0]):1===n.length?n[0]:r}function Yi(e,t,n){var r,a=function(e){return e.split(/\?(.*)?$/)[0]};return void 0===n&&(n="#"),Ri()&&!t?a(e).split(n)[0]:(r=e.split(n)).length>1?a(r[1]):a(r[0])}function ji(e,t,n){if(t&&"object"===(void 0===t?"undefined":Hi(t))){if(t.before)return void t.before((function(){var r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];r&&(e(),t.after&&t.after(n))}),n);if(t.after)return e(),void(t.after&&t.after(n))}e()}xi.prototype={helpers:{match:Ui,root:Ji,clean:ki,getOnlyURL:Yi},navigate:function(e,t){var n;return e=e||"",this._usePushState?(n=(n=(t?"":this._getRoot()+"/")+e.replace(/^\/+/,"/")).replace(/([^:])(\/{2,})/g,"$1/"),history[this._historyAPIUpdateMethod]({},"",n),this.resolve()):"undefined"!=typeof window&&(e=e.replace(new RegExp("^"+this._hash),""),window.location.href=window.location.href.replace(/#$/,"").replace(new RegExp(this._hash+".*$"),"")+this._hash+e),this},on:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if("function"==typeof n[0])this._defaultHandler={handler:n[0],hooks:n[1]};else if(n.length>=2)if("/"===n[0]){var a=n[1];"object"===Hi(n[1])&&(a=n[1].uses),this._defaultHandler={handler:a,hooks:n[2]}}else this._add(n[0],n[1],n[2]);else if("object"===Hi(n[0])){var o=Object.keys(n[0]).sort(Fi);o.forEach((function(t){e.on(t,n[0][t])}))}return this},off:function(e){return null!==this._defaultHandler&&e===this._defaultHandler.handler?this._defaultHandler=null:null!==this._notFoundHandler&&e===this._notFoundHandler.handler&&(this._notFoundHandler=null),this._routes=this._routes.reduce((function(t,n){return n.handler!==e&&t.push(n),t}),[]),this},notFound:function(e,t){return this._notFoundHandler={handler:e,hooks:t},this},resolve:function(e){var t,n,r=this,a=(e||this._cLoc()).replace(this._getRoot(),"");this._useHash&&(a=a.replace(new RegExp("^/"+this._hash),"/"));var o=function(e){return e.split(/\?(.*)?$/).slice(1).join("")}(e||this._cLoc()),i=Yi(a,this._useHash,this._hash);return!this._paused&&(this._lastRouteResolved&&i===this._lastRouteResolved.url&&o===this._lastRouteResolved.query?(this._lastRouteResolved.hooks&&this._lastRouteResolved.hooks.already&&this._lastRouteResolved.hooks.already(this._lastRouteResolved.params),!1):(n=Ui(i,this._routes))?(this._callLeave(),this._lastRouteResolved={url:i,query:o,hooks:n.route.hooks,params:n.params,name:n.route.name},t=n.route.handler,ji((function(){ji((function(){n.route.route instanceof RegExp?t.apply(void 0,n.match.slice(1,n.match.length)):t(n.params,o)}),n.route.hooks,n.params,r._genericHooks)}),this._genericHooks,n.params),n):this._defaultHandler&&(""===i||"/"===i||i===this._hash||function(e,t,n){if(Ri()&&!t)return!1;if(!e.match(n))return!1;var r=e.split(n);return r.length<2||""===r[1]}(i,this._useHash,this._hash))?(ji((function(){ji((function(){r._callLeave(),r._lastRouteResolved={url:i,query:o,hooks:r._defaultHandler.hooks},r._defaultHandler.handler(o)}),r._defaultHandler.hooks)}),this._genericHooks),!0):(this._notFoundHandler&&ji((function(){ji((function(){r._callLeave(),r._lastRouteResolved={url:i,query:o,hooks:r._notFoundHandler.hooks},r._notFoundHandler.handler(o)}),r._notFoundHandler.hooks)}),this._genericHooks),!1))},destroy:function(){this._routes=[],this._destroyed=!0,this._lastRouteResolved=null,this._genericHooks=null,clearTimeout(this._listeningInterval),"undefined"!=typeof window&&(window.removeEventListener("popstate",this._onLocationChange),window.removeEventListener("hashchange",this._onLocationChange))},updatePageLinks:function(){var e=this;"undefined"!=typeof document&&this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(n){if((n.ctrlKey||n.metaKey)&&"a"==n.target.tagName.toLowerCase())return!1;var r=e.getLinkPath(t);e._destroyed||(n.preventDefault(),e.navigate(r.replace(/\/+$/,"").replace(/^\/+/,"/")))})),t.hasListenerAttached=!0)}))},generate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._routes.reduce((function(n,r){var a;if(r.name===e)for(a in n=r.route,t)n=n.toString().replace(":"+a,t[a]);return n}),"");return this._useHash?this._hash+n:n},link:function(e){return this._getRoot()+e},pause:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._paused=e,this._historyAPIUpdateMethod=e?"replaceState":"pushState"},resume:function(){this.pause(!1)},historyAPIUpdateMethod:function(e){return void 0===e?this._historyAPIUpdateMethod:(this._historyAPIUpdateMethod=e,e)},disableIfAPINotAvailable:function(){Ri()||this.destroy()},lastRouteResolved:function(){return this._lastRouteResolved},getLinkPath:function(e){return e.getAttribute("href")},hooks:function(e){this._genericHooks=e},_add:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"string"==typeof e&&(e=encodeURI(e)),this._routes.push("object"===(void 0===t?"undefined":Hi(t))?{route:e,handler:t.uses,name:t.as,hooks:n||t.hooks}:{route:e,handler:t,hooks:n}),this._add},_getRoot:function(){return null!==this.root||(this.root=Ji(this._cLoc().split("?")[0],this._routes)),this.root},_listen:function(){var e=this;if(this._usePushState)window.addEventListener("popstate",this._onLocationChange);else if("undefined"!=typeof window&&"onhashchange"in window)window.addEventListener("hashchange",this._onLocationChange);else{var t=this._cLoc(),n=void 0,r=void 0;(r=function(){n=e._cLoc(),t!==n&&(t=n,e.resolve()),e._listeningInterval=setTimeout(r,200)})()}},_cLoc:function(){return"undefined"!=typeof window?void 0!==window.__NAVIGO_WINDOW_LOCATION_MOCK__?window.__NAVIGO_WINDOW_LOCATION_MOCK__:ki(window.location.href):""},_findLinks:function(){return[].slice.call(document.querySelectorAll("[data-navigo]"))},_onLocationChange:function(){this.resolve()},_callLeave:function(){var e=this._lastRouteResolved;e&&e.hooks&&e.hooks.leave&&e.hooks.leave(e.params)}},xi.PARAMETER_REGEXP=/([:*])(\w+)/g,xi.WILDCARD_REGEXP=/\*/g,xi.REPLACE_VARIABLE_REGEXP="([^/]+)",xi.REPLACE_WILDCARD="(?:.*)",xi.FOLLOWED_BY_SLASH_REGEXP="(?:/$|$)",xi.MATCH_REGEXP_FLAGS="";var Ki=function(e){c(r,xi);var t=p(r);function r(){return n(this,r),t.apply(this,arguments)}return a(r,[{key:"updatePageLinks",value:function(){var e=this;if("undefined"!=typeof document){var t=document.createElement("a");t.href=this.root;var n=t.pathname;this._findLinks().forEach((function(t){t.hasListenerAttached||(t.addEventListener("click",(function(r){if((r.ctrlKey||r.metaKey)&&"a"==r.target.tagName.toLowerCase())return!1;if(!e._destroyed){var a=t.pathname.replace(n,"");r.preventDefault(),e.navigate(a)}})),t.hasListenerAttached=!0)}))}}}]),r}(),Vi=we.indexOf,Xi=[].indexOf,Gi=!!Xi&&1/[1].indexOf(1,-0)<0,Bi=Do("indexOf"),Qi=Vo("indexOf",{ACCESSORS:!0,1:0});It({target:"Array",proto:!0,forced:Gi||!Bi||!Qi},{indexOf:function(e){return Gi?Xi.apply(this,arguments)||0:Vi(this,e,arguments.length>1?arguments[1]:void 0)}});var Wi=cr("slice"),qi=Vo("slice",{ACCESSORS:!0,0:0,1:2}),Zi=Se("species"),$i=[].slice,zi=Math.max;It({target:"Array",proto:!0,forced:!Wi||!qi},{slice:function(e,t){var n,r,a,o=A(this),i=ge(o.length),s=Ee(e,i),c=Ee(void 0===t?i:t,i);if(Ln(o)&&("function"!=typeof(n=o.constructor)||n!==Array&&!Ln(n.prototype)?V(n)&&null===(n=n[Zi])&&(n=void 0):n=void 0,n===Array||void 0===n))return $i.call(o,s,c);for(r=new(void 0===n?Array:n)(zi(c-s,0)),a=0;s<c;s++,a++)s in o&&tr(r,a,o[s]);return r.length=a,r}});var es=cr("splice"),ts=Vo("splice",{ACCESSORS:!0,0:0,1:2}),ns=Math.max,rs=Math.min;It({target:"Array",proto:!0,forced:!es||!ts},{splice:function(e,t){var n,r,a,o,i,s,c=Mt(this),l=ge(c.length),u=Ee(e,l),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=l-u):(n=d-2,r=rs(ns(me(t),0),l-u)),l+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(a=Mn(c,r),o=0;o<r;o++)(i=u+o)in c&&tr(a,o,c[i]);if(a.length=r,n<r){for(o=u;o<l-r;o++)s=o+n,(i=o+r)in c?c[s]=c[i]:delete c[s];for(o=l;o>l-r+n;o--)delete c[o-1]}else if(n>r)for(o=l-r;o>u;o--)s=o+n-1,(i=o+r-1)in c?c[s]=c[i]:delete c[s];for(o=0;o<n;o++)c[o+u]=arguments[o+2];return c.length=l-r+n,a}});var as=z.f,os=Nt.f,is=lt.set,ss=Se("match"),cs=j.RegExp,ls=cs.prototype,us=/a/g,ds=/a/g,hs=new cs(us)!==us,fs=Ua.UNSUPPORTED_Y;if(K&&Ot("RegExp",!hs||fs||M((function(){return ds[ss]=!1,cs(us)!=us||cs(ds)==ds||"/a/i"!=cs(us,"i")})))){for(var vs=function(e,t){var n,r=this instanceof vs,a=$o(e),o=void 0===t;if(!r&&a&&e.constructor===vs&&o)return e;hs?a&&!o&&(e=e.source):e instanceof vs&&(o&&(t=Ra.call(e)),e=e.source),fs&&(n=!!t&&t.indexOf("y")>-1)&&(t=t.replace(/y/g,""));var i=Cn(hs?new cs(e,t):cs(e,t),r?this:ls,vs);return fs&&n&&is(i,{sticky:n}),i},Ss=function(e){e in vs||as(vs,e,{configurable:!0,get:function(){return cs[e]},set:function(t){cs[e]=t}})},ps=os(cs),Ns=0;ps.length>Ns;)Ss(ps[Ns++]);ls.constructor=vs,vs.prototype=ls,St(j,"RegExp",vs)}mr("RegExp");var ms=function(){function e(){if(n(this,e),o(this,"minimumRankSort",null),o(this,"requireExtantDDbRecords",!1),o(this,"skipJunk",!0),!No.rawTaxa&&(No.rawTaxa=BsbiDb.TaxonNames,!No.rawTaxa))throw new Error("Taxon list has failed to load in TaxonSearch")}return a(e,[{key:"lookup",value:function(t){var n,r,a,o,i={};if(r=e.normaliseTaxonName(decodeURIComponent(t).trim()).replace(/\s+x$/i,""),o=/ x\b/.test(r),""!==r){var s=r.match(e.abbreviatedGenusRegex);if(s){var c,l;for(var u in"X"===s[2]||"x"===s[2]?l=c=new RegExp("^(X\\s|X[a-z]+\\s+)(x )?\\b".concat(e.generate_hybrid_combinations_regex(s[3]),".*"),"i"):(c=new RegExp("^(X )?".concat(e.escapeRegExp(s[2]),"[a-z]+ (x )?.*\\b").concat(e.generate_hybrid_combinations_regex(s[3]),".*"),"i"),l=new RegExp("^(X )?".concat(e.escapeRegExp(s[2]),"[a-z]+ (x )?\\b").concat(e.generate_hybrid_combinations_regex(s[3]),".*"),"i")),No.rawTaxa){var d=No.rawTaxa[u];a=0===d[e.canonicalColumn]?d[e.nameStringColumn]:d[e.canonicalColumn],(c.test(a)||""!==d[e.hybridCanonicalColumn]&&c.test(d[e.hybridCanonicalColumn]))&&(i[u]={exact:d[e.nameStringColumn]===r,near:l.test(d[e.nameStringColumn])})}n=this.compile_results(i,o)}else{var h,f,v=e.escapeRegExp(r);-1!==r.indexOf(" ")?(h="".concat(e.escapeRegExp(r.substr(0,r.indexOf(" ")))," (x )?.*\\b").concat(e.generate_hybrid_combinations_regex(r.substr(r.indexOf(" ")+1)),".*"),f=new RegExp("^(?:Xs+)?".concat(e.escapeRegExp(r.substr(0,r.indexOf(" ")))," (x )?\\b").concat(e.generate_hybrid_combinations_regex(r.substr(r.indexOf(" ")+1)),".*"),"i")):(h="".concat(v,".*"),f=new RegExp("^".concat(v,".*")));var S="^".concat(v,".*"),p=new RegExp("^(?:Xs+)?".concat(h),"i");if(e.showVernacular){var N=new RegExp(S,"i");for(var m in No.rawTaxa){var y=No.rawTaxa[m];a=0===y[e.canonicalColumn]?y[e.nameStringColumn]:y[e.canonicalColumn],p.test(y[e.nameStringColumn])||a!==y[e.nameStringColumn]&&p.test(a)?i[m]={exact:y[e.nameStringColumn]===r,near:f.test(y[e.nameStringColumn])||f.test(a)}:(N.test(y[e.vernacularColumn])||N.test(y[e.vernacularRootColumn]))&&(i[m]={exact:y[e.vernacularColumn]===r,vernacular:!0})}if((n=this.compile_results(i,o)).length<5){var g=new RegExp("\\b".concat(v,".*"),"i");for(var T in No.rawTaxa)if(!i.hasOwnProperty(T)){var b=No.rawTaxa[T];g.test(b[e.nameStringColumn])?i[T]={exact:b[e.nameStringColumn]===r}:(0!==b[e.canonicalColumn]&&g.test(b[e.canonicalColumn])||g.test(b[e.vernacularColumn]))&&(i[T]={exact:b[e.nameStringColumn]===r,vernacular:!0})}n=this.compile_results(i,o)}}else{for(var E in No.rawTaxa){var _=No.rawTaxa[E];a=0===_[e.canonicalColumn]?_[e.nameStringColumn]:_[e.canonicalColumn],(p.test(_[e.nameStringColumn])||a!==_[e.nameStringColumn]&&p.test(a))&&(i[E]={exact:_[e.nameStringColumn]===r})}n=this.compile_results(i,o)}}}else n=[];return n}},{key:"compile_results",value:function(t,n){var r=[];for(var a in t)if(t.hasOwnProperty(a)){var o=No.rawTaxa[a];if((!this.requireExtantDDbRecords||this.requireExtantDDbRecords&&1===o[e.usedColumn])&&(!this.minimumRankSort||this.minimumRankSort>0&&o[e.minRankColumn]>=this.minimumRankSort)){var i=o[e.nameStringColumn]+(o[e.qualifierColumn]?" ".concat(o[e.qualifierColumn]):""),s={entityId:a,vernacular:o[e.vernacularColumn],qname:i,name:i,qualifier:o[e.qualifierColumn],authority:o[e.authorityColumn],uname:o[e.nameStringColumn],vernacularMatched:t[a].hasOwnProperty("vernacular"),exact:t[a].hasOwnProperty("exact")&&t[a].exact,near:t[a].hasOwnProperty("near")&&t[a].near};if(s.formatted=e.formatter(s),o[e.acceptedEntityIdColumn]){var c=No.rawTaxa[o[e.acceptedEntityIdColumn]];if(!c)throw No.rawTaxa?new Error("Failed to find taxon for accepted entity id ".concat(o[e.acceptedEntityIdColumn])):new Error("Taxon.rawTaxa set is undefined, when trying to find taxon for accepted entity id ".concat(o[e.acceptedEntityIdColumn]));s.acceptedEntityId=o[e.acceptedEntityIdColumn],s.acceptedNameString=c[e.nameStringColumn],s.acceptedQualifier=c[e.qualifierColumn],s.acceptedAuthority=c[e.authorityColumn]}r.push(s)}}return r.length&&(r.sort((function(e,t){if(e.exact)return t.exact?e.acceptedEntityId?1:0:-1;if(t.exact)return 1;if(e.near){if(!t.near)return-1}else if(t.near)return 1;var r=null!==e.uname.match(/\bx\b/i),a=null!==t.uname.match(/\bx\b/i);if(r)return a?e.uname===t.uname?e.acceptedEntityId?1:0:e.qname<t.qname?-1:1:n?-1:1;if(a)return n?1:-1;if(e.uname===t.uname){if(!e.acceptedEntityId&&!t.acceptedEntityId||e.acceptedEntityId&&t.acceptedEntityId){var o=["s.s.","",null,"s.l.","agg."].indexOf(e.qualifier),i=["s.s.","",null,"s.l.","agg."].indexOf(t.qualifier);return o===i?0:o<i?1:-1}return e.acceptedEntityId?1:-1}return e.uname<t.uname?-1:1})),r.length>e.MAXIMUM_RESULTS&&(r.length=e.MAXIMUM_RESULTS)),r}}],[{key:"formatter",value:function(t){return e.showVernacular?t.vernacularMatched?t.acceptedEntityId?"<q><b>".concat(t.vernacular,'</b></q> <span class="italictaxon">').concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")+' = <span class="italictaxon">'.concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):"<q><b>".concat(t.vernacular,'</b></q> <span class="italictaxon">').concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>"):t.acceptedEntityId?'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>").concat(t.vernacular?" <q><b>".concat(t.vernacular,"</b></q>"):"",' = <span class="italictaxon">').concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>").concat(t.vernacular?" <q><b>".concat(t.vernacular,"</b></q>"):""):t.acceptedEntityId?'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")+' = <span class="italictaxon">'.concat(t.acceptedNameString).concat(t.acceptedQualifier?" <b>".concat(t.acceptedQualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.acceptedAuthority,"</span>"):'<span class="italictaxon">'.concat(t.uname).concat(t.qualifier?" <b>".concat(t.qualifier,"</b>"):"",'</span> <span class="taxauthority">').concat(t.authority,"</span>")}},{key:"normaliseTaxonName",value:function(t){for(var n=0,r=e.taxonRankNameSearchRegex.length;n<r;n++)t=t.replace(e.taxonRankNameSearchRegex[n],e.taxonRankNameReplacement[n]);for(var a=0,o=e.taxonQualifierSearchRegex.length;a<o;a++)t=t.replace(e.taxonQualifierSearchRegex[a],e.taxonQualifierReplacement[a]);return t}},{key:"escapeRegExp",value:function(t){return t.replace(e.cleanRegex,"\\$&")}},{key:"generate_hybrid_combinations_regex",value:function(t){var n=e.escapeRegExp(t).split(/\s+x\s+/i);if(n.length<2)return n[0];var r=[];return function e(t,n){if(0===t.length)r[r.length]=n.join("[a-zA-Z]* x ");else for(var a=t.length-1;a>=0;--a){var o=t.slice(0),i=n.slice(0);i.unshift(o.splice(a,1)[0]),e(o,i)}}(n,[]),"(?:".concat(r.join("|"),")")}}]),e}();o(ms,"showVernacular",!0),o(ms,"MIN_SEARCH_LENGTH",2),o(ms,"MAXIMUM_RESULTS",25),o(ms,"abbreviatedGenusRegex",/^(X\s+)?([a-z])[.\s]+(.*?)$/i),o(ms,"nameStringColumn",0),o(ms,"canonicalColumn",1),o(ms,"hybridCanonicalColumn",2),o(ms,"acceptedEntityIdColumn",3),o(ms,"qualifierColumn",4),o(ms,"authorityColumn",5),o(ms,"vernacularColumn",6),o(ms,"vernacularRootColumn",7),o(ms,"usedColumn",8),o(ms,"minRankColumn",9),o(ms,"taxonRankNameSearchRegex",[/\s+sub-?g(?:en(?:us)?)?[.\s]+/i,/\s+sect(?:ion)?[.\s]+/i,/\s+subsect(?:ion)?[.\s]+/i,/\s+ser(?:ies)?[.\s]+/i,/\s+gp[.\s]+/i,/\s+s(?:ub)?-?sp(?:ecies)?[.\s]+/i,/\s+morphotype\s+/i,/\s+var[.\s]+/i,/\s+cv[.\s]+/i,/\s+n(?:otho)?v(?:ar)?[.\s]+/i,/\s+f[.\s]+|\s+forma?\s+/i,/\s+n(?:otho)?ssp[.\s]+/i]),o(ms,"taxonRankNameReplacement",[" subg. "," sect. "," subsect. "," ser. "," group "," subsp. "," morph. "," var. "," cv. "," nothovar. "," f. "," nothosubsp. "]),o(ms,"cleanRankNamesRegex",/\s(subfam\.|subg\.|sect\.|subsect\.|ser\.|subser\.|subsp\.|nothosubsp\.|microsp\.|praesp\.|agsp\.|race|convar\.|nm\.|microgene|f\.|subvar\.|var\.|nothovar\.|cv\.|sublusus|taxon|morph\.|group|sp\.)\s/),o(ms,"taxonQualifierSearchRegex",[/\s*\(?\bf\s*x\s*m or m\s*x\s*f\)?\s*$/i,/\s*\(?\bm\s*x\s*f or f\s*x\s*m\)?\s*$/i,/\s*\(?\bf\s*x\s*m\)?\s*$/i,/\s*\(?\bm\s*x\s*f\)?\s*$/i,/\s*\(?\bfemale\s*x\s*male\)?\s*$/i,/\s*\(?\bmale\s*x\s*female\)?\s*$/i,/\s*'male'\s*$/i,/\s*'female'\s*$/i,/\b\s*sens\.?\s*lat[.\s]+/i,/\b\s*s\.\s*lat\.?\s*\b/i,/\b\s*s\.?\s*l\.?\s+\b/i,/\b\s*sensu\s*lato\s+\b|\(\s*sensu\s*lato\s*\)/i,/\b\s*sensu\s*stricto\s+\b|\(\s*sensu\s*stricto\s*\)/i,/\b\s*sens\.?\s*strict[.\s]+/i,/\b\s*sens\.?\s*str\.?\s*(?=\))|\b\s*sens\.?\s*str[.\s]+/i,/\b\s*s\.\s*str[.\s]+/i,/\b\s*s\.?\s*s\.?\s+\b/i,/\b\s*sens\.?\s*lat\.?\s*$/i,/\b\s*s\.\s*lat\.?\s*$/i,/\b\s*s\.?\s*l\.?\s*$/i,/\b\s*sensu\s*lato\s*$/i,/\b\s*sensu\s*stricto\s*$/i,/\b\s*sens\.?\s*strict\.?\s*$/i,/\b\s*sens\.?\s*str\.?\s*$/i,/\b\s*s\.\s*str\.?\s*$/i,/\b\s*s\.?\s*s\.?\s*$/i,/\b\s*agg\.?\s*$/i,/\b\s*aggregate\s*$/i,/\b\s*sp\.?\s*cultivar\s*$/i,/\b\s*sp\.?\s*cv\.?\s*$/i,/\b\s*cultivars?\s*$/i,/\b\s*cv\s+$/i,/\b\s*cv$/i,/\b\s*cf\s*$/i,/\b\s*aff\s*$/i,/\b\s*s\.?n\.?\s*$/i,/\b\s*sp\.?\s*nov\.?\s*$/i,/\b\s*auct[.\s]*$/i,/\b\s*ined[.\s]*$/i,/\b\s*nom\.?\snud[.\s]*$/i,/\b\s*p\.p[.\s?]*$/i,/\b\s*spp?\.?[\s?]*$/i,/\b\s*species\s*$/i,/\b\s*spp?\.?\s*\(/i,/\b\s*species\s*\(/i]),o(ms,"taxonQualifierReplacement",[" "," "," (f x m)"," (m x f)"," (f x m)"," (m x f)"," male"," female"," s.l. "," s.l. "," s.l. "," s.l. "," s.s. "," s.s. "," s.s. "," s.s. "," s.s. "," s.l."," s.l."," s.l."," s.l."," s.s."," s.s."," s.s."," s.s."," s.s."," agg."," agg."," cv. "," cv. "," cv. "," cv. "," cv. "," cf."," aff."," sp.nov."," sp.nov."," auct."," ined."," nom. nud."," pro parte","",""," ("," ("]),o(ms,"cleanRegex",/[.*+?^${}()|[\]\\]/g);var ys=function(){function e(){n(this,e)}return a(e,null,[{key:"taxaLoadedEntryPoint",value:function(){for(No.rawTaxa=BsbiDb.TaxonNames;e.callbackStack.length;){var t=e.callbackStack.shift();try{t()}catch(e){console.log({"Exception after taxon load":e})}}}},{key:"onceTaxaLoaded",value:function(){return BsbiDb.hasOwnProperty("TaxonNames")?Promise.resolve():(BsbiDb.taxonNamesLoadedEntryPoint||(BsbiDb.taxonNamesLoadedEntryPoint=e.taxaLoadedEntryPoint),new Promise((function(t){e.callbackStack.push(t)})))}}]),e}();o(ys,"callbackStack",[]);var gs=z.f,Ts=Function.prototype,bs=Ts.toString,Es=/^\s*function ([^ (]*)/;K&&!("name"in Ts)&&gs(Ts,"name",{configurable:!0,get:function(){try{return bs.call(this).match(Es)[1]}catch(e){return""}}}),It({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var _s=function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),ws.set(v(a),{writable:!0,value:void 0}),Cs.set(v(a),{writable:!0,value:void 0}),o(v(a),"_value",""),o(v(a),"_inputType","date"),o(v(a),"_autocomplete",""),a._value=(new Date).toJSON().slice(0,10),e&&(e.placeholder&&(a.placeholder=e.placeholder),e.autocomplete&&(a._autocomplete=e.autocomplete)),a}return a(r,[{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(E(this,ws)).value=Co.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",_(this,Cs,e.id=Co.nextId),_(this,ws,Co.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=E(this,ws),t.textContent=this.label;var n=e.appendChild(document.createElement("input"));if(n.className="form-control",n.id=E(this,ws),n.type=this._inputType,this.placeholder&&(n.placeholder=this.placeholder),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=ho())),this.completion===Co.COMPLETION_COMPULSORY&&(n.required=!0),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(E(this,ws));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got date field change event"),this.value=Co.cleanRawString(document.getElementById(E(this,ws)).value),this.fireEvent(Co.EVENT_CHANGE)}},{key:"value",set:function(e){this._value=void 0===e||null==e?(new Date).toJSON().slice(0,10):e.trim(),this.updateView()},get:function(){return this._value}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?po(n[e].trim()):""}}]),r}(),ws=new WeakMap,Cs=new WeakMap;On("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Kn);var Os=function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),Rs.add(v(a)),Hs.add(v(a)),Ls.set(v(a),{writable:!0,value:void 0}),Is.set(v(a),{writable:!0,value:void 0}),Ms.set(v(a),{writable:!0,value:void 0}),o(v(a),"parentForm",void 0),o(v(a),"_value",{images:[]}),o(v(a),"includeCamera",!0),o(v(a),"placeholder",""),e&&(e.hasOwnProperty("includeCamera")&&(a.includeCamera=e.includeCamera),e.placeholder&&(a.placeholder=e.placeholder)),a}return a(r,[{key:"updateView",value:function(){if(this._fieldEl){var e,t=[],n=b(this._value.images);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push('<picture style="cursor: pointer;" data-imageid="'.concat(r.id,'"><source srcset="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=webp" type="image/webp"><img data-imageid="').concat(r.id,'" src="/image.php?imageid=').concat(r.id,'&amp;height=128&amp;format=jpeg" height="128" alt="photo"></picture>'))}}catch(e){n.e(e)}finally{n.f()}document.getElementById(E(this,Ms)).innerHTML=t.join("\n")}}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",_(this,Is,e.id=Co.nextId),_(this,Ls,Co.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=E(this,Ls),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="input-group";var r=document.createElement("div");r.className="custom-file",n.appendChild(r);var a=r.appendChild(document.createElement("input"));if(a.type="file",a.className="custom-file-input",a.id=E(this,Ls),a.accept="image/png, image/jpeg",a.multiple=!0,this.placeholder){var o=r.appendChild(document.createElement("label"));o.className="custom-file-label",o.htmlFor=E(this,Ls),o.textContent=this.placeholder}if(this.includeCamera){var i=document.createElement("div");i.className="input-group-append";var s=i.appendChild(document.createElement("span"));s.className="input-group-text";var c=s.appendChild(document.createElement("label"));c.className="pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0 material-icons";var l=c.appendChild(document.createElement("i"));l.className="material-icons pl-0 pr-0 ml-0 mr-0 mt-0 mb-0 pt-0 pb-0",l.textContent="add_a_photo";var u=c.appendChild(document.createElement("input"));u.type="file",u.capture="environment",u.accept="image/*",u.style.display="none",u.id=Co.nextId,n.appendChild(i),u.addEventListener("change",this.inputChangeHandler.bind(this,u.id))}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);var d=e.appendChild(document.createElement("p"));if(_(this,Ms,d.id=Co.nextId),d.addEventListener("click",this.imageClickHandler.bind(this)),this.validationMessage){var h=e.appendChild(document.createElement("div"));h.className="invalid-feedback",h.innerHTML=this.validationMessage}a.addEventListener("change",this.inputChangeHandler.bind(this,a.id)),this._fieldEl=e,this.parentForm.addListener("deleteimage",this.deleteImageHandler.bind(this))}},{key:"deleteImageHandler",value:function(e){var t;for(var n in console.log("delete image ".concat(e.imageId)),this._value.images)if(this._value.images.hasOwnProperty(n)&&this._value.images[n].id===e.imageId){t=this._value.images.splice(n,1)[0];break}t?(this.updateView(),this.fireEvent(Co.EVENT_CHANGE)):console.log("Failed to find image id ".concat(e.imageId))}},{key:"imageClickHandler",value:function(e){var t=e.target.closest("picture");t||(t=e.target.closest("img")),console.log({"clicked image":t});var n=t.getAttribute("data-imageid");n&&(document.getElementById("imagemodal").getElementsByTagName("picture")[0].innerHTML='<source srcset="/image.php?imageid='.concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=webp" type="image/webp">\n                <img src="/image.php?imageid=').concat(n,"&amp;width=").concat(window.innerWidth,'&amp;format=jpeg" width="auto" style="max-height: 48vh; max-width: 100%;" alt="photo">'),document.getElementById("imagemodaldelete").setAttribute("data-imageid",n),$("#".concat("imagemodal")).modal({}))}},{key:"inputChangeHandler",value:function(e,t){var n=this;t.stopPropagation(),console.log("got image field input change event");var r=document.getElementById(e);r.files.length?O(this,Hs,xs).call(this,r.files).then((function(){n.fireEvent(Co.EVENT_CHANGE)})):this.fireEvent(Co.EVENT_CHANGE)}},{key:"value",set:function(e){if(this._value={images:[]},e){var t,n=b(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;ci.imageCache.has(r)?this._value.images.push(ci.imageCache.get(r)):(console.log("Creating placeholder image object '".concat(r,"'")),this._value.images.push(ci.placeholder(r)))}}catch(e){n.e(e)}finally{n.f()}}this.updateView()},get:function(){var e=[];if(this._value&&this._value.images){var t,n=b(this._value.images);try{for(n.s();!(t=n.n()).done;){var r=t.value;e[e.length]=r.id}}catch(e){n.e(e)}finally{n.f()}}return e}}],[{key:"isEmpty",value:function(e){return!e||0===e.length}},{key:"licenseModal",value:function(){var e=document.createElement("div");return e.innerHTML='<div class="modal fade" id="'.concat(r.LICENSE_MODAL,'" tabindex="-1" role="dialog" aria-labelledby="').concat(r.LICENSE_MODAL,'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat(r.LICENSE_MODAL,'Title">Image licensing</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>By choosing to submit images with your Garden Wildflower Hunt records you agree to license the image under the terms of the Creative Common Attribution 4.0 International license (CC BY 4.0).</p>\n        <p>The following is a summary of (and not a substitute for) the <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">license</a>.</p>\n        <p>Licensees are free to:</p>\n        <ul class="license-properties">\n<li>\n<strong>Share</strong> â copy and redistribute the material in any medium or format\n</li>\n<li>\n<strong>Adapt</strong> â remix, transform, and build upon the material for any purpose, even commercially.\n</li>\n</ul>\n<p>Licensees are most follow these term:</p>\n<ul>\n<li>\n<p>\n<strong>Attribution</strong> â licensees must give appropriate credit, provide a link to the license, and indicate if changes were made.\n</p>\n</li>\n</ul>\n<p>Full details of the license are here: <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank">CC BY 4.0 license</a></p>\n\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),e.firstChild}}]),r}(),Ls=new WeakMap,Is=new WeakMap,Ms=new WeakMap,Hs=new WeakSet,Rs=new WeakSet;o(Os,"LICENSE_MODAL","imagelicensemodal");var xs=function(e){this.parentForm.pingOccurrence();var t,n=[],r=b(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(ci.fromFile(a))}}catch(e){r.e(e)}finally{r.f()}return O(this,Rs,ks).call(this,n)},ks=function e(t){var n=this;if(t.length){var r=t.shift();return r.save(this.parentForm.surveyId,this.parentForm.occurrenceId,this.parentForm.projectId).then((function(e){console.log("Added image '".concat(r.id,"'")),console.log({jsonDescription:e}),n._value.images.push(r),n.updateView()}),(function(e){console.log("Failed to add image ".concat(r.id)),console.log({"Failure reason":e})})).finally((function(){return O(n,Rs,e).call(n,t)}))}return Promise.resolve()},Ps=function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),As.set(v(a),{writable:!0,value:void 0}),Ds.set(v(a),{writable:!0,value:void 0}),o(v(a),"_value",""),o(v(a),"_inputType","text"),o(v(a),"_autocomplete",""),e&&(e.type&&(a._inputType=e.type),e.placeholder&&(a.placeholder=e.placeholder),e.autocomplete&&(a._autocomplete=e.autocomplete)),a}return a(r,[{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(E(this,As)).value=Co.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",_(this,Ds,e.id=Co.nextId),_(this,As,Co.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=E(this,As),t.textContent=this.label;var n=e.appendChild(document.createElement("input"));if(n.className="form-control",n.id=E(this,As),n.type=this._inputType,this.placeholder&&(n.placeholder=this.placeholder),this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=ho())),this.completion===Co.COMPLETION_COMPULSORY&&(n.required=!0),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(E(this,As));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got input field change event"),this.value=Co.cleanRawString(document.getElementById(E(this,As)).value),this.fireEvent(Co.EVENT_CHANGE)}},{key:"value",set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()},get:function(){return this._value}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?po(n[e].trim()):""}}]),r}(),As=new WeakMap,Ds=new WeakMap;function Fs(e,t,n){if(n.length>2){var r=n.pop();return"".concat(n.join(e+" ")," ").concat(t," ").concat(r)}return n.join(" ".concat(t," "))}var Us=function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),js.add(v(a)),Js.set(v(a),{writable:!0,value:void 0}),Ys.set(v(a),{writable:!0,value:void 0}),o(v(a),"options",{}),o(v(a),"includeOtherFreeText",!0),o(v(a),"_value",{selection:[],other:null}),e&&(e.options&&(a.options=e.options),e.hasOwnProperty("includeOtherFreeText")&&(a.includeOtherFreeText=e.includeOtherFreeText)),a}return a(r,[{key:"updateView",value:function(){if(this._fieldEl){var e,t=b(document.querySelectorAll("".concat(w(r,r,Ks),"#").concat(E(this,Js),' input[type="checkbox"]')));try{for(t.s();!(e=t.n()).done;){var n=e.value,a=n.checked=this._value.selection.includes(n.name);if(n.name===r.KEY_OTHER&&E(this,Ys)){var o=document.getElementById(E(this,Ys));o.style.display=a?"block":"none",o.value=null===this._value.other?"":this._value.other.trim()}}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(w(r,r,Ks));e.className="form-group",_(this,Js,e.id=Co.nextId);var t=e.appendChild(document.createElement("label"));(t.style.display="block",t.textContent=this.label,this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);for(var n in this.options)this.options.hasOwnProperty(n)&&O(this,js,Vs).call(this,e,n,this.options[n]);if(this.validationMessage){var a=e.appendChild(document.createElement("div"));a.className="invalid-feedback",a.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,n={selection:[],other:null};E(this,Ys)&&(t=document.getElementById(E(this,Ys)));var a,o=b(document.querySelectorAll("".concat(w(r,r,Ks),"#").concat(E(this,Js),' input[type="checkbox"]:checked')));try{for(o.s();!(a=o.n()).done;){var i=a.value;n.selection[n.selection.length]=i.name,i.name===r.KEY_OTHER&&E(this,Ys)&&(n.other=Co.cleanRawInput(t),!0)}}catch(e){o.e(e)}finally{o.f()}this.value=n,this.fireEvent(Co.EVENT_CHANGE)}},{key:"value",set:function(e){this._value=e||{selection:[],other:null},this.updateView()},get:function(){return this._value}}],[{key:"summariseImpl",value:function(e,t,n){var r=t.summary,a=[];if(n[e].selection.length){var o,i=b(n[e].selection);try{for(i.s();!(o=i.n()).done;){var s=o.value;"other"===s&&n[e].other?a[a.length]="".concat(t.attributes.options[s].summary||t.attributes.options[s].label," (").concat(n[e].other,")"):a[a.length]=t.attributes.options[s].summary||t.attributes.options[s].label}}catch(e){i.e(e)}finally{i.f()}return po("".concat(r.summaryPrefix," ").concat(Fs(",","or",a)))}return""}}]),r}(),Js=new WeakMap,Ys=new WeakMap,js=new WeakSet;o(Us,"KEY_OTHER","other");var Ks={writable:!0,value:"fieldset"},Vs=function(e,t,n){var r=e.appendChild(document.createElement("div"));r.className="form-check";var a=r.appendChild(document.createElement("input"));a.type="checkbox",a.className="form-check-input",a.id=Co.nextId,a.name=t;var o=r.appendChild(document.createElement("label"));if(o.htmlFor=a.id,o.className="form-check-label",o.textContent=n.label,Us.KEY_OTHER===t&&this.includeOtherFreeText){var i=r.appendChild(document.createElement("input"));i.id=_(this,Ys,Co.nextId),i.className="form-control",i.style.display="none"}},Xs=function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),Ws.add(v(a)),Gs.set(v(a),{writable:!0,value:void 0}),Bs.set(v(a),{writable:!0,value:void 0}),Qs.set(v(a),{writable:!0,value:void 0}),o(v(a),"options",{}),o(v(a),"placeholder",""),o(v(a),"includeOtherFreeText",!0),o(v(a),"_value",{selection:[],other:null}),e&&(e.options&&(a.options=e.options),e.hasOwnProperty("includeOtherFreeText")&&(a.includeOtherFreeText=e.includeOtherFreeText),e.placeholder&&(a.placeholder=e.placeholder)),a}return a(r,[{key:"markValidity",value:function(e){var t=document.getElementById(E(this,Bs));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"updateView",value:function(){if(this._fieldEl){var e,t=b(document.querySelectorAll("select#".concat(E(this,Bs)," option")));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(""!==n.value){var r=n.selected=this._value.selection.includes(n.value);if(n.value===Us.KEY_OTHER&&E(this,Qs)){var a=document.getElementById(E(this,Qs));a.style.display=r?"block":"none",a.value=null===this._value.other?"":this._value.other.trim()}}else n.selected=0===this._value.selection.length}}catch(e){t.e(e)}finally{t.f()}}}},{key:"buildField",value:function(){if(!this.options)throw new Error("Options have not been set before call to buildField()");var e=document.createElement(w(r,r,qs));e.className="form-group",_(this,Gs,e.id=Co.nextId),_(this,Bs,Co.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=E(this,Bs),t.style.display="block",t.innerHTML=this.label;var n=document.createElement("select");(n.id=E(this,Bs),n.className="custom-select",this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);for(var a in this.placeholder&&O(this,Ws,Zs).call(this,e,n,"",{label:this.placeholder}),this.options)this.options.hasOwnProperty(a)&&O(this,Ws,Zs).call(this,e,n,a,this.options[a]);if(e.appendChild(n),this.validationMessage){var o=e.appendChild(document.createElement("div"));o.className="invalid-feedback",o.innerHTML=this.validationMessage}e.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation();var t,n={selection:[],other:null};E(this,Qs)&&(t=document.getElementById(E(this,Qs)));var r,a=b(document.querySelectorAll("select#".concat(E(this,Bs)," option:checked")));try{for(a.s();!(r=a.n()).done;){var o=r.value;""!==o.value&&(n.selection[n.selection.length]=o.value,o.name===Us.KEY_OTHER&&E(this,Qs)&&(n.other=Co.cleanRawInput(t),!0))}}catch(e){a.e(e)}finally{a.f()}this.value=n,this.fireEvent(Co.EVENT_CHANGE)}},{key:"value",set:function(e){this._value=e||{selection:[],other:null},this.updateView()},get:function(){return this._value}}],[{key:"isEmpty",value:function(e){return 0===e.selection.length||""===e.selection[0]}},{key:"summariseImpl",value:function(e,t,n){var r=t.summary,a=[];if(n[e].selection.length){var o,i=b(n[e].selection);try{for(i.s();!(o=i.n()).done;){var s=o.value;"other"===s&&n[e].other?a[a.length]="".concat(t.attributes.options[s].summary||t.attributes.options[s].label," (").concat(n[e].other,")"):a[a.length]=t.attributes.options[s].summary||t.attributes.options[s].label}}catch(e){i.e(e)}finally{i.f()}return po("".concat(r.summaryPrefix," ").concat(Fs(",","or",a)))}return""}}]),r}(),Gs=new WeakMap,Bs=new WeakMap,Qs=new WeakMap,Ws=new WeakSet,qs={writable:!0,value:"fieldset"},Zs=function(e,t,n,r){var a=t.appendChild(document.createElement("option"));if(a.value=n,a.innerText=r.label,Us.KEY_OTHER===n&&this.includeOtherFreeText){var o=e.appendChild(document.createElement("input"));o.id=_(this,Qs,Co.nextId),o.className="form-control"}},$s=xn.find,zs=!0,ec=Vo("find");"find"in[]&&Array(1).find((function(){zs=!1})),It({target:"Array",proto:!0,forced:zs||!ec},{find:function(e){return $s(this,e,arguments.length>1?arguments[1]:void 0)}}),Xe("find");var tc=Eo.start,nc=_o("trimStart"),rc=nc?function(){return tc(this)}:"".trimStart;It({target:"String",proto:!0,forced:nc},{trimStart:rc,trimLeft:rc});var ac=function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),fc.add(v(a)),o(v(a),"taxonSearch",void 0),oc.set(v(a),{writable:!0,value:void 0}),ic.set(v(a),{writable:!0,value:void 0}),sc.set(v(a),{writable:!0,value:void 0}),cc.set(v(a),{writable:!0,value:void 0}),lc.set(v(a),{writable:!0,value:null}),uc.set(v(a),{writable:!0,value:null}),dc.set(v(a),{writable:!0,value:null}),o(v(a),"_lastInputValue",""),hc.set(v(a),{writable:!0,value:[]}),o(v(a),"_value",{taxonId:"",taxonName:"",vernacularMatch:!1}),a.taxonSearch=new ms,a}return a(r,[{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(E(this,oc)).value=this._value.taxonName,this._lastInputValue=this._value.taxonName)}},{key:"markValidity",value:function(e){var t=document.getElementById(E(this,oc));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",_(this,cc,e.id=Co.nextId),_(this,oc,Co.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=E(this,oc),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="dropdown-wrapper";var r=n.appendChild(document.createElement("input"));if(r.className="form-control dropdown-input",r.id=E(this,oc),r.autocomplete="off",r.spellcheck=!1,this.validationMessage){var a=n.appendChild(document.createElement("div"));a.className="invalid-feedback",a.innerHTML=this.validationMessage}var o=n.appendChild(document.createElement("div"));(o.className="dropdown-list",_(this,ic,o.id=Co.nextId),_(this,sc,Co.nextId),this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);r.addEventListener("keydown",this.keydownHandler.bind(this)),r.addEventListener("input",this.inputHandler.bind(this)),r.addEventListener("change",this.inputChangeHandler.bind(this)),e.addEventListener("focusin",this.focusHandler.bind(this)),e.addEventListener("focusout",this.blurHandler.bind(this)),o.addEventListener("click",this.dropboxClickHandler.bind(this)),this._fieldEl=e}},{key:"keydownHandler",value:function(e){switch(this._lastInputValue=e.target.value.trimLeft(),e.key){case"Enter":case"ArrowUp":case"ArrowDown":e.preventDefault()}}},{key:"inputHandler",value:function(e){e.target.value.trimLeft()!==this._lastInputValue&&O(this,fc,vc).call(this,e.target)}},{key:"keyupHandler",value:function(e){!e.key||1!==e.key.length&&"Backspace"!==e.key&&"Delete"!==e.key||O(this,fc,vc).call(this,e.target)}},{key:"focusHandler",value:function(e){console.log("focused");var t=document.getElementById(E(this,ic));if(!t.classList.contains("dropdown-focused")){var n=document.getElementById(E(this,oc));O(this,fc,vc).call(this,n),t.classList.add("dropdown-focused")}}},{key:"blurHandler",value:function(e){var t=this;E(this,lc)&&(clearTimeout(E(this,lc)),_(this,lc,null)),setTimeout((function(){document.getElementById(E(t,ic)).classList.remove("dropdown-focused")}),500)}},{key:"refreshSearchResultsList",value:function(){var e=document.getElementById(E(this,ic));if(E(this,hc).length){var t,n=[],r=0,a=b(E(this,hc));try{for(a.s();!(t=a.n()).done;){var o=t.value;n[n.length]='<a class="list-group-item list-group-item-action" href="#" data-occurrenceId="'.concat(o.entityId,'" data-resultnumber="').concat(r,'">').concat(ms.formatter(o),"</a>"),++r}}catch(e){a.e(e)}finally{a.f()}e.innerHTML='<div class="list-group" id="'.concat(E(this,sc),'">').concat(n.join(""),"</div>")}else e.innerHTML="";_(this,dc,null)}},{key:"dropboxClickHandler",value:function(e){console.log("click handler"),console.log(e);var t=e.target.closest("a");if(console.log(t),E(this,uc)&&(clearTimeout(E(this,uc)),_(this,uc,null),console.log("cleared a pending change event")),t&&t.dataset.occurrenceid){e.preventDefault(),console.log("got target ".concat(t.dataset.occurrenceid));var n=E(this,hc)[t.dataset.resultnumber];this.value={taxonId:n.entityId,taxonName:n.vernacularMatched?n.vernacular:n.qname,vernacularMatch:n.vernacularMatched},this.fireEvent(Co.EVENT_CHANGE)}}},{key:"inputChangeHandler",value:function(e){var t=this;e.stopPropagation(),console.log("got taxon field input change event"),E(this,uc)&&clearTimeout(E(this,uc)),_(this,uc,setTimeout((function(){console.log("processing taxon field input change event");var e=E(t,hc).find((function(e){return e.exact}));e?(console.log("exact match"),t.value={taxonId:e.entityId,taxonName:e.vernacularMatched?e.vernacular:e.qname,vernacularMatch:e.vernacularMatched}):(console.log("no match"),t.value={taxonId:"",taxonName:document.getElementById(E(t,oc)).value.trim(),vernacularMatch:null}),console.log(t._value),t.fireEvent(Co.EVENT_CHANGE)}),500))}},{key:"value",set:function(e){var t;e&&e.taxonId?(t=No.fromId(e.taxonId),this._value={taxonId:t.id,taxonName:e.vernacularMatch?t.vernacular:t.nameString,vernacularMatch:e.vernacularMatch}):this._value={taxonId:"",taxonName:e&&e.taxonName?e.taxonName:"",vernacularMatch:null},this.updateView()},get:function(){return this._value}}],[{key:"isEmpty",value:function(e){return!e||e&&!e.taxonName}},{key:"cleanRawInput",value:function(e){return e.value.trim().replace(/\s\s+/g," ")}}]),r}(),oc=new WeakMap,ic=new WeakMap,sc=new WeakMap,cc=new WeakMap,lc=new WeakMap,uc=new WeakMap,dc=new WeakMap,hc=new WeakMap,fc=new WeakSet;o(ac,"timeoutDelay",50);var vc=function(e){var t=this,n=Co.cleanRawInput(e);E(this,lc)&&clearTimeout(E(this,lc)),n.length>=ms.MIN_SEARCH_LENGTH?_(this,lc,setTimeout((function(){_(t,hc,t.taxonSearch.lookup(Co.cleanRawInput(document.getElementById(E(t,oc))))),console.log(E(t,hc)),t.refreshSearchResultsList(),_(t,lc,null)}),ac.timeoutDelay)):(_(this,hc,[]),this.refreshSearchResultsList())},Sc=function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),pc.set(v(a),{writable:!0,value:void 0}),Nc.set(v(a),{writable:!0,value:void 0}),o(v(a),"_value",""),o(v(a),"_autocomplete",""),e&&(e.options&&(a.options=e.options),e.placeholder&&(a.placeholder=e.placeholder),e.autocomplete&&(a._autocomplete=e.autocomplete)),a}return a(r,[{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(E(this,pc)).value=Co.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",_(this,Nc,e.id=Co.nextId),_(this,pc,Co.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=E(this,pc),t.textContent=this.label;var n=e.appendChild(document.createElement("textarea"));(n.className="form-control",n.id=E(this,pc),this.helpText)&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);if(this._autocomplete&&(n.autocomplete=this._autocomplete,"off"===this._autocomplete&&(n.name=ho())),this.validationMessage){var r=e.appendChild(document.createElement("div"));r.className="invalid-feedback",r.innerHTML=this.validationMessage}n.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got text area field input change event"),this.value=Co.cleanRawString(document.getElementById(E(this,pc)).value),this.fireEvent(Co.EVENT_CHANGE)}},{key:"value",set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()},get:function(){return this._value}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?po(n[e].trim()):""}}]),r}(),pc=new WeakMap,Nc=new WeakMap,mc=function(e,t){this.lat=e,this.lng=t},yc=Math.PI/180,gc=180/Math.PI,Tc=function(e,t){this.lat=e,this.lng=t};Tc.prototype.to_WGS84=function(){var e=6377563.396,t=.00667054007,n=this.lat*yc,r=Math.sin(n),a=this.lng*yc,o=e/Math.sqrt(1-t*(r*r)),i=o*Math.cos(n)*Math.cos(a),s=o*Math.cos(n)*Math.sin(a),c=(1-t)*o*r,l=-204894e-10,u=7.28190110241429e-7,d=119748977294801e-20,h=446.448+i*(1+l)+-u*s+d*c,f=408261589226812e-20*i-124.157+s*(1+l)+-u*c,v=542.06+-d*i+u*s+c*(1+l);e=6378137,t=.00669438003;for(var S=Math.sqrt(h*h+f*f),p=Math.atan(v/(S*(1-t))),N=1;N<10;++N){var m=Math.sin(p);p=Math.atan((v+t*(e/Math.sqrt(1-t*(m*m)))*m)/S)}return new mc(gc*p,gc*Math.atan(f/h))},Tc.from_wgs84=function(e){var t=e.lat*yc,n=e.lng*yc,r=.00669438037928458,a=.0066705397616,o=20.4894*1e-6,i=6378137/Math.sqrt(1-r*Math.sin(t)*Math.sin(t)),s=(i+0)*Math.cos(t)*Math.cos(n),c=(i+0)*Math.cos(t)*Math.sin(n),l=((1-r)*i+0)*Math.sin(t),u=-.1502/3600*yc,d=-.247/3600*yc,h=-.8421/3600*yc,f=s+s*o-c*h+l*d-446.448,v=s*h+c+c*o-l*u+125.157,S=-1*s*d+c*u+l+l*o+-542.06,p=Math.atan(v/f),N=Math.sqrt(f*f+v*v),m=Math.atan(S/(N*(1-a)));i=6377563.396/Math.sqrt(1-a*(Math.sin(m)*Math.sin(m)));for(var y=1,g=0;y>.001;)g=Math.atan((S+a*i*Math.sin(m))/N),y=Math.abs(g-m),m=g;return new Tc(m*gc,p*gc)};var bc=function(){var e=function(e,t){this.lat=e,this.lng=t};return e._transform=function(t,n,r,a,o,i,s,c,l,u,d,h,f,v){var S=1e-6*v,p=r/Math.sqrt(1-a*(Math.sin(t)*Math.sin(t))),N=(p+o)*Math.cos(t)*Math.cos(n),m=(p+o)*Math.cos(t)*Math.sin(n),y=((1-a)*p+o)*Math.sin(t),g=d/3600*yc,T=h/3600*yc,b=f/3600*yc,E=N+N*S-m*b+y*T+c,_=N*b+m+m*S-y*g+l,w=-1*N*T+m*g+y+y*S+u;n=Math.atan(_/E);var C=Math.sqrt(E*E+_*_);t=Math.atan(w/(C*(1-s))),p=i/Math.sqrt(1-s*(Math.sin(t)*Math.sin(t)));for(var O=1,L=0;O>.001;)L=Math.atan((w+s*p*Math.sin(t))/C),O=Math.abs(L-t),t=L;return new e(t,n)},e._Marc=function(e,t,n,r){return e*((1+t+5/4*(t*t)+5/4*(t*t*t))*(r-n)-(3*t+t*t*3+21/8*(t*t*t))*Math.sin(r-n)*Math.cos(r+n)+(15/8*(t*t)+15/8*(t*t*t))*Math.sin(2*(r-n))*Math.cos(2*(r+n))-35/24*(t*t*t)*Math.sin(3*(r-n))*Math.cos(3*(r+n)))},e}(),Ec=function(){var e=function(e,t){this.lat=e,this.lng=t};return e.from_wgs84=function(t){var n=t.lat*yc,r=t.lng*yc,a=bc._transform(n,r,6378137,.00669438037928458,0,6378388,.0067226700223333,83.901,98.127,118.635,0,0,0,0);return new e(a.lat*gc,a.lng*gc)},e}(),_c=function(e,t){this.lat=e,this.lng=t};_c.prototype.to_WGS84=function(){var e=bc._transform(this.lat*yc,this.lng*yc,6377340.189,.00667054015,0,6378137,.00669438037928458,482.53,-130.596,564.557,-1.042,-.214,-.631,-8.15);return new mc(e.lat*gc,e.lng*gc)},_c.from_wgs84=function(e){var t=e.lat*yc,n=e.lng*yc,r=bc._transform(t,n,6378137,.00669438037928458,0,6377340.189,.00667054015,-482.53,130.596,-564.557,1.042,.214,.631,8.15);return new _c(r.lat*gc,r.lng*gc)};var wc=function(){};wc.tetradLetters="ABCDEFGHIJKLMNPQRSTUVWXYZ",wc.tetradLettersRowFirst="AFKQVBGLRWCHMSXDINTYEJPUZ",wc.from_latlng=function(e,t){if(t>=-8.74&&e>49.88){var n=new Tc.from_wgs84(new mc(e,t)).to_os_coords();if(n.x>=0&&n.is_gb_hectad())return n}if(t<-5.3&&e>51.34&&t>-11&&e<55.73){var r=new _c.from_wgs84(new mc(e,t)).to_os_coords();return r.x<0||r.y<0?null:r}var a=new Ec.from_wgs84(new mc(e,t)).to_os_coords();return a.x>=5e5&&a.x<6e5&&a.y>=54e5&&a.y<56e5?a:null},wc.calculate_tetrad=function(e,t){return e>=0&&t>=0?wc.tetradLetters.charAt(5*Math.floor(e%1e4/2e3)+Math.floor(t%1e4/2e3)):""},wc.prototype.toString=function(){return this.x+","+this.y};var Cc=function(e,t,n,r){var a="00000"+Math.floor(t),o="00000"+Math.floor(n);if(2e3===r)return e+a.charAt(a.length-5)+o.charAt(o.length-5)+wc.calculate_tetrad(t,n);if(1e5===r)return e;5e3===r&&(r=1e4);var i=Math.round(Math.log10(r));return e+(i?a.slice(-5,-i)+o.slice(-5,-i):a.slice(-5)+o.slice(-5))},Oc=function(e,t){this.x=e,this.y=t};(Oc.prototype=new wc).constructor=Oc,Oc.prototype.country="CI",Oc.prototype.to_latLng=function(){var e=.0067226700223333,t=6375836.6448,n=6354369.181221601,r=this.x-5e5,a=Lc(this.y,0,t,0,.0016863406508729017,n),o=t/Math.sqrt(1-e*(Math.sin(a)*Math.sin(a))),i=o*(1-e)/(1-e*Math.sin(a)*Math.sin(a)),s=o/i-1,c=Math.tan(a)*Math.tan(a),l=Math.pow(Math.tan(a),4),u=Math.pow(Math.tan(a),6),d=Math.pow(Math.cos(a),-1),h=Math.tan(a)/(2*i*o),f=Math.tan(a)/(24*i*(o*o*o))*(5+3*c+s-9*s*c),v=Math.tan(a)/(720*i*Math.pow(o,5))*(61+90*c+45*l),S=a-r*r*h+Math.pow(r,4)*f-Math.pow(r,6)*v,p=Math.pow(Math.cos(a),-1)/o,N=d/(o*o*o*6)*(o/i+2*c),m=d/(120*Math.pow(o,5))*(5+28*c+24*l),y=d/(5040*Math.pow(o,7))*(61+662*c+1320*l+720*u),g=r*p-.0523598775598-r*r*r*N+Math.pow(r,5)*m-Math.pow(r,7)*y,T=Oc.convert_to_wgs(S,g);return new mc(T.lat*gc,T.lng*gc)};var Lc=function(e,t,n,r,a,o){for(var i=(e-t)/n+r,s=Oc.marc(o,a,r,i),c=(e-t-s)/n+i,l=0;Math.abs(e-t-s)>1e-5&&l<20;)l+=1,c=(e-t-s)/n+i,s=bc._Marc(o,a,r,c),i=c;return c};Oc.prototype.to_gridref=function(e){return this.y>=55e5?Cc("WA",this.x-5e5,this.y-55e5,e||1):this.y<55e5?Cc("WV",this.x-5e5,this.y-54e5,e||1):null},Oc.prototype.to_hectad=function(){return this.y>55e5?"WA"+this.x.toString().substring(1,2)+this.y.toString().substring(2,3):this.y<55e5?"WV"+this.x.toString().substring(1,2)+this.y.toString().substring(2,3):null};var Ic=function(e,t){this.x=e,this.y=t};(Ic.prototype=new wc).constructor=Ic,Ic.prototype.country="GB",Ic.gbHectads="SV80SV81SV90SV91SW32SW33SW42SW43SW44SW52SW53SW54SW61SW62SW63SW64SW65SW71SW72SW73SW74SW75SW76SW81SW82SW83SW84SW85SW86SW87SW95SW96SW97SS10SS11SS20SS21SS30SW83SW84SW85SW93SW94SW95SW96SW97SW98SX03SX04SX05SX06SX07SX08SX09SX14SX15SX16SX17SX18SX19SX25SX26SX27SX28SX29SX35SX36SX37SX38SX39SX44SX45SX46SX47SS70SS80SS81SS90SS91ST00ST01ST10ST11ST20ST21ST30SX37SX44SX45SX46SX47SX48SX54SX55SX56SX57SX58SX63SX64SX65SX66SX67SX68SX69SX73SX74SX75SX76SX77SX78SX79SX83SX84SX85SX86SX87SX88SX89SX94SX95SX96SX97SX98SX99SY07SY08SY09SY18SY19SY28SY29SY38SY39SS14SS20SS21SS22SS30SS31SS32SS40SS41SS42SS43SS44SS50SS51SS52SS53SS54SS60SS61SS62SS63SS64SS70SS71SS72SS73SS74SS75SS80SS81SS82SS83SS91SS92ST01ST02SX28SX29SX37SX38SX39SX48SX49SX58SX59SX68SX69SX79SS73SS74SS82SS83SS84SS92SS93SS94ST01ST02ST03ST04ST11ST12ST13ST14ST20ST21ST22ST23ST24ST25ST30ST31ST32ST33ST34ST40ST41ST42ST50ST51ST52ST61ST62ST71ST72ST24ST25ST26ST32ST33ST34ST35ST36ST37ST42ST43ST44ST45ST46ST47ST52ST53ST54ST55ST56ST57ST62ST63ST64ST65ST66ST67ST72ST73ST74ST75ST76ST77ST83ST84ST85ST86SP00SP10ST76ST77ST85ST86ST87ST88ST89ST96ST97ST98ST99SU06SU07SU08SU09SU16SU17SU18SU19SU26SU27SU28SU29SU36SU37ST73ST74ST75ST76ST82ST83ST84ST85ST86ST91ST92ST93ST94ST95ST96SU01SU02SU03SU04SU05SU06SU11SU12SU13SU14SU15SU16SU21SU22SU23SU24SU25SU26SU31SU32SU34SU35SU36ST20ST30ST40ST50ST51ST60ST61ST70ST71ST72ST73ST80ST81ST82ST83ST90ST91ST92SU00SU01SU02SU10SU11SY39SY48SY49SY58SY59SY66SY67SY68SY69SY77SY78SY79SY87SY88SY89SY97SY98SY99SZ07SZ08SZ09SZ28SZ38SZ39SZ47SZ48SZ49SZ57SZ58SZ59SZ68SZ69SU00SU01SU02SU10SU11SU12SU20SU21SU22SU23SU30SU31SU32SU33SU40SU41SU42SU43SU50SU51SU52SU60SU61SU62SU70SU71SU72SZ08SZ09SZ19SZ29SZ38SZ39SZ49SZ59SZ69SZ79SU23SU24SU25SU33SU34SU35SU36SU42SU43SU44SU45SU46SU52SU53SU54SU55SU56SU62SU63SU64SU65SU66SU72SU73SU74SU75SU76SU82SU83SU84SU85SU86SU70SU71SU72SU80SU81SU82SU83SU90SU91SU92SU93SZ79SZ89SZ99TQ00TQ01TQ02TQ03TQ10TQ11TQ12TQ13TQ20TQ21TQ22TQ23TQ30TQ31TQ32TQ20TQ21TQ22TQ23TQ30TQ31TQ32TQ33TQ40TQ41TQ42TQ43TQ44TQ50TQ51TQ52TQ53TQ54TQ60TQ61TQ62TQ63TQ70TQ71TQ72TQ80TQ81TQ82TQ91TQ92TV49TV59TV69TQ65TQ72TQ73TQ74TQ75TQ76TQ77TQ82TQ83TQ84TQ85TQ86TQ87TQ91TQ92TQ93TQ94TQ95TQ96TQ97TR01TR02TR03TR04TR05TR06TR07TR12TR13TR14TR15TR16TR23TR24TR25TR26TR27TR33TR34TR35TR36TR37TR46TR47TQ35TQ36TQ37TQ38TQ43TQ44TQ45TQ46TQ47TQ48TQ53TQ54TQ55TQ56TQ57TQ58TQ63TQ64TQ65TQ66TQ67TQ72TQ73TQ74TQ75TQ76TQ77TQ78TQ87TQ88TQ97SU83SU84SU85SU86SU93SU94SU95SU96SU97TQ03TQ04TQ05TQ06TQ07TQ13TQ14TQ15TQ16TQ17TQ23TQ24TQ25TQ26TQ27TQ33TQ34TQ35TQ36TQ37TQ38TQ43TQ44TQ45TL30TL40TL50TL60TL70TL80TL90TM00TQ38TQ39TQ47TQ48TQ49TQ57TQ58TQ59TQ67TQ68TQ69TQ77TQ78TQ79TQ88TQ89TQ98TQ99TR08TR09TR19TL30TL31TL34TL40TL41TL42TL43TL44TL50TL51TL52TL53TL54TL60TL61TL62TL63TL64TL70TL71TL72TL73TL74TL80TL81TL82TL83TL84TL90TL91TL92TL93TM01TM02TM03TM11TM12TM13TM21TM22TM23TQ49SP81SP90SP91TL00TL01TL02TL10TL11TL12TL13TL20TL21TL22TL23TL24TL30TL31TL32TL33TL34TL41TL42TL43TL44TL51TL52TQ09TQ19TQ29TQ39TL20TL30TQ06TQ07TQ08TQ09TQ16TQ17TQ18TQ19TQ27TQ28TQ29TQ37TQ38TQ39SP20SP30SP40SP41SP50SU19SU26SU27SU28SU29SU36SU37SU38SU39SU46SU47SU48SU49SU56SU57SU58SU59SU66SU67SU68SU69SU76SU77SU78SU86SU87SU88SU96SU97SU98SP10SP20SP21SP22SP23SP30SP31SP32SP33SP34SP40SP41SP42SP43SP44SP45SP50SP51SP52SP53SP54SP60SP61SP62SP63SP70SU29SU39SU49SU57SU58SU59SU67SU68SU69SU77SU78SU79SP51SP53SP60SP61SP62SP63SP64SP70SP71SP72SP73SP74SP80SP81SP82SP83SP84SP85SP90SP91SP92SP93SP94SP95SU78SU79SU88SU89SU97SU98SU99TL00TL01TQ07TQ08TQ09TG40TG50TM03TM04TM05TM06TM07TM13TM14TM15TM16TM17TM23TM24TM25TM26TM27TM28TM33TM34TM35TM36TM37TM38TM39TM44TM45TM46TM47TM48TM49TM57TM58TM59TL64TL65TL66TL67TL68TL74TL75TL76TL77TL78TL83TL84TL85TL86TL87TL88TL93TL94TL95TL96TL97TL98TM03TM04TM05TM06TM07TM08TG00TG01TG02TG03TG04TG10TG11TG12TG13TG14TG20TG21TG22TG23TG24TG30TG31TG32TG33TG40TG41TG42TG50TG51TM07TM08TM09TM17TM18TM19TM27TM28TM29TM38TM39TM49TM59TF40TF41TF42TF50TF51TF52TF53TF60TF61TF62TF63TF64TF70TF71TF72TF73TF74TF80TF81TF82TF83TF84TF90TF91TF92TF93TF94TG00TG01TG02TG03TG04TL49TL59TL68TL69TL78TL79TL87TL88TL89TL98TL99TM07TM08TM09TF20TF30TF31TF40TF41TF50TL15TL19TL23TL24TL25TL26TL28TL29TL33TL34TL35TL36TL37TL38TL39TL44TL45TL46TL47TL48TL49TL54TL55TL56TL57TL58TL59TL63TL64TL65TL66TL67TL68TL69TL75TL76SP91SP92SP93SP94SP95SP96TL01TL02TL03TL04TL05TL06TL07TL11TL12TL13TL14TL15TL16TL23TL24TL25TL06TL07TL08TL09TL15TL16TL17TL18TL19TL25TL26TL27TL28TL29TL36TL37TL38TL39SK90SP43SP44SP45SP46SP53SP54SP55SP56SP57SP58SP63SP64SP65SP66SP67SP68SP73SP74SP75SP76SP77SP78SP79SP84SP85SP86SP87SP88SP89SP95SP96SP97SP98SP99TF00TF10TF20TL06TL07TL08TL09TL18TL19TL29SO70SO71SO80SO81SO82SO83SO90SO91SO92SO93SO94SP00SP01SP02SP03SP04SP10SP11SP12SP13SP14SP15SP20SP21SP22SP23SP24SP25ST99SU09SU19SU29SO50SO51SO60SO61SO62SO63SO70SO71SO72SO73SO80SO81SO82SO83SO90ST57ST58ST59ST66ST67ST68ST69ST76ST77ST78ST79ST87ST88ST89ST98ST99SO10SO11SO20SO21SO22SO23SO30SO31SO32SO40SO41SO42SO50SO51ST18ST19ST27ST28ST29ST37ST38ST39ST47ST48ST49ST58ST59SO22SO23SO24SO25SO26SO32SO33SO34SO35SO36SO37SO41SO42SO43SO44SO45SO46SO47SO51SO52SO53SO54SO55SO56SO57SO61SO62SO63SO64SO65SO66SO73SO74SO75SO76SO56SO64SO65SO66SO67SO72SO73SO74SO75SO76SO77SO78SO82SO83SO84SO85SO86SO87SO88SO93SO94SO95SO96SO97SO98SO99SP03SP04SP05SP06SP07SP08SP13SP14SP16SP17SP18SK10SK20SK30SP04SP05SP06SP07SP08SP09SP14SP15SP16SP17SP18SP19SP22SP23SP24SP25SP26SP27SP28SP29SP33SP34SP35SP36SP37SP38SP39SP44SP45SP46SP47SP48SP49SP55SP56SP57SP58SJ63SJ70SJ71SJ72SJ73SJ74SJ75SJ80SJ81SJ82SJ83SJ84SJ85SJ86SJ90SJ91SJ92SJ93SJ94SJ95SJ96SK00SK01SK02SK03SK04SK05SK06SK10SK11SK12SK13SK14SK15SK16SK20SK21SK22SO77SO78SO79SO88SO89SO98SO99SP08SP09SP19SP29SJ20SJ21SJ22SJ23SJ30SJ31SJ32SJ33SJ34SJ40SJ41SJ42SJ43SJ50SJ51SJ52SJ53SJ54SJ60SJ61SJ62SJ63SJ64SJ70SJ71SJ72SJ73SJ74SJ80SO17SO18SO27SO28SO29SO37SO38SO39SO46SO47SO48SO49SO56SO57SO58SO59SO66SO67SO68SO69SO77SO78SO79SO88SO89SN50SN60SN61SN70SN71SN80SN81SN90SO00SO01SO10SO11SS38SS39SS48SS49SS58SS59SS68SS69SS77SS78SS79SS87SS88SS89SS96SS97SS98SS99ST06ST07ST08ST09ST16ST17ST18ST19ST26ST27ST28SN70SN71SN74SN80SN81SN82SN83SN84SN85SN86SN90SN91SN92SN93SN94SN95SN96SO00SO01SO02SO03SO04SO05SO06SO10SO11SO12SO13SO14SO21SO22SO23SO24SN86SN87SN96SN97SO04SO05SO06SO07SO08SO13SO14SO15SO16SO17SO18SO24SO25SO26SO27SO36SO37SN01SN02SN10SN11SN12SN20SN21SN22SN23SN24SN30SN31SN32SN33SN34SN40SN41SN42SN43SN44SN50SN51SN52SN53SN54SN60SN61SN62SN63SN64SN65SN71SN72SN73SN74SN75SN81SN82SN83SN84SS39SS49SS59SM50SM62SM70SM71SM72SM73SM80SM81SM82SM83SM84SM90SM91SM92SM93SM94SN00SN01SN02SN03SN04SN10SN11SN12SN13SN14SN22SN23SN24SR89SR99SS09SS19SN14SN15SN24SN25SN33SN34SN35SN36SN44SN45SN46SN54SN55SN56SN57SN58SN64SN65SN66SN67SN68SN69SN74SN75SN76SN77SN78SN79SN84SN85SN86SN87SN88SN89SH70SH71SH80SH81SH90SH91SH92SJ00SJ01SJ02SJ03SJ10SJ11SJ12SJ20SJ21SJ22SJ31SN69SN78SN79SN87SN88SN89SN97SN98SN99SO07SO08SO09SO18SO19SO28SO29SO39SH50SH51SH52SH53SH54SH60SH61SH62SH63SH64SH70SH71SH72SH73SH74SH80SH81SH82SH83SH84SH91SH92SH93SH94SH95SJ03SJ04SJ05SJ13SJ14SN59SN69SN79SH12SH13SH22SH23SH24SH32SH33SH34SH43SH44SH45SH46SH53SH54SH55SH56SH57SH64SH65SH66SH67SH74SH75SH76SH77SH78SH84SH85SH86SH87SH88SH74SH75SH76SH77SH84SH85SH86SH87SH88SH94SH95SH96SH97SH98SJ02SJ03SJ04SJ05SJ06SJ07SJ08SJ12SJ13SJ14SJ15SJ16SJ17SJ22SJ23SJ24SJ25SJ26SJ33SJ34SJ35SJ43SJ44SJ45SJ53SJ54SH97SH98SJ06SJ07SJ08SJ15SJ16SJ17SJ18SJ25SJ26SJ27SJ35SJ36SJ37SH27SH28SH29SH36SH37SH38SH39SH46SH47SH48SH49SH56SH57SH58SH59SH67SH68SK81SK82SK83SK84SK85SK86SK87SK90SK91SK92SK93SK94SK95SK96SK97TF00TF01TF02TF03TF04TF05TF06TF07TF10TF11TF12TF13TF14TF15TF16TF17TF20TF21TF22TF23TF24TF25TF30TF31TF32TF33TF34TF41TF42TF43TF44TF52SE60SE70SE71SE80SE81SE82SE90SE91SE92SK78SK79SK87SK88SK89SK97SK98SK99TA00TA01TA02TA10TA11TA12TA20TA21TA30TA31TA40TF07TF08TF09TF15TF16TF17TF18TF19TF24TF25TF26TF27TF28TF29TF33TF34TF35TF36TF37TF38TF39TF43TF44TF45TF46TF47TF48TF49TF54TF55TF56TF57TF58SK20SK21SK30SK31SK32SK40SK41SK42SK43SK50SK51SK52SK60SK61SK62SK70SK71SK72SK73SK74SK80SK81SK82SK83SK84SK90SK91SP39SP48SP49SP57SP58SP59SP68SP69SP78SP79SP89SP99TF00TF01SE60SE70SK42SK43SK44SK45SK46SK52SK53SK54SK55SK56SK57SK58SK59SK62SK63SK64SK65SK66SK67SK68SK69SK72SK73SK74SK75SK76SK77SK78SK79SK84SK85SK86SK87SK88SK89SK97SJ98SJ99SK03SK06SK07SK08SK09SK11SK12SK13SK14SK15SK16SK17SK18SK19SK21SK22SK23SK24SK25SK26SK27SK28SK31SK32SK33SK34SK35SK36SK37SK38SK42SK43SK44SK45SK46SK47SK48SK53SK56SK57SD90SE00SE10SJ18SJ19SJ27SJ28SJ29SJ35SJ36SJ37SJ38SJ39SJ44SJ45SJ46SJ47SJ48SJ54SJ55SJ56SJ57SJ58SJ63SJ64SJ65SJ66SJ67SJ68SJ69SJ74SJ75SJ76SJ77SJ78SJ79SJ85SJ86SJ87SJ88SJ89SJ96SJ97SJ98SJ99SK06SK07SK08SK09SK19SD20SD21SD22SD30SD31SD32SD40SD41SD42SD50SD51SD52SD53SD60SD61SD62SD63SD70SD71SD72SD73SD74SD80SD81SD82SD83SD84SD90SD91SD92SD93SD94SJ29SJ38SJ39SJ48SJ49SJ58SJ59SJ68SJ69SJ79SJ88SJ89SJ99SD22SD23SD32SD33SD34SD35SD36SD42SD43SD44SD45SD46SD47SD52SD53SD54SD55SD56SD57SD63SD64SD65SD66SD67SD68SD73SD78SE53SE54SE62SE63SE64SE65SE72SE73SE74SE75SE76SE82SE83SE84SE85SE86SE87SE92SE93SE94SE95SE96SE97SE98TA02TA03TA04TA05TA06TA07TA08TA12TA13TA14TA15TA16TA17TA18TA21TA22TA23TA24TA26TA27TA31TA32TA33TA41TA42NZ30NZ31NZ40NZ41NZ42NZ50NZ51NZ52NZ60NZ61NZ62NZ70NZ71NZ72NZ80NZ81NZ90NZ91SE37SE38SE39SE46SE47SE48SE49SE55SE56SE57SE58SE59SE64SE65SE66SE67SE68SE69SE75SE76SE77SE78SE79SE86SE87SE88SE89SE97SE98SE99TA08TA09TA18SD84SD90SD91SD92SD93SD94SD95SE00SE01SE02SE03SE04SE10SE11SE12SE13SE14SE20SE21SE22SE23SE30SE31SE32SE33SE40SE41SE42SE50SE51SE52SE60SE61SE62SE70SE71SE72SE81SE82SK18SK19SK28SK29SK38SK39SK47SK48SK49SK57SK58SK59SK69SD54SD55SD64SD65SD66SD67SD68SD73SD74SD75SD76SD77SD78SD84SD85SD86SD87SD88SD94SD95SD96SD97SD98SE04SE05SE06SE07SE13SE14SE15SE16SE17SE23SE24SE25SE26SE27SE32SE33SE34SE35SE36SE37SE42SE43SE44SE45SE46SE52SE53SE54SE55SE56SE62SE63SE64SE65SE72NY72NY80NY81NY82NY90NY91NY92NZ00NZ01NZ02NZ10NZ11NZ20NZ21NZ30NZ31SD68SD69SD78SD79SD88SD89SD97SD98SD99SE07SE08SE09SE17SE18SE19SE27SE28SE29SE36SE37SE38SE39SE46SE47NY73NY74NY82NY83NY84NY92NY93NY94NY95NZ01NZ02NZ03NZ04NZ05NZ11NZ12NZ13NZ14NZ15NZ16NZ20NZ21NZ22NZ23NZ24NZ25NZ26NZ30NZ31NZ32NZ33NZ34NZ35NZ36NZ41NZ42NZ43NZ44NZ45NZ46NZ52NZ53NT60NT70NT80NT90NU00NU10NU20NY58NY59NY64NY65NY66NY67NY68NY69NY74NY75NY76NY77NY78NY79NY84NY85NY86NY87NY88NY89NY94NY95NY96NY97NY98NY99NZ04NZ05NZ06NZ07NZ08NZ09NZ15NZ16NZ17NZ18NZ19NZ26NZ27NZ28NZ29NZ36NZ37NZ38NZ39NT70NT71NT73NT80NT81NT82NT83NT84NT90NT91NT92NT93NT94NT95NU00NU01NU02NU03NU04NU05NU10NU11NU12NU13NU14NU20NU21NU22NU23NZ09NZ19NY20NY21NY30NY31NY40NY41NY42NY50NY51NY52NY53NY60NY61NY62NY63NY70NY71NY72NY73NY80NY81NY82NY83SD16SD17SD18SD19SD26SD27SD28SD29SD36SD37SD38SD39SD46SD47SD48SD49SD57SD58SD59SD67SD68SD69SD78SD79SD89NX90NX91NX92NX93NY00NY01NY02NY03NY04NY05NY10NY11NY12NY13NY14NY15NY16NY20NY21NY22NY23NY24NY25NY26NY31NY32NY33NY34NY35NY36NY37NY41NY42NY43NY44NY45NY46NY47NY48NY52NY53NY54NY55NY56NY57NY58NY62NY63NY64NY65NY66NY67NY68NY73NY74NY75NY84SD08SD09SD17SD18SD19SD28SD29NX30NX40SC16SC17SC26SC27SC28SC36SC37SC38SC39SC47SC48SC49NS60NS61NS70NS71NS72NS80NS81NS90NT00NT01NT10NT11NT20NT21NT30NX69NX78NX79NX88NX89NX96NX97NX98NX99NY05NY06NY07NY08NY09NY16NY17NY18NY19NY26NY27NY28NY29NY36NY37NY38NY39NY47NY48NY49NS50NS60NX36NX37NX38NX45NX46NX47NX48NX49NX54NX55NX56NX57NX58NX59NX64NX65NX66NX67NX68NX69NX74NX75NX76NX77NX78NX79NX84NX85NX86NX87NX88NX95NX96NX97NX98NY05NY06NW95NW96NW97NX03NX04NX05NX06NX07NX13NX14NX15NX16NX17NX24NX25NX26NX27NX33NX34NX35NX36NX37NX43NX44NX45NX46NS00NS10NS14NS15NS16NS20NS21NS23NS24NS25NS26NS30NS31NS32NS33NS34NS35NS36NS40NS41NS42NS43NS44NS45NS50NS51NS52NS53NS54NS55NS60NS61NS62NS63NS64NS71NS72NS73NX07NX08NX09NX17NX18NX19NX27NX28NX29NX37NX38NX39NX48NX49NX59NS16NS17NS26NS27NS35NS36NS37NS44NS45NS46NS47NS54NS55NS56NS64NS65NS66NS53NS54NS55NS56NS57NS63NS64NS65NS66NS67NS71NS72NS73NS74NS75NS76NS77NS80NS81NS82NS83NS84NS85NS86NS87NS90NS91NS92NS93NS94NS95NS96NT00NT01NT02NT03NT04NT05NT14NT01NT02NT03NT04NT05NT11NT12NT13NT14NT15NT21NT22NT23NT24NT25NT32NT33NT34NT10NT11NT20NT21NT22NT23NT30NT31NT32NT33NT34NT41NT42NT43NT44NT53NT20NT30NT31NT40NT41NT42NT43NT44NT50NT51NT52NT53NT54NT60NT61NT62NT63NT64NT70NT71NT72NT73NT74NT81NT82NT83NY39NY47NY48NY49NY58NY59NY69NT44NT45NT46NT53NT54NT55NT56NT63NT64NT65NT66NT73NT74NT75NT76NT77NT83NT84NT85NT86NT87NT94NT95NT96NT36NT37NT45NT46NT47NT48NT55NT56NT57NT58NT65NT66NT67NT68NT76NT77NS95NS96NT05NT06NT15NT16NT17NT24NT25NT26NT27NT34NT35NT36NT37NT43NT44NT45NT46NS86NS87NS95NS96NS97NS98NT06NT07NT08NT16NT17NO00NO01NO10NO11NO20NO21NO22NO30NO31NO32NO40NO41NO42NO50NO51NO52NO60NO61NS99NT08NT09NT18NT19NT28NT29NT39NT49NT59NT69NN30NN31NN40NN41NS38NS39NS47NS48NS49NS57NS58NS59NS67NS68NS69NS77NS78NS79NS86NS87NS88NS89NS97NS98NN21NN22NN30NN31NN32NN40NN41NN42NN50NN51NN52NN60NN61NN70NN71NN80NN81NN90NN91NO00NS49NS59NS69NS79NS88NS89NS98NS99NT08NT09NN22NN23NN32NN33NN34NN35NN42NN43NN44NN45NN46NN47NN51NN52NN53NN54NN55NN56NN57NN61NN62NN63NN64NN65NN66NN67NN71NN72NN73NN74NN75NN76NN77NN81NN82NN83NN84NN85NN86NN90NN91NN92NN93NN94NN95NN96NO00NO01NO02NO03NO04NO11NO12NO13NO21NN56NN57NN66NN67NN68NN76NN77NN78NN86NN87NN88NN94NN95NN96NN97NN98NO02NO03NO04NO05NO06NO07NO08NO11NO12NO13NO14NO15NO16NO17NO21NO22NO23NO24NO25NO32NO33NO34NO15NO16NO17NO23NO24NO25NO26NO27NO28NO32NO33NO34NO35NO36NO37NO38NO42NO43NO44NO45NO46NO47NO48NO53NO54NO55NO56NO57NO58NO63NO64NO65NO66NO67NO74NO75NO76NJ60NJ70NJ80NJ90NO57NO58NO66NO67NO68NO69NO76NO77NO78NO79NO86NO87NO88NO89NO99NH90NJ00NJ10NJ11NJ20NJ21NJ30NJ31NJ32NJ40NJ41NJ42NJ50NJ51NJ52NJ60NJ61NJ62NJ70NJ71NJ72NJ80NJ81NJ82NJ90NJ91NJ92NK02NN98NN99NO07NO08NO09NO17NO18NO19NO27NO28NO29NO37NO38NO39NO48NO49NO58NO59NO68NO69NO79NO89NJ31NJ32NJ33NJ34NJ42NJ43NJ44NJ52NJ53NJ54NJ55NJ62NJ63NJ64NJ65NJ72NJ73NJ74NJ75NJ76NJ82NJ83NJ84NJ85NJ86NJ92NJ93NJ94NJ95NJ96NK02NK03NK04NK05NK06NK13NK14NK15NH90NJ00NJ01NJ10NJ11NJ12NJ13NJ14NJ21NJ22NJ23NJ24NJ25NJ32NJ33NJ34NJ35NJ36NJ42NJ43NJ44NJ45NJ46NJ54NJ55NJ56NJ64NJ65NJ66NJ74NJ75NJ76NJ86NN99NH72NH81NH82NH91NH92NH93NH94NH95NH96NJ00NJ01NJ02NJ03NJ04NJ05NJ06NJ11NJ12NJ13NJ14NJ15NJ16NJ17NJ23NJ24NJ25NJ26NJ27NJ34NJ35NJ36NJ45NH01NH02NH10NH11NH12NH13NH14NH20NH21NH22NH23NH24NH30NH31NH32NH33NH34NH40NH41NH42NH43NH44NH50NH51NH52NH53NH54NH60NH61NH62NH63NH64NH70NH71NH72NH73NH74NH75NH80NH81NH82NH83NH84NH85NH90NH91NH92NH93NH94NH95NH96NJ00NJ01NN39NN46NN47NN48NN49NN56NN57NN58NN59NN67NN68NN69NN77NN78NN79NN88NN89NN98NN99NG60NG70NG71NG72NG80NG81NG82NG90NG91NH00NH01NH10NH20NH30NM46NM47NM54NM55NM56NM57NM64NM65NM66NM67NM68NM69NM74NM75NM76NM77NM78NM79NM84NM85NM86NM87NM88NM89NM95NM96NM97NM98NM99NN05NN06NN07NN08NN09NN16NN17NN18NN19NN26NN27NN28NN29NN35NN36NN37NN38NN39NN46NN47NN48NN49NN57NN58NN59NM70NM71NM72NM73NM80NM81NM82NM83NM84NM90NM91NM92NM93NM94NM95NN00NN01NN02NN03NN04NN05NN10NN11NN12NN13NN14NN15NN16NN20NN21NN22NN23NN24NN25NN26NN30NN33NN34NN35NN36NN44NN45NN46NR79NR88NR89NR96NR97NR98NR99NS06NS07NS08NS09NS16NS17NS18NS19NS28NS29NN20NN21NN30NN31NS28NS29NS37NS38NS39NS46NS47NS48NS56NS57NR82NR83NR84NR92NR93NR94NR95NR96NR97NS01NS02NS03NS04NS05NS06NS07NS15NS16NR50NR51NR60NR61NR62NR63NR64NR65NR67NR68NR70NR71NR72NR73NR74NR75NR76NR77NR78NR79NR83NR84NR85NR86NR87NR88NR89NR95NR96NM40NM60NM61NM70NM71NR15NR16NR24NR25NR26NR27NR34NR35NR36NR37NR38NR39NR44NR45NR46NR47NR48NR49NR56NR57NR58NR59NR67NR68NR69NR79NL93NL94NM04NM05NM15NM16NM21NM22NM23NM24NM25NM26NM31NM32NM33NM34NM35NM41NM42NM43NM44NM45NM51NM52NM53NM54NM55NM61NM62NM63NM64NM72NM73NG13NG14NG15NG20NG23NG24NG25NG26NG30NG31NG32NG33NG34NG35NG36NG37NG38NG40NG41NG42NG43NG44NG45NG46NG47NG50NG51NG52NG53NG54NG55NG56NG60NG61NG62NG63NG64NG65NG66NG71NG72NG82NM19NM29NM37NM38NM39NM47NM48NM49NM59NB90NB91NC00NC01NC10NC11NC20NC21NG63NG64NG65NG72NG73NG74NG75NG76NG77NG78NG79NG82NG83NG84NG85NG86NG87NG88NG89NG91NG92NG93NG94NG95NG96NG97NG98NG99NH00NH01NH02NH03NH04NH05NH06NH07NH08NH09NH10NH11NH15NH16NH17NH18NH19NH27NH28NH29NC10NC20NC21NC30NC31NC40NH02NH03NH04NH05NH06NH07NH12NH13NH14NH15NH16NH17NH19NH23NH24NH25NH26NH27NH28NH29NH34NH35NH36NH37NH38NH39NH44NH45NH46NH47NH48NH49NH54NH55NH56NH57NH58NH59NH64NH65NH66NH67NH68NH69NH75NH76NH77NH78NH86NH87NH88NH97NH98NC22NC30NC31NC32NC33NC40NC41NC42NC43NC50NC51NC52NC60NC61NC62NC63NC70NC71NC72NC73NC74NC80NC81NC82NC83NC84NC90NC91NC92NC93ND01ND02NH49NH59NH68NH69NH78NH79NH88NH89NC01NC02NC03NC10NC11NC12NC13NC14NC15NC16NC20NC21NC22NC23NC24NC25NC26NC27NC31NC32NC33NC34NC35NC36NC37NC42NC43NC44NC45NC46NC52NC53NC54NC55NC56NC62NC63NC64NC65NC66NC73NC74NC75NC76NC83NC84NC85NC86NC93NC94NC95NC96NC92NC93NC94NC95NC96ND01ND02ND03ND04ND05ND06ND07ND12ND13ND14ND15ND16ND17ND23ND24ND25ND26ND27ND33ND34ND35ND36ND37ND47HW63HW83HX62NA00NA10NA64NA74NA81NA90NA91NA92NA93NB00NB01NB02NB03NB10NB11NB12NB13NB14NB20NB21NB22NB23NB24NB30NB31NB32NB33NB34NB35NB40NB41NB42NB43NB44NB45NB46NB52NB53NB54NB55NB56NF09NF19NF56NF58NF60NF61NF66NF67NF68NF70NF71NF72NF73NF74NF75NF76NF77NF80NF81NF82NF83NF84NF85NF86NF87NF88NF89NF95NF96NF97NF98NF99NG07NG08NG09NG18NG19NG29NG49NL57NL58NL68NL69NL79HY10HY20HY21HY22HY23HY30HY31HY32HY33HY34HY35HY40HY41HY42HY43HY44HY45HY50HY51HY52HY53HY54HY55HY60HY61HY62HY63HY64HY73HY74HY75ND19ND28ND29ND38ND39ND47ND48ND49ND59HP40HP50HP51HP60HP61HT93HT94HU14HU15HU16HU24HU25HU26HU27HU28HU30HU31HU32HU33HU34HU35HU36HU37HU38HU39HU40HU41HU42HU43HU44HU45HU46HU47HU48HU49HU53HU54HU55HU56HU57HU58HU59HU66HU67HU68HU69HZ16HZ17HZ26HZ27",Ic.prototype.to_gridref=function(e){var t=this.x/1e5|0,n=this.y/1e5|0,r="";r=n<5?t<5?"S":"T":n<10?t<5?"N":"O":t<5?"H":"J";var a=65+5*(4-n%5)+t%5;a>=73&&a++;var o=String.fromCharCode(a);return Cc(r+o,this.x-1e5*t,this.y-1e5*n,e||1)},Ic.prototype.to_hectad=function(){var e=this.x/1e5|0,t=this.y/1e5|0,n=65+5*(4-t%5)+e%5;return n>=73&&n++,(t<5?e<5?"S":"T":t<10?e<5?"N":"O":e<5?"H":"J")+String.fromCharCode(n)+((this.x-1e5*e)/1e4|0)+((this.y-1e5*t)/1e4|0)},Ic.prototype.is_gb_hectad=function(){return-1!==Ic.gbHectads.indexOf(this.to_hectad())},Ic.prototype.to_latLng=function(){var e,t=4e5,n=.85521133347722,r=6377563.396,a=this.x,o=this.y,i=.0016732203289875,s=(o+1e5)/(.9996012717*r)+n;do{s+=(e=o+1e5-6353722.489*(1.0016767257674*(s-n)-.00502807228247412*Math.sin(s-n)*Math.cos(s+n)+5258157614724887e-21*Math.sin(2*(s-n))*Math.cos(2*(s+n))-35/24*i*i*i*Math.sin(3*(s-n))*Math.cos(3*(s+n))))/6375020.48098897}while(e>=.001);var c=Math.sin(s)*Math.sin(s),l=Math.tan(s)*Math.tan(s),u=1/Math.cos(s),d=.9996012717*r*Math.pow(1-.00667054007*c,-.5),h=6332495.651423464*Math.pow(1-.00667054007*c,-1.5),f=d/h-1,v=Math.tan(s)/(2*h*d),S=Math.tan(s)/(24*h*Math.pow(d,3))*(5+3*l+f-9*l*f),p=Math.tan(s)/(720*h*Math.pow(d,5))*(61+90*l+45*l*l),N=u/d,m=u/(6*d*d*d)*(d/h+2*l),y=u/(120*Math.pow(d,5))*(5+28*l+24*l*l),g=u/(5040*Math.pow(d,7))*(61+662*l+1320*l*l+720*l*l*l),T=s-v*Math.pow(a-t,2)+S*Math.pow(a-t,4)-p*Math.pow(a-t,6),b=N*(a-t)-.034906585039887-m*Math.pow(a-t,3)+y*Math.pow(a-t,5)-g*Math.pow(a-t,7);return new Tc(gc*T,gc*b).to_WGS84()};var Mc=function(){var e=function(e,t){this.x=e,this.y=t};return(e.prototype=new wc).constructor=e,e.prototype.country="IE",e.irishGrid={0:["V","Q","L","F","A"],1:["W","R","M","G","B"],2:["X","S","N","H","C"],3:["Y","T","O","J","D"]},e.prototype.to_latLng=function(){var e=6377340.189,t=.0066705402933363,n=.0016732203841521,r=this.x-2e5,a=(5929615.3530033+(this.y-25e4)/1.000035)/6366691.7742864415,o=a+.002509826623715886*Math.sin(2*a)+36745487490091978e-22*Math.sin(4*a)+151*n*n*n/96*Math.sin(6*a),i=e/Math.sqrt(1-t*Math.sin(o)*Math.sin(o)),s=Math.tan(o)*Math.tan(o),c=.0067153352074207*Math.cos(o)*Math.cos(o),l=e*(1-t)/Math.pow(1-t*Math.sin(o)*Math.sin(o),1.5),u=r/(1.000035*i),d=o-i*Math.tan(o)/l*(u*u/2-(5+3*s+10*c-4*c*c-.0604380168667863)*u*u*u*u/24+(61+90*s+298*c+45*s*s-1.6922644722700164-3*c*c)*u*u*u*u*u*u/720);d*=gc;var h=(u-(1+2*s+c)*u*u*u/6+(5-2*c+28*s-3*c*c+.0537226816593656+24*s*s)*u*u*u*u*u/120)/Math.cos(o);return new _c(d,h=h*gc-8).to_WGS84()},e.prototype.to_gridref=function(t){var n=Math.floor(this.x/1e5),r=Math.floor(this.y/1e5);return e.irishGrid[n]&&e.irishGrid[n][r]?Cc(e.irishGrid[n][r],this.x-1e5*n,this.y-1e5*r,t||1):null},e.prototype.to_hectad=function(){var t=Math.floor(this.x/1e5),n=Math.floor(this.y/1e5);return e.irishGrid[t]&&e.irishGrid[t][n]?e.irishGrid[t][n]+Math.floor(this.x%1e5/1e4)+Math.floor(this.y%1e5/1e4):""},e}(),Hc=Ic,Rc=(Tc.prototype.to_os_coords=function(){var e=this.lat*yc,t=this.lng*yc,n=.9996012717,r=.0066705397616,a=6377563.396*n,o=6356256.91*n,i=Math.sin(e)*Math.sin(e),s=a/Math.sqrt(1-r*i),c=s*(1-r)/(1-r*i),l=s/c-1,u=t- -.03490658503988659,d=s*Math.cos(e),h=Math.pow(Math.cos(e),3),f=Math.tan(e)*Math.tan(e),v=s/6*h*(s/c-f),S=Math.pow(Math.cos(e),5),p=Math.pow(Math.tan(e),4),N=s/120*S*(5-18*f+p+14*l-58*f*l),m=4e5+u*d+Math.pow(u,3)*v+Math.pow(u,5)*N,y=bc._Marc(o,.0016732202503250907,.8552113334772214,e)+-1e5,g=s/2*Math.sin(e)*Math.cos(e),T=s/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*l),b=s/720*Math.sin(e)*S*(61-58*f+p),E=y+u*u*g+Math.pow(u,4)*T+Math.pow(u,6)*b;return new Hc(Math.round(m),Math.round(E))},Mc),xc=(_c.prototype.to_os_coords=function(){var e=this.lat*yc,t=this.lng*yc,n=.00667054015,r=6377563.395906615,a=6356256.908205645,o=Math.sin(e)*Math.sin(e),i=r/Math.sqrt(1-n*o),s=i*(1-n)/(1-n*o),c=i/s-1,l=t- -.13962634015954636,u=i*Math.cos(e),d=Math.pow(Math.cos(e),3),h=Math.tan(e)*Math.tan(e),f=i/6*d*(i/s-h),v=Math.pow(Math.cos(e),5),S=Math.pow(Math.tan(e),4),p=i/120*v*(5-18*h+S+14*c-58*h*c),N=2e5+l*u+Math.pow(l,3)*f+Math.pow(l,5)*p,m=bc._Marc(a,.0016732203841520518,.9337511498169663,e)+25e4,y=i/2*Math.sin(e)*Math.cos(e),g=i/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*c),T=i/720*Math.sin(e)*v*(61-58*h+S),b=m+l*l*y+Math.pow(l,4)*g+Math.pow(l,6)*T;return new Rc(Math.round(N),Math.round(b))},Oc),kc=(Ec.prototype.to_os_coords=function(){var e=this.lat*yc,t=this.lng*yc,n=.0067226700223333,r=6375836.6448,a=6354369.181221601,o=Math.sin(e)*Math.sin(e),i=r/Math.sqrt(1-n*o),s=i*(1-n)/(1-n*o),c=i/s-1,l=t- -.0523598775598,u=i*Math.cos(e),d=Math.pow(Math.cos(e),3),h=Math.tan(e)*Math.tan(e),f=i/6*d*(i/s-h),v=Math.pow(Math.cos(e),5),S=Math.pow(Math.tan(e),4),p=i/120*v*(5-18*h+S+14*c-58*h*c),N=5e5+l*u+Math.pow(l,3)*f+Math.pow(l,5)*p,m=bc._Marc(a,.0016863406508729017,0,e)+0,y=i/2*Math.sin(e)*Math.cos(e),g=i/24*Math.sin(e)*Math.pow(Math.cos(e),3)*(5-Math.pow(Math.tan(e),2)+9*c),T=i/720*Math.sin(e)*v*(61-58*h+S),b=m+l*l*y+Math.pow(l,4)*g+Math.pow(l,6)*T;return new xc(Math.round(N),Math.round(b))},function(e){c(r,Co);var t=p(r);function r(e){var a;return n(this,r),a=t.call(this,e),Pc.set(v(a),{writable:!0,value:void 0}),Ac.set(v(a),{writable:!0,value:void 0}),o(v(a),"_value",""),o(v(a),"_inputType","text"),o(v(a),"_autocomplete",""),e&&(e.type&&(a._inputType=e.type),e.placeholder&&(a.placeholder=e.placeholder),e.autocomplete&&(a._autocomplete=e.autocomplete)),a}return a(r,[{key:"updateView",value:function(){this._fieldEl&&(document.getElementById(E(this,Pc)).value=Co.cleanRawString(this._value))}},{key:"buildField",value:function(){var e=document.createElement("div");e.className="form-group",_(this,Ac,e.id=Co.nextId),_(this,Pc,Co.nextId);var t=e.appendChild(document.createElement("label"));t.htmlFor=E(this,Pc),t.textContent=this.label;var n=e.appendChild(document.createElement("div"));n.className="input-group";var r=n.appendChild(document.createElement("input"));r.className="form-control",r.id=E(this,Pc),r.type="text",this.placeholder&&(r.placeholder=this.placeholder),this._autocomplete&&(r.autocomplete=this._autocomplete,"off"===this._autocomplete&&(r.name=ho()));var a=n.appendChild(document.createElement("span"));if(a.className="input-group-btn",navigator.geolocation){var o=a.appendChild(document.createElement("button"));o.id=Co.nextId,o.type="button",o.className="btn btn-outline-secondary btn-sm",o.title="use GPS";var i=o.appendChild(document.createElement("span"));i.className="material-icons",i.innerText="gps_not_fixed",o.addEventListener("click",this.gpsButtonClickHandler.bind(this))}if(this.completion===Co.COMPLETION_COMPULSORY&&(r.required=!0),this.validationMessage){var s=e.appendChild(document.createElement("div"));s.className="invalid-feedback",s.innerHTML=this.validationMessage}this.helpText&&(e.appendChild(document.createElement("small")).innerHTML=this.helpText);r.addEventListener("change",this.inputChangeHandler.bind(this)),this._fieldEl=e}},{key:"markValidity",value:function(e){var t=document.getElementById(E(this,Pc));null===e?t.classList.remove("is-invalid","is-valid"):(t.classList.remove(e?"is-invalid":"is-valid"),t.classList.add(e?"is-valid":"is-invalid"))}},{key:"inputChangeHandler",value:function(e){e.stopPropagation(),console.log("got input field change event"),this.value=Co.cleanRawString(document.getElementById(E(this,Pc)).value),this.fireEvent(Co.EVENT_CHANGE)}},{key:"gpsButtonClickHandler",value:function(e){var t=this;console.log("got gps button click event"),navigator.geolocation.getCurrentPosition((function(e){var n=e.coords.latitude,r=e.coords.longitude;console.log("Got GPS fix ".concat(n," , ").concat(r));var a=wc.from_latlng(n,r).to_gridref(1e3);console.log("Got grid-ref: ".concat(a)),t.value=a,t.fireEvent(Co.EVENT_CHANGE)}),(function(e){console.log("gps look-up failed"),console.log(e)}))}},{key:"value",set:function(e){this._value=void 0===e||null==e?"":e.trim(),this.updateView()},get:function(){return this._value}}],[{key:"summariseImpl",value:function(e,t,n){return""!==n[e]&&null!==n[e]&&void 0!==n[e]?po(n[e].trim()):""}}]),r}()),Pc=new WeakMap,Ac=new WeakMap,Dc=function(e){c(r,Lo);var t=p(r);function r(e){var a;if(n(this,r),o(v(a=t.call(this)),"_occurrence",void 0),o(v(a),"surveyId",""),(this instanceof r?this.constructor:void 0)===r)throw new TypeError("Cannot construct OccurrenceForm instances directly, class should be overridden.");return e&&(a.model=e),a}return a(r,[{key:"buildContentContainer",value:function(e){var t=e.appendChild(document.createElement("div"));t.className="card mt-3 ml-0 mr-0 mb-3";var n=t.appendChild(document.createElement("div"));return n.className="card-header",n.textContent=r.sectionTitle,this._formContentContainer=t.appendChild(document.createElement("div")),this._formContentContainer.className="card-body",this._formContentContainer}},{key:"initialiseFormFields",value:function(){var e=r.properties;for(var t in this.fields={},e)e.hasOwnProperty(t)&&(this.fields[t]=new e[t].field(e[t].attributes))}},{key:"updateModelFromContent",value:function(){for(var e in console.log("updating occurrence from OccurrenceForm content"),this.fields)if(this.fields.hasOwnProperty(e)){var t=this.fields[e];this._occurrence.attributes[e]=t.value}console.log({occurrence:this._occurrence})}},{key:"changeHandler",value:function(e){console.log("occurrence form change event"),console.log({event:e}),this.fireEvent(Lo.CHANGE_EVENT,{form:this})}},{key:"pingOccurrence",value:function(){this._occurrence.unsaved()&&this.fireEvent(Lo.CHANGE_EVENT,{form:this})}},{key:"destructor",value:function(){this._occurrence=null,N(l(r.prototype),"destructor",this).call(this)}},{key:"getFormSectionProperties",value:function(){return r.properties}},{key:"formElement",get:function(){var e=arguments,t=N(l(r.prototype),"formElement",this);return this._formFieldsBuilt||(this.buildFormFields(),t.addEventListener("change",(function(){console.log("occurrence form change event"),console.log(e)}),{capture:!1})),t}},{key:"occurrenceId",get:function(){return this._occurrence?this._occurrence.id:null}},{key:"projectId",get:function(){return this._occurrence?this._occurrence.projectId:null}},{key:"model",set:function(e){this._occurrence=e,this.populateFormContent()},get:function(){return this._occurrence}}]),r}();o(Dc,"properties",void 0),o(Dc,"sectionTitle","Occurrence form"),o(Dc,"help","Records help text, should normally be initialised with an imported html template");var Fc=function e(){n(this,e)};o(Fc,"sectionTitle",void 0),o(Fc,"sectionSortOrder",void 0),o(Fc,"sectionNavigationKey",void 0),o(Fc,"help",""),o(Fc,"properties",void 0);var Uc=function(e){c(i,ai);var r=p(i);function i(){var e;n(this,i);for(var t=arguments.length,a=new Array(t),s=0;s<t;s++)a[s]=arguments[s];return e=r.call.apply(r,[this].concat(a)),el.add(v(e)),zc.add(v(e)),$c.add(v(e)),Zc.add(v(e)),qc.add(v(e)),Wc.add(v(e)),Qc.add(v(e)),Bc.add(v(e)),Gc.add(v(e)),Xc.add(v(e)),Vc.add(v(e)),Kc.add(v(e)),o(v(e),"controller",void 0),Jc.set(v(e),{writable:!0,value:{}}),Yc.set(v(e),{writable:!0,value:void 0}),jc.set(v(e),{writable:!0,value:{}}),o(v(e),"panelKey",""),o(v(e),"OCCURRENCES_ARE_LAST_SECTION",!0),o(v(e),"occurrenceSummaryText","Placeholder occurrence summary text in MainView.js"),o(v(e),"welcomeContent","Placeholder welcome text in MainView.js"),o(v(e),"defaultRightHandSideHelp","Default right-hand side help text in MainView.js"),e}return a(i,[{key:"initialise",value:function(){this.controller.app.addListener(li.EVENT_OCCURRENCE_ADDED,this.occurrenceAddedHandler.bind(this))}},{key:"setLayout",value:function(){var e=this;document.getElementById("body").innerHTML='\r\n<div class="container-fluid">\r\n    <div class="row" style="height: 90vh;">\r\n        <div class="col d-md-block pr-md-0 pt-3" id="col1panel" style="overflow-y: auto; max-height: calc(100vh - 5rem);">\r\n        </div>\r\n        <div class="col d-md-none pl-0 pr-0" id="ctrlpanel" style="background-color: aliceblue; width: 28px; max-width: 28px; overflow-y: hidden; ">\r\n            <button class="navbar-light navbar-toggler pl-0 pr-0" type="button" aria-label="Back" id="right-panel-back">\r\n                <i class="material-icons-round" style="color: gray;">view_list</i>\r\n            </button>\r\n        </div>\r\n        <div class="col d-md-block pr-md-0" id="col2panel" style="overflow-y: auto; height: 100%;">\r\n        </div>\r\n    </div>\r\n</div>\r\n',document.getElementById("right-panel-back").addEventListener("click",(function(t){t.stopPropagation(),t.preventDefault(),e.fireEvent(ko.EVENT_BACK)}))}},{key:"refreshLeftPanelAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat(this.leftPanelAccordionId,' div[data-parent="#').concat(this.leftPanelAccordionId,'"].collapse'));e=this.controller.viewSubcontext?"record"===this.controller.viewSubcontext?"record":this.controller.surveySection:"";var n,r=b(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.getAttribute("data-sectionkey")===e?a.classList.add("show"):a.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}this._refreshOccurrenceAccordionState()}},{key:"_refreshOccurrenceAccordionState",value:function(){var e,t=document.querySelectorAll("div#".concat("occurrencelistcontainer",' div[data-parent="#').concat("occurrencelistcontainer",'"].collapse')),n=this.controller.currentOccurrenceId,r=b(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;a.getAttribute("data-occurrenceid")===n?a.classList.add("show"):a.classList.remove("show")}}catch(e){r.e(e)}finally{r.f()}}},{key:"display",value:function(){if(this.controller.needsFullRefresh?(console.log("Full refresh triggered."),this.setLayout(),O(this,Bc,ol).call(this)):this.refreshLeftPanelAccordionState(),this.controller.needRightPanelRefresh)switch(this.controller.viewSubcontext){case"record":O(this,Vc,nl).call(this);break;case"survey":O(this,Kc,tl).call(this);break;default:O(this,Xc,rl).call(this)}this.setResponsivePanel(""===this.panelKey?"left":"right")}},{key:"refreshOccurrenceFooterControls",value:function(e){var n=this,r=e.appendChild(document.createElement("div")),a=r.appendChild(document.createElement("button"));if(a.className="btn btn-secondary btn-md-lg mt-2 mb-3 mr-2",a.type="button",a.textContent="back to list",a.setAttribute("data-buttonaction","back"),this.occurrenceIsMostRecent(this.controller.currentOccurrence)){var o=r.appendChild(document.createElement("button"));o.className="btn btn-primary btn-md-lg mt-2 mb-3 mr-2",o.type="button",o.textContent="add another",o.setAttribute("data-buttonaction","new")}if(this.OCCURRENCES_ARE_LAST_SECTION){var i=r.appendChild(document.createElement("button"));i.className="btn btn-primary btn-md-lg mt-2 mb-3",i.type="button",i.textContent="finish",i.setAttribute("data-buttonaction","finish")}else{var s=ii.sections[1],c=r.appendChild(document.createElement("button"));c.className="btn btn-primary btn-md-lg mt-2 mb-3",c.type="button",c.textContent="next Â»",c.setAttribute("data-buttonaction","next"),c.title=s.sectionTitle}r.addEventListener("click",(function(e){var r=e.target.closest("button");if(r&&r.hasAttribute("data-buttonaction"))switch(r.getAttribute("data-buttonaction")){case"new":n.fireEvent(ko.EVENT_NEW_RECORD);break;case"back":n.controller.app.router.navigate("/list/record/");break;case"finish":n.controller.app.router.navigate("/list/record/"),t("#".concat("finishmodal")).modal();break;case"next":n.controller.app.router.navigate("/list/survey/".concat(nextSection.sectionNavigationKey));break;default:throw new Error("Unrecognised button action ".concat(r.getAttribute("data-buttonaction")))}}))}},{key:"occurrenceIsMostRecent",value:function(e){var t,n=b(this.controller.occurrences.entries());try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r[1].createdStamp>e.createdStamp&&!r[1].deleted)return!1}}catch(e){n.e(e)}finally{n.f()}return!0}},{key:"newButtonClickHandler",value:function(e){e.preventDefault(),e.stopPropagation(),this.fireEvent(ko.EVENT_NEW_RECORD)}},{key:"occurrenceAddedHandler",value:function(e){var t=document.getElementById("occurrencelistcontainer");if(t){var n=this.controller.occurrences.get(e.occurrenceId),r=document.createElement("div");r.className="card",r.id="card_".concat(n.id),r.innerHTML=O(this,el,hl).call(this,n),E(this,jc)[n.id]=n.addListener(Ro.EVENT_MODIFIED,this.occurrenceChangeHandler.bind(this),{occurrenceId:n.id}),t.insertBefore(r,t.firstChild)}}},{key:"refreshOccurrenceValiditySummary",value:function(e){var t=document.getElementById("card_".concat(e.id));t&&(e.evaluateCompletionStatus(Dc.properties).requiredFieldsPresent?t.classList.remove("is-invalid"):t.classList.add("is-invalid"))}},{key:"occurrenceChangeHandler",value:function(e){var t=this.controller.occurrences.get(e.occurrenceId),n=document.getElementById("card_".concat(e.occurrenceId));n&&(t.deleted?(n.parentElement.removeChild(n),E(this,jc)[e.occurrenceId]&&(t.removeListener(Ro.EVENT_MODIFIED,E(this,jc)[e.occurrenceId]),E(this,jc)[e.occurrenceId]=null)):(n.innerHTML=O(this,el,hl).call(this,t),this.refreshOccurrenceValiditySummary(t)))}},{key:"occurrenceSummaryBodyHTML",value:function(e){var t="";for(var n in e.attributes)if(e.attributes.hasOwnProperty(n)&&Dc.properties.hasOwnProperty(n)&&!Dc.properties[n].field.isEmpty(e.attributes[n])){var r=Dc.properties[n].field.summarise(n,Dc.properties[n],e.attributes);r&&(t+='<p class="ellipsed-line mb-0">'.concat(r,"</p>"))}return li.devMode&&(t+='<p class="mb-0">(<i>id '.concat(e.id,"</i>)</p>")),t}},{key:"occurrenceSummaryHeadingHTML",value:function(e){var t="";if(e.attributes.hasOwnProperty("images")&&e.attributes.images.length){var n=e.attributes.images[0];t+=ci.imageLink(n,48,48,{className:"mr-1"})}return e.attributes.taxon&&e.attributes.taxon.taxonId?t+=e.taxon.formattedHTML(e.attributes.taxon.vernacularMatch):e.attributes.taxon&&e.attributes.taxon.taxonName?t+=po(e.attributes.taxon.taxonName):t+="<span>(unnamed plant)</span>",t}},{key:"setResponsivePanel",value:function(e){var t=document.getElementById("col2panel"),n=document.getElementById("col1panel"),r=document.getElementById("ctrlpanel");switch(e){case"left":n.classList.remove("d-none"),n.classList.add("d-block"),t.classList.remove("d-block"),t.classList.add("d-none"),r.classList.remove("d-md-none"),r.classList.add("d-none");break;case"right":n.classList.remove("d-block"),n.classList.add("d-none"),t.classList.remove("d-none"),t.classList.add("d-block"),r.classList.remove("d-none"),r.classList.add("d-md-none");break;default:throw new Error("Unrecognised panel value '".concat(e))}}}]),i}(),Jc=new WeakMap,Yc=new WeakMap,jc=new WeakMap,Kc=new WeakSet,Vc=new WeakSet,Xc=new WeakSet,Gc=new WeakSet,Bc=new WeakSet,Qc=new WeakSet,Wc=new WeakSet,qc=new WeakSet,Zc=new WeakSet,$c=new WeakSet,zc=new WeakSet,el=new WeakSet,tl=function(){var e=document.getElementById("col2panel"),t=this.controller.surveySection,n=ii.sectionsByKey[t]?ii.sectionsByKey[t].help:"";e.innerHTML=n||("welcome"===t?this.defaultRightHandSideHelp:"<p>placeholder survey help content for '".concat(t,"'</p>"))},nl=function(){try{var e=this.controller.currentOccurrence,n=document.getElementById("col2panel");if(e){E(this,Yc)&&E(this,Yc).occurrenceId===e.id||(E(this,Yc)&&E(this,Yc).destructor(),_(this,Yc,e.setForm(new Dc(e))),E(this,Yc).surveyId=this.controller.app.currentSurvey.id,n.scrollTop=0),n.innerHTML="";var r=E(this,Yc).formElement;n.appendChild(r),E(this,Yc).populateFormContent(),this.refreshOccurrenceFooterControls(n),t("#description_".concat(e.id)).collapse("show")}else O(this,Xc,rl).call(this,Dc.help)}catch(e){console.log({error:e});var a=document.getElementById("col2panel");a?a.innerHTML="<p>".concat(e.message,"</p>"):document.body.innerHTML="<h2>Internal error</h2><p>Please report this problem:</p><p>".concat(e.message,"</p>")}},rl=function(e){document.getElementById("col2panel").innerHTML=e||this.defaultRightHandSideHelp},al=function(){for(var e in E(this,jc)){var t=this.controller.occurrences.get[e];t&&t.removeListener(Ro.EVENT_MODIFIED,E(this,jc)[e])}_(this,jc,{})};o(Uc,"NEXT_RECORDS","records"),o(Uc,"NEXT_SURVEY_SECTION","survey"),o(Uc,"NEXT_IS_FINAL","last");var ol=function(){var e=this,t=document.getElementById("col1panel").appendChild(document.createElement("div"));t.className="accordion",this.leftPanelAccordionId=t.id=Lo.nextId,O(this,qc,cl).call(this),O(this,Zc,ll).call(this,0,t,Uc.NEXT_RECORDS),O(this,$c,ul).call(this),O(this,zc,dl).call(this),t.addEventListener("click",(function(t){var n=t.target.closest("a");n&&n.hasAttribute("data-help-link")&&(t.preventDefault(),t.stopPropagation(),e.controller.app.router.navigate(n.getAttribute("data-help-link")))})),O(this,Wc,sl).call(this),O(this,Qc,il).call(this)},il=function(){var e=this,n=document.body,r='<div class="modal fade" id="'.concat("deleteoccurrencemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("deleteoccurrencemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("deleteoccurrencemodal",'Title">Delete record?</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        Please confirm that you wish to delete the record.\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Back</button>\n        <button type="button" class="btn btn-danger" data-dismiss="modal" id="').concat("deleteoccurrencemodal",'confirmed">Delete record</button>\n      </div>\n    </div>\n  </div>\n</div>'),a=document.createElement("div");a.innerHTML=r,n.appendChild(a.firstChild),t("#".concat("deleteoccurrencemodal")).on("show.bs.modal",(function(e){var n=t(e.relatedTarget);if(n&&n.data("occurrenceid")){var r=n.data("occurrenceid");document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",r)}})),document.getElementById("".concat("deleteoccurrencemodal","confirmed")).addEventListener("click",(function(t){var n=t.target.closest("button");if(n&&n.hasAttribute("data-occurrenceid")){var r=n.getAttribute("data-occurrenceid");console.log("Deleting occurrence ".concat(r,".")),e.fireEvent(ko.EVENT_DELETE_OCCURRENCE,{occurrenceId:r})}}));var o=document.createElement("div");o.innerHTML='<div class="modal fade" id="'.concat("finishmodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("finishmodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header">\n        <h5 class="modal-title" id="').concat("finishmodal",'Title">Thank you</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <p>Thank you! Your form responses have been sent. If you wish, you can continue to make changes and edit or add further records.</p>\n        <p>If you provided an email address, then we will send you a message with a link to this form, so that you can return to it later if needed.</p>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),n.appendChild(o.firstChild),n.appendChild(Os.licenseModal());var i=document.createElement("div");i.innerHTML='<div class="modal fade" id="'.concat("imagemodal",'" tabindex="-1" role="dialog" aria-labelledby="').concat("imagemodal",'Title" aria-hidden="true">\n  <div class="modal-dialog modal-dialog-centered" role="document">\n    <div class="modal-content">\n      <div class="modal-header d-none d-md-flex">\n        <h5 class="modal-title" id="').concat("imagemodal",'Title">Photo</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body" style="position: relative;">\n        <picture>\n        </picture>\n      </div>\n      <div class="modal-footer">\n        <button type="button" id="').concat("imagemodaldelete",'" class="btn btn-outline-danger delete-occurrence-button mr-3" data-toggle="modal" data-target="#').concat("deleteimagemodal",'" data-imageid=""><i class="material-icons">delete</i></button>\n        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>\n      </div>\n    </div>\n  </div>\n</div>'),n.appendChild(i.firstChild),document.getElementById("imagemodaldelete").addEventListener("click",(function(n){var r=n.target.closest("button");if(r&&r.hasAttribute("data-imageid")){var a=r.getAttribute("data-imageid");E(e,Yc).fireEvent("deleteimage",{imageId:a}),t("#".concat("imagemodal")).modal("hide")}}))},sl=function(){var e=this;t("#".concat("col1panel")).on("show.bs.collapse",(function(t){t.target.dataset.occurrenceid?(console.log({"left panel accordion show event (with occ id)":t}),e.fireEvent(ko.EVENT_SELECT_OCCURRENCE,{occurrenceId:t.target.dataset.occurrenceid})):t.target.dataset.sectionkey?(console.log({"left panel accordion show event (with section key)":t}),e.fireEvent(ko.EVENT_SELECT_SURVEY_SECTION,{sectionKey:t.target.dataset.sectionkey})):console.log({"left panel accordion show event (other)":t})})).on("hidden.bs.collapse",(function(t){if(console.log({"left panel accordion hide event":t}),t.target.dataset.occurrenceid){var n=e.controller.occurrences.get(t.target.dataset.occurrenceid);n.isNew&&!n.isPristine&&(n.isNew=!1,e.refreshOccurrenceValiditySummary(n)),e.controller.currentOccurrenceId===t.target.dataset.occurrenceid&&e.fireEvent(ko.EVENT_SELECT_OCCURRENCE,{occurrenceId:""})}else if(t.target.dataset.sectionkey)if("record"===t.target.dataset.sectionkey)"record"===e.controller.viewSubcontext&&e.fireEvent(ko.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""});else if(E(e,Jc)[t.target.dataset.sectionkey]){var r=E(e,Jc)[t.target.dataset.sectionkey].validateForm();console.log({"survey section validity":r}),e.controller.surveySection===t.target.dataset.sectionkey&&e.fireEvent(ko.EVENT_SELECT_SURVEY_SECTION,{sectionKey:""})}}))},cl=function(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createElement("button");t.className="btn btn-primary",t.type="button",t.textContent="get started Â»",t.setAttribute("data-toggle","collapse"),t.setAttribute("data-target","#survey-0-about");var n=Lo.nextId,r=document.createElement("div");r.innerHTML=this.welcomeContent,r.appendChild(t);var a=document.createElement("span");a.className="d-md-none pl-2",a.innerHTML='(<a href="/app/list/survey/welcome/help" data-navigo="list/survey/welcome/help">more info</a>)',r.appendChild(a),e.appendChild(this.card({cardId:n,cardHeadingId:Lo.nextId,collapsed:"welcome"!==this.controller.surveySection,headingButtonId:Lo.nextId,headingHTML:'<img src="/img/BSBIlong.png" alt="" style="float:right; max-width: 40%; max-height: 48px;"><div style="float: left;">Welcome</div>',buttonStyleString:"width: 100%",headingNonbuttonHTML:"",headingValidationWarningHTML:"",cardDescriptionId:"survey-welcome",parentContainerId:e.id,bodyContentElement:r,dataAttributes:{sectionkey:"welcome"}}))},ll=function(e,n,r){var a=this,o=ii.sections[e],i=new ii(o);E(this,Jc)[o.sectionNavigationKey]=i;var s=i.formElement,c=document.createElement("button");switch(c.className="btn btn-primary",c.type="button",c.textContent="next Â»",r){case Uc.NEXT_RECORDS:c.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),a.fireEvent(ko.EVENT_NEXT_TO_RECORDS)}));break;case Uc.NEXT_SURVEY_SECTION:var l=ii.sections[e+1];c.setAttribute("data-toggle","collapse"),c.setAttribute("data-target","#survey-".concat(e+1,"-").concat(l.sectionNavigationKey)),c.title=l.sectionTitle;break;case Uc.NEXT_IS_FINAL:c.textContent="finish",c.className="btn btn-primary btn-md-lg mt-2 mb-3",c.type="button",c.addEventListener("click",(function(){a.controller.app.router.navigate("/list/"),t("#".concat("finishmodal")).modal()}));break;default:throw new Error("Unrecognized next section keyword '".concat(r,"'"))}s.appendChild(c);var u=Lo.nextId;n.appendChild(this.card({cardId:u,cardHeadingId:Lo.nextId,collapsed:this.controller.surveySection!==o.sectionNavigationKey,headingButtonId:Lo.nextId,headingHTML:o.sectionTitle,headingNonbuttonHTML:'<small class="btn d-md-none" style="margin: 0; padding: 0;">(<a href="/app/list/survey/'.concat(o.sectionNavigationKey,'/help" data-help-link="/list/survey/').concat(o.sectionNavigationKey,'/help">help</a>)</small>'),headingValidationWarningHTML:"Please check the form for some missing responses.",cardDescriptionId:"survey-".concat(e,"-").concat(o.sectionNavigationKey),parentContainerId:n.id,bodyContentElement:s,dataAttributes:{sectionkey:o.sectionNavigationKey}})),this.controller.survey.registerForm(i),i.addListener(ii.EVENT_VALIDATION_STATE_CHANGE,(function(e){var t=document.getElementById(u);e.isValid?t.classList.remove("is-invalid"):t.classList.add("is-invalid")}))},ul=function(){var e=document.getElementById(this.leftPanelAccordionId),t=document.createDocumentFragment();t.appendChild(document.createElement("p")).innerHTML="".concat(this.occurrenceSummaryText,'<small class="d-block d-md-none"><a href="/app/list/record/help">(help)</a></small>');var n=t.appendChild(document.createElement("button"));n.type="button",n.className="btn btn-primary btn-lg mb-2",n.innerText="Add a plant record.",n.addEventListener("click",this.newButtonClickHandler.bind(this)),t.appendChild(document.createElement("div")).id="occurrencelistcontainer",e.appendChild(this.card({cardId:Lo.nextId,cardHeadingId:Lo.nextId,collapsed:"record"!==this.controller.viewSubcontext,headingButtonId:Lo.nextId,headingHTML:"Your plant records",cardDescriptionId:Lo.nextId,parentContainerId:e.id,bodyContentElement:t,dataAttributes:{sectionkey:"record"}}))},dl=function(){var e=document.getElementById("occurrencelistcontainer");if(!e)throw new xo("Failed to find list container.");O(this,Gc,al).call(this);var n,r=[],a=b(y(this.controller.occurrences.entries()).sort((function(e,t){return t[1].createdStamp-e[1].createdStamp})));try{for(a.s();!(n=a.n()).done;){var o=n.value[1];if(console.log("displaying '".concat(o.id,"'")),!o.deleted){var i=o.isNew||o.evaluateCompletionStatus(Dc.properties).requiredFieldsPresent;r.push('<div class="card'.concat(i?"":" is-invalid",'" id="card_').concat(o.id,'">\n    ').concat(O(this,el,hl).call(this,o),"\n</div>")),E(this,jc)[o.id]=o.addListener(Ro.EVENT_MODIFIED,this.occurrenceChangeHandler.bind(this),{occurrenceId:o.id})}}}catch(e){a.e(e)}finally{a.f()}e.className="accordion",e.innerHTML=r.join(""),e.addEventListener("click",(function(e){var n=e.target.closest("button");n&&n.hasAttribute("data-toggle")&&"modal"===n.getAttribute("data-toggle")&&(document.getElementById("".concat("deleteoccurrencemodal","confirmed")).setAttribute("data-occurrenceid",n.getAttribute("data-occurrenceid")),t(n.getAttribute("data-target")).modal(),e.preventDefault(),e.stopPropagation())}))},hl=function(e){return'<div class="card-header pointer pl-2 pr-2 pt-2 pb-2" id="heading_'.concat(e.id,'" data-toggle="collapse" data-target="#description_').concat(e.id,'">\n    <div class="float-right">\n        <button type="button" class="btn btn-outline-danger delete-occurrence-button" data-toggle="modal" data-target="#').concat("deleteoccurrencemodal",'" data-occurrenceid="').concat(e.id,'"><i class="material-icons">delete</i></button>\n    </div>\n    <h2 class="mb-0 pb-0 mt-0 pt-0 pl-0 ml-0">\n        <button class="btn btn-link').concat(this.controller.currentOccurrenceId===e.id?"":" collapsed",' pt-0 pb-0 pl-0" id="headingbutton_').concat(e.id,'" type="button" data-toggle="collapse" data-target="#description_').concat(e.id,'" aria-expanded="').concat(this.controller.currentOccurrenceId===e.id?"true":"false",'" aria-controls="description_').concat(e.id,'">\n          ').concat(this.occurrenceSummaryHeadingHTML(e),'\n        </button>\n    </h2>\n    <div class="card-invalid-feedback">\n        <small>Please check for errors or missing details.</small>\n    </div>\n</div>\n<div id="description_').concat(e.id,'" class="collapse').concat(this.controller.currentOccurrenceId===e.id?" show":"",'" aria-labelledby="heading_').concat(e.id,'" data-parent="#').concat("occurrencelistcontainer",'" data-occurrenceid="').concat(e.id,'">\n  <div class="card-body">\n    ').concat(this.occurrenceSummaryBodyHTML(e),"\n  </div>\n</div>")};export{li as App,L as AppController,Ei as BSBIServiceWorker,_s as DateField,co as EventHarness,Lo as Form,Co as FormField,Os as ImageField,Ps as InputField,xo as InternalAppError,hi as Layout,ko as MainController,Uc as MainView,vo as Model,er as NotFoundError,Ro as Occurrence,Dc as OccurrenceForm,ci as OccurrenceImage,Us as OptionsField,ai as Page,Ki as PatchedNavigo,Xs as SelectField,Ao as StaticContentController,si as Survey,ii as SurveyForm,Fc as SurveyFormSection,fi as SurveyPickerController,ys as TaxaLoadedHook,No as Taxon,So as TaxonError,ac as TaxonPickerField,ms as TaxonSearch,Sc as TextAreaField,kc as TextGeorefField};
//# sourceMappingURL=bsbiappframework.js.map
